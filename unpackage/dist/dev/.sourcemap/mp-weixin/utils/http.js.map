{"version":3,"file":"http.js","sources":["utils/http.js"],"sourcesContent":["import config from './config'\r\nimport { isLoggedIn, logout } from './auth'\r\n\r\n// é»˜è®¤è¯·æ±‚é…ç½®\r\nconst defaultOptions = {\r\n  timeout: config.timeout,\r\n  retryCount: 0,  // é»˜è®¤ä¸é‡è¯•\r\n  retryDelay: 1000,  // é‡è¯•é—´éš”1ç§’\r\n}\r\n\r\n// è§„èŒƒåŒ–å¯èƒ½çš„tokenï¼ˆæ’é™¤çº¯æ•°å­—çŠ¶æ€ç /ç©ºå€¼/å¾®ä¿¡codeï¼‰\r\nfunction normalizeTokenCandidate(candidate) {\r\n  if (typeof candidate !== 'string') {\r\n    return null;\r\n  }\r\n  const trimmed = candidate.trim();\r\n  if (!trimmed) {\r\n    return null;\r\n  }\r\n  // æ’é™¤çº¯æ•°å­—çŠ¶æ€ç ï¼ˆå¦‚ 200, 401ï¼‰\r\n  if (/^\\d+$/.test(trimmed) && trimmed.length <= 6) {\r\n    return null;\r\n  }\r\n  // æ’é™¤å¾®ä¿¡ç™»å½•codeï¼ˆé€šå¸¸ä»¥\"mock_code_\"å¼€å¤´æˆ–é•¿åº¦è¾ƒçŸ­ï¼‰\r\n  if (trimmed.startsWith('mock_code_') || trimmed.length < 20) {\r\n    // JWT tokené€šå¸¸å¾ˆé•¿ï¼ˆè‡³å°‘20ä¸ªå­—ç¬¦ï¼‰ï¼Œå¾®ä¿¡codeé€šå¸¸è¾ƒçŸ­\r\n    // ä½†ä¸ºäº†å®‰å…¨ï¼Œæˆ‘ä»¬åªæ’é™¤æ˜æ˜¾æ˜¯codeçš„æƒ…å†µ\r\n    if (trimmed.startsWith('mock_code_')) {\r\n      return null;\r\n    }\r\n    // å¦‚æœé•¿åº¦å°äº20ä¸”çœ‹èµ·æ¥åƒcodeï¼ˆå­—æ¯æ•°å­—ç»„åˆï¼Œé•¿åº¦6-32ï¼‰ï¼Œä¹Ÿæ’é™¤\r\n    if (trimmed.length < 20 && /^[A-Za-z0-9]{6,32}$/.test(trimmed) && !trimmed.includes('.')) {\r\n      // JWT tokené€šå¸¸åŒ…å«ç‚¹å·ï¼ˆ.ï¼‰ï¼Œè€Œå¾®ä¿¡codeä¸åŒ…å«\r\n      return null;\r\n    }\r\n  }\r\n  return trimmed;\r\n}\r\n\r\nfunction resolveTokenFromLoginInfo(loginInfo) {\r\n  if (!loginInfo || typeof loginInfo !== 'object') {\r\n    return null;\r\n  }\r\n  // ä¼˜å…ˆä»æ ‡å‡†tokenå­—æ®µæå–ï¼Œé¿å…ä»codeå­—æ®µæå–ï¼ˆcodeæ˜¯å¾®ä¿¡ç™»å½•å‡­è¯ï¼Œä¸æ˜¯JWT tokenï¼‰\r\n  const candidates = [\r\n    loginInfo.token,           // æ ‡å‡†tokenå­—æ®µï¼ˆæœ€ä¼˜å…ˆï¼‰\r\n    loginInfo.data?.token,     // åµŒå¥—çš„tokenå­—æ®µ\r\n    loginInfo.accessToken,     // å¤‡ç”¨tokenå­—æ®µ\r\n    loginInfo.authToken,       // å¤‡ç”¨tokenå­—æ®µ\r\n    loginInfo.rawToken,        // åŸå§‹tokenå­—æ®µ\r\n    // æ³¨æ„ï¼šä¸å†ä» code å­—æ®µæå–tokenï¼Œå› ä¸ºcodeæ˜¯å¾®ä¿¡ç™»å½•å‡­è¯ï¼Œä¸æ˜¯JWT token\r\n    // loginInfo.code,          // âŒ ç§»é™¤ï¼šè¿™æ˜¯å¾®ä¿¡ç™»å½•codeï¼Œä¸æ˜¯JWT token\r\n    // loginInfo.data?.code,    // âŒ ç§»é™¤ï¼šè¿™æ˜¯å¾®ä¿¡ç™»å½•codeï¼Œä¸æ˜¯JWT token\r\n  ];\r\n  for (const candidate of candidates) {\r\n    const normalized = normalizeTokenCandidate(candidate);\r\n    if (normalized) {\r\n      return normalized;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n// æ ‡è®°æ˜¯å¦å·²ç»å°è¯•è¿‡æ¸…é™¤æ— æ•ˆç™»å½•ä¿¡æ¯ï¼ˆé¿å…é‡å¤æ¸…é™¤ï¼‰\r\nlet hasClearedInvalidLogin = false\r\n\r\n// å¤„ç†è¯·æ±‚é”™è¯¯\r\nfunction handleRequestError(error, options = {}) {\r\n  console.error('è¯·æ±‚é”™è¯¯:', error)\r\n  \r\n  // å¼€å‘ç¯å¢ƒä¸‹æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯\r\n  if (process.env.NODE_ENV === 'development') {\r\n    console.warn('âš ï¸ å¼€å‘æ¨¡å¼ï¼šåç«¯æ¥å£æœªå°±ç»ªæˆ–ç½‘ç»œé”™è¯¯')\r\n    console.warn('âš ï¸ è¯·æ£€æŸ¥ï¼š')\r\n    console.warn('  1. åç«¯æœåŠ¡æ˜¯å¦å·²å¯åŠ¨')\r\n    console.warn('  2. è¯·æ±‚åœ°å€æ˜¯å¦æ­£ç¡®')\r\n    console.warn('  3. ç½‘ç»œæ˜¯å¦è¿é€š')\r\n  }\r\n  \r\n  // 401é”™è¯¯å¤„ç†\r\n  // ä½†æ˜¯ç™»å½•æ¥å£è¿”å›401æ—¶ä¸åº”è¯¥è°ƒç”¨handleUnauthorized\r\n  if (error.statusCode === 401) {\r\n    const urlForCheck = (options.url || '').toString();\r\n    const isLoginApi = urlForCheck.includes('/api/login/') && \r\n                       !urlForCheck.includes('/api/login/logout');\r\n    \r\n    if (!isLoginApi) {\r\n      // éç™»å½•æ¥å£çš„401é”™è¯¯ï¼Œæ­£å¸¸å¤„ç†\r\n      handleUnauthorized()\r\n      return\r\n    } else {\r\n      // ç™»å½•æ¥å£è¿”å›401ï¼Œè®°å½•é”™è¯¯ä½†ä¸è·³è½¬\r\n      console.error('âŒ [ç™»å½•æ¥å£] è¿”å›401é”™è¯¯ï¼Œå¯èƒ½æ˜¯åç«¯é…ç½®é—®é¢˜');\r\n    }\r\n  }\r\n  \r\n  // è¶…æ—¶é”™è¯¯ç‰¹æ®Šå¤„ç†\r\n  if (error.errMsg && error.errMsg.includes('timeout')) {\r\n    if (options.retryCount > 0) {\r\n      return new Promise((resolve, reject) => {\r\n        setTimeout(() => {\r\n          console.log(`è¯·æ±‚è¶…æ—¶ï¼Œ${options.retryDelay/1000}ç§’åé‡è¯•ï¼Œå‰©ä½™é‡è¯•æ¬¡æ•°ï¼š${options.retryCount-1}`)\r\n          options.retryCount--\r\n          request(options).then(resolve).catch(reject)\r\n        }, options.retryDelay)\r\n      })\r\n    }\r\n  }\r\n  \r\n  return Promise.reject(error)\r\n}\r\n\r\n// å¤„ç†æœªæˆæƒæƒ…å†µ\r\nfunction handleUnauthorized(customMessage) {\r\n  if (isLoggedIn()) {\r\n    const message = customMessage || 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•';\r\n    uni.showToast({\r\n      title: message,\r\n      icon: 'none',\r\n      duration: 2000\r\n    })\r\n    // å»¶è¿Ÿä¸€ç‚¹å†æ‰§è¡Œlogoutï¼ˆé™é»˜æ¨¡å¼ï¼Œé¿å…é‡å¤æç¤ºï¼‰ï¼Œè®©ç”¨æˆ·çœ‹åˆ°æç¤º\r\n    setTimeout(() => {\r\n      logout(true) // é™é»˜é€€å‡ºï¼Œé¿å…æ˜¾ç¤º\"å·²é€€å‡ºç™»å½•\"çš„æç¤º\r\n    }, 500);\r\n  } else {\r\n    // å¦‚æœæœªç™»å½•ï¼Œç›´æ¥è·³è½¬åˆ°ç™»å½•é¡µ\r\n    uni.reLaunch({\r\n      url: '/pages/login/index'\r\n    });\r\n  }\r\n}\r\n\r\n// å¤„ç†401é”™è¯¯çš„è¯Šæ–­é€»è¾‘ï¼ˆå¤ç”¨ä»£ç ï¼‰\r\nfunction handle401Diagnosis(res, options, responseData) {\r\n  const urlForCheck401 = options.url || '';\r\n  const isLoginApi = urlForCheck401.includes('/api/login/') && \r\n                     !urlForCheck401.includes('/api/login/logout');\r\n  \r\n  // è¯¦ç»†è®°å½•401é”™è¯¯çš„tokenè¯Šæ–­ä¿¡æ¯\r\n  console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n  console.error('ğŸ” [401é”™è¯¯è¯Šæ–­] è®¤è¯å¤±è´¥');\r\n  console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n  console.error('ğŸ“ [è¯·æ±‚URL]', options.url);\r\n  console.error('ğŸ“‹ [è¯·æ±‚æ–¹æ³•]', options.method || 'GET');\r\n  console.error('ğŸ“Š [HTTPçŠ¶æ€ç ]', res.statusCode);\r\n  console.error('ğŸ“Š [ä¸šåŠ¡çŠ¶æ€ç ]', responseData?.code || 'æ— ');\r\n  console.error('ğŸ“¦ [å“åº”æ•°æ®]', JSON.stringify(responseData || res.data, null, 2));\r\n  \r\n  // æ£€æŸ¥è¯·æ±‚å¤´ä¸­çš„Authorization\r\n  const authHeader = options.header?.['Authorization'] || options.header?.['authorization'];\r\n  if (authHeader) {\r\n    console.error('âœ… [Tokenä¼ é€’] Authorizationå¤´å·²å‘é€');\r\n    console.error('ğŸ“‹ [Authorizationå¤´é•¿åº¦]', authHeader.length, 'å­—ç¬¦');\r\n    console.error('ğŸ” [Authorizationå¤´é¢„è§ˆ]', authHeader.substring(0, 50) + '...');\r\n    console.error('ğŸ’¡ [å¯èƒ½åŸå› ] Tokenå·²è¿‡æœŸæˆ–æ— æ•ˆï¼Œéœ€è¦é‡æ–°ç™»å½•');\r\n  } else {\r\n    console.error('âŒ [Tokenä¼ é€’] Authorizationå¤´æœªå‘é€ï¼');\r\n    console.error('ğŸ’¡ [å¯èƒ½åŸå› ] Tokenæœªæ­£ç¡®æ·»åŠ åˆ°è¯·æ±‚å¤´');\r\n  }\r\n  \r\n  // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„token\r\n  const currentLoginInfo = uni.getStorageSync('login_info');\r\n  if (currentLoginInfo) {\r\n    const currentToken = resolveTokenFromLoginInfo(currentLoginInfo);\r\n    if (currentToken) {\r\n      console.error('ğŸ“¦ [æœ¬åœ°Token] Tokenå­˜åœ¨');\r\n      console.error('ğŸ“ [Tokené•¿åº¦]', currentToken.length, 'å­—ç¬¦');\r\n      console.error('ğŸ” [Tokené¢„è§ˆ]', currentToken.substring(0, 50) + '...');\r\n      console.error('ğŸ’¡ [è¯Šæ–­] Tokenå·²ä¼ é€’ä½†åç«¯è®¤ä¸ºæ— æ•ˆï¼Œå¯èƒ½åŸå› ï¼š');\r\n      console.error('   1. Tokenå·²è¿‡æœŸï¼ˆæœ€å¸¸è§ï¼‰');\r\n      console.error('   2. Tokenæ ¼å¼ä¸æ­£ç¡®');\r\n      console.error('   3. åç«¯éªŒè¯é€»è¾‘æœ‰é—®é¢˜');\r\n      console.error('   4. åç«¯æœåŠ¡é‡å¯å¯¼è‡´tokenå¤±æ•ˆ');\r\n    } else {\r\n      console.error('âŒ [æœ¬åœ°Token] Tokenä¸å­˜åœ¨æˆ–æ— æ³•è§£æ');\r\n      console.error('ğŸ’¡ [è¯Šæ–­] æœ¬åœ°å­˜å‚¨ä¸­æ²¡æœ‰æœ‰æ•ˆçš„token');\r\n    }\r\n  } else {\r\n    console.error('âŒ [æœ¬åœ°Token] ç™»å½•ä¿¡æ¯ä¸å­˜åœ¨');\r\n    console.error('ğŸ’¡ [è¯Šæ–­] æœ¬åœ°å­˜å‚¨ä¸­æ²¡æœ‰ç™»å½•ä¿¡æ¯');\r\n  }\r\n  \r\n  console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n  \r\n  if (isLoginApi) {\r\n    // ç™»å½•æ¥å£è¿”å›401ï¼Œè¯´æ˜åç«¯é…ç½®æœ‰é—®é¢˜\r\n    console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    console.error('âŒ [ä¸¥é‡é”™è¯¯] ç™»å½•æ¥å£è¿”å›401é”™è¯¯ï¼');\r\n    console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    console.error('âš ï¸ å¯èƒ½åŸå› ï¼š');\r\n    console.error('   1. åç«¯é…ç½®é”™è¯¯ï¼šç™»å½•æ¥å£è¢«é”™è¯¯åœ°é…ç½®ä¸ºéœ€è¦è®¤è¯');\r\n    console.error('   2. åç«¯Spring Securityé…ç½®é—®é¢˜ï¼š/api/login/** è·¯å¾„æœªæ­£ç¡®æ”¾è¡Œ');\r\n    console.error('   3. è¯·æ±‚å‚æ•°é”™è¯¯ï¼šcodeã€nickNameæˆ–avatarUrlç¼ºå¤±æˆ–æ ¼å¼é”™è¯¯');\r\n    console.error('   4. åç«¯æœåŠ¡å¼‚å¸¸ï¼šè®¤è¯æ‹¦æˆªå™¨è¯¯æ‹¦æˆªäº†ç™»å½•æ¥å£');\r\n    console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    console.error('ğŸ“ [è¯·æ±‚URL]', options.url);\r\n    console.error('ğŸ“‹ [è¯·æ±‚æ–¹æ³•]', options.method || 'POST');\r\n    if (options.data) {\r\n      console.error('ğŸ“¤ [è¯·æ±‚å‚æ•°]', JSON.stringify(options.data, null, 2));\r\n    }\r\n    console.error('ğŸ“¦ [å“åº”æ•°æ®]', JSON.stringify(responseData || res.data, null, 2));\r\n    console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    console.error('ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š');\r\n    console.error('   1. æ£€æŸ¥åç«¯Spring Securityé…ç½®ï¼Œç¡®ä¿ /api/login/** è·¯å¾„å·²æ”¾è¡Œ');\r\n    console.error('   2. æ£€æŸ¥åç«¯è®¤è¯æ‹¦æˆªå™¨ï¼Œç¡®ä¿ç™»å½•æ¥å£ä¸åœ¨æ‹¦æˆªèŒƒå›´å†…');\r\n    console.error('   3. æ£€æŸ¥è¯·æ±‚å‚æ•°æ˜¯å¦å®Œæ•´ä¸”æ ¼å¼æ­£ç¡®');\r\n    console.error('   4. è”ç³»åç«¯å¼€å‘äººå‘˜æ£€æŸ¥åç«¯æ—¥å¿—');\r\n    console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    \r\n    // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º\r\n    uni.showToast({\r\n      title: 'ç™»å½•å¤±è´¥ï¼šåç«¯é…ç½®é”™è¯¯',\r\n      icon: 'none',\r\n      duration: 3000\r\n    });\r\n  } else {\r\n    // éç™»å½•æ¥å£çš„401é”™è¯¯ï¼Œæ­£å¸¸å¤„ç†\r\n    handleUnauthorized();\r\n  }\r\n}\r\n\r\n// åŸºç¡€è¯·æ±‚æ–¹æ³•\r\nfunction request(options) {\r\n  // åˆå¹¶é»˜è®¤é…ç½®\r\n  options = { ...defaultOptions, ...options }\r\n  \r\n  // å¤„ç†è¯·æ±‚URL\r\n  const originalUrl = options.url\r\n  if (!options.url.startsWith('http')) {\r\n    options.url = config.baseURL + options.url\r\n  }\r\n  \r\n  // åˆ¤æ–­æ˜¯å¦ä¸ºç™»å½•æ¥å£ï¼ˆç™»å½•æ¥å£ä¸éœ€è¦tokenï¼‰\r\n  const isLoginApi = options.url.includes('/api/login/') && \r\n                     !options.url.includes('/api/login/logout')\r\n  \r\n  // åˆ¤æ–­æ˜¯å¦ä¸ºä¸€ç™¾ä»¶äº‹ç›¸å…³API\r\n  const isChallengeApi = options.url.includes('/api/challenge/')\r\n  \r\n  // æå‰åˆ¤æ–­å¼€å‘ç¯å¢ƒå’ŒURLï¼ˆç”¨äºtokenè¯Šæ–­æ—¥å¿—ï¼‰\r\n  let isDev = false;\r\n  try {\r\n    isDev = process.env.NODE_ENV === 'development' || \r\n            typeof __wxConfig !== 'undefined' ||  // å¾®ä¿¡å°ç¨‹åºå¼€å‘å·¥å…·\r\n            (typeof uni !== 'undefined' && uni.getSystemInfoSync && uni.getSystemInfoSync().platform === 'devtools'); // å¼€å‘å·¥å…·ç¯å¢ƒ\r\n  } catch (e) {\r\n    // å¦‚æœè·å–ç³»ç»Ÿä¿¡æ¯å¤±è´¥ï¼Œé»˜è®¤åˆ¤æ–­ä¸ºå¼€å‘ç¯å¢ƒï¼ˆä¿å®ˆç­–ç•¥ï¼Œç¡®ä¿æ—¥å¿—è¾“å‡ºï¼‰\r\n    isDev = process.env.NODE_ENV === 'development' || typeof __wxConfig !== 'undefined';\r\n  }\r\n  \r\n  const urlForCheck = options.url || originalUrl || '';\r\n  const isHeartWallApi = urlForCheck.includes('/api/heart-wall/') || \r\n                         urlForCheck.includes('heart-wall') ||\r\n                         urlForCheck.includes('heartwall') ||\r\n                         urlForCheck.toLowerCase().includes('heart_wall');\r\n  \r\n  // æ·»åŠ tokenï¼ˆç™»å½•æ¥å£é™¤å¤–ï¼‰\r\n  const loginInfo = uni.getStorageSync('login_info')\r\n  let token = resolveTokenFromLoginInfo(loginInfo)\r\n  \r\n  // å¦‚æœä»å…¶ä»–å­—æ®µæå–åˆ°äº†tokenï¼Œä½†loginInfo.tokenä¸å­˜åœ¨ï¼Œåˆ™å†™å›æ ‡å‡†å­—æ®µ\r\n  if (token && loginInfo && !loginInfo.token) {\r\n    loginInfo.token = token\r\n    try {\r\n      uni.setStorageSync('login_info', loginInfo)\r\n    } catch (storageError) {\r\n      console.warn('âš ï¸ å†™å›æ ‡å‡†tokenå­—æ®µå¤±è´¥:', storageError)\r\n    }\r\n  }\r\n  \r\n  // å¦‚æœtokenä¸ºç©ºï¼Œè®°å½•è¯¦ç»†æ—¥å¿—ï¼ˆç™»å½•æ¥å£é™¤å¤–ï¼‰\r\n  if (!token && !isLoginApi && process.env.NODE_ENV === 'development') {\r\n    console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    console.warn('âš ï¸ [Tokenè¯Šæ–­] æœªæ‰¾åˆ°æœ‰æ•ˆtoken');\r\n    console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    if (loginInfo) {\r\n      console.warn('ğŸ“¦ ç™»å½•ä¿¡æ¯å­˜åœ¨ï¼Œä½†tokenå­—æ®µç¼ºå¤±');\r\n      console.warn('ğŸ“¦ loginInfo.token:', loginInfo.token || 'âŒ ä¸å­˜åœ¨');\r\n      console.warn('ğŸ“¦ loginInfo.data?.token:', loginInfo.data?.token || 'âŒ ä¸å­˜åœ¨');\r\n      console.warn('ğŸ“¦ loginInfo.accessToken:', loginInfo.accessToken || 'âŒ ä¸å­˜åœ¨');\r\n      console.warn('ğŸ“¦ loginInfo.code:', loginInfo.code ? 'âš ï¸ å­˜åœ¨ï¼ˆè¿™æ˜¯å¾®ä¿¡ç™»å½•codeï¼Œä¸æ˜¯JWT tokenï¼‰' : 'âŒ ä¸å­˜åœ¨');\r\n    } else {\r\n      console.warn('ğŸ“¦ ç™»å½•ä¿¡æ¯ä¸å­˜åœ¨');\r\n    }\r\n    console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n  }\r\n  \r\n  // è°ƒè¯•ä¿¡æ¯ï¼šæ£€æŸ¥tokenæ˜¯å¦å­˜åœ¨ï¼ˆç™»å½•æ¥å£é™¤å¤–ï¼‰\r\n  if (process.env.NODE_ENV === 'development' && !isLoginApi) {\r\n    if (!token) {\r\n      console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n      console.warn('âš ï¸ [Tokenè¯Šæ–­] Tokenæœªæ‰¾åˆ°ï¼Œè¯·æ±‚å¯èƒ½å¤±è´¥');\r\n      console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n      console.warn('ğŸ“¦ å®Œæ•´ç™»å½•ä¿¡æ¯ç»“æ„:');\r\n      console.warn(JSON.stringify(loginInfo, null, 2));\r\n      console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n      console.warn('ğŸ” ç™»å½•ä¿¡æ¯å­—æ®µæ£€æŸ¥:');\r\n      if (loginInfo) {\r\n        console.warn(`   - isLoggedIn: ${loginInfo.isLoggedIn !== undefined ? loginInfo.isLoggedIn : 'âŒ ä¸å­˜åœ¨'}`);\r\n        console.warn(`   - token: ${loginInfo.token !== undefined ? (loginInfo.token ? `âœ… å­˜åœ¨ï¼Œé•¿åº¦: ${loginInfo.token.length}` : 'âŒ ä¸ºç©º') : 'âŒ ä¸å­˜åœ¨'}`);\r\n        console.warn(`   - data?.token: ${loginInfo.data?.token !== undefined ? (loginInfo.data.token ? `âœ… å­˜åœ¨ï¼Œé•¿åº¦: ${loginInfo.data.token.length}` : 'âŒ ä¸ºç©º') : 'âŒ ä¸å­˜åœ¨'}`);\r\n        console.warn(`   - accessToken: ${loginInfo.accessToken !== undefined ? (loginInfo.accessToken ? `âœ… å­˜åœ¨ï¼Œé•¿åº¦: ${loginInfo.accessToken.length}` : 'âŒ ä¸ºç©º') : 'âŒ ä¸å­˜åœ¨'}`);\r\n        if (loginInfo.code !== undefined) {\r\n          if (typeof loginInfo.code === 'string') {\r\n            console.warn(`   - code: ${loginInfo.code ? `âœ… å­—ç¬¦ä¸²ï¼Œé•¿åº¦: ${loginInfo.code.length}` : 'âŒ ä¸ºç©ºå­—ç¬¦ä¸²'}`);\r\n          } else {\r\n            console.warn(`   - code: â„¹ï¸ ç±»å‹: ${typeof loginInfo.code}, å€¼: ${loginInfo.code}`);\r\n          }\r\n        } else {\r\n          console.warn('   - code: âŒ ä¸å­˜åœ¨');\r\n        }\r\n        console.warn(`   - userInfo: ${loginInfo.userInfo !== undefined ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}`);\r\n        console.warn(`   - loginTime: ${loginInfo.loginTime !== undefined ? `âœ… å­˜åœ¨: ${loginInfo.loginTime}` : 'âŒ ä¸å­˜åœ¨'}`);\r\n      }\r\n      console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n      \r\n      if (loginInfo?.isGuest) {\r\n        console.warn('âš ï¸ æ£€æµ‹åˆ°æ¸¸å®¢ç™»å½•ï¼Œæ¸¸å®¢ç™»å½•ä¸æ”¯æŒéœ€è¦è®¤è¯çš„API')\r\n      } else if (loginInfo && loginInfo.isLoggedIn) {\r\n        console.warn('âš ï¸ ç™»å½•çŠ¶æ€ä¸ºtrueï¼Œä½†tokenç¼ºå¤±ã€‚å¯èƒ½çš„åŸå› ï¼š');\r\n        console.warn('   1. ä¹‹å‰çš„ç™»å½•ä»£ç æ²¡æœ‰æ­£ç¡®ä¿å­˜token');\r\n        console.warn('   2. ç™»å½•ä¿¡æ¯è¢«éƒ¨åˆ†è¦†ç›–æˆ–æŸå');\r\n        console.warn('   3. åç«¯è¿”å›çš„æ•°æ®ç»“æ„ä¸ç¬¦åˆé¢„æœŸ');\r\n        console.warn('ğŸ’¡ å»ºè®®ï¼šæ¸…é™¤ç™»å½•ä¿¡æ¯å¹¶é‡æ–°ç™»å½•');\r\n        \r\n        // è‡ªåŠ¨ä¿®å¤ï¼šå¦‚æœç™»å½•ä¿¡æ¯å­˜åœ¨ä½†tokenç¼ºå¤±ï¼Œæ¸…é™¤ç™»å½•ä¿¡æ¯ï¼ˆåªæ¸…é™¤ä¸€æ¬¡ï¼‰\r\n        // æ³¨æ„ï¼šè¿™é‡Œåªæ¸…é™¤ï¼Œä¸è‡ªåŠ¨è·³è½¬ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨é‡æ–°ç™»å½•\r\n        if (!hasClearedInvalidLogin && !token) {\r\n          console.warn('ğŸ”§ [è‡ªåŠ¨ä¿®å¤] æ£€æµ‹åˆ°æ— æ•ˆçš„ç™»å½•ä¿¡æ¯ï¼Œæ­£åœ¨æ¸…é™¤...');\r\n          uni.removeStorageSync('login_info');\r\n          hasClearedInvalidLogin = true; // æ ‡è®°å·²æ¸…é™¤ï¼Œé¿å…é‡å¤æ¸…é™¤\r\n          console.warn('âœ… [è‡ªåŠ¨ä¿®å¤] å·²æ¸…é™¤æ— æ•ˆçš„ç™»å½•ä¿¡æ¯');\r\n          console.warn('ğŸ’¡ è¯·é‡æ–°ç™»å½•ä»¥è·å–æœ‰æ•ˆçš„token');\r\n          \r\n          // å¯é€‰ï¼šæ˜¾ç¤ºæç¤ºç»™ç”¨æˆ·\r\n          uni.showToast({\r\n            title: 'ç™»å½•ä¿¡æ¯å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•',\r\n            icon: 'none',\r\n            duration: 3000\r\n          });\r\n        } else if (hasClearedInvalidLogin) {\r\n          console.warn('ğŸ’¡ å·²æ¸…é™¤è¿‡æ— æ•ˆç™»å½•ä¿¡æ¯ï¼Œè¯·é‡æ–°ç™»å½•');\r\n        }\r\n      } else {\r\n        console.warn('âš ï¸ æœªæ‰¾åˆ°ç™»å½•ä¿¡æ¯ï¼Œè¯·å…ˆç™»å½•')\r\n      }\r\n      console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    } else {\r\n      console.log('âœ… Tokenå·²æ‰¾åˆ°ï¼Œé•¿åº¦:', token.length)\r\n    }\r\n  }\r\n  \r\n  if (token) {\r\n    // ç¡®ä¿tokenä¸åŒ…å«\"Bearer \"å‰ç¼€ï¼ˆé¿å…é‡å¤æ·»åŠ ï¼‰\r\n    let cleanToken = token.trim();\r\n    if (cleanToken.startsWith('Bearer ')) {\r\n      cleanToken = cleanToken.substring(7); // ç§»é™¤\"Bearer \"å‰ç¼€\r\n    }\r\n    \r\n    // éªŒè¯tokenæ ¼å¼ï¼ˆJWT tokené€šå¸¸åŒ…å«ç‚¹å·ï¼Œä¸”é•¿åº¦è¾ƒé•¿ï¼‰\r\n    if (cleanToken.length < 20) {\r\n      console.warn('âš ï¸ [Tokenè­¦å‘Š] Tokené•¿åº¦è¿‡çŸ­ï¼Œå¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„JWT token');\r\n      console.warn('âš ï¸ Tokené•¿åº¦:', cleanToken.length);\r\n      console.warn('âš ï¸ Tokenå€¼:', cleanToken.substring(0, 20) + '...');\r\n    }\r\n    \r\n    // è¯¦ç»†è®°å½•tokenä¼ é€’ä¿¡æ¯ï¼ˆç”¨äºè°ƒè¯•401é”™è¯¯ï¼‰\r\n    if (isDev || isHeartWallApi || urlForCheck.includes('/api/couple/')) {\r\n      console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n      console.log('ğŸ”‘ [Tokenä¼ é€’è¯Šæ–­]');\r\n      console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n      console.log('ğŸ“ [è¯·æ±‚URL]', options.url);\r\n      console.log('ğŸ“‹ [è¯·æ±‚æ–¹æ³•]', options.method || 'GET');\r\n      console.log('âœ… [TokençŠ¶æ€] Tokenå·²æ‰¾åˆ°');\r\n      console.log('ğŸ“ [Tokené•¿åº¦]', cleanToken.length, 'å­—ç¬¦');\r\n      console.log('ğŸ” [Tokené¢„è§ˆ]', cleanToken.substring(0, 50) + (cleanToken.length > 50 ? '...' : ''));\r\n      console.log('ğŸ” [Tokenæ ¼å¼]', cleanToken.includes('.') ? 'âœ… JWTæ ¼å¼ï¼ˆåŒ…å«ç‚¹å·ï¼‰' : 'âš ï¸ éJWTæ ¼å¼ï¼ˆä¸åŒ…å«ç‚¹å·ï¼‰');\r\n      console.log('ğŸ“¦ [Authorizationå¤´]', `Bearer ${cleanToken.substring(0, 30)}...`);\r\n      console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    }\r\n    \r\n    // ç¡®ä¿headerå¯¹è±¡å­˜åœ¨\r\n    if (!options.header) {\r\n      options.header = {};\r\n    }\r\n    \r\n    options.header = {\r\n      ...options.header,\r\n      'Authorization': `Bearer ${cleanToken}`\r\n    }\r\n    \r\n    // éªŒè¯Authorizationå¤´æ˜¯å¦æ­£ç¡®è®¾ç½®\r\n    if (isDev || isHeartWallApi || urlForCheck.includes('/api/couple/')) {\r\n      const authHeader = options.header['Authorization'] || options.header['authorization'];\r\n      if (authHeader) {\r\n        console.log('âœ… [éªŒè¯] Authorizationå¤´å·²æ­£ç¡®è®¾ç½®');\r\n        console.log('ğŸ“‹ [Authorizationå¤´é•¿åº¦]', authHeader.length, 'å­—ç¬¦');\r\n        console.log('ğŸ” [Authorizationå¤´é¢„è§ˆ]', authHeader.substring(0, 50) + '...');\r\n      } else {\r\n        console.error('âŒ [éªŒè¯å¤±è´¥] Authorizationå¤´æœªæ­£ç¡®è®¾ç½®ï¼');\r\n        console.error('ğŸ“‹ [å½“å‰è¯·æ±‚å¤´]', JSON.stringify(options.header, null, 2));\r\n      }\r\n    }\r\n  } else if (!isLoginApi) {\r\n    // å¦‚æœæ²¡æœ‰tokenä¸”ä¸æ˜¯ç™»å½•æ¥å£ï¼Œæ·»åŠ è­¦å‘Š\r\n    console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    console.warn('âš ï¸ [Tokenç¼ºå¤±] è¯·æ±‚æœªæºå¸¦Authorizationå¤´ï¼Œå¯èƒ½å¯¼è‡´401é”™è¯¯');\r\n    console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    console.warn('ğŸ“ [è¯·æ±‚URL]', options.url);\r\n    console.warn('ğŸ“‹ [è¯·æ±‚æ–¹æ³•]', options.method || 'GET');\r\n    console.warn('ğŸ“¦ [ç™»å½•ä¿¡æ¯]', loginInfo ? 'å­˜åœ¨ä½†tokenä¸ºç©º' : 'ä¸å­˜åœ¨');\r\n    if (loginInfo) {\r\n      console.warn('ğŸ“‹ [ç™»å½•ä¿¡æ¯å­—æ®µ]');\r\n      console.warn('   - token:', loginInfo.token ? `âœ… å­˜åœ¨ï¼ˆ${loginInfo.token.length}å­—ç¬¦ï¼‰` : 'âŒ ä¸å­˜åœ¨');\r\n      console.warn('   - data?.token:', loginInfo.data?.token ? `âœ… å­˜åœ¨ï¼ˆ${loginInfo.data.token.length}å­—ç¬¦ï¼‰` : 'âŒ ä¸å­˜åœ¨');\r\n      console.warn('   - accessToken:', loginInfo.accessToken ? `âœ… å­˜åœ¨ï¼ˆ${loginInfo.accessToken.length}å­—ç¬¦ï¼‰` : 'âŒ ä¸å­˜åœ¨');\r\n      console.warn('   - isLoggedIn:', loginInfo.isLoggedIn ? 'âœ… true' : 'âŒ false');\r\n    }\r\n    console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n  }\r\n  \r\n  // å¼€å‘ç¯å¢ƒä¸‹è®°å½•æ‰€æœ‰APIè¯·æ±‚ä¿¡æ¯\r\n  // æ³¨æ„ï¼šisDevã€urlForCheckã€isHeartWallApi å·²åœ¨å‰é¢å®šä¹‰ï¼ˆç”¨äºtokenè¯Šæ–­ï¼‰\r\n  \r\n  if (isDev || isHeartWallApi) {\r\n    // åˆ¤æ–­APIç±»å‹ï¼ˆä½¿ç”¨å®Œæ•´URLæˆ–åŸå§‹URLè¿›è¡Œåˆ¤æ–­ï¼‰\r\n    let apiType = 'é€šç”¨API';\r\n    if (urlForCheck.includes('/api/challenge/')) {\r\n      apiType = 'ä¸€ç™¾ä»¶äº‹API';\r\n    } else if (urlForCheck.includes('/api/couple/')) {\r\n      apiType = 'æƒ…ä¾£ç»‘å®šAPI';\r\n    } else if (isHeartWallApi) {\r\n      apiType = 'å¿ƒå½¢å¢™API';\r\n    } else if (urlForCheck.includes('/api/qna/')) {\r\n      apiType = 'é—®ç­”API';\r\n    } else if (urlForCheck.includes('/api/login/')) {\r\n      apiType = 'ç™»å½•API';\r\n    } else if (urlForCheck.includes('/api/user/')) {\r\n      apiType = 'ç”¨æˆ·API';\r\n    } else if (urlForCheck.includes('/api/letter/')) {\r\n      apiType = 'æƒ…ä¹¦API';\r\n    }\r\n    \r\n    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    console.log('ğŸ”— [HTTPè¯·æ±‚]', apiType);\r\n    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n    console.log('ğŸ“ [URL]', options.url);\r\n    console.log('ğŸ“‹ [æ–¹æ³•]', options.method || 'GET');\r\n    if (options.data) {\r\n      console.log('ğŸ“¤ [è¯·æ±‚å‚æ•°]', JSON.stringify(options.data, null, 2));\r\n    }\r\n    if (token) {\r\n      console.log('ğŸ”‘ [è®¤è¯] Tokenå·²æºå¸¦ (é•¿åº¦:', token.length, ')');\r\n    } else {\r\n      if (!isLoginApi) {\r\n        console.warn('âš ï¸ [è®¤è¯] Tokenæœªæºå¸¦ï¼Œè¯·æ±‚å¯èƒ½å¤±è´¥');\r\n      } else {\r\n        console.log('â„¹ï¸ [è®¤è¯] ç™»å½•æ¥å£ï¼Œæ— éœ€Token');\r\n      }\r\n    }\r\n    if (options.header) {\r\n      console.log('ğŸ“‹ [è¯·æ±‚å¤´]', Object.keys(options.header).join(', '));\r\n    }\r\n    console.log('â° [æ—¶é—´]', new Date().toLocaleString());\r\n    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n  }\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    uni.request({\r\n      ...options,\r\n      success: (res) => {\r\n        if (res.statusCode >= 200 && res.statusCode < 300) {\r\n          // å¼€å‘ç¯å¢ƒä¸‹è®°å½•æ‰€æœ‰APIå“åº”æ•°æ®ï¼Œå¸®åŠ©è°ƒè¯•\r\n          let isDev = false;\r\n          try {\r\n            isDev = process.env.NODE_ENV === 'development' || \r\n                    typeof __wxConfig !== 'undefined' ||\r\n                    (typeof uni !== 'undefined' && uni.getSystemInfoSync && uni.getSystemInfoSync().platform === 'devtools');\r\n          } catch (e) {\r\n            isDev = process.env.NODE_ENV === 'development' || typeof __wxConfig !== 'undefined';\r\n          }\r\n          \r\n          // æ— è®ºæ˜¯å¦å¼€å‘ç¯å¢ƒï¼Œéƒ½è®°å½•çˆ±å¿ƒå¢™ç›¸å…³çš„å“åº”ï¼ˆä¾¿äºè°ƒè¯•ï¼‰\r\n          const urlForCheck = options.url || '';\r\n          const isHeartWallApi = urlForCheck.includes('/api/heart-wall/') || \r\n                                 urlForCheck.includes('heart-wall') ||\r\n                                 urlForCheck.includes('heartwall') ||\r\n                                 urlForCheck.toLowerCase().includes('heart_wall');\r\n          \r\n          if (isDev || isHeartWallApi) {\r\n            // åˆ¤æ–­APIç±»å‹ï¼ˆä½¿ç”¨å®Œæ•´URLè¿›è¡Œåˆ¤æ–­ï¼‰\r\n            let apiType = 'é€šç”¨API';\r\n            if (urlForCheck.includes('/api/challenge/')) {\r\n              apiType = 'ä¸€ç™¾ä»¶äº‹API';\r\n            } else if (urlForCheck.includes('/api/couple/')) {\r\n              apiType = 'æƒ…ä¾£ç»‘å®šAPI';\r\n            } else if (isHeartWallApi) {\r\n              apiType = 'å¿ƒå½¢å¢™API';\r\n            } else if (urlForCheck.includes('/api/qna/')) {\r\n              apiType = 'é—®ç­”API';\r\n            } else if (urlForCheck.includes('/api/login/')) {\r\n              apiType = 'ç™»å½•API';\r\n            } else if (urlForCheck.includes('/api/user/')) {\r\n              apiType = 'ç”¨æˆ·API';\r\n            } else if (urlForCheck.includes('/api/letter/')) {\r\n              apiType = 'æƒ…ä¹¦API';\r\n            }\r\n            \r\n            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n            console.log('âœ… [HTTPå“åº”]', apiType, 'è¯·æ±‚æˆåŠŸ');\r\n            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n            console.log('ğŸ“ [URL]', options.url);\r\n            console.log('ğŸ“Š [çŠ¶æ€ç ]', res.statusCode);\r\n            console.log('ğŸ“¦ [å“åº”æ•°æ®]', JSON.stringify(res.data, null, 2));\r\n            \r\n            // ç»Ÿè®¡å“åº”æ•°æ®ä¿¡æ¯\r\n            if (res.data && typeof res.data === 'object') {\r\n              if (res.data.tasks && Array.isArray(res.data.tasks)) {\r\n                console.log('ğŸ“Š [æ•°æ®ç»Ÿè®¡] ä»»åŠ¡æ•°é‡:', res.data.tasks.length);\r\n              }\r\n              if (res.data.projects && Array.isArray(res.data.projects)) {\r\n                console.log('ğŸ“Š [æ•°æ®ç»Ÿè®¡] é¡¹ç›®æ•°é‡:', res.data.projects.length);\r\n              }\r\n              if (res.data.photos && Array.isArray(res.data.photos)) {\r\n                console.log('ğŸ“Š [æ•°æ®ç»Ÿè®¡] ç…§ç‰‡æ•°é‡:', res.data.photos.length);\r\n              }\r\n              if (res.data.questions && Array.isArray(res.data.questions)) {\r\n                console.log('ğŸ“Š [æ•°æ®ç»Ÿè®¡] é—®é¢˜æ•°é‡:', res.data.questions.length);\r\n              }\r\n              if (res.data.success !== undefined) {\r\n                console.log('âœ… [ä¸šåŠ¡çŠ¶æ€]', res.data.success ? 'æˆåŠŸ' : 'å¤±è´¥');\r\n              }\r\n              if (res.data.message) {\r\n                console.log('ğŸ’¬ [æ¶ˆæ¯]', res.data.message);\r\n              }\r\n            }\r\n            \r\n            console.log('â° [æ—¶é—´]', new Date().toLocaleString());\r\n            console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n          }\r\n          \r\n          // æ£€æŸ¥ä¸šåŠ¡çŠ¶æ€ç ï¼šå¦‚æœåç«¯è¿”å› code: 401ï¼Œä¹Ÿè¦æŒ‰401é”™è¯¯å¤„ç†\r\n          // è¿™ç§æƒ…å†µæ˜¯åç«¯è¿”å›HTTP 200ï¼Œä½†ä¸šåŠ¡codeæ˜¯401\r\n          if (res.data && typeof res.data === 'object' && res.data.code === 401) {\r\n            const errorMessage = res.data.msg || res.data.message || 'è®¤è¯å¤±è´¥ï¼Œæ— æ³•è®¿é—®ç³»ç»Ÿèµ„æº';\r\n            const error = new Error(errorMessage);\r\n            error.statusCode = 401; // è®¾ç½®ä¸º401ï¼Œä¾¿äºç»Ÿä¸€å¤„ç†\r\n            error.data = res.data;\r\n            error.responseData = res.data;\r\n            \r\n            // è°ƒç”¨401è¯Šæ–­å‡½æ•°\r\n            handle401Diagnosis(res, options, res.data);\r\n            \r\n            reject(error);\r\n            return;\r\n          }\r\n          \r\n          // å¦‚æœåç«¯è¿”å›çš„æ ¼å¼æ˜¯ { success: false, message: \"...\" }ï¼Œåº”è¯¥ä½œä¸ºé”™è¯¯å¤„ç†\r\n          if (res.data && typeof res.data === 'object' && res.data.success === false) {\r\n            const errorMessage = res.data.message || 'è¯·æ±‚å¤±è´¥'\r\n            const error = new Error(errorMessage)\r\n            error.statusCode = res.statusCode\r\n            error.data = res.data\r\n            \r\n            // æ£€æŸ¥æ˜¯å¦æ˜¯tokenè¿‡æœŸæˆ–æœªç™»å½•çš„é”™è¯¯\r\n            const isTokenExpired = errorMessage.includes('æœªç™»å½•') || \r\n                                   errorMessage.includes('tokenå·²è¿‡æœŸ') || \r\n                                   errorMessage.includes('tokenè¿‡æœŸ') ||\r\n                                   errorMessage.includes('ç™»å½•å·²è¿‡æœŸ') ||\r\n                                   errorMessage.includes('æœªæˆæƒ') ||\r\n                                   errorMessage.includes('Unauthorized') ||\r\n                                   errorMessage.toLowerCase().includes('token expired') ||\r\n                                   errorMessage.toLowerCase().includes('not logged in')\r\n            \r\n            // å¦‚æœæ˜¯tokenè¿‡æœŸé”™è¯¯ï¼Œè°ƒç”¨handleUnauthorizedå¤„ç†\r\n            if (isTokenExpired) {\r\n              handleUnauthorized(errorMessage)\r\n            }\r\n            \r\n            reject(error)\r\n            return\r\n          }\r\n          \r\n          resolve(res.data)\r\n        } else {\r\n          // ç‰¹æ®Šæƒ…å†µï¼šå³ä½¿HTTPçŠ¶æ€ç ä¸æ˜¯200-299ï¼Œä½†å¦‚æœå“åº”ä½“ä¸­ success: trueï¼Œä¹Ÿåº”è¯¥å½“ä½œæˆåŠŸå¤„ç†\r\n          // è¿™æ˜¯å› ä¸ºåç«¯å¯èƒ½åœ¨ä¸šåŠ¡æˆåŠŸæ—¶è¿”å›äº†é”™è¯¯çš„çŠ¶æ€ç ï¼ˆå¦‚500ï¼‰\r\n          \r\n          // å…ˆè®°å½•è¯¦ç»†æ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•\r\n          const urlForCheck = options.url || '';\r\n          const isHeartWallApi = urlForCheck.includes('/api/heart-wall/') || \r\n                                 urlForCheck.includes('heart-wall') ||\r\n                                 urlForCheck.includes('heartwall') ||\r\n                                 urlForCheck.toLowerCase().includes('heart_wall');\r\n          \r\n          // å°è¯•è§£æå“åº”æ•°æ®ï¼ˆå¦‚æœæ˜¯å­—ç¬¦ä¸²æ ¼å¼ï¼‰\r\n          let responseData = res.data;\r\n          if (typeof responseData === 'string') {\r\n            try {\r\n              responseData = JSON.parse(responseData);\r\n            } catch (e) {\r\n              // è§£æå¤±è´¥ï¼Œä¿æŒåŸæ ·\r\n            }\r\n          }\r\n          \r\n          if (isHeartWallApi || process.env.NODE_ENV === 'development') {\r\n            console.warn(`âš ï¸ [HTTPå“åº”] çŠ¶æ€ç å¼‚å¸¸: ${res.statusCode}`);\r\n            console.warn(`âš ï¸ [å“åº”æ•°æ®]`, responseData);\r\n            console.warn(`âš ï¸ [å“åº”æ•°æ®ç±»å‹]`, typeof responseData);\r\n            if (responseData && typeof responseData === 'object') {\r\n              console.warn(`âš ï¸ [successå­—æ®µ]`, responseData.success);\r\n              console.warn(`âš ï¸ [messageå­—æ®µ]`, responseData.message);\r\n              // å¦‚æœæ˜¯å¿ƒå½¢å¢™APIï¼Œä¹Ÿæ£€æŸ¥photoå­—æ®µ\r\n              if (isHeartWallApi && responseData.photo) {\r\n                console.warn(`âš ï¸ [photoå­—æ®µå­˜åœ¨]`, !!responseData.photo);\r\n              }\r\n            }\r\n          }\r\n          \r\n          // æ£€æŸ¥å“åº”æ•°æ®ä¸­æ˜¯å¦æœ‰ success: true\r\n          // æ”¯æŒå¤šç§æ ¼å¼ï¼š\r\n          // 1. { success: true, ... }\r\n          // 2. { data: { success: true, ... } }\r\n          // 3. å¯¹äºå¿ƒå½¢å¢™APIï¼Œä¹Ÿæ£€æŸ¥æ˜¯å¦æœ‰photoå­—æ®µï¼ˆè¡¨ç¤ºæˆåŠŸï¼‰\r\n          let isSuccess = false;\r\n          if (responseData && typeof responseData === 'object') {\r\n            if (responseData.success === true) {\r\n              isSuccess = true;\r\n            } else if (responseData.data && typeof responseData.data === 'object' && responseData.data.success === true) {\r\n              isSuccess = true;\r\n              // å°†dataæå‡ä¸ºé¡¶å±‚\r\n              responseData = responseData.data;\r\n            } else if (isHeartWallApi && responseData.photo && typeof responseData.photo === 'object') {\r\n              // å¯¹äºå¿ƒå½¢å¢™APIï¼Œå¦‚æœè¿”å›äº†photoå­—æ®µï¼Œä¹Ÿè®¤ä¸ºæˆåŠŸ\r\n              isSuccess = true;\r\n            }\r\n          }\r\n          \r\n          if (isSuccess) {\r\n            console.warn(`âš ï¸ [HTTPå“åº”] åç«¯è¿”å›çŠ¶æ€ç  ${res.statusCode}ï¼Œä½†ä¸šåŠ¡é€»è¾‘æˆåŠŸ (success: true)`);\r\n            console.warn('âš ï¸ å»ºè®®åç«¯ä¿®æ”¹ï¼šæˆåŠŸæ—¶åº”è¯¥è¿”å› 200 çŠ¶æ€ç ');\r\n            // å½“ä½œæˆåŠŸå¤„ç†\r\n            resolve(responseData)\r\n            return\r\n          }\r\n          \r\n          // å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œè®°å½•è¯¦ç»†ä¿¡æ¯åreject\r\n          if (isHeartWallApi || process.env.NODE_ENV === 'development') {\r\n            console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n            console.error(`âŒ [HTTPå“åº”] çŠ¶æ€ç  ${res.statusCode} ä¸”ä¸šåŠ¡é€»è¾‘å¤±è´¥`);\r\n            console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n            console.error('ğŸ“ [è¯·æ±‚URL]', options.url);\r\n            console.error('ğŸ“‹ [è¯·æ±‚æ–¹æ³•]', options.method || 'GET');\r\n            if (options.data) {\r\n              console.error('ğŸ“¤ [è¯·æ±‚å‚æ•°]', JSON.stringify(options.data, null, 2));\r\n            }\r\n            if (options.header) {\r\n              console.error('ğŸ“‹ [è¯·æ±‚å¤´]', JSON.stringify(options.header, null, 2));\r\n            }\r\n            console.error('ğŸ“Š [å“åº”çŠ¶æ€ç ]', res.statusCode);\r\n            console.error('ğŸ“¦ [å®Œæ•´å“åº”å¯¹è±¡]', JSON.stringify(res, null, 2));\r\n            if (!responseData || typeof responseData !== 'object') {\r\n              console.error(`âŒ [å“åº”æ•°æ®] ä¸æ˜¯å¯¹è±¡ï¼Œç±»å‹: ${typeof responseData}ï¼Œå€¼:`, responseData);\r\n            } else {\r\n              console.error(`âŒ [successå­—æ®µ]`, responseData.success);\r\n              console.error(`âŒ [messageå­—æ®µ]`, responseData.message);\r\n              console.error(`âŒ [å®Œæ•´å“åº”æ•°æ®]`, JSON.stringify(responseData, null, 2));\r\n              // æ£€æŸ¥å“åº”æ•°æ®çš„æ‰€æœ‰å­—æ®µ\r\n              console.error(`âŒ [å“åº”æ•°æ®å­—æ®µåˆ—è¡¨]`, Object.keys(responseData).join(', '));\r\n              if (isHeartWallApi) {\r\n                console.error(`âŒ [photoå­—æ®µ]`, responseData.photo ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨');\r\n              }\r\n            }\r\n            console.error('â° [æ—¶é—´]', new Date().toLocaleString());\r\n            console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n          }\r\n          \r\n          // åˆ›å»º Error å¯¹è±¡ï¼Œç¡®ä¿ handleRequestError èƒ½æ­£ç¡®å¤„ç†\r\n          const errorMessage = (responseData && typeof responseData === 'object' && responseData.message) \r\n            ? responseData.message \r\n            : `è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${res.statusCode}`;\r\n          \r\n          const error = new Error(errorMessage);\r\n          error.statusCode = res.statusCode;\r\n          error.data = responseData || res.data;\r\n          // æ·»åŠ å“åº”æ•°æ®åˆ°é”™è¯¯å¯¹è±¡ï¼Œä¾¿äºä¸Šå±‚å¤„ç†\r\n          if (responseData && typeof responseData === 'object') {\r\n            error.responseData = responseData;\r\n          }\r\n          \r\n          // æ£€æŸ¥ä¸šåŠ¡çŠ¶æ€ç ï¼šå¦‚æœåç«¯è¿”å› code: 401ï¼Œä¹Ÿè¦æŒ‰401é”™è¯¯å¤„ç†\r\n          // è¿™ç§æƒ…å†µå¯èƒ½å‡ºç°åœ¨é200-299çŠ¶æ€ç çš„æƒ…å†µä¸‹\r\n          if (responseData && typeof responseData === 'object' && responseData.code === 401) {\r\n            const errorMessage = responseData.msg || responseData.message || 'è®¤è¯å¤±è´¥ï¼Œæ— æ³•è®¿é—®ç³»ç»Ÿèµ„æº';\r\n            const error = new Error(errorMessage);\r\n            error.statusCode = 401; // è®¾ç½®ä¸º401ï¼Œä¾¿äºç»Ÿä¸€å¤„ç†\r\n            error.data = responseData;\r\n            error.responseData = responseData;\r\n            \r\n            // è°ƒç”¨401è¯Šæ–­å‡½æ•°\r\n            handle401Diagnosis(res, options, responseData);\r\n            \r\n            reject(error);\r\n            return;\r\n          }\r\n          \r\n          // å¦‚æœæ˜¯ 401 é”™è¯¯ï¼Œç«‹å³å¤„ç†æœªæˆæƒæƒ…å†µ\r\n          // ä½†æ˜¯ç™»å½•æ¥å£è¿”å›401æ—¶ä¸åº”è¯¥è°ƒç”¨handleUnauthorizedï¼Œå› ä¸ºï¼š\r\n          // 1. ç™»å½•æ¥å£æœ¬èº«ä¸éœ€è¦è®¤è¯\r\n          // 2. å¦‚æœç™»å½•æ¥å£è¿”å›401ï¼Œè¯´æ˜åç«¯é…ç½®æœ‰é—®é¢˜æˆ–è¯·æ±‚å‚æ•°æœ‰é—®é¢˜\r\n          // 3. ä¸åº”è¯¥å› ä¸ºç™»å½•æ¥å£è¿”å›401å°±è·³è½¬åˆ°ç™»å½•é¡µï¼ˆä¼šå¯¼è‡´æ­»å¾ªç¯ï¼‰\r\n          if (res.statusCode === 401) {\r\n            // è°ƒç”¨401è¯Šæ–­å‡½æ•°ï¼ˆå‡½æ•°å†…éƒ¨ä¼šå¤„ç†è·³è½¬é€»è¾‘ï¼‰\r\n            handle401Diagnosis(res, options, responseData);\r\n            // ç»§ç»­æ‰§è¡Œï¼Œè®©é”™è¯¯è¢«reject\r\n          }\r\n          \r\n          // å¦‚æœæ˜¯ 404 é”™è¯¯ä¸”é”™è¯¯æ¶ˆæ¯æ˜¯\"ç”¨æˆ·ä¸å­˜åœ¨\"ï¼Œä¹ŸæŒ‰æœªæˆæƒå¤„ç†\r\n          // è¿™é€šå¸¸è¡¨ç¤ºtokenä¸­çš„ç”¨æˆ·ä¿¡æ¯å·²å¤±æ•ˆæˆ–åç«¯æ•°æ®åº“ä¸­ç”¨æˆ·ä¸å­˜åœ¨\r\n          // ä½†æ˜¯å¯¹äºä½ç½®ç›¸å…³çš„APIå’Œä¸€ç™¾ä»¶äº‹APIï¼Œä¸è‡ªåŠ¨è·³è½¬ç™»å½•ï¼Œè®©è°ƒç”¨è€…è‡ªå·±å¤„ç†\r\n          if (res.statusCode === 404 && errorMessage && errorMessage.includes('ç”¨æˆ·ä¸å­˜åœ¨')) {\r\n            const isLocationApi = options.url.includes('/api/trajectory/location/');\r\n            const isChallengeApi = options.url.includes('/api/challenge/');\r\n            \r\n            if (isLocationApi) {\r\n              // ä½ç½®ç›¸å…³APIï¼šåªè®°å½•æ—¥å¿—ï¼Œä¸è‡ªåŠ¨è·³è½¬ç™»å½•\r\n              console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n              console.warn('âš ï¸ [HTTPå“åº”] æ£€æµ‹åˆ°\"ç”¨æˆ·ä¸å­˜åœ¨\"é”™è¯¯ï¼ˆä½ç½®APIï¼‰');\r\n              console.warn('âš ï¸ è¿™é€šå¸¸è¡¨ç¤ºç”¨æˆ·ä¿¡æ¯å·²å¤±æ•ˆæˆ–tokenä¸­çš„ç”¨æˆ·åœ¨åç«¯ä¸å­˜åœ¨');\r\n              console.warn('âš ï¸ ä½ç½®åŠŸèƒ½å°†æ— æ³•ä½¿ç”¨ï¼Œä½†ä¸ä¼šå½±å“é¡µé¢å…¶ä»–åŠŸèƒ½');\r\n              console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n            } else if (isChallengeApi) {\r\n              // ä¸€ç™¾ä»¶äº‹APIï¼šå¯èƒ½æ˜¯æ¥å£ä¸å­˜åœ¨ï¼Œä¹Ÿå¯èƒ½æ˜¯ç”¨æˆ·ä¸å­˜åœ¨\r\n              // ä¸è‡ªåŠ¨è·³è½¬ç™»å½•ï¼Œè®©è°ƒç”¨è€…è‡ªå·±å¤„ç†ï¼ˆå¯ä»¥æ˜¾ç¤ºå‹å¥½æç¤ºæˆ–ä½¿ç”¨æœ¬åœ°æ•°æ®ï¼‰\r\n              console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n              console.warn('âš ï¸ [HTTPå“åº”] æ£€æµ‹åˆ°\"ç”¨æˆ·ä¸å­˜åœ¨\"é”™è¯¯ï¼ˆä¸€ç™¾ä»¶äº‹APIï¼‰');\r\n              console.warn('âš ï¸ å¯èƒ½åŸå› ï¼š');\r\n              console.warn('   1. æ¥å£ä¸å­˜åœ¨ï¼ˆåç«¯æœªå®ç°æ­¤æ¥å£ï¼‰');\r\n              console.warn('   2. ç”¨æˆ·ä¿¡æ¯å·²å¤±æ•ˆæˆ–tokenä¸­çš„ç”¨æˆ·åœ¨åç«¯ä¸å­˜åœ¨');\r\n              console.warn('âš ï¸ ä¸ä¼šè‡ªåŠ¨è·³è½¬ç™»å½•ï¼Œè¯·æ£€æŸ¥æ¥å£æ˜¯å¦å·²å®ç°');\r\n              console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n            } else {\r\n              // å…¶ä»–APIï¼šæ¸…é™¤ç™»å½•ä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µ\r\n              console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n              console.warn('âš ï¸ [HTTPå“åº”] æ£€æµ‹åˆ°\"ç”¨æˆ·ä¸å­˜åœ¨\"é”™è¯¯');\r\n              console.warn('âš ï¸ è¿™é€šå¸¸è¡¨ç¤ºç”¨æˆ·ä¿¡æ¯å·²å¤±æ•ˆæˆ–tokenä¸­çš„ç”¨æˆ·åœ¨åç«¯ä¸å­˜åœ¨');\r\n              console.warn('âš ï¸ å°†æ¸…é™¤ç™»å½•ä¿¡æ¯å¹¶è·³è½¬åˆ°ç™»å½•é¡µ');\r\n              console.warn('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n              handleUnauthorized('ç”¨æˆ·ä¿¡æ¯å·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•');\r\n            }\r\n          }\r\n          \r\n          reject(error);\r\n        }\r\n      },\r\n      fail: (error) => {\r\n        // å¼€å‘ç¯å¢ƒä¸‹è®°å½•æ‰€æœ‰APIçš„é”™è¯¯ä¿¡æ¯\r\n        let isDev = false;\r\n        try {\r\n          isDev = process.env.NODE_ENV === 'development' || \r\n                  typeof __wxConfig !== 'undefined' ||\r\n                  (typeof uni !== 'undefined' && uni.getSystemInfoSync && uni.getSystemInfoSync().platform === 'devtools');\r\n        } catch (e) {\r\n          isDev = process.env.NODE_ENV === 'development' || typeof __wxConfig !== 'undefined';\r\n        }\r\n        \r\n        // æ— è®ºæ˜¯å¦å¼€å‘ç¯å¢ƒï¼Œéƒ½è®°å½•çˆ±å¿ƒå¢™ç›¸å…³çš„é”™è¯¯ï¼ˆä¾¿äºè°ƒè¯•ï¼‰\r\n        const urlForCheck = options.url || '';\r\n        const isHeartWallApi = urlForCheck.includes('/api/heart-wall/') || \r\n                               urlForCheck.includes('heart-wall') ||\r\n                               urlForCheck.includes('heartwall') ||\r\n                               urlForCheck.toLowerCase().includes('heart_wall');\r\n        \r\n        if (isDev || isHeartWallApi) {\r\n          // åˆ¤æ–­APIç±»å‹ï¼ˆä½¿ç”¨å®Œæ•´URLè¿›è¡Œåˆ¤æ–­ï¼‰\r\n          let apiType = 'é€šç”¨API';\r\n          if (urlForCheck.includes('/api/challenge/')) {\r\n            apiType = 'ä¸€ç™¾ä»¶äº‹API';\r\n          } else if (urlForCheck.includes('/api/couple/')) {\r\n            apiType = 'æƒ…ä¾£ç»‘å®šAPI';\r\n          } else if (isHeartWallApi) {\r\n            apiType = 'å¿ƒå½¢å¢™API';\r\n          } else if (urlForCheck.includes('/api/qna/')) {\r\n            apiType = 'é—®ç­”API';\r\n          } else if (urlForCheck.includes('/api/login/')) {\r\n            apiType = 'ç™»å½•API';\r\n          } else if (urlForCheck.includes('/api/user/')) {\r\n            apiType = 'ç”¨æˆ·API';\r\n          } else if (urlForCheck.includes('/api/letter/')) {\r\n            apiType = 'æƒ…ä¹¦API';\r\n          }\r\n          \r\n          console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n          console.error('âŒ [HTTPé”™è¯¯]', apiType, 'è¯·æ±‚å¤±è´¥');\r\n          console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n          console.error('ğŸ“ [URL]', options.url);\r\n          console.error('ğŸ“‹ [æ–¹æ³•]', options.method || 'GET');\r\n          console.error('ğŸ”´ [é”™è¯¯è¯¦æƒ…]', error);\r\n          console.error('ğŸ“‹ [é”™è¯¯æ¶ˆæ¯]', error.errMsg || error.message || 'æœªçŸ¥é”™è¯¯');\r\n          console.error('ğŸ“Š [çŠ¶æ€ç ]', error.statusCode || 'æ— ');\r\n          \r\n          // é”™è¯¯åˆ†æ\r\n          if (error.errMsg) {\r\n            if (error.errMsg.includes('timeout')) {\r\n              console.error('â±ï¸ [é”™è¯¯ç±»å‹] è¯·æ±‚è¶…æ—¶');\r\n            } else if (error.errMsg.includes('fail')) {\r\n              console.error('ğŸ”Œ [é”™è¯¯ç±»å‹] ç½‘ç»œè¿æ¥å¤±è´¥');\r\n              console.error('ğŸ’¡ [æç¤º] è¯·æ£€æŸ¥ï¼š');\r\n              console.error('   1. åç«¯æœåŠ¡æ˜¯å¦å·²å¯åŠ¨');\r\n              console.error('   2. è¯·æ±‚åœ°å€æ˜¯å¦æ­£ç¡®:', options.url);\r\n              console.error('   3. ç½‘ç»œæ˜¯å¦è¿é€š');\r\n            } else if (error.errMsg.includes('404')) {\r\n              console.error('ğŸ” [é”™è¯¯ç±»å‹] æ¥å£ä¸å­˜åœ¨ (404)');\r\n            } else if (error.errMsg.includes('401')) {\r\n              console.error('ğŸ” [é”™è¯¯ç±»å‹] æœªæˆæƒ (401)ï¼Œå¯èƒ½æ˜¯Tokenè¿‡æœŸ');\r\n            }\r\n          }\r\n          \r\n          console.error('â° [æ—¶é—´]', new Date().toLocaleString());\r\n          console.error('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');\r\n        }\r\n        handleRequestError(error, options)\r\n          .then(resolve)\r\n          .catch(reject)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\n// æ–‡ä»¶ä¸Šä¼ æ–¹æ³•\r\nfunction upload(options) {\r\n  // åˆå¹¶é»˜è®¤é…ç½®\r\n  options = {\r\n    ...defaultOptions,\r\n    timeout: config.uploadTimeout || 30000,  // ä¸Šä¼ é»˜è®¤30ç§’è¶…æ—¶\r\n    header: {\r\n      'content-type': 'multipart/form-data'\r\n    },\r\n    ...options\r\n  }\r\n  \r\n  // éªŒè¯æ–‡ä»¶è·¯å¾„\r\n  if (!options.filePath) {\r\n    return Promise.reject(new Error('æœªæ‰¾åˆ°ä¸Šä¼ çš„æ–‡ä»¶ï¼šfilePath å‚æ•°ä¸ºç©º'))\r\n  }\r\n  \r\n  // è®°å½•åŸå§‹è·¯å¾„\r\n  const originalFilePath = options.filePath\r\n  console.log('ğŸ“ [ä¸Šä¼ ] åŸå§‹æ–‡ä»¶è·¯å¾„:', originalFilePath)\r\n  \r\n  // å¤„ç†æ–‡ä»¶è·¯å¾„\r\n  let validFilePath = originalFilePath\r\n  \r\n  if (validFilePath && typeof validFilePath === 'string') {\r\n    // ç‰¹æ®Šå¤„ç†å¾®ä¿¡å°ç¨‹åºçš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„\r\n    if (validFilePath.startsWith('http://tmp/') || validFilePath.startsWith('https://tmp/')) {\r\n      // å¾®ä¿¡å°ç¨‹åºä¸´æ—¶æ–‡ä»¶è·¯å¾„ï¼Œuni.uploadFile å¯ä»¥ç›´æ¥å¤„ç†\r\n      // ä¸éœ€è¦åšä»»ä½•è½¬æ¢ï¼Œç›´æ¥ä½¿ç”¨åŸå§‹è·¯å¾„\r\n      console.log('â„¹ï¸ [ä¸Šä¼ ] æ£€æµ‹åˆ°å¾®ä¿¡å°ç¨‹åºä¸´æ—¶æ–‡ä»¶è·¯å¾„ï¼Œuni.uploadFile å°†ç›´æ¥å¤„ç†')\r\n      validFilePath = originalFilePath\r\n    }\r\n    // å¦‚æœè·¯å¾„å·²ç»æ˜¯å®Œæ•´çš„HTTP(S) URLï¼ˆä¸”ä¸æ˜¯ä¸´æ—¶æ–‡ä»¶è·¯å¾„ï¼‰ï¼Œè¯´æ˜æ˜¯å·²ä¸Šä¼ çš„å›¾ç‰‡ï¼Œä¸éœ€è¦ä¸Šä¼ \r\n    else if (validFilePath.startsWith('http://') || validFilePath.startsWith('https://')) {\r\n      // è¿™æ˜¯å·²ä¸Šä¼ çš„å®Œæ•´URLï¼Œä¸éœ€è¦ä¸Šä¼ \r\n      console.warn('âš ï¸ [ä¸Šä¼ ] æ–‡ä»¶è·¯å¾„å·²ç»æ˜¯URLæ ¼å¼ï¼Œè·³è¿‡ä¸Šä¼ :', validFilePath)\r\n      return Promise.reject(new Error('æ–‡ä»¶è·¯å¾„å·²ç»æ˜¯URLæ ¼å¼ï¼Œæ— éœ€ä¸Šä¼ '))\r\n    }\r\n    // å…¶ä»–æƒ…å†µç›´æ¥ä½¿ç”¨åŸå§‹è·¯å¾„ï¼ˆuni.uploadFile åº”è¯¥èƒ½å¤„ç†å„ç§æœ¬åœ°è·¯å¾„æ ¼å¼ï¼‰\r\n  }\r\n  \r\n  // å¤„ç†è¯·æ±‚URL\r\n  if (!options.url.startsWith('http')) {\r\n    options.url = config.baseURL + options.url\r\n  }\r\n  \r\n  // æ·»åŠ token\r\n  const loginInfo = uni.getStorageSync('login_info')\r\n  const token = loginInfo?.token\r\n  \r\n  if (token) {\r\n    // ç¡®ä¿tokenä¸åŒ…å«\"Bearer \"å‰ç¼€ï¼ˆé¿å…é‡å¤æ·»åŠ ï¼‰\r\n    let cleanToken = token.trim();\r\n    if (cleanToken.startsWith('Bearer ')) {\r\n      cleanToken = cleanToken.substring(7); // ç§»é™¤\"Bearer \"å‰ç¼€\r\n    }\r\n    options.header['Authorization'] = `Bearer ${cleanToken}`\r\n  } else {\r\n    console.warn('âš ï¸ ä¸Šä¼ è¯·æ±‚æœªæºå¸¦Authorizationå¤´ï¼Œå¯èƒ½å¯¼è‡´401é”™è¯¯')\r\n  }\r\n  \r\n  // ä½¿ç”¨ä¿®å¤åçš„æ–‡ä»¶è·¯å¾„\r\n  const uploadOptions = {\r\n    ...options,\r\n    filePath: validFilePath\r\n  }\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    console.log('ğŸ“¤ [ä¸Šä¼ ] å¼€å§‹ä¸Šä¼ æ–‡ä»¶ï¼Œè·¯å¾„:', validFilePath)\r\n    uni.uploadFile({\r\n      ...uploadOptions,\r\n      success: (uploadRes) => {\r\n        try {\r\n          const result = JSON.parse(uploadRes.data)\r\n          if (result.success) {\r\n            console.log('âœ… [ä¸Šä¼ ] æ–‡ä»¶ä¸Šä¼ æˆåŠŸ')\r\n            const normalizedData = result.data !== undefined && result.data !== null\r\n              ? result.data\r\n              : result\r\n            resolve(normalizedData)\r\n          } else {\r\n            const errorMsg = result.message || 'ä¸Šä¼ å¤±è´¥'\r\n            console.error('âŒ [ä¸Šä¼ ] æœåŠ¡å™¨è¿”å›å¤±è´¥:', errorMsg)\r\n            reject(new Error(errorMsg))\r\n          }\r\n        } catch (e) {\r\n          console.error('âŒ [ä¸Šä¼ ] è§£æå“åº”å¤±è´¥:', e)\r\n          reject(new Error('è§£æä¸Šä¼ å“åº”å¤±è´¥'))\r\n        }\r\n      },\r\n      fail: (error) => {\r\n        console.error('âŒ [ä¸Šä¼ ] ä¸Šä¼ å¤±è´¥:', error)\r\n        console.error('âŒ [ä¸Šä¼ ] åŸå§‹è·¯å¾„:', originalFilePath)\r\n        console.error('âŒ [ä¸Šä¼ ] ä½¿ç”¨è·¯å¾„:', validFilePath)\r\n        \r\n        // æ£€æŸ¥æ˜¯å¦æ˜¯æ–‡ä»¶è·¯å¾„é—®é¢˜\r\n        if (error.errMsg && (error.errMsg.includes('æœªæ‰¾åˆ°') || error.errMsg.includes('file not found') || error.errMsg.includes('no such file') || error.errMsg.includes('file doesn\\'t exist'))) {\r\n          // ç‰¹åˆ«å¤„ç†å¾®ä¿¡å°ç¨‹åºä¸´æ—¶æ–‡ä»¶è·¯å¾„é—®é¢˜\r\n          if (originalFilePath && (originalFilePath.startsWith('http://tmp/') || originalFilePath.startsWith('https://tmp/'))) {\r\n            console.error('âŒ [ä¸Šä¼ ] å¾®ä¿¡å°ç¨‹åºä¸´æ—¶æ–‡ä»¶è·¯å¾„å¯èƒ½å·²è¿‡æœŸï¼Œè¯·é‡æ–°é€‰æ‹©å›¾ç‰‡')\r\n            reject(new Error('å›¾ç‰‡é€‰æ‹©å·²è¿‡æœŸï¼Œè¯·é‡æ–°é€‰æ‹©å›¾ç‰‡'))\r\n            return\r\n          }\r\n          \r\n          // å¦‚æœæ˜¯å› ä¸ºè·¯å¾„é—®é¢˜å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨åŸå§‹è·¯å¾„ï¼ˆå¦‚æœä¸åŒï¼‰\r\n          if (validFilePath !== originalFilePath && originalFilePath) {\r\n            console.warn('âš ï¸ [ä¸Šä¼ ] è½¬æ¢åçš„è·¯å¾„æ— æ•ˆï¼Œå°è¯•ä½¿ç”¨åŸå§‹è·¯å¾„:', originalFilePath)\r\n            // è¿™ç§æƒ…å†µä¸åº”è¯¥å†å°è¯•ï¼Œå› ä¸ºå·²ç»å¤±è´¥äº†\r\n          }\r\n          console.error('âŒ [ä¸Šä¼ ] æ–‡ä»¶è·¯å¾„æ— æ•ˆï¼Œæ— æ³•æ‰¾åˆ°æ–‡ä»¶')\r\n          reject(new Error(`æœªæ‰¾åˆ°ä¸Šä¼ çš„æ–‡ä»¶: ${validFilePath} (åŸå§‹è·¯å¾„: ${originalFilePath})`))\r\n        } else {\r\n          handleRequestError(error, options)\r\n            .then(resolve)\r\n            .catch(reject)\r\n        }\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\n// HTTPæ–¹æ³•å°è£…\r\nconst http = {\r\n  request,\r\n  upload,\r\n  get: (url, data, options = {}) => request({ ...options, url, data, method: 'GET' }),\r\n  post: (url, data, options = {}) => request({ ...options, url, data, method: 'POST' }),\r\n  put: (url, data, options = {}) => request({ ...options, url, data, method: 'PUT' }),\r\n  delete: (url, data, options = {}) => request({ ...options, url, data, method: 'DELETE' })\r\n}\r\n\r\nexport default http\r\n"],"names":["config","uni","isLoggedIn","logout","isDev","urlForCheck","isHeartWallApi","errorMessage","error","isChallengeApi"],"mappings":"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"}