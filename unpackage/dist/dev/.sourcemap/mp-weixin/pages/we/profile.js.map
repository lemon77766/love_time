{"version":3,"file":"profile.js","sources":["pages/we/profile.vue","D:/softcaree/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvd2UvcHJvZmlsZS52dWU"],"sourcesContent":["<template>\r\n  <view class=\"profile-edit-page\">\r\n    <!-- ÂÜÖÂÆπÂå∫Âüü -->\r\n    <view class=\"content\">\r\n      <!-- Â§¥ÂÉèËÆæÁΩÆ -->\r\n      <view class=\"section\">\r\n        <text class=\"section-title\">Â§¥ÂÉèËÆæ</text>\r\n        <view class=\"avatar-section\">\r\n          <view class=\"current-avatar\">\r\n            <image class=\"avatar\" :src=\"userInfo.displayAvatar || userInfo.avatarUrl || '/static/login/love.jpg'\" mode=\"aspectFill\" />\r\n            <text class=\"avatar-label\">ÂΩìÂâçÂ§¥ÂÉè</text>\r\n          </view>\r\n          \r\n          <view class=\"avatar-options\">\r\n            <button class=\"avatar-btn\" @click=\"selectWechatAvatar\">\r\n              <text class=\"btn-icon\">üì±</text>\r\n              <text class=\"btn-text\">‰ΩøÁî®ÂæÆ‰ø°Â§¥ÂÉè</text>\r\n            </button>\r\n            \r\n            <button class=\"avatar-btn\" @click=\"uploadCustomAvatar\">\r\n              <text class=\"btn-icon\">üñºÔ∏è</text>\r\n              <text class=\"btn-text\">‰∏ä‰º†Ëá™ÂÆö‰πâÂ§¥ÂÉè</text>\r\n            </button>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- ÊòµÁß∞ËÆæÁΩÆ -->\r\n      <view class=\"section\">\r\n        <text class=\"section-title\">ÊòµÁß∞ËÆæÁΩÆ</text>\r\n        <view class=\"nickname-section\">\r\n          <view class=\"nickname-option\" @click=\"toggleUseWechatNickname\">\r\n            <view class=\"checkbox\" :class=\"{ checked: useWechatNickname }\"></view>\r\n            <text class=\"option-text\">‰ΩøÁî®ÂæÆ‰ø°ÊòµÁß∞</text>\r\n            <text class=\"current-nickname\">{{ userInfo.nickName }}</text>\r\n          </view>\r\n          \r\n          <view v-if=\"!useWechatNickname\" class=\"custom-nickname\">\r\n            <input \r\n              v-model=\"customNickname\" \r\n              class=\"nickname-input\" \r\n              placeholder=\"ËØ∑ËæìÂÖ•Ëá™ÂÆö‰πâÊòµÁß∞\"\r\n              maxlength=\"20\"\r\n            />\r\n            <text class=\"char-count\">{{ customNickname.length }}/20</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- ‰øùÂ≠òÊåâÈíÆ -->\r\n      <view class=\"save-section\">\r\n        <button class=\"save-btn\" @click=\"saveProfile\" :disabled=\"isLoading\">\r\n          <text class=\"save-icon\">üíæ</text>\r\n          <text class=\"save-text\">‰øùÂ≠òËÆæÁΩÆ</text>\r\n        </button>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport http from '@/utils/http.js';\r\nimport config from '@/utils/config.js';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      userInfo: {\r\n        nickName: '',\r\n        avatarUrl: '',\r\n        displayName: '',\r\n        displayAvatar: ''\r\n      },\r\n      useWechatNickname: true,\r\n      customNickname: '',\r\n      isLoading: false\r\n    };\r\n  },\r\n  \r\n  onLoad() {\r\n    this.loadUserInfo();\r\n  },\r\n  \r\n  methods: {\r\n    // Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØ\r\n    loadUserInfo() {\r\n      try {\r\n        const loginInfo = uni.getStorageSync('login_info');\r\n        if (loginInfo && loginInfo.userInfo) {\r\n          this.userInfo = { ...loginInfo.userInfo };\r\n          this.useWechatNickname = !this.userInfo.displayName || \r\n            this.userInfo.displayName === this.userInfo.nickName;\r\n          this.customNickname = this.useWechatNickname ? '' : this.userInfo.displayName;\r\n        }\r\n      } catch (error) {\r\n        console.error('Âä†ËΩΩÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•', error);\r\n      }\r\n    },\r\n    \r\n    // ‰ΩøÁî®ÂæÆ‰ø°Â§¥ÂÉè\r\n    selectWechatAvatar() {\r\n      this.userInfo.displayAvatar = this.userInfo.avatarUrl;\r\n      uni.showToast({\r\n        title: 'Â∑≤ÂàáÊç¢‰∏∫ÂæÆ‰ø°Â§¥ÂÉè',\r\n        icon: 'success',\r\n        duration: 1500\r\n      });\r\n    },\r\n    \r\n    // ‰∏ä‰º†Ëá™ÂÆö‰πâÂ§¥ÂÉè\r\n    uploadCustomAvatar() {\r\n      uni.chooseImage({\r\n        count: 1,\r\n        sizeType: ['compressed'],\r\n        sourceType: ['album', 'camera'],\r\n        success: async (res) => {\r\n          const tempFilePath = res.tempFilePaths[0];\r\n          \r\n          try {\r\n            uni.showLoading({\r\n              title: 'Â§ÑÁêÜÂ§¥ÂÉè‰∏≠...',\r\n              mask: true\r\n            });\r\n            \r\n            // ÂéãÁº©ÂõæÁâá\r\n            const compressedImage = await this.compressImage(tempFilePath);\r\n            \r\n            // Â∞ùËØï‰∏ä‰º†Âà∞ÊúçÂä°Âô®\r\n            try {\r\n              const uploadResult = await http.upload({\r\n                url: config.API.USER.AVATAR_UPLOAD,\r\n                filePath: compressedImage,\r\n                name: 'avatar',\r\n                formData: { type: 'avatar' }\r\n              });\r\n              this.userInfo.displayAvatar = uploadResult.url || tempFilePath;\r\n            } catch (uploadError) {\r\n              // ‰∏ä‰º†Â§±Ë¥•Ôºå‰ΩøÁî®Êú¨Âú∞ÂõæÁâá\r\n              console.warn('Â§¥ÂÉè‰∏ä‰º†Â§±Ë¥•Ôºå‰ΩøÁî®Êú¨Âú∞ÂõæÁâá', uploadError);\r\n              this.userInfo.displayAvatar = tempFilePath;\r\n            }\r\n            \r\n            uni.showToast({\r\n              title: 'Â§¥ÂÉè‰∏ä‰º†ÊàêÂäü',\r\n              icon: 'success',\r\n              duration: 1500\r\n            });\r\n            \r\n          } catch (error) {\r\n            console.error('Â§ÑÁêÜÂ§¥ÂÉèÂ§±Ë¥•', error);\r\n            uni.showToast({\r\n              title: 'Â§¥ÂÉèÂ§ÑÁêÜÂ§±Ë¥•',\r\n              icon: 'none'\r\n            });\r\n          } finally {\r\n            uni.hideLoading();\r\n          }\r\n        },\r\n        fail: (err) => {\r\n          console.error('ÈÄâÊã©ÂõæÁâáÂ§±Ë¥•', err);\r\n        }\r\n      });\r\n    },\r\n    \r\n    // ÂéãÁº©ÂõæÁâá\r\n    compressImage(tempFilePath) {\r\n      return new Promise((resolve, reject) => {\r\n        uni.compressImage({\r\n          src: tempFilePath,\r\n          quality: 80,\r\n          success: (res) => {\r\n            resolve(res.tempFilePath);\r\n          },\r\n          fail: (error) => {\r\n            console.warn('ÂõæÁâáÂéãÁº©Â§±Ë¥•Ôºå‰ΩøÁî®ÂéüÂõæ', error);\r\n            resolve(tempFilePath);\r\n          }\r\n        });\r\n      });\r\n    },\r\n    \r\n    // ÂàáÊç¢ÊòØÂê¶‰ΩøÁî®ÂæÆ‰ø°ÊòµÁß∞\r\n    toggleUseWechatNickname() {\r\n      this.useWechatNickname = !this.useWechatNickname;\r\n      if (this.useWechatNickname) {\r\n        this.customNickname = '';\r\n      }\r\n    },\r\n    \r\n    // ‰øùÂ≠ò‰∏™‰∫∫ËµÑÊñô\r\n    saveProfile() {\r\n      // È™åËØÅËá™ÂÆö‰πâÊòµÁß∞\r\n      if (!this.useWechatNickname && !this.customNickname.trim()) {\r\n        uni.showToast({\r\n          title: 'ËØ∑ËæìÂÖ•Ëá™ÂÆö‰πâÊòµÁß∞',\r\n          icon: 'none'\r\n        });\r\n        return;\r\n      }\r\n      \r\n      this.isLoading = true;\r\n      \r\n      try {\r\n        // ÊûÑÂª∫ÊúÄÁªàÁî®Êà∑‰ø°ÊÅØ\r\n        const displayName = this.useWechatNickname \r\n          ? this.userInfo.nickName \r\n          : this.customNickname.trim();\r\n          \r\n        const displayAvatar = this.userInfo.displayAvatar || this.userInfo.avatarUrl;\r\n        \r\n        // Êõ¥Êñ∞Êú¨Âú∞Â≠òÂÇ®\r\n        const loginInfo = uni.getStorageSync('login_info') || {};\r\n        loginInfo.userInfo = {\r\n          ...loginInfo.userInfo,\r\n          displayName,\r\n          displayAvatar,\r\n          originalNickName: this.userInfo.nickName,\r\n          originalAvatarUrl: this.userInfo.avatarUrl\r\n        };\r\n        \r\n        uni.setStorageSync('login_info', loginInfo);\r\n        \r\n        uni.showToast({\r\n          title: '‰øùÂ≠òÊàêÂäü',\r\n          icon: 'success',\r\n          duration: 1500\r\n        });\r\n        \r\n        // Âª∂ËøüËøîÂõû\r\n        setTimeout(() => {\r\n          uni.navigateBack();\r\n        }, 1500);\r\n        \r\n      } catch (error) {\r\n        console.error('‰øùÂ≠òÂ§±Ë¥•', error);\r\n        uni.showToast({\r\n          title: '‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï',\r\n          icon: 'none'\r\n        });\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.profile-edit-page {\r\n  min-height: 100vh;\r\n  background: #f5f5f5;\r\n}\r\n\r\n/* ÂÜÖÂÆπÂå∫Âüü */\r\n.content {\r\n  padding: 30rpx;\r\n  margin-top: 20rpx;\r\n}\r\n\r\n/* Âå∫ÂùóÊ†∑Âºè */\r\n.section {\r\n  background: #ffffff;\r\n  border-radius: 16rpx;\r\n  padding: 30rpx;\r\n  margin-bottom: 20rpx;\r\n  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.section-title {\r\n  display: block;\r\n  font-size: 28rpx;\r\n  font-weight: 600;\r\n  color: #333;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n/* Â§¥ÂÉèËÆæÁΩÆ */\r\n.avatar-section {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 30rpx;\r\n}\r\n\r\n.current-avatar {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 16rpx;\r\n}\r\n\r\n.avatar {\r\n  width: 120rpx;\r\n  height: 120rpx;\r\n  border-radius: 60rpx;\r\n  border: 4rpx solid #e5e5e5;\r\n}\r\n\r\n.avatar-label {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n\r\n.avatar-options {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 16rpx;\r\n}\r\n\r\n.avatar-btn {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 12rpx;\r\n  padding: 20rpx;\r\n  background: #f8f8f8;\r\n  border-radius: 12rpx;\r\n  border: none;\r\n  font-size: 28rpx;\r\n  color: #333;\r\n}\r\n\r\n.avatar-btn:active {\r\n  background: #f0f0f0;\r\n}\r\n\r\n.btn-icon {\r\n  font-size: 32rpx;\r\n}\r\n\r\n.btn-text {\r\n  font-size: 28rpx;\r\n}\r\n\r\n/* ÊòµÁß∞ËÆæÁΩÆ */\r\n.nickname-option {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 20rpx;\r\n  background: #f8f8f8;\r\n  border-radius: 12rpx;\r\n  margin-bottom: 16rpx;\r\n  cursor: pointer;\r\n}\r\n\r\n.checkbox {\r\n  width: 28rpx;\r\n  height: 28rpx;\r\n  border: 2rpx solid #d0d0d0;\r\n  border-radius: 6rpx;\r\n  margin-right: 12rpx;\r\n  position: relative;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.checkbox.checked {\r\n  background: #2bad81;\r\n  border-color: #2bad81;\r\n}\r\n\r\n.checkbox.checked::after {\r\n  content: '';\r\n  position: absolute;\r\n  width: 12rpx;\r\n  height: 20rpx;\r\n  border: solid #fff;\r\n  border-width: 0 2rpx 2rpx 0;\r\n  transform: rotate(45deg);\r\n  top: 50%;\r\n  left: 50%;\r\n  margin-top: -10rpx;\r\n  margin-left: -8rpx;\r\n}\r\n\r\n.option-text {\r\n  flex: 1;\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  font-weight: 500;\r\n}\r\n\r\n.current-nickname {\r\n  font-size: 24rpx;\r\n  color: #999;\r\n}\r\n\r\n.custom-nickname {\r\n  background: #f8f8f8;\r\n  border-radius: 12rpx;\r\n  padding: 20rpx;\r\n}\r\n\r\n.nickname-input {\r\n  width: 100%;\r\n  padding: 16rpx;\r\n  border: 1rpx solid #e5e5e5;\r\n  border-radius: 8rpx;\r\n  font-size: 28rpx;\r\n  background: #ffffff;\r\n  margin-bottom: 8rpx;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.char-count {\r\n  display: block;\r\n  font-size: 22rpx;\r\n  color: #999;\r\n  text-align: right;\r\n}\r\n\r\n/* ‰øùÂ≠òÊåâÈíÆ */\r\n.save-section {\r\n  margin-top: 40rpx;\r\n}\r\n\r\n.save-btn {\r\n  width: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 12rpx;\r\n  padding: 28rpx;\r\n  background: #2bad81;\r\n  border-radius: 48rpx;\r\n  border: none;\r\n  color: #ffffff;\r\n  font-size: 30rpx;\r\n  font-weight: 600;\r\n  box-shadow: 0 8rpx 20rpx rgba(43, 173, 129, 0.25);\r\n}\r\n\r\n.save-btn:active {\r\n  opacity: 0.85;\r\n}\r\n\r\n.save-btn[disabled] {\r\n  opacity: 0.6;\r\n}\r\n\r\n.save-icon {\r\n  font-size: 32rpx;\r\n}\r\n\r\n.save-text {\r\n  font-size: 30rpx;\r\n}\r\n</style>\r\n\r\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/love_time/pages/we/profile.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","http","config"],"mappings":"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"}