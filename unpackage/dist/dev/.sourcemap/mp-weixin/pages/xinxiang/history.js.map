{"version":3,"file":"history.js","sources":["pages/xinxiang/history.vue","D:/softcaree/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMveGlueGlhbmcvaGlzdG9yeS52dWU"],"sourcesContent":["<template>\n  <view class=\"history-page\">\n    <!-- 信件列表 -->\n    <view v-if=\"letters.length > 0\" class=\"letter-list\">\n      <view \n        v-for=\"(letter, index) in letters\" \n        :key=\"index\"\n        class=\"letter-card\"\n        @click=\"viewLetter(letter, index)\"\n      >\n        <!-- 缩略图预览 -->\n        <view class=\"card-preview\">\n          <image \n            class=\"preview-bg\" \n            :src=\"getLetterBackground(letter)\" \n            mode=\"aspectFill\"\n          ></image>\n          <view class=\"preview-overlay\" :style=\"{ opacity: 1 - letter.opacity / 100 }\"></view>\n          <view class=\"preview-badge\">\n            <text class=\"badge-text\">{{ letter.style === 'custom' ? '自定义' : '样式' + letter.style }}</text>\n          </view>\n        </view>\n\n        <!-- 信件信息 -->\n        <view class=\"card-info\">\n          <text class=\"card-title\">{{ letter.title }}</text>\n          <view class=\"card-meta\">\n            <text class=\"meta-item\">📅 送达: {{ letter.deliveryDate }}</text>\n            <text class=\"meta-item\">📝 {{ letter.createTime }}</text>\n          </view>\n          <view class=\"card-preview-content\">\n            <text class=\"preview-text\">{{ letter.content.slice(0, 50) }}{{ letter.content.length > 50 ? '...' : '' }}</text>\n          </view>\n        </view>\n\n        <!-- 操作按钮 -->\n        <view class=\"card-actions\">\n          <view class=\"action-btn view\" @click.stop=\"viewLetter(letter, index)\">\n            <text>👁️ 查看</text>\n          </view>\n          <view class=\"action-btn delete\" @click.stop=\"confirmDelete(index)\">\n            <text>🗑️ 删除</text>\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 空状态 -->\n    <view v-else class=\"empty-state\">\n      <text class=\"empty-icon\">✉️</text>\n      <text class=\"empty-text\">还没有写过信件</text>\n      <button class=\"write-btn\" @click=\"goWrite\">写第一封信</button>\n    </view>\n\n    <!-- 信件详情弹窗 -->\n    <view v-if=\"showDetailModal\" class=\"detail-modal-overlay\" @click=\"closeDetail\">\n      <view class=\"detail-modal-content\" @click.stop>\n        <text class=\"detail-modal-title\">信件详情</text>\n        \n        <!-- 信件融合预览 -->\n        <view class=\"letter-detail\">\n          <view class=\"letter-wrapper\">\n            <!-- 底图层 -->\n            <image \n              class=\"letter-bg\" \n              :src=\"getLetterBackground(currentLetter)\" \n              mode=\"aspectFill\"\n            ></image>\n            \n            <!-- 透明度遮罩 -->\n            <view class=\"letter-overlay\" :style=\"{ opacity: 1 - currentLetter.opacity / 100 }\"></view>\n            \n            <!-- 信件内容层 -->\n            <view class=\"letter-content\">\n              <view class=\"letter-header\">\n                <text class=\"letter-title\">{{ currentLetter.title }}</text>\n                <text class=\"letter-date\">送达时间：{{ currentLetter.deliveryDate }}</text>\n              </view>\n              \n              <view class=\"letter-body\">\n                <text class=\"letter-text\">{{ currentLetter.content }}</text>\n              </view>\n              \n              <view class=\"letter-footer\">\n                <text class=\"letter-info\">收件人：{{ currentLetter.phone.slice(0, 3) }}****{{ currentLetter.phone.slice(-4) }}</text>\n                <text class=\"letter-info\" v-if=\"currentLetter.wechat\">微信：{{ currentLetter.wechat }}</text>\n                <text class=\"letter-time\">创建于 {{ currentLetter.createTime }}</text>\n              </view>\n            </view>\n          </view>\n        </view>\n\n        <view class=\"detail-modal-actions\">\n          <button class=\"detail-modal-btn close\" @click=\"closeDetail\">关闭</button>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      letters: [],\n      showDetailModal: false,\n      currentLetter: null,\n      currentIndex: -1\n    };\n  },\n  onLoad() {\n    this.loadLetters();\n  },\n  onShow() {\n    this.loadLetters();\n  },\n  methods: {\n    // 加载信件列表\n    loadLetters() {\n      try {\n        const letters = uni.getStorageSync('xinxiang_letters') || [];\n        this.letters = letters;\n      } catch (e) {\n        console.error('加载信件失败', e);\n        this.letters = [];\n      }\n    },\n    \n    // 获取信件背景图\n    getLetterBackground(letter) {\n      if (letter.style === 'custom') {\n        return letter.customImage;\n      }\n      return `/static/xinxiang/xin${letter.style}.jpg`;\n    },\n    \n    // 查看信件详情\n    viewLetter(letter, index) {\n      this.currentLetter = letter;\n      this.currentIndex = index;\n      this.showDetailModal = true;\n    },\n    \n    // 关闭详情弹窗\n    closeDetail() {\n      this.showDetailModal = false;\n      this.currentLetter = null;\n      this.currentIndex = -1;\n    },\n    \n    // 确认删除\n    confirmDelete(index) {\n      uni.showModal({\n        title: '确认删除',\n        content: '确定要删除这封信件吗？',\n        success: (res) => {\n          if (res.confirm) {\n            this.deleteLetter(index);\n          }\n        }\n      });\n    },\n    \n    // 删除信件\n    deleteLetter(index) {\n      try {\n        this.letters.splice(index, 1);\n        uni.setStorageSync('xinxiang_letters', this.letters);\n        uni.showToast({ title: '已删除', icon: 'success' });\n      } catch (e) {\n        uni.showToast({ title: '删除失败', icon: 'none' });\n      }\n    },\n    \n    // 去写信\n    goWrite() {\n      uni.navigateTo({ url: '/pages/xinxiang/create' });\n    }\n  }\n};\n</script>\n\n<style>\n.history-page {\n  min-height: 100vh;\n  background: #f5f5f5;\n  padding: 24rpx;\n}\n\n/* 信件列表 */\n.letter-list {\n  display: flex;\n  flex-direction: column;\n  gap: 24rpx;\n}\n\n.letter-card {\n  background: #ffffff;\n  border-radius: 24rpx;\n  overflow: hidden;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.08);\n}\n\n/* 缩略图预览 */\n.card-preview {\n  position: relative;\n  width: 100%;\n  height: 240rpx;\n  overflow: hidden;\n}\n\n.preview-bg {\n  width: 100%;\n  height: 100%;\n}\n\n.preview-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: #ffffff;\n}\n\n.preview-badge {\n  position: absolute;\n  top: 16rpx;\n  right: 16rpx;\n  background: rgba(255, 143, 179, 0.9);\n  padding: 8rpx 16rpx;\n  border-radius: 8rpx;\n}\n\n.badge-text {\n  font-size: 22rpx;\n  color: #ffffff;\n  font-weight: 600;\n}\n\n/* 卡片信息 */\n.card-info {\n  padding: 24rpx;\n  display: flex;\n  flex-direction: column;\n  gap: 12rpx;\n}\n\n.card-title {\n  font-size: 32rpx;\n  font-weight: 700;\n  color: #333;\n}\n\n.card-meta {\n  display: flex;\n  flex-direction: column;\n  gap: 8rpx;\n}\n\n.meta-item {\n  font-size: 24rpx;\n  color: #666;\n}\n\n.card-preview-content {\n  margin-top: 8rpx;\n  padding: 16rpx;\n  background: #f5f5f5;\n  border-radius: 12rpx;\n}\n\n.preview-text {\n  font-size: 26rpx;\n  color: #666;\n  line-height: 1.6;\n}\n\n/* 操作按钮 */\n.card-actions {\n  display: flex;\n  border-top: 1rpx solid #f0f0f0;\n}\n\n.action-btn {\n  flex: 1;\n  padding: 24rpx;\n  text-align: center;\n  font-size: 28rpx;\n  transition: background 0.3s;\n}\n\n.action-btn.view {\n  color: #ff8fb3;\n  border-right: 1rpx solid #f0f0f0;\n}\n\n.action-btn.delete {\n  color: #ff4444;\n}\n\n.action-btn:active {\n  background: #f5f5f5;\n}\n\n/* 空状态 */\n.empty-state {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 120rpx 0;\n}\n\n.empty-icon {\n  font-size: 120rpx;\n  margin-bottom: 24rpx;\n}\n\n.empty-text {\n  font-size: 28rpx;\n  color: #999;\n  margin-bottom: 40rpx;\n}\n\n.write-btn {\n  padding: 20rpx 60rpx;\n  background: linear-gradient(135deg, #ff8fb3 0%, #ff7aa0 100%);\n  color: #ffffff;\n  border-radius: 48rpx;\n  font-size: 28rpx;\n  font-weight: 600;\n}\n\n/* 详情弹窗 */\n.detail-modal-overlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.8);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 2000;\n}\n\n.detail-modal-content {\n  width: 90%;\n  max-width: 650rpx;\n  background: #ffffff;\n  border-radius: 24rpx;\n  padding: 32rpx;\n  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.3);\n  max-height: 90vh;\n  display: flex;\n  flex-direction: column;\n}\n\n.detail-modal-title {\n  font-size: 32rpx;\n  font-weight: 700;\n  color: #333;\n  display: block;\n  text-align: center;\n  margin-bottom: 24rpx;\n}\n\n.letter-detail {\n  flex: 1;\n  overflow: hidden;\n  border-radius: 16rpx;\n  margin-bottom: 24rpx;\n}\n\n.letter-wrapper {\n  position: relative;\n  width: 100%;\n  height: 800rpx;\n  border-radius: 16rpx;\n  overflow: hidden;\n  box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);\n}\n\n.letter-bg {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 0;\n}\n\n.letter-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background: #ffffff;\n  z-index: 1;\n}\n\n.letter-content {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  padding: 60rpx 40rpx;\n  display: flex;\n  flex-direction: column;\n  z-index: 2;\n  box-sizing: border-box;\n}\n\n.letter-header {\n  display: flex;\n  flex-direction: column;\n  gap: 12rpx;\n  margin-bottom: 40rpx;\n  padding-bottom: 24rpx;\n  border-bottom: 2rpx solid rgba(0, 0, 0, 0.1);\n}\n\n.letter-title {\n  font-size: 36rpx;\n  font-weight: 700;\n  color: #333;\n}\n\n.letter-date {\n  font-size: 24rpx;\n  color: #666;\n}\n\n.letter-body {\n  flex: 1;\n  overflow-y: auto;\n  margin-bottom: 32rpx;\n}\n\n.letter-text {\n  font-size: 28rpx;\n  line-height: 2;\n  color: #333;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.letter-footer {\n  display: flex;\n  flex-direction: column;\n  gap: 8rpx;\n  padding-top: 24rpx;\n  border-top: 2rpx solid rgba(0, 0, 0, 0.1);\n}\n\n.letter-info {\n  font-size: 24rpx;\n  color: #666;\n}\n\n.letter-time {\n  font-size: 22rpx;\n  color: #999;\n  margin-top: 8rpx;\n}\n\n.detail-modal-actions {\n  display: flex;\n  gap: 16rpx;\n}\n\n.detail-modal-btn {\n  flex: 1;\n  padding: 24rpx;\n  border-radius: 12rpx;\n  font-size: 28rpx;\n  font-weight: 600;\n}\n\n.detail-modal-btn.close {\n  background: linear-gradient(135deg, #ff8fb3 0%, #ff7aa0 100%);\n  color: #ffffff;\n}\n</style>\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/项目/love_time_fu/pages/xinxiang/history.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AAqGA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,SAAS,CAAE;AAAA,MACX,iBAAiB;AAAA,MACjB,eAAe;AAAA,MACf,cAAc;AAAA;EAEjB;AAAA,EACD,SAAS;AACP,SAAK,YAAW;AAAA,EACjB;AAAA,EACD,SAAS;AACP,SAAK,YAAW;AAAA,EACjB;AAAA,EACD,SAAS;AAAA;AAAA,IAEP,cAAc;AACZ,UAAI;AACF,cAAM,UAAUA,cAAG,MAAC,eAAe,kBAAkB,KAAK,CAAA;AAC1D,aAAK,UAAU;AAAA,MACjB,SAAS,GAAG;AACVA,gFAAc,UAAU,CAAC;AACzB,aAAK,UAAU;MACjB;AAAA,IACD;AAAA;AAAA,IAGD,oBAAoB,QAAQ;AAC1B,UAAI,OAAO,UAAU,UAAU;AAC7B,eAAO,OAAO;AAAA,MAChB;AACA,aAAO,uBAAuB,OAAO,KAAK;AAAA,IAC3C;AAAA;AAAA,IAGD,WAAW,QAAQ,OAAO;AACxB,WAAK,gBAAgB;AACrB,WAAK,eAAe;AACpB,WAAK,kBAAkB;AAAA,IACxB;AAAA;AAAA,IAGD,cAAc;AACZ,WAAK,kBAAkB;AACvB,WAAK,gBAAgB;AACrB,WAAK,eAAe;AAAA,IACrB;AAAA;AAAA,IAGD,cAAc,OAAO;AACnBA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,SAAS;AAAA,QACT,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,SAAS;AACf,iBAAK,aAAa,KAAK;AAAA,UACzB;AAAA,QACF;AAAA,MACF,CAAC;AAAA,IACF;AAAA;AAAA,IAGD,aAAa,OAAO;AAClB,UAAI;AACF,aAAK,QAAQ,OAAO,OAAO,CAAC;AAC5BA,sBAAAA,MAAI,eAAe,oBAAoB,KAAK,OAAO;AACnDA,sBAAG,MAAC,UAAU,EAAE,OAAO,OAAO,MAAM,UAAQ,CAAG;AAAA,MACjD,SAAS,GAAG;AACVA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,MAC/C;AAAA,IACD;AAAA;AAAA,IAGD,UAAU;AACRA,oBAAAA,MAAI,WAAW,EAAE,KAAK,yBAA0B,CAAA;AAAA,IAClD;AAAA,EACF;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClLA,GAAG,WAAW,eAAe;"}