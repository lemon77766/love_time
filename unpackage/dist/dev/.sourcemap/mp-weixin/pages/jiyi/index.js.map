{"version":3,"file":"index.js","sources":["pages/jiyi/index.vue","D:/softcaree/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaml5aS9pbmRleC52dWU"],"sourcesContent":["<template>\n  <view class=\"memory-page\">\n    <!-- 顶部标题 -->\n    <view class=\"header\">\n      <text class=\"greeting\">恋爱长河</text>\n      <text class=\"subtext\">  沿着水墨长河，记录你们的每一个恋爱阶段</text>\n    </view>\n\n    <!-- 水墨河流背景与阶段容器 -->\n    <view class=\"river-wrapper\" :class=\"{ active: isRiverActive }\" @mouseenter=\"setHover(true)\" @mouseleave=\"setHover(false)\" @click=\"onRiverClick\" @touchstart=\"onRiverClick\">\n      <!-- 背景底图 -->\n      <image class=\"river-bg\" src=\"/static/changhe/ditu.jpg\" mode=\"aspectFill\" />\n      <!-- 已删除悬停提示 -->\n      <!-- 选择位置提示与临时节点 -->\n      <view v-if=\"showAdd && selectPosMode\" class=\"select-hint\">在长河图片上点击设置节点位置</view>\n      <view v-if=\"tempPos\" class=\"temp-dot\" :style=\"{ top: tempPos.top + '%', left: tempPos.left + '%' }\"></view>\n\n      <!-- 阶段卡片：沿河分布 -->\n      <view\n        v-for=\"(stage, idx) in stages\"\n        :key=\"idx\"\n        class=\"stage-card\"\n        :class=\"stage.side\"\n        :style=\"{ top: stage.top + '%', left: (stage.left || 50) + '%' }\"\n        @click=\"openStage(stage)\"\n      >\n        <!-- 蓝色心形标记点 -->\n        <view class=\"stage-marker\">\n          <text class=\"heart-icon\">💙</text>\n        </view>\n      </view>\n\n      <!-- 添加阶段按钮 -->\n      <view class=\"add-stage\" @click=\"showAdd = true\">\n        <text class=\"add-icon\">＋</text>\n        <text class=\"add-text\">新增阶段</text>\n      </view>\n    </view>\n\n    <!-- 阶段详情弹窗 -->\n    <view v-if=\"showDetail\" class=\"modal-mask\" @click=\"closeDetail\">\n      <view class=\"modal detail-modal\" @click.stop>\n        <image class=\"detail-bg-image\" src=\"/static/changhe/xinfeng.jpg\" mode=\"aspectFill\"></image>\n        <view class=\"detail-content-wrapper\">\n          <text class=\"detail-title\">{{ currentStage.title }}</text>\n          <text class=\"detail-date\">{{ currentStage.date }}</text>\n          <view class=\"detail-content\">\n            <text class=\"detail-desc\" v-if=\"currentStage.description\">{{ currentStage.description }}</text>\n            <text class=\"detail-empty\" v-else>暂无详细描述</text>\n          </view>\n          <view class=\"modal-actions\">\n            <button class=\"btn\" @click=\"closeDetail\">关闭</button>\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <!-- 新增阶段弹窗 -->\n    <view v-if=\"showAdd\" class=\"modal-mask\" @click=\"cancelAdd\">\n      <view class=\"modal\" @click.stop>\n        <text class=\"modal-title\">新增恋爱阶段</text>\n        <view class=\"form\">\n          <view class=\"form-item\">\n            <text class=\"label\">标题</text>\n            <input class=\"input\" v-model=\"form.title\" placeholder=\"如：初遇、表白、第一次旅行\" />\n          </view>\n          <view class=\"form-item\">\n            <text class=\"label\">日期</text>\n            <input class=\"input\" v-model=\"form.date\" placeholder=\"如：2023-05-20\" />\n          </view>\n          <view class=\"form-item\">\n            <text class=\"label\">详细描述</text>\n            <textarea class=\"textarea\" v-model=\"form.description\" placeholder=\"记录更详细的故事...\"></textarea>\n          </view>\n          <view class=\"form-item\">\n            <button class=\"btn primary\" @click=\"onStartSelectPosition\">在长河上选择位置</button>\n            <text v-if=\"form.top !== null\">已选择：Top {{ (form.top||0).toFixed(1) }}%，Left {{ (form.left||0).toFixed(1) }}%</text>\n          </view>\n        </view>\n        <view class=\"modal-actions\">\n          <button class=\"btn secondary\" @click=\"cancelAdd\">取消</button>\n          <button class=\"btn primary\" @click=\"saveAdd\">保存</button>\n        </view>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      stages: [],  // 清空默认阶段，由用户自己添加\n      isRiverActive: false,\n      hoveredIdx: -1,\n      showDetail: false,\n      currentStage: {},\n      showAdd: false,\n      form: {\n        title: '',\n        date: '',\n        description: '',\n        top: null,\n        left: null,\n      },\n      selectPosMode: false,\n      tempPos: null,\n    };\n  },\n  methods: {\n    onSideChange(e) {\n      // 微信/uni picker change 事件：e.detail.value 为索引\n      this.form.sideIndex = Number(e.detail.value || 0);\n    },\n    setHover(v) {\n      // PC: mouseenter/mouseleave 控制；移动端点击触发\n      this.isRiverActive = !!v;\n      if (!v) this.hoveredIdx = -1;\n    },\n    onStartSelectPosition() {\n      // 进入选点模式：关闭弹窗，激活河流交互\n      this.selectPosMode = true;\n      this.showAdd = false;\n      this.isRiverActive = true;\n      this.tempPos = null;\n      uni.showToast({ title: '请在长河上点击选择位置', icon: 'none' });\n    },\n    onRiverClick(e) {\n      // 仅在新增阶段选择位置模式下处理点击/触摸\n      if (!(this.selectPosMode)) return;\n      const touch = (e.touches && e.touches[0]) || (e.changedTouches && e.changedTouches[0]) || e.detail || {};\n      const pageX = touch.pageX || touch.x || 0;\n      const pageY = touch.pageY || touch.y || 0;\n      uni.createSelectorQuery().in(this).select('.river-wrapper').boundingClientRect(rect => {\n        if (!rect || !rect.width || !rect.height) return;\n        const leftPct = Math.max(0, Math.min(100, ((pageX - rect.left) / rect.width) * 100));\n        const topPct = Math.max(0, Math.min(100, ((pageY - rect.top) / rect.height) * 100));\n        this.form.left = leftPct;\n        this.form.top = topPct;\n        this.tempPos = { left: leftPct, top: topPct };\n        this.selectPosMode = false;\n        this.showAdd = true; // 选点完成后回到弹窗显示坐标\n        uni.showToast({ title: '位置已选择', icon: 'none' });\n      }).exec();\n    },\n    setStageHover(idx, v) {\n      if (!this.isRiverActive) return;\n      this.hoveredIdx = v ? idx : -1;\n    },\n    openStage(stage) {\n      // 移除 isRiverActive 限制，允许随时点击查看详情\n      this.currentStage = stage;\n      this.showDetail = true;\n    },\n    closeDetail() {\n      this.showDetail = false;\n      this.currentStage = {};\n    },\n    cancelAdd() {\n      this.showAdd = false;\n      this.resetForm();\n    },\n    saveAdd() {\n      if (!this.form.title || !this.form.date) {\n        uni.showToast({ title: '请填写标题和日期', icon: 'none' });\n        return;\n      }\n      // 根据left位置自动判断侧边\n      const side = (this.form.left != null && this.form.left > 50) ? 'right' : 'left';\n      const top = this.form.top != null ? this.form.top : this.computeNextTop();\n      const left = this.form.left != null ? this.form.left : 50;\n      this.stages.push({\n        title: this.form.title,\n        date: this.form.date,\n        description: this.form.description,\n        side,\n        top,\n        left\n      });\n      this.showAdd = false;\n      this.selectPosMode = false;\n      this.tempPos = null;\n      this.resetForm();\n      uni.showToast({ title: '已新增阶段', icon: 'none' });\n    },\n    computeNextTop() {\n      if (this.stages.length === 0) return 6;\n      const last = this.stages[this.stages.length - 1];\n      // 按照竖向百分比分布，每次向下递增 10-14\n      return Math.min(94, last.top + 12);\n    },\n    resetForm() {\n      this.form = { title: '', date: '', description: '', top: null, left: null };\n    }\n  }\n}\n</script>\n\n<style>\n.memory-page {\n  min-height: 100vh;\n  background-color: #ffffff;\n  padding-bottom: 40rpx;\n}\n\n.header {\n  padding: 40rpx 30rpx 10rpx 30rpx;\n}\n.greeting {\n  font-size: 44rpx;\n  color: #2b2b2b;\n  font-weight: 700;\n}\n.subtext {\n  margin-top: 10rpx;\n  font-size: 26rpx;\n  color: #7a7a7a;\n}\n\n/* 水墨河流区域 */\n.river-wrapper {\n  position: relative;\n  margin: 20rpx;\n  height: 1200rpx; /* 可根据内容增减 */\n  border-radius: 24rpx;\n  overflow: hidden;\n  box-shadow: 0 8rpx 24rpx rgba(0,0,0,0.06);\n}\n/* 已删除 .hover-hint 样式 */\n.select-hint {\n  position: absolute; left: 50%; bottom: 24rpx; transform: translateX(-50%);\n  background: rgba(255,143,179,0.95); color: #ffffff; border-radius: 999rpx;\n  padding: 12rpx 24rpx; font-size: 24rpx; box-shadow: 0 6rpx 16rpx rgba(0,0,0,0.08);\n}\n.temp-dot { position: absolute; width: 18rpx; height: 18rpx; border-radius: 9rpx; background: #ff6b6b; box-shadow: 0 4rpx 10rpx rgba(0,0,0,0.12); }\n/* 已删除 .river-wrapper.active .hover-hint 样式 */\n.river-bg {\n  position: absolute;\n  inset: 0;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  filter: saturate(0.9) contrast(1.05);\n}\n\n/* 阶段卡片沿河分布 */\n.stage-card {\n  position: absolute;\n  width: 40rpx;\n  height: 40rpx;\n  background: transparent;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n}\n\n/* 添加可见的标记点 - 蓝色心形设计 */\n.stage-marker {\n  width: 40rpx;\n  height: 40rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n  filter: drop-shadow(0 4rpx 12rpx rgba(52, 152, 219, 0.5));\n  transition: all 0.3s ease;\n}\n\n/* 心形图标 */\n.heart-icon {\n  font-size: 32rpx;\n  line-height: 1;\n  animation: heartbeat 1.5s infinite;\n}\n\n/* 心跳动画 */\n@keyframes heartbeat {\n  0%, 100% {\n    transform: scale(1);\n  }\n  10% {\n    transform: scale(1.2);\n  }\n  20% {\n    transform: scale(1);\n  }\n  30% {\n    transform: scale(1.2);\n  }\n  40% {\n    transform: scale(1);\n  }\n}\n\n/* 添加蓝色光晕效果 */\n.stage-marker::before {\n  content: '';\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background: radial-gradient(circle, rgba(52, 152, 219, 0.4) 0%, rgba(41, 128, 185, 0.2) 50%, transparent 70%);\n  animation: pulse-heart 2s infinite;\n}\n\n@keyframes pulse-heart {\n  0% {\n    transform: scale(1);\n    opacity: 0.7;\n  }\n  50% {\n    transform: scale(1.8);\n    opacity: 0;\n  }\n  100% {\n    transform: scale(1);\n    opacity: 0;\n  }\n}\n\n.stage-card:active .stage-marker {\n  transform: scale(1.3);\n  filter: drop-shadow(0 6rpx 16rpx rgba(52, 152, 219, 0.7));\n}\n\n.stage-card:active .heart-icon {\n  animation: none;\n  transform: scale(1.2);\n}\n\n.stage-card.left { left: 4%; }\n.stage-card.right { right: 4%; }\n/* 已删除重复的 .stage-dot 样式 */\n.stage-content { flex: 1; }\n.stage-title { font-size: 30rpx; font-weight: 700; color: #2b2b2b; }\n.stage-date { margin-top: 6rpx; font-size: 24rpx; color: #7a7a7a; }\n.stage-desc { margin-top: 8rpx; font-size: 24rpx; color: #555; }\n\n/* 新增阶段按钮 */\n.add-stage {\n  position: absolute;\n  bottom: 20rpx;\n  left: 50%;\n  transform: translateX(-50%);\n  display: flex;\n  align-items: center;\n  gap: 12rpx;\n  background: #ffffff;\n  border-radius: 999rpx;\n  padding: 16rpx 28rpx;\n  box-shadow: 0 6rpx 16rpx rgba(0,0,0,0.08);\n}\n.add-icon { font-size: 32rpx; color: #ffb3c6; font-weight: 700; }\n.add-text { font-size: 26rpx; color: #2b2b2b; }\n\n/* 弹窗样式 */\n.modal-mask {\n  position: fixed;\n  inset: 0;\n  background: rgba(0,0,0,0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 99;\n}\n.modal {\n  width: 86%;\n  max-width: 600rpx;\n  background: #ffffff;\n  border-radius: 24rpx;\n  padding: 40rpx 32rpx;\n  box-shadow: 0 12rpx 40rpx rgba(0,0,0,0.15);\n}\n\n/* 详情弹窗 - 使用默认样式 */\n.detail-modal {\n  position: relative;\n  overflow: hidden;\n  padding: 0;\n  min-height: 600rpx; /* 设置最小高度，让背景图可以显示 */\n}\n\n/* 背景图片 */\n.detail-bg-image {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 0;\n  opacity: 1; /* 确保图片不透明 */\n}\n\n/* 内容容器 - 覆盖在背景图上 */\n.detail-content-wrapper {\n  position: relative;\n  z-index: 1;\n  padding: 40rpx 32rpx;\n  background: rgba(255, 255, 255, 0.5); /* 降低到50%透明度，背景图更明显 */\n  min-height: 600rpx; /* 与弹窗高度一致 */\n}\n\n.detail-title {\n  font-size: 34rpx;\n  font-weight: 700;\n  color: #2b2b2b;\n  display: block;\n}\n\n.detail-date {\n  margin-top: 8rpx;\n  font-size: 26rpx;\n  color: #7a7a7a;\n  display: block;\n}\n\n.detail-content {\n  margin-top: 16rpx;\n}\n\n.detail-desc {\n  font-size: 26rpx;\n  color: #555;\n  line-height: 1.6;\n  display: block;\n}\n\n.detail-empty {\n  font-size: 26rpx;\n  color: #999;\n  text-align: center;\n  padding: 20rpx 0;\n  display: block;\n}\n\n/* 原有样式 */\n.modal-title { font-size: 34rpx; font-weight: 700; color: #2b2b2b; }\n.modal-sub { margin-top: 8rpx; font-size: 26rpx; color: #7a7a7a; }\n.modal-desc { margin-top: 16rpx; font-size: 26rpx; color: #555; line-height: 1.6; }\n.modal-actions { margin-top: 60rpx; display: flex; justify-content: flex-end; gap: 16rpx; }\n.btn { padding: 16rpx 26rpx; border-radius: 12rpx; font-size: 26rpx; border: none; }\n.btn.primary { background: linear-gradient(135deg, #ff8fb3 0%, #ff7aa0 100%); color: #ffffff; }\n.btn.secondary { background: #f0f0f0; color: #333; }\n\n/* 表单样式 */\n.form { margin-top: 14rpx; }\n.form-item { margin-top: 16rpx; }\n.label { font-size: 26rpx; color: #4a4a4a; }\n.input { margin-top: 8rpx; border: 1rpx solid #e6e6e6; border-radius: 12rpx; padding: 14rpx; font-size: 26rpx; }\n.textarea { margin-top: 8rpx; border: 1rpx solid #e6e6e6; border-radius: 12rpx; padding: 14rpx; font-size: 26rpx; min-height: 160rpx; }\n.picker-value { margin-top: 8rpx; font-size: 26rpx; color: #2b2b2b; padding: 14rpx; border: 1rpx solid #e6e6e6; border-radius: 12rpx; }\n</style>\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/项目/love_time_fu/pages/jiyi/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}