{"version":3,"file":"index.js","sources":["pages/login/index.vue","D:/softcaree/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vaW5kZXgudnVl"],"sourcesContent":["<template>\r\n  <view class=\"login-page\">\r\n    <!-- èƒŒæ™¯å›¾ç‰‡ -->\r\n    <image class=\"bg-image\" src=\"/static/login/beijing.jpg\" mode=\"aspectFill\" />\r\n    \r\n    <!-- èƒŒæ™¯è’™ç‰ˆï¼ˆå¢åŠ å¯è¯»æ€§ï¼‰ -->\r\n    <view class=\"bg-overlay\"></view>\r\n\r\n    <!-- å†…å®¹å±‚ -->\r\n    <view class=\"content-wrapper\">\r\n\r\n    <!-- Logo å’Œæ ‡é¢˜ -->\r\n    <view class=\"logo-section\">\r\n      <image class=\"logo\" src=\"/static/zhuye/yellow_love.png\" mode=\"aspectFit\" />\r\n      <text class=\"app-name\">ç”œèœœæ—¶å…‰</text>\r\n      <text class=\"app-slogan\">è®°å½•æ¯ä¸€ä¸ªçˆ±çš„ç¬é—´</text>\r\n    </view>\r\n\r\n    <!-- ç™»å½•åŒºåŸŸï¼ˆæ— å¡ç‰‡ï¼‰ -->\r\n    <view class=\"login-area\">\r\n      <!-- ç”¨æˆ·ä¿¡æ¯é¢„è§ˆï¼ˆæˆæƒåæ˜¾ç¤ºï¼‰ -->\r\n      <view v-if=\"userInfo.nickName\" class=\"user-preview\">\r\n        <image class=\"avatar\" :src=\"userInfo.avatarUrl\" mode=\"aspectFill\" />\r\n        <text class=\"nickname\">{{ userInfo.nickName }}</text>\r\n      </view>\r\n\r\n      <!-- ç™»å½•æŒ‰é’® -->\r\n      <button \r\n        v-if=\"!isLoggedIn\" \r\n        class=\"login-btn\" \r\n        @click=\"handleWxLogin\"\r\n        :loading=\"isLoading\"\r\n      >\r\n        <text class=\"btn-icon\">ğŸ“±</text>\r\n        <text class=\"btn-text\">å¾®ä¿¡æˆæƒç™»å½•</text>\r\n      </button>\r\n\r\n      <!-- è¿›å…¥æŒ‰é’® -->\r\n      <button \r\n        v-else \r\n        class=\"enter-btn\" \r\n        @click=\"enterApp\"\r\n      >\r\n        <text class=\"btn-text\">è¿›å…¥ç”œèœœæ—¶å…‰</text>\r\n      </button>\r\n\r\n      <!-- æç¤ºä¿¡æ¯ -->\r\n      <view class=\"tips\">\r\n        <text class=\"tip-text\">ç™»å½•å³è¡¨ç¤ºåŒæ„</text>\r\n        <text class=\"link-text\">ã€Šç”¨æˆ·åè®®ã€‹</text>\r\n        <text class=\"tip-text\">å’Œ</text>\r\n        <text class=\"link-text\">ã€Šéšç§æ”¿ç­–ã€‹</text>\r\n      </view>\r\n    </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { wxLogin } from '@/api/login.js';\r\nimport config from '@/utils/config.js';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      isLoggedIn: false,\r\n      isLoading: false,\r\n      userInfo: {\r\n        nickName: '',\r\n        avatarUrl: ''\r\n      }\r\n    };\r\n  },\r\n  onLoad() {\r\n    // æ£€æŸ¥æ˜¯å¦å·²ç™»å½•\r\n    this.checkLoginStatus();\r\n  },\r\n  methods: {\r\n    // æ£€æŸ¥ç™»å½•çŠ¶æ€\r\n    checkLoginStatus() {\r\n      try {\r\n        const loginInfo = uni.getStorageSync('login_info');\r\n        if (loginInfo && loginInfo.isLoggedIn) {\r\n          this.isLoggedIn = true;\r\n          this.userInfo = loginInfo.userInfo || {};\r\n        }\r\n      } catch (e) {\r\n        console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥', e);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * å¾®ä¿¡æˆæƒç™»å½•ä¸»æµç¨‹\r\n     * æµç¨‹è¯´æ˜ï¼š\r\n     * 1. è°ƒç”¨ wx.login è·å–ä¸´æ—¶ç™»å½•å‡­è¯ code\r\n     * 2. è°ƒç”¨ uni.getUserProfile è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆæ˜µç§°ã€å¤´åƒï¼‰\r\n     * 3. å°† code å’Œç”¨æˆ·ä¿¡æ¯å‘é€åˆ°åç«¯æœåŠ¡å™¨\r\n     * 4. åç«¯éªŒè¯åè¿”å› session_key å’Œ openid\r\n     * 5. å‰ç«¯ä¿å­˜ç™»å½•çŠ¶æ€å’Œç”¨æˆ·ä¿¡æ¯\r\n     */\r\n    async handleWxLogin() {\r\n      this.isLoading = true;\r\n\r\n      try {\r\n        // æ­¥éª¤1ï¼šè°ƒç”¨ wx.login è·å– code\r\n        const loginCode = await this.getWxLoginCode();\r\n        console.log('è·å–åˆ°ç™»å½•å‡­è¯ code:', loginCode);\r\n\r\n        // æ­¥éª¤2ï¼šè·å–ç”¨æˆ·ä¿¡æ¯\r\n        const userProfile = await this.getUserProfile();\r\n        console.log('è·å–åˆ°ç”¨æˆ·ä¿¡æ¯:', userProfile);\r\n        \r\n        // æ­¥éª¤3ï¼šå°† code å’Œç”¨æˆ·ä¿¡æ¯å‘é€åˆ°åç«¯\r\n        const loginResult = await this.sendLoginToBackend(loginCode, userProfile);\r\n        console.log('åç«¯éªŒè¯ç»“æœ:', loginResult);\r\n\r\n        // æ­¥éª¤4ï¼šä¿å­˜ç”¨æˆ·ä¿¡æ¯å’Œç™»å½•çŠ¶æ€\r\n        this.userInfo = {\r\n          nickName: userProfile.nickName,\r\n          avatarUrl: userProfile.avatarUrl\r\n        };\r\n\r\n        // ä¿å­˜ç™»å½•ä¿¡æ¯åˆ°æœ¬åœ°å­˜å‚¨\r\n        const loginInfo = {\r\n          isLoggedIn: true,\r\n          userInfo: this.userInfo,\r\n          token: loginResult.token || '',  // åç«¯è¿”å›çš„ token\r\n          openid: loginResult.openid || '',  // åç«¯è¿”å›çš„ openid\r\n          sessionKey: loginResult.session_key || '',  // åç«¯è¿”å›çš„ session_key\r\n          loginTime: new Date().toISOString()\r\n        };\r\n        uni.setStorageSync('login_info', loginInfo);\r\n\r\n        this.isLoggedIn = true;\r\n\r\n        // æ­¥éª¤5ï¼šæç¤ºç™»å½•æˆåŠŸ\r\n        uni.showToast({\r\n          title: 'ç™»å½•æˆåŠŸ',\r\n          icon: 'success',\r\n          duration: 1500\r\n        });\r\n\r\n        // æ­¥éª¤6ï¼šå»¶è¿Ÿè¿›å…¥é¦–é¡µ\r\n        setTimeout(() => {\r\n          this.enterApp();\r\n        }, 1500);\r\n        \r\n      } catch (e) {\r\n        console.error('ç™»å½•å¤±è´¥', e);\r\n        uni.showToast({\r\n          title: e.errMsg || 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•',\r\n          icon: 'none'\r\n        });\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * è°ƒç”¨å¾®ä¿¡ wx.login æ¥å£è·å–ä¸´æ—¶ç™»å½•å‡­è¯ code\r\n     * @returns {Promise<string>} è¿”å› codeå­—ç¬¦ä¸²\r\n     */\r\n    getWxLoginCode() {\r\n      return new Promise((resolve, reject) => {\r\n        // #ifdef MP-WEIXIN\r\n        uni.login({\r\n          provider: 'weixin',\r\n          success: (res) => {\r\n            if (res.code) {\r\n              resolve(res.code);\r\n            } else {\r\n              reject(new Error('è·å–codeå¤±è´¥'));\r\n            }\r\n          },\r\n          fail: (err) => {\r\n            reject(err);\r\n          }\r\n        });\r\n        // #endif\r\n\r\n        // #ifndef MP-WEIXIN\r\n        // H5 æˆ–å…¶ä»–å¹³å°è¿”å›æ¨¡æ‹Ÿ code\r\n        resolve('mock_code_' + Date.now());\r\n        // #endif\r\n      });\r\n    },\r\n\r\n    /**\r\n     * è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆå¾®ä¿¡å°ç¨‹åºï¼‰\r\n     * @returns {Promise<Object>} è¿”å›ç”¨æˆ·ä¿¡æ¯å¯¹è±¡\r\n     */\r\n    getUserProfile() {\r\n      return new Promise((resolve, reject) => {\r\n        // #ifdef MP-WEIXIN\r\n        uni.getUserProfile({\r\n          desc: 'ç”¨äºå®Œå–„ç”¨æˆ·èµ„æ–™',\r\n          success: (res) => {\r\n            resolve(res.userInfo);\r\n          },\r\n          fail: (err) => {\r\n            reject(err);\r\n          }\r\n        });\r\n        // #endif\r\n\r\n        // #ifndef MP-WEIXIN\r\n        // H5 æˆ–å…¶ä»–å¹³å°ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®\r\n        resolve({\r\n          nickName: 'æ¸¸å®¢ç”¨æˆ·',\r\n          avatarUrl: '/static/zhuye/smile.png'\r\n        });\r\n        // #endif\r\n      });\r\n    },\r\n\r\n    /**\r\n     * å°†ç™»å½•ä¿¡æ¯å‘é€åˆ°åç«¯æœåŠ¡å™¨ï¼ˆä½¿ç”¨å°è£…å¥½çš„APIï¼‰\r\n     * @param {string} code - å¾®ä¿¡ç™»å½•å‡­è¯\r\n     * @param {Object} userInfo - ç”¨æˆ·ä¿¡æ¯\r\n     * @returns {Promise<Object>} è¿”å›åç«¯å“åº”æ•°æ®\r\n     */\r\n    async sendLoginToBackend(code, userInfo) {\r\n      try {\r\n        // è°ƒç”¨å°è£…å¥½çš„ç™»å½•API\r\n        const result = await wxLogin(code, userInfo);\r\n        return result;\r\n      } catch (error) {\r\n        // å¼€å‘é˜¶æ®µï¼šå¦‚æœåç«¯æœªå°±ç»ªï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®\r\n        if (process.env.NODE_ENV === 'development') {\r\n          console.warn('å¼€å‘æ¨¡å¼ï¼šä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œåç«¯æ¥å£æœªå°±ç»ª');\r\n          console.warn('åç«¯æ¥å£åœ°å€åº”ä¸ºï¼š', config.baseURL + config.API.LOGIN.WECHAT);\r\n          return {\r\n            token: 'mock_token_' + Date.now(),\r\n            openid: 'mock_openid',\r\n            session_key: 'mock_session_key'\r\n          };\r\n        }\r\n        throw error;\r\n      }\r\n    },\r\n\r\n    // è¿›å…¥åº”ç”¨\r\n    enterApp() {\r\n      uni.reLaunch({\r\n        url: '/pages/index/index'\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.login-page {\r\n  min-height: 100vh;\r\n  position: relative;\r\n  overflow: hidden;\r\n}\r\n\r\n/* èƒŒæ™¯å›¾ç‰‡ */\r\n.bg-image {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  z-index: 0;\r\n}\r\n\r\n/* èƒŒæ™¯è’™ç‰ˆï¼ˆè®©æ–‡å­—æ›´æ¸…æ™°ï¼‰ */\r\n.bg-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(255, 255, 255, 0.15);\r\n  z-index: 1;\r\n}\r\n\r\n/* å†…å®¹å±‚ */\r\n.content-wrapper {\r\n  position: relative;\r\n  z-index: 2;\r\n  min-height: 100vh;\r\n  padding: 40rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n/* ç§»é™¤æ—§çš„èƒŒæ™¯è£…é¥° */\r\n.bg-decoration {\r\n  display: none;\r\n}\r\n\r\n.heart {\r\n  display: none;\r\n}\r\n\r\n/* Logo åŒºåŸŸ */\r\n.logo-section {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-bottom: 80rpx;\r\n}\r\n\r\n.logo {\r\n  width: 180rpx;\r\n  height: 180rpx;\r\n  margin-bottom: 30rpx;\r\n  animation: pulse 2s ease-in-out infinite;\r\n}\r\n\r\n@keyframes pulse {\r\n  0%, 100% {\r\n    transform: scale(1);\r\n  }\r\n  50% {\r\n    transform: scale(1.05);\r\n  }\r\n}\r\n\r\n.app-name {\r\n  font-size: 48rpx;\r\n  font-weight: 700;\r\n  color: #2bad81;\r\n  margin-bottom: 16rpx;\r\n}\r\n\r\n.app-slogan {\r\n  font-size: 26rpx;\r\n  color: #4e3c3c;\r\n}\r\n\r\n/* ç™»å½•åŒºåŸŸï¼ˆæ— å¡ç‰‡èƒŒæ™¯ï¼‰ */\r\n.login-area {\r\n  width: 70%;\r\n  max-width: 500rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n\r\n/* ç§»é™¤æ—§çš„ç™»å½•å¡ç‰‡æ ·å¼ */\r\n.login-card {\r\n  display: none;\r\n}\r\n\r\n/* ç§»é™¤æ¬¢è¿æ–‡å­—æ ·å¼ */\r\n.welcome-text {\r\n  display: none;\r\n}\r\n\r\n.subtitle {\r\n  display: none;\r\n}\r\n\r\n/* ç”¨æˆ·ä¿¡æ¯é¢„è§ˆ */\r\n.user-preview {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  margin-bottom: 40rpx;\r\n}\r\n\r\n.avatar {\r\n  width: 120rpx;\r\n  height: 120rpx;\r\n  border-radius: 60rpx;\r\n  border: 4rpx solid #e5e5e5;\r\n  margin-bottom: 20rpx;\r\n}\r\n\r\n.nickname {\r\n  font-size: 28rpx;\r\n  color: #333;\r\n  font-weight: 600;\r\n}\r\n\r\n/* ç™»å½•æŒ‰é’® */\r\n.login-btn, .enter-btn {\r\n  width: 100%;\r\n  background: #2bad81;\r\n  border-radius: 48rpx;\r\n  padding: 28rpx 0;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 12rpx;\r\n  box-shadow: 0 8rpx 20rpx rgba(43, 173, 129, 0.25);\r\n  margin-bottom: 30rpx;\r\n  border: none;\r\n  color: #ffffff;\r\n}\r\n\r\n.login-btn::after, .enter-btn::after {\r\n  border: none;\r\n}\r\n\r\n.login-btn:active, .enter-btn:active {\r\n  opacity: 0.85;\r\n}\r\n\r\n.enter-btn {\r\n  background: #2bad81;\r\n  box-shadow: 0 8rpx 20rpx rgba(43, 173, 129, 0.25);\r\n}\r\n\r\n.btn-icon {\r\n  font-size: 32rpx;\r\n}\r\n\r\n.btn-text {\r\n  font-size: 30rpx;\r\n  font-weight: 600;\r\n  color: #ffffff;\r\n}\r\n\r\n/* æç¤ºä¿¡æ¯ */\r\n.tips {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 8rpx;\r\n  padding: 16rpx 32rpx;\r\n  background: rgba(255, 255, 255, 0.85);\r\n  border-radius: 20rpx;\r\n  backdrop-filter: blur(8px);\r\n}\r\n\r\n.tip-text {\r\n  font-size: 22rpx;\r\n  color: #666;\r\n}\r\n\r\n.link-text {\r\n  font-size: 22rpx;\r\n  color: #2bad81;\r\n}\r\n\r\n/* åº•éƒ¨ */\r\n.footer {\r\n  position: relative;\r\n  margin-top: 40rpx;\r\n  text-align: center;\r\n}\r\n\r\n.footer-text {\r\n  font-size: 24rpx;\r\n  color: #666;\r\n  text-shadow: 0 2rpx 4rpx rgba(255, 255, 255, 0.8);\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/love_time/pages/login/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","wxLogin","config"],"mappings":"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"}