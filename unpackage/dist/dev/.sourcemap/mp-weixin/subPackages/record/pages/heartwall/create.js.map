{"version":3,"file":"create.js","sources":["subPackages/record/pages/heartwall/create.vue","D:/softcaree/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3ViUGFja2FnZXNccmVjb3JkXHBhZ2VzXGhlYXJ0d2FsbFxjcmVhdGUudnVl"],"sourcesContent":["<template>\n  <view class=\"create-page\" :style=\"{ paddingTop: containerPaddingTop }\">\n    <!-- Ëá™ÂÆö‰πâÂØºËà™Ê†èÔºà‰∏éÈ¶ñÈ°µ‰∏ÄËá¥Ôºâ -->\n    <view class=\"custom-navbar\">\n      <view class=\"navbar-gradient-bg\"></view>\n      <view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\n      <view class=\"navbar-content\" :style=\"{ height: navBarHeight + 'px' }\">\n        <view class=\"navbar-left\" @click=\"goBack\">\n          <text class=\"back-icon\">‚Üê</text>\n        </view>\n        <view class=\"navbar-title\">\n          <text class=\"title-text\">Áà±ÂøÉÁÖßÁâáÂ¢ô</text>\n        </view>\n        <view class=\"navbar-right\"></view>\n      </view>\n    </view>\n    <view class=\"center\">\n      <view id=\"heartArea\" class=\"heart-grid\">\n        <view v-for=\"(cell, idx) in heartMask\" :key=\"idx\" class=\"cell\" :class=\"{ hole: !cell, filled: cell && images[idx] }\" @tap=\"onPickSingle(idx)\">\n          <image v-if=\"images[idx]\" :src=\"images[idx]\" mode=\"aspectFill\" />\n        </view>\n      </view>\n    </view>\n\n    <!-- ÁÖßÁâáÊï∞ÈáèÊèêÁ§∫ -->\n    <view class=\"photo-count\">\n      <text class=\"count-text\">Â∑≤Ê∑ªÂä† {{ filledCount }}/{{ totalSlots }} Âº†ÁÖßÁâá</text>\n      <text v-if=\"filledCount > 0\" class=\"clear-btn\" @click=\"clearAllImages\">Ê∏ÖÁ©∫</text>\n    </view>\n\n    <view class=\"actions\">\n      <button class=\"btn yellow\" @click=\"onBatchUpload\">\n        ÊâπÈáè‰∏ä‰º†ÁÖßÁâá ({{ remainingSlots > 0 ? `ËøòÂèØÊ∑ªÂä†${Math.min(9, remainingSlots)}Âº†` : 'Â∑≤Êª°' }})\n      </button>\n      <button class=\"btn green\" @click=\"onSaveProject\">‰øùÂ≠òÈ°πÁõÆ</button>\n      \n    </view>\n  </view>\n</template>\n\n<script>\nimport { createProject, updateProject, uploadPhoto, uploadPhotoWithFile, getProjectDetail, getProjectPhotos, clearProjectPhotos, updatePhoto } from '@/api/heartwall.js';\nimport http from '@/utils/http.js';\nimport config from '@/utils/config.js';\n\n// Â§ÑÁêÜÂõæÁâáURLÔºöÂ¶ÇÊûúÊòØÁõ∏ÂØπË∑ØÂæÑÔºåÊãºÊé•baseURL\nfunction processImageUrl(url) {\n  if (!url || url === '') {\n    return '';\n  }\n  \n  // Â¶ÇÊûúÂ∑≤ÁªèÊòØÂÆåÊï¥ÁöÑURLÔºàhttp:// Êàñ https://ÔºâÔºåÁõ¥Êé•ËøîÂõû\n  if (url.startsWith('http://') || url.startsWith('https://')) {\n    return url;\n  }\n  \n  // Â¶ÇÊûúÊòØÁõ∏ÂØπË∑ØÂæÑÔºà‰ª• / ÂºÄÂ§¥ÔºâÔºåÊãºÊé•baseURL\n  if (url.startsWith('/')) {\n    // ÂÖºÂÆπÈîôËØØËøîÂõûÁöÑÂâçÁ´ØË∑ØÂæÑÔºåÂ¶Ç /pages/heartwall/uploads/... -> ÂΩí‰∏ÄÂåñ‰∏∫ /uploads/... ÊàñÂéªÊéâ /pages ÂâçÁºÄ\n    if (url.startsWith('/pages/')) {\n      const stripped = url.replace(/^\\/pages/, '');\n      const uploadsIndex = stripped.indexOf('/uploads/');\n      if (uploadsIndex !== -1) {\n        url = stripped.slice(uploadsIndex);\n      } else {\n        url = stripped.startsWith('/') ? stripped : '/' + stripped;\n      }\n    }\n    // ÁßªÈô§baseURLÊú´Â∞æÂèØËÉΩÂ≠òÂú®ÁöÑÊñúÊù†ÔºåÈÅøÂÖçÂèåÊñúÊù†\n    const baseUrl = config.baseURL.endsWith('/') ? config.baseURL.slice(0, -1) : config.baseURL;\n    return baseUrl + url;\n  }\n  \n  // ÂÖ∂‰ªñÊÉÖÂÜµÔºàÂèØËÉΩÊòØÁõ∏ÂØπË∑ØÂæÑ‰ΩÜ‰∏ç‰ª•/ÂºÄÂ§¥ÔºâÔºå‰πüÂ∞ùËØïÊãºÊé•\n  const baseUrl = config.baseURL.endsWith('/') ? config.baseURL.slice(0, -1) : config.baseURL;\n  return baseUrl + '/' + url;\n}\n\nexport default {\n  data() {\n    return {\n      statusBarHeight: 0,\n      navBarHeight: 44,\n      screenWidth: 375,\n      // 9x9 ÂøÉÂΩ¢Êé©Á†ÅÔºà1 Ë°®Á§∫ÂèØÂ°´ÂÖÖÔºå0 Ë°®Á§∫Á©∫‰ΩçÔºâÔºõÂèØÊåâÈúÄË∞ÉÊï¥\n      heartMask: [\n        0,1,1,0,0,1,1,0,0,\n        1,1,1,1,1,1,1,1,0,\n        1,1,1,1,1,1,1,1,0,\n        1,1,1,1,1,1,1,1,0,\n        0,1,1,1,1,1,1,0,0,\n        0,0,1,1,1,1,0,0,0,\n        0,0,0,1,1,0,0,0,0,\n        0,0,0,0,0,0,0,0,0,\n        0,0,0,0,0,0,0,0,0\n      ],\n      images: [],\n      editingProjectId: null,  // Ê≠£Âú®ÁºñËæëÁöÑÈ°πÁõÆIDÔºånull Ë°®Á§∫ÂàõÂª∫Êñ∞È°πÁõÆ\n      saving: false,  // ‰øùÂ≠ò‰∏≠Áä∂ÊÄÅ\n      photoMap: {}  // Â≠òÂÇ®positionIndexÂà∞photoIdÁöÑÊò†Â∞Ñ { positionIndex: photoId }\n    };\n  },\n  computed: {\n    containerPaddingTop() {\n      const totalHeightPx = this.statusBarHeight + this.navBarHeight;\n      const pxToRpx = 750 / this.screenWidth;\n      return totalHeightPx * pxToRpx + 'rpx';\n    },\n    // ÊÄªÂÖ±ÂèØÂ°´ÂÖÖÁöÑ‰ΩçÁΩÆÊï∞\n    totalSlots() {\n      return this.heartMask.filter(cell => cell === 1).length;\n    },\n    // Â∑≤Â°´ÂÖÖÁöÑÁÖßÁâáÊï∞\n    filledCount() {\n      let count = 0;\n      for (let i = 0; i < this.heartMask.length; i++) {\n        if (this.heartMask[i] && this.images[i]) {\n          count++;\n        }\n      }\n      return count;\n    },\n    // Ââ©‰ΩôÂèØÊ∑ªÂä†ÁöÑÁÖßÁâáÊï∞\n    remainingSlots() {\n      return this.totalSlots - this.filledCount;\n    }\n  },\n  async mounted() {\n    this.getSystemInfo();\n    // Ê£ÄÊü•ÊòØÂê¶Âú®ÁºñËæëÁé∞ÊúâÈ°πÁõÆ\n    try {\n      const editingProjectId = uni.getStorageSync('heartwall_editing_projectId');\n      if (editingProjectId) {\n        this.editingProjectId = editingProjectId;\n        // ‰ªéÂêéÁ´ØÂä†ËΩΩÈ°πÁõÆÊï∞ÊçÆ\n        await this.loadProjectFromBackend(editingProjectId);\n      } else {\n        // Â¶ÇÊûúÊ≤°ÊúâÈ°πÁõÆIDÔºåÂ∞ùËØï‰ªéÊú¨Âú∞ÁºìÂ≠òÂä†ËΩΩÔºàÂÖºÂÆπÊóßÊï∞ÊçÆÔºâ\n      const cached = uni.getStorageSync('heartwall_grid_images');\n      if (Array.isArray(cached)) {\n        this.images = cached;\n      }\n      }\n    } catch (e) {\n      console.error('Âä†ËΩΩÈ°πÁõÆÊï∞ÊçÆÂ§±Ë¥•:', e);\n    }\n  },\n  methods: {\n    goBack() {\n      uni.navigateBack();\n    },\n    getSystemInfo() {\n      // #ifdef MP-WEIXIN\n      try {\n        const windowInfo = wx.getWindowInfo && wx.getWindowInfo();\n        if (windowInfo) {\n          this.statusBarHeight = windowInfo.statusBarHeight || 0;\n          this.screenWidth = windowInfo.windowWidth || 375;\n        } else {\n          const sys = uni.getSystemInfoSync();\n          this.statusBarHeight = sys.statusBarHeight || 0;\n          this.screenWidth = sys.windowWidth || 375;\n        }\n      } catch (e) {\n        const sys = uni.getSystemInfoSync();\n        this.statusBarHeight = sys.statusBarHeight || 0;\n        this.screenWidth = sys.windowWidth || 375;\n      }\n      this.navBarHeight = 44;\n      // #endif\n      // #ifdef H5\n      const sysH5 = uni.getSystemInfoSync();\n      this.statusBarHeight = sysH5.statusBarHeight || 0;\n      this.screenWidth = sysH5.windowWidth || 375;\n      this.navBarHeight = 44;\n      // #endif\n      // #ifndef MP-WEIXIN || H5\n      const sysOther = uni.getSystemInfoSync();\n      this.statusBarHeight = sysOther.statusBarHeight || 0;\n      this.screenWidth = sysOther.windowWidth || 375;\n      this.navBarHeight = 44;\n      // #endif\n    },\n    async onBatchUpload() {\n      // ËÆ°ÁÆóÁ©∫‰ΩçÊï∞Èáè\n      const emptySlots = this.getEmptySlots();\n      if (emptySlots.length === 0) {\n        uni.showToast({ title: 'ÁÖßÁâáÂ¢ôÂ∑≤Êª°', icon: 'none' });\n        return;\n      }\n\n      try {\n        // uni-app ‰∏ÄÊ¨°ÊúÄÂ§öÈÄâÊã© 9 Âº†ÂõæÁâáÔºàÂæÆ‰ø°Â∞èÁ®ãÂ∫èÈôêÂà∂Ôºâ\n        const maxCount = Math.min(9, emptySlots.length);\n        const res = await uni.chooseImage({ \n          count: maxCount, \n          sizeType: ['compressed'], \n          sourceType: ['album', 'camera'] \n        });\n        \n        if (!res || !res.tempFilePaths || res.tempFilePaths.length === 0) return;\n        \n        const files = res.tempFilePaths;\n        \n        // ÊåâÈ°∫Â∫èÂ°´ÂÖÖÁ©∫‰Ωç\n        for (let i = 0; i < files.length && i < emptySlots.length; i++) {\n          const idx = emptySlots[i];\n          this.$set(this.images, idx, files[i]);\n        }\n        \n        this.persist();\n        \n        // ÊèêÁ§∫Áî®Êà∑\n        const remainingSlots = emptySlots.length - files.length;\n        if (remainingSlots > 0) {\n          uni.showToast({ \n            title: `Â∑≤Ê∑ªÂä†${files.length}Âº†ÔºåËøòÂèØÊ∑ªÂä†${remainingSlots}Âº†`, \n            icon: 'none',\n            duration: 2000\n          });\n        } else {\n          uni.showToast({ \n            title: `Â∑≤Ê∑ªÂä†${files.length}Âº†ÁÖßÁâá`, \n            icon: 'success' \n          });\n        }\n      } catch (e) {\n        console.error('ÊâπÈáè‰∏ä‰º†Â§±Ë¥•:', e);\n      }\n    },\n    \n    // Ëé∑ÂèñÊâÄÊúâÁ©∫‰ΩçÁöÑÁ¥¢Âºï\n    getEmptySlots() {\n      const slots = [];\n      for (let i = 0; i < this.heartMask.length; i++) {\n        if (this.heartMask[i] && !this.images[i]) {\n          slots.push(i);\n        }\n      }\n      return slots;\n    },\n    \n    // Ê∏ÖÁ©∫ÊâÄÊúâÁÖßÁâá\n    async clearAllImages() {\n      uni.showModal({\n        title: 'Á°ÆËÆ§Ê∏ÖÁ©∫',\n        content: 'Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÁÖßÁâáÂêóÔºüÊ∏ÖÁ©∫ÂêéÊó†Ê≥ïÊÅ¢Â§ç„ÄÇ',\n        success: async (res) => {\n          if (res.confirm) {\n            try {\n              // Â¶ÇÊûúÊúâÈ°πÁõÆIDÔºåË∞ÉÁî®ÂêéÁ´ØÊé•Âè£Ê∏ÖÁ©∫\n              if (this.editingProjectId) {\n                uni.showLoading({ title: 'Ê∏ÖÁ©∫‰∏≠...', mask: true });\n                console.log('üóëÔ∏è [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂºÄÂßãÊ∏ÖÁ©∫È°πÁõÆÁÖßÁâáÔºåÈ°πÁõÆID:', this.editingProjectId);\n                \n                await clearProjectPhotos(this.editingProjectId);\n                \n                console.log('‚úÖ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] È°πÁõÆÁÖßÁâáÊ∏ÖÁ©∫ÊàêÂäü');\n                uni.hideLoading();\n              }\n              \n              // Ê∏ÖÁ©∫ÂâçÁ´ØÊï∞ÊçÆ\n              this.images = [];\n              this.photoMap = {};\n              this.persist();\n              \n            uni.showToast({ title: 'Â∑≤Ê∏ÖÁ©∫', icon: 'success' });\n            } catch (error) {\n              console.error('‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] Ê∏ÖÁ©∫È°πÁõÆÁÖßÁâáÂ§±Ë¥•:', error);\n              uni.hideLoading();\n              \n              // Âç≥‰ΩøÂêéÁ´ØÊ∏ÖÁ©∫Â§±Ë¥•Ôºå‰πüÊ∏ÖÁ©∫ÂâçÁ´ØÊï∞ÊçÆ\n              this.images = [];\n              this.persist();\n              \n              uni.showToast({ \n                title: error.message || 'Ê∏ÖÁ©∫Â§±Ë¥•ÔºåÂ∑≤Ê∏ÖÁ©∫Êú¨Âú∞Êï∞ÊçÆ', \n                icon: 'none',\n                duration: 2000\n              });\n            }\n          }\n        }\n      });\n    },\n    async onPickSingle(idx) {\n      if (!this.heartMask[idx]) return;\n      \n      try {\n        // ÈÄâÊã©Êñ∞ÂõæÁâá\n        const res = await uni.chooseImage({ \n          count: 1,\n          sizeType: ['compressed'],\n          sourceType: ['album', 'camera']\n        });\n        \n        if (!res || !res.tempFilePaths || !res.tempFilePaths[0]) {\n          return;\n        }\n        \n        const newImagePath = res.tempFilePaths[0];\n        const isExistingPhoto = this.images[idx] && this.editingProjectId;\n        const photoId = this.photoMap[idx];\n        \n        // Â¶ÇÊûúÂ∑≤ÊúâÈ°πÁõÆ‰∏îÊúâphotoIdÔºåËØ¥ÊòéÊòØÊõøÊç¢Â∑≤ÊúâÁÖßÁâá\n        if (isExistingPhoto && photoId) {\n          uni.showLoading({ title: 'ÊõøÊç¢‰∏≠...', mask: true });\n          \n          try {\n            console.log(`üîÑ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂºÄÂßãÊõøÊç¢‰ΩçÁΩÆ ${idx} ÁöÑÁÖßÁâáÔºåphotoId: ${photoId}`);\n            \n            // 1. ‰∏ä‰º†Êñ∞ÂõæÁâáÂà∞ÊúçÂä°Âô®\n            console.log('üì§ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰∏ä‰º†Êñ∞ÂõæÁâáÂà∞ÊúçÂä°Âô®...');\n            const photoUrl = await this.uploadImageToServer(newImagePath);\n            console.log('‚úÖ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] Êñ∞ÂõæÁâá‰∏ä‰º†ÊàêÂäüÔºåURL:', photoUrl);\n            \n            // 2. Êõ¥Êñ∞ÂêéÁ´ØÁÖßÁâá‰ø°ÊÅØ\n            const updateData = {\n              photoUrl: photoUrl,\n              thumbnailUrl: photoUrl,\n              positionIndex: idx\n            };\n            \n            console.log('üìù [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] Êõ¥Êñ∞ÂêéÁ´ØÁÖßÁâá‰ø°ÊÅØ...');\n            await updatePhoto(photoId, updateData);\n            console.log('‚úÖ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂêéÁ´ØÁÖßÁâáÊõ¥Êñ∞ÊàêÂäü');\n            \n            // 3. Êõ¥Êñ∞ÂâçÁ´ØÊòæÁ§∫\n            this.$set(this.images, idx, photoUrl);\n            this.persist();\n            \n            uni.hideLoading();\n            uni.showToast({ \n              title: 'ÊõøÊç¢ÊàêÂäü', \n              icon: 'success',\n              duration: 1500\n            });\n          } catch (error) {\n            console.error('‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÊõøÊç¢ÁÖßÁâáÂ§±Ë¥•:', error);\n            uni.hideLoading();\n            uni.showToast({ \n              title: error.message || 'ÊõøÊç¢Â§±Ë¥•ÔºåËØ∑ÈáçËØï', \n              icon: 'none',\n              duration: 2000\n            });\n          }\n        } else {\n          // Êñ∞Ê∑ªÂä†ÁÖßÁâáÔºàÈ°πÁõÆÊú™ÂàõÂª∫ÊàñËØ•‰ΩçÁΩÆÊ≤°ÊúâÁÖßÁâáÔºâ\n          // ÊöÇÊó∂Âè™Êõ¥Êñ∞ÂâçÁ´ØÊòæÁ§∫Ôºå‰øùÂ≠òÈ°πÁõÆÊó∂‰ºöÁªü‰∏Ä‰∏ä‰º†\n          this.$set(this.images, idx, newImagePath);\n          this.persist();\n          \n          uni.showToast({ \n            title: 'Â∑≤Ê∑ªÂä†ÁÖßÁâá', \n            icon: 'success',\n            duration: 1000\n          });\n        }\n      } catch (e) {\n        console.error('‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÈÄâÊã©ÂõæÁâáÂ§±Ë¥•:', e);\n        uni.showToast({ \n          title: 'ÈÄâÊã©ÂõæÁâáÂ§±Ë¥•', \n          icon: 'none'\n        });\n      }\n    },\n    onInvite() {\n      uni.showToast({ title: 'ÈÇÄËØ∑ÂäüËÉΩÂæÖÊé•ÂÖ•ÂêéÁ´Ø', icon: 'none' });\n    },\n    \n    // Âä†ËΩΩÈ°πÁõÆÊï∞ÊçÆÔºà‰ªéÂêéÁ´ØÔºâ\n    async loadProjectFromBackend(projectId) {\n      try {\n        console.log('üì° [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂºÄÂßã‰ªéÂêéÁ´ØÂä†ËΩΩÈ°πÁõÆËØ¶ÊÉÖ ID:', projectId);\n        \n        // Ëé∑ÂèñÈ°πÁõÆËØ¶ÊÉÖ\n        const projectResponse = await getProjectDetail(projectId);\n        console.log('üì° [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] È°πÁõÆËØ¶ÊÉÖ:', projectResponse);\n        \n        // Ëé∑ÂèñÈ°πÁõÆÁÖßÁâáÂàóË°®\n        const photosResponse = await getProjectPhotos(projectId, { page: 1, pageSize: 100 });\n        console.log('üì° [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] È°πÁõÆÁÖßÁâá:', photosResponse);\n        \n        // Â§ÑÁêÜÁÖßÁâáÊï∞ÊçÆ\n        let photosData = [];\n        if (photosResponse && photosResponse.data) {\n          photosData = Array.isArray(photosResponse.data) ? photosResponse.data : (photosResponse.data.photos || []);\n        } else if (Array.isArray(photosResponse)) {\n          photosData = photosResponse;\n        } else if (photosResponse && photosResponse.photos) {\n          photosData = photosResponse.photos;\n        }\n        \n        // Â∞ÜÁÖßÁâáÊåâ‰ΩçÁΩÆÁ¥¢ÂºïÂ°´ÂÖÖÂà∞imagesÊï∞ÁªÑÔºåÂêåÊó∂‰øùÂ≠òphotoIdÊò†Â∞Ñ\n        this.images = [];\n        this.photoMap = {};\n        photosData.forEach(photo => {\n          const positionIndex = photo.positionIndex || photo.position_index || 0;\n          const photoId = photo.photoId || photo.photo_id || photo.id;\n          if (positionIndex >= 0 && positionIndex < this.heartMask.length) {\n            // ‰ºòÂÖà‰ΩøÁî®photoUrlÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàô‰ΩøÁî®thumbnailUrl\n            const rawUrl = photo.photoUrl || photo.photo_url || photo.thumbnailUrl || photo.thumbnail_url || '';\n            // Â§ÑÁêÜURLÔºöÂ¶ÇÊûúÊòØÁõ∏ÂØπË∑ØÂæÑÔºåÊãºÊé•baseURL\n            const processedUrl = processImageUrl(rawUrl);\n            console.log(`üñºÔ∏è [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰ΩçÁΩÆ ${positionIndex} ÂéüÂßãURL: ${rawUrl}, Â§ÑÁêÜÂêéURL: ${processedUrl}`);\n            this.$set(this.images, positionIndex, processedUrl);\n            // ‰øùÂ≠òphotoIdÊò†Â∞Ñ\n            if (photoId) {\n              this.$set(this.photoMap, positionIndex, photoId);\n            }\n          }\n        });\n        \n        console.log(`‚úÖ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÊàêÂäüÂä†ËΩΩ ${photosData.length} Âº†ÁÖßÁâá`);\n        console.log('üì∑ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÁÖßÁâáIDÊò†Â∞Ñ:', this.photoMap);\n        console.log('üñºÔ∏è [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÁÖßÁâáURLÂàóË°®:', this.images.filter(url => url));\n      } catch (error) {\n        console.error('‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] Âä†ËΩΩÈ°πÁõÆÊï∞ÊçÆÂ§±Ë¥•:', error);\n        uni.showToast({ \n          title: 'Âä†ËΩΩÈ°πÁõÆÂ§±Ë¥•', \n          icon: 'none',\n          duration: 2000\n        });\n      }\n    },\n    \n    // ÂéãÁº©ÂõæÁâá\n    compressImage(tempFilePath) {\n      return new Promise((resolve, reject) => {\n        uni.compressImage({\n          src: tempFilePath,\n          quality: 80,\n          success: (res) => {\n            console.log('‚úÖ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂõæÁâáÂéãÁº©ÊàêÂäüÔºåÊñ∞Ë∑ØÂæÑ:', res.tempFilePath);\n            resolve(res.tempFilePath);\n          },\n          fail: (error) => {\n            console.warn('‚ö†Ô∏è [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂõæÁâáÂéãÁº©Â§±Ë¥•Ôºå‰ΩøÁî®ÂéüÂõæ', error);\n            resolve(tempFilePath);\n          }\n        });\n      });\n    },\n    \n    // ‰∏ä‰º†ÂçïÂº†ÂõæÁâáÂà∞ÊúçÂä°Âô®Ëé∑ÂèñURL\n    async uploadImageToServer(filePath) {\n      try {\n        console.log('üì§ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂºÄÂßã‰∏ä‰º†ÂõæÁâáÂà∞ÊúçÂä°Âô®ÔºåÂéüÂßãË∑ØÂæÑ:', filePath);\n        \n        // È™åËØÅÊñá‰ª∂Ë∑ØÂæÑÔºöÂ¶ÇÊûúÂ∑≤ÁªèÊòØURLÔºå‰∏çÂ∫îËØ•‰∏ä‰º†\n        if (filePath && (filePath.startsWith('http://') || filePath.startsWith('https://'))) {\n          console.warn('‚ö†Ô∏è [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] Êñá‰ª∂Ë∑ØÂæÑÂ∑≤ÁªèÊòØURLÊ†ºÂºèÔºåË∑≥Ëøá‰∏ä‰º†:', filePath);\n          return filePath;\n        }\n        \n        // Â§ÑÁêÜÂºÇÂ∏∏Ë∑ØÂæÑÊ†ºÂºèÔºöhttp://tmp/... ËΩ¨Êç¢‰∏∫ /tmp/...\n        let validFilePath = filePath;\n        if (filePath && filePath.startsWith('http://tmp/')) {\n          validFilePath = filePath.replace('http://tmp/', '/tmp/');\n          console.log('üîß [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰øÆÂ§çË∑ØÂæÑÊ†ºÂºè:', filePath, '->', validFilePath);\n        }\n        \n        // ÂÖàÂéãÁº©ÂõæÁâáÔºàÂéãÁº©‰ºöËøîÂõûÊñ∞ÁöÑ‰∏¥Êó∂Êñá‰ª∂Ë∑ØÂæÑÔºåÂèØËÉΩÊúâÂä©‰∫éËß£ÂÜ≥Ë∑ØÂæÑÈóÆÈ¢òÔºâ\n        console.log('üîÑ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂéãÁº©ÂõæÁâá‰∏≠...');\n        const compressedPath = await this.compressImage(validFilePath);\n        console.log('‚úÖ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂõæÁâáÂéãÁº©ÂÆåÊàêÔºå‰ΩøÁî®Ë∑ØÂæÑ:', compressedPath);\n        \n        // Â∞ùËØï‰ΩøÁî®Áî®Êà∑Â§¥ÂÉè‰∏ä‰º†Êé•Âè£‰Ωú‰∏∫ÈÄöÁî®ÂõæÁâá‰∏ä‰º†Êé•Âè£\n        // Â¶ÇÊûúÂêéÁ´ØÊúâ‰∏ìÈó®ÁöÑÁà±ÂøÉÂ¢ôÂõæÁâá‰∏ä‰º†Êé•Âè£ÔºåÂèØ‰ª•Âú®ËøôÈáåÊõøÊç¢\n        const uploadUrl = config.API.USER.AVATAR_UPLOAD;\n        \n        console.log('üì§ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂºÄÂßã‰∏ä‰º†Êñá‰ª∂ÔºåË∑ØÂæÑ:', compressedPath);\n        const result = await http.upload({\n          url: uploadUrl,\n          filePath: compressedPath,\n          name: 'avatar',  // Â§¥ÂÉè‰∏ä‰º†Êé•Âè£ÊúüÊúõÁöÑÂ≠óÊÆµÂêç\n          formData: { type: 'heart-wall-photo' }\n        });\n        \n        console.log('‚úÖ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂõæÁâá‰∏ä‰º†ÊàêÂäüÔºåËøîÂõûURL:', result);\n        \n        // ËøîÂõûÂõæÁâáURLÔºåÊ†πÊçÆÂêéÁ´ØËøîÂõûÊ†ºÂºèË∞ÉÊï¥\n        const imageUrl = result.url || result.photoUrl || result.photo_url || result.data?.url || filePath;\n        console.log('üñºÔ∏è [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] Ëé∑ÂèñÂà∞ÂõæÁâáURL:', imageUrl);\n        return imageUrl;\n      } catch (error) {\n        console.error('‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂõæÁâá‰∏ä‰º†Â§±Ë¥•:', error);\n        console.error('üî¥ ÈîôËØØËØ¶ÊÉÖ:', {\n          message: error.message,\n          filePath: filePath,\n          stack: error.stack\n        });\n        // ‰∏ä‰º†Â§±Ë¥•Êó∂ÔºåÂ¶ÇÊûúÂêéÁ´ØÊîØÊåÅÁõ¥Êé•‰º†Êñá‰ª∂Ë∑ØÂæÑÔºåÂèØ‰ª•Â∞ùËØïÁõ¥Êé•‰ΩøÁî®\n        // Âê¶ÂàôÊäõÂá∫ÈîôËØØËÆ©‰∏äÂ±ÇÂ§ÑÁêÜ\n        throw error;\n      }\n    },\n    \n    // ‰øùÂ≠òÈ°πÁõÆÂà∞ÂàóË°®È°µ\n    onSaveProject() {\n      if (this.filledCount === 0) {\n        uni.showToast({ title: 'ËØ∑Ëá≥Â∞ëÊ∑ªÂä†‰∏ÄÂº†ÁÖßÁâá', icon: 'none' });\n        return;\n      }\n\n      if (this.saving) {\n        uni.showToast({ title: '‰øùÂ≠ò‰∏≠ÔºåËØ∑Á®çÂÄô...', icon: 'none' });\n        return;\n      }\n\n      // ÂºπÂá∫ËæìÂÖ•Ê°ÜÔºåËÆ©Áî®Êà∑ËæìÂÖ•È°πÁõÆÂêçÁß∞ÂíåÊèèËø∞\n      uni.showModal({\n        title: this.editingProjectId ? '‰øùÂ≠ò‰øÆÊîπ' : '‰øùÂ≠òÈ°πÁõÆ',\n        editable: true,\n        placeholderText: 'ËØ∑ËæìÂÖ•È°πÁõÆÂêçÁß∞',\n        success: async (res) => {\n          if (res.confirm) {\n            const projectName = res.content || 'ÊàëÁöÑÁà±ÂøÉÂ¢ô';\n            await this.saveProjectData(projectName);\n          }\n        }\n      });\n    },\n    \n    // ‰øùÂ≠òÈ°πÁõÆÊï∞ÊçÆÔºàË∞ÉÁî®ÂêéÁ´ØAPIÔºâ\n    async saveProjectData(projectName) {\n      this.saving = true;\n      \n      try {\n        uni.showLoading({ title: '‰øùÂ≠ò‰∏≠...', mask: true });\n        \n        console.log('üíæ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂºÄÂßã‰øùÂ≠òÈ°πÁõÆÂà∞ÂêéÁ´Ø');\n\n      // ÊûÑÂª∫È°πÁõÆÊï∞ÊçÆ\n      const projectData = {\n          projectName: projectName,\n          description: `ÂÖ±${this.filledCount}Âº†ÁÖßÁâá`,\n          isPublic: false,\n          maxPhotos: this.totalSlots\n        };\n        \n        let projectId;\n        let createResponse = null; // Áî®‰∫éÈîôËØØË∞ÉËØï\n        \n        // ÂàõÂª∫ÊàñÊõ¥Êñ∞È°πÁõÆ\n        if (this.editingProjectId) {\n          // Êõ¥Êñ∞Áé∞ÊúâÈ°πÁõÆ\n          console.log('üîÑ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] Êõ¥Êñ∞È°πÁõÆ ID:', this.editingProjectId);\n          await updateProject(this.editingProjectId, projectData);\n          projectId = this.editingProjectId;\n        } else {\n          // ÂàõÂª∫Êñ∞È°πÁõÆ\n          console.log('‚ú® [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂàõÂª∫Êñ∞È°πÁõÆ');\n          createResponse = await createProject(projectData);\n          console.log('‚úÖ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] È°πÁõÆÂàõÂª∫ÊàêÂäü:', createResponse);\n          \n          // Ëé∑ÂèñÈ°πÁõÆID - ÊîØÊåÅÂ§öÁßçÂìçÂ∫îÊ†ºÂºè\n          if (createResponse && createResponse.data) {\n            // Ê†ºÂºè: { data: { projectId: ..., id: ... } }\n            projectId = createResponse.data.projectId || createResponse.data.id;\n          } else if (createResponse && createResponse.project) {\n            // Ê†ºÂºè: { project: { projectId: ..., id: ... } }\n            projectId = createResponse.project.projectId || createResponse.project.id;\n          } else if (createResponse && (createResponse.projectId || createResponse.id)) {\n            // Ê†ºÂºè: { projectId: ..., id: ... }\n            projectId = createResponse.projectId || createResponse.id;\n          }\n          \n          console.log('üîç [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÊèêÂèñÁöÑÈ°πÁõÆID:', projectId);\n          \n          // Â¶ÇÊûúÂàõÂª∫È°πÁõÆÂêé‰ªçÊó†Ê≥ïËé∑ÂèñIDÔºåÊäõÂá∫ËØ¶ÁªÜÈîôËØØ\n          if (!projectId) {\n            console.error('‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] Êó†Ê≥ïËé∑ÂèñÈ°πÁõÆID');\n            console.error('üì¶ [ÂìçÂ∫îÊï∞ÊçÆÁªìÊûÑ]:', JSON.stringify(createResponse, null, 2));\n            throw new Error('Êó†Ê≥ïËé∑ÂèñÈ°πÁõÆIDÔºåËØ∑Ê£ÄÊü•ÂêéÁ´ØËøîÂõûÁöÑÊï∞ÊçÆÊ†ºÂºè');\n          }\n        }\n        \n        console.log('üìù [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] È°πÁõÆID:', projectId);\n        \n        // Á¨¨‰∏ÄÊ≠•ÔºöÊî∂ÈõÜÊâÄÊúâÈúÄË¶Å‰∏ä‰º†ÁöÑÁÖßÁâá‰ø°ÊÅØ\n        const photoTasks = [];\n        for (let i = 0; i < this.heartMask.length; i++) {\n          if (this.heartMask[i] && this.images[i]) {\n            photoTasks.push({\n              positionIndex: i,\n              imagePath: this.images[i]\n            });\n          }\n        }\n        \n        console.log(`üìã [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂáÜÂ§á‰∏ä‰º† ${photoTasks.length} Âº†ÁÖßÁâá`);\n        \n        // Á¨¨‰∫åÊ≠•Ôºö‰∏ä‰º†ÁÖßÁâá\n        // ÊñπÂºè1Ôºö‰ΩøÁî®Áõ¥Êé•‰∏ä‰º†ÊñπÂºèÔºàmultipart/form-dataÔºå‰∏ÄÊ≠•ÂÆåÊàêÔºåÊé®ËçêÔºâ\n        // ÊñπÂºè2Ôºö‰ΩøÁî®JSONÊ†ºÂºèÔºàÂÖà‰∏ä‰º†Êñá‰ª∂Ëé∑ÂèñURLÔºåÂÜçÂèëÈÄÅJSONÊï∞ÊçÆÔºâ\n        // ËøôÈáå‰ΩøÁî®ÊñπÂºè1ÔºàÁõ¥Êé•‰∏ä‰º†ÔºâÔºåÂ¶ÇÊûúÈúÄË¶Å‰ΩøÁî®ÊñπÂºè2ÔºåÂèØ‰ª•ÂèñÊ∂àÊ≥®Èáä‰∏ãÈù¢ÁöÑ‰ª£Á†Å\n        \n        const USE_DIRECT_UPLOAD = false; // ËÆæÁΩÆ‰∏∫true‰ΩøÁî®Áõ¥Êé•‰∏ä‰º†Ôºåfalse‰ΩøÁî®JSONÊ†ºÂºè\n        \n        let savePromises;\n        let validPhotos;\n        \n        if (USE_DIRECT_UPLOAD) {\n          // ÊñπÂºè1ÔºöÁõ¥Êé•‰∏ä‰º†Êñá‰ª∂Ôºàmultipart/form-dataÔºâ\n          console.log('üì§ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰ΩøÁî®Áõ¥Êé•‰∏ä‰º†ÊñπÂºèÔºàmultipart/form-dataÔºâ');\n          \n          savePromises = photoTasks.map(async (task) => {\n            const { positionIndex, imagePath } = task;\n            \n            // Âà§Êñ≠ÊòØÂê¶ÊòØÊú¨Âú∞‰∏¥Êó∂Ë∑ØÂæÑÔºàÈúÄË¶Å‰∏ä‰º†Ôºâ\n            const isTmpPath = imagePath && (imagePath.startsWith('http://tmp/') || imagePath.startsWith('https://tmp/'));\n            // Âà§Êñ≠ÊòØÂê¶ÊòØÁúüÊ≠£ÁöÑHTTP/HTTPS URLÔºàÊéíÈô§‰∏¥Êó∂Ë∑ØÂæÑÔºâ\n            const isRealUrl = imagePath && \n                             (imagePath.startsWith('http://') || imagePath.startsWith('https://')) &&\n                             !isTmpPath;\n            // Âà§Êñ≠ÊòØÂê¶ÊòØÊú¨Âú∞Ë∑ØÂæÑÔºàÈúÄË¶Å‰∏ä‰º†Ôºâ\n            const isLocalPath = !isRealUrl && !imagePath.startsWith('data:');\n            \n            // Ê£ÄÊü•ËØ•‰ΩçÁΩÆÊòØÂê¶Â∑≤ÊúâphotoIdÔºàÂ∑≤Â≠òÂú®ÁöÑÁÖßÁâáÔºâ\n            const existingPhotoId = this.photoMap[positionIndex];\n            \n            if (isLocalPath || isTmpPath) {\n              // Êú¨Âú∞Êñá‰ª∂Ôºå‰ΩøÁî®Áõ¥Êé•‰∏ä‰º†ÊñπÂºè\n              try {\n                if (existingPhotoId) {\n                  // Â∑≤ÊúâÁÖßÁâáÔºåÂÖàÊõ¥Êñ∞URLÔºåÁÑ∂Âêé‰ΩøÁî®updatePhotoÊõ¥Êñ∞ÂÖ∂‰ªñ‰ø°ÊÅØ\n                  // Ê≥®ÊÑèÔºöÂ¶ÇÊûúÂêéÁ´ØÊîØÊåÅÂú®multipart/form-data‰∏≠Êõ¥Êñ∞ÔºåÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®\n                  // ËøôÈáåÂÖà‰∏ä‰º†Êñá‰ª∂Ëé∑ÂèñURLÔºåÁÑ∂ÂêéÊõ¥Êñ∞\n                  console.log(`üîÑ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰ΩçÁΩÆ ${positionIndex} Â∑≤ÊúâÁÖßÁâá(photoId: ${existingPhotoId})ÔºåÂÖà‰∏ä‰º†Êñá‰ª∂...`);\n                  const photoUrl = await this.uploadImageToServer(imagePath);\n                  const photoData = {\n                    photoUrl: photoUrl,\n                    thumbnailUrl: photoUrl,\n                    positionIndex: positionIndex\n                  };\n                  return updatePhoto(existingPhotoId, photoData).catch(error => {\n                    console.error(`‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÁÖßÁâá ${positionIndex} Êõ¥Êñ∞Â§±Ë¥•:`, error);\n                    return null;\n                  });\n                } else {\n                  // Êñ∞ÁÖßÁâáÔºåÁõ¥Êé•‰∏ä‰º†Êñá‰ª∂+ÂÖÉÊï∞ÊçÆ\n                  console.log(`üì§ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] Áõ¥Êé•‰∏ä‰º†ÁÖßÁâá ${positionIndex}ÔºàÊñá‰ª∂+ÂÖÉÊï∞ÊçÆÔºâ...`);\n                  const result = await uploadPhotoWithFile({\n                    filePath: imagePath,\n                    projectId: projectId,\n                    positionIndex: positionIndex\n                  });\n                  console.log(`‚úÖ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÁÖßÁâá ${positionIndex} ‰∏ä‰º†ÊàêÂäü`);\n                  return result;\n                }\n              } catch (uploadError) {\n                console.error(`‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÁÖßÁâá ${positionIndex} ‰∏ä‰º†Â§±Ë¥•:`, uploadError);\n                return null;\n              }\n            } else {\n              // Â∑≤ÁªèÊòØURLÔºå‰ΩøÁî®JSONÊ†ºÂºèÊõ¥Êñ∞ÊàñÊñ∞Â¢û\n              const photoData = {\n                photoUrl: imagePath,\n                thumbnailUrl: imagePath,\n                positionIndex: positionIndex\n              };\n              \n              if (existingPhotoId) {\n                console.log(`üîÑ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰ΩçÁΩÆ ${positionIndex} Â∑≤ÊúâÁÖßÁâá(photoId: ${existingPhotoId})Ôºå‰ΩøÁî®Êõ¥Êñ∞Êé•Âè£`);\n                return updatePhoto(existingPhotoId, photoData).catch(error => {\n                  console.error(`‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÁÖßÁâá ${positionIndex} Êõ¥Êñ∞Â§±Ë¥•:`, error);\n                  return null;\n                });\n              } else {\n                console.log(`‚ûï [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰ΩçÁΩÆ ${positionIndex} ‰∏∫Êñ∞ÁÖßÁâáÔºå‰ΩøÁî®Êñ∞Â¢ûÊé•Âè£`);\n                const createData = {\n                  ...photoData,\n                  projectId: projectId\n                };\n                return uploadPhoto(createData).catch(error => {\n                  console.error(`‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÁÖßÁâá ${positionIndex} ‰øùÂ≠òÂ§±Ë¥•:`, error);\n                  return null;\n                });\n              }\n            }\n          });\n          \n          validPhotos = photoTasks; // Áõ¥Êé•‰∏ä‰º†ÊñπÂºèÔºåÊâÄÊúâ‰ªªÂä°ÈÉΩÊòØÊúâÊïàÁÖßÁâá\n        } else {\n          // ÊñπÂºè2ÔºöÂÖà‰∏ä‰º†Êñá‰ª∂Ëé∑ÂèñURLÔºåÂÜçÂèëÈÄÅJSONÊï∞ÊçÆÔºàÂéüÊúâÊñπÂºèÔºâ\n          console.log('üì§ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰ΩøÁî®JSONÊ†ºÂºè‰∏ä‰º†ÊñπÂºèÔºà‰∏§Ê≠•ÂÆåÊàêÔºâ');\n          \n          const photoUploadPromises = photoTasks.map(async (task) => {\n            const { positionIndex, imagePath } = task;\n            \n            // Âà§Êñ≠ÊòØÂê¶ÊòØÊú¨Âú∞‰∏¥Êó∂Ë∑ØÂæÑÔºàÈúÄË¶Å‰∏ä‰º†Ôºâ\n            const isTmpPath = imagePath && (imagePath.startsWith('http://tmp/') || imagePath.startsWith('https://tmp/'));\n            // Âà§Êñ≠ÊòØÂê¶ÊòØÁúüÊ≠£ÁöÑHTTP/HTTPS URLÔºàÊéíÈô§‰∏¥Êó∂Ë∑ØÂæÑÔºâ\n            const isRealUrl = imagePath && \n                             (imagePath.startsWith('http://') || imagePath.startsWith('https://')) &&\n                             !isTmpPath;\n            // Âà§Êñ≠ÊòØÂê¶ÊòØÊú¨Âú∞Ë∑ØÂæÑÔºàÈúÄË¶Å‰∏ä‰º†Ôºâ\n            const isLocalPath = !isRealUrl && !imagePath.startsWith('data:');\n            \n            if (isLocalPath || isTmpPath) {\n              try {\n                console.log(`üì§ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰∏ä‰º†ÂõæÁâá ${positionIndex} Âà∞ÊúçÂä°Âô®...`);\n                const photoUrl = await this.uploadImageToServer(imagePath);\n                console.log(`‚úÖ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂõæÁâá ${positionIndex} ‰∏ä‰º†ÊàêÂäü`);\n                return {\n                  positionIndex,\n                  photoUrl,\n                  thumbnailUrl: photoUrl\n                };\n              } catch (uploadError) {\n                console.error(`‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂõæÁâá ${positionIndex} ‰∏ä‰º†Â§±Ë¥•:`, uploadError);\n                return null;\n              }\n            } else {\n              // Â∑≤ÁªèÊòØURLÔºåÁõ¥Êé•‰ΩøÁî®\n              return {\n                positionIndex,\n                photoUrl: imagePath,\n                thumbnailUrl: imagePath\n              };\n            }\n          });\n          \n          // Á≠âÂæÖÊâÄÊúâÂõæÁâá‰∏ä‰º†ÂÆåÊàê\n          const photoUrls = await Promise.all(photoUploadPromises);\n          \n          // ËøáÊª§Êéâ‰∏ä‰º†Â§±Ë¥•ÁöÑÂõæÁâá\n          validPhotos = photoUrls.filter(photo => photo !== null);\n          const failedCount = photoUrls.length - validPhotos.length;\n          \n          if (failedCount > 0) {\n            console.warn(`‚ö†Ô∏è [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ${failedCount} Âº†ÂõæÁâá‰∏ä‰º†Â§±Ë¥•`);\n            uni.showToast({ \n              title: `${failedCount} Âº†ÁÖßÁâá‰∏ä‰º†Â§±Ë¥•ÔºåÂÖ∂‰ΩôÁÖßÁâáÂ∞ÜÁªßÁª≠‰øùÂ≠ò`, \n              icon: 'none',\n              duration: 3000\n            });\n          }\n          \n          // Á¨¨‰∏âÊ≠•ÔºöÂ∞ÜÊâÄÊúâÊàêÂäüÁöÑÁÖßÁâá‰ø°ÊÅØ‰øùÂ≠òÂà∞ÂêéÁ´Ø\n          savePromises = validPhotos.map(photo => {\n            const photoData = {\n              photoUrl: photo.photoUrl,\n              thumbnailUrl: photo.thumbnailUrl,\n              positionIndex: photo.positionIndex\n            };\n            \n            // Ê£ÄÊü•ËØ•‰ΩçÁΩÆÊòØÂê¶Â∑≤ÊúâphotoIdÔºàÂ∑≤Â≠òÂú®ÁöÑÁÖßÁâáÔºâ\n            const existingPhotoId = this.photoMap[photo.positionIndex];\n            \n            if (existingPhotoId) {\n              // ËØ•‰ΩçÁΩÆÂ∑≤ÊúâÁÖßÁâáÔºå‰ΩøÁî®Êõ¥Êñ∞Êé•Âè£\n              console.log(`üîÑ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰ΩçÁΩÆ ${photo.positionIndex} Â∑≤ÊúâÁÖßÁâá(photoId: ${existingPhotoId})Ôºå‰ΩøÁî®Êõ¥Êñ∞Êé•Âè£`);\n              return updatePhoto(existingPhotoId, photoData).catch(error => {\n                console.error(`‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÁÖßÁâá ${photo.positionIndex} Êõ¥Êñ∞Â§±Ë¥•:`, error);\n                return null;\n              });\n            } else {\n              // ËØ•‰ΩçÁΩÆÊ≤°ÊúâÁÖßÁâáÔºå‰ΩøÁî®Êñ∞Â¢ûÊé•Âè£\n              console.log(`‚ûï [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰ΩçÁΩÆ ${photo.positionIndex} ‰∏∫Êñ∞ÁÖßÁâáÔºå‰ΩøÁî®Êñ∞Â¢ûÊé•Âè£`);\n              const createData = {\n                ...photoData,\n                projectId: projectId\n              };\n              return uploadPhoto(createData).catch(error => {\n                console.error(`‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÁÖßÁâá ${photo.positionIndex} ‰øùÂ≠òÂ§±Ë¥•:`, error);\n                return null;\n              });\n            }\n          });\n        }\n        \n        // Á≠âÂæÖÊâÄÊúâÁÖßÁâá‰øùÂ≠òÂÆåÊàê\n        console.log(`üíæ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÂºÄÂßã‰øùÂ≠ò ${savePromises.length} Âº†ÁÖßÁâá‰ø°ÊÅØ`);\n        const saveResults = await Promise.all(savePromises);\n        const savedCount = saveResults.filter(r => r !== null).length;\n        \n        const totalPhotos = USE_DIRECT_UPLOAD ? photoTasks.length : validPhotos.length;\n        console.log(`‚úÖ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ÊàêÂäü‰øùÂ≠ò ${savedCount}/${totalPhotos} Âº†ÁÖßÁâá`);\n        \n        // Êõ¥Êñ∞photoMapÔºå‰øùÂ≠òÊñ∞‰∏ä‰º†ÁÖßÁâáÁöÑphotoIdÊò†Â∞Ñ\n        saveResults.forEach((result, index) => {\n          if (result && result.data) {\n            const photoId = result.data.photoId || result.data.photo_id || result.data.id;\n            let photo;\n            \n            if (USE_DIRECT_UPLOAD) {\n              // Áõ¥Êé•‰∏ä‰º†ÊñπÂºèÔºö‰ªéphotoTasksËé∑Âèñ\n              photo = photoTasks[index];\n            } else {\n              // JSONÊ†ºÂºèÊñπÂºèÔºö‰ªévalidPhotosËé∑Âèñ\n              photo = validPhotos[index];\n            }\n            \n            if (photoId && photo) {\n              const positionIndex = photo.positionIndex || photo.index;\n              // Âè™ÊúâÊñ∞Â¢ûÁöÑÁÖßÁâáÊâçÈúÄË¶ÅÊõ¥Êñ∞photoMapÔºàÂ∑≤ÊúâÁöÑÁÖßÁâáphotoMapÂ∑≤ÁªèÂ≠òÂú®Ôºâ\n              if (positionIndex !== undefined && !this.photoMap[positionIndex]) {\n                this.$set(this.photoMap, positionIndex, photoId);\n                console.log(`üì∑ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] Êõ¥Êñ∞ÁÖßÁâáÊò†Â∞Ñ: positionIndex=${positionIndex}, photoId=${photoId}`);\n              } else if (positionIndex !== undefined) {\n                console.log(`üì∑ [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰ΩçÁΩÆ ${positionIndex} ÁÖßÁâáÂ∑≤Â≠òÂú®(photoId: ${photoId})ÔºåÊó†ÈúÄÊõ¥Êñ∞Êò†Â∞Ñ`);\n              }\n            }\n          }\n        });\n        \n        // ‰øùÂ≠òÈ°πÁõÆIDÔºå‰ª•‰æøÂêéÁª≠ÂèØ‰ª•ÁªßÁª≠ÁºñËæë\n        this.editingProjectId = projectId;\n        uni.setStorageSync('heartwall_editing_projectId', projectId);\n        \n        uni.hideLoading();\n        uni.showToast({ \n          title: this.editingProjectId ? '‰øÆÊîπÊàêÂäü' : '‰øùÂ≠òÊàêÂäü', \n          icon: 'success',\n          duration: 1500\n        });\n        \n        // Âª∂ËøüË∑≥ËΩ¨Âà∞ÂàóË°®È°µ\n        setTimeout(() => {\n          uni.navigateBack();\n        }, 1500);\n      } catch (error) {\n        console.error('‚ùå [Áà±ÂøÉÂ¢ôÂàõÂª∫È°µ] ‰øùÂ≠òÈ°πÁõÆÂ§±Ë¥•:', error);\n        uni.hideLoading();\n        uni.showToast({ \n          title: error.message || '‰øùÂ≠òÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', \n          icon: 'none',\n          duration: 2000\n        });\n      } finally {\n        this.saving = false;\n      }\n    },\n    persist() {\n      try { uni.setStorageSync('heartwall_grid_images', this.images); } catch (e) {}\n    }\n  }\n};\n</script>\n\n<style>\n.create-page { min-height: 100vh; background: #FFFAF4; display: flex; flex-direction: column; overflow: hidden; }\n\n/* Ëá™ÂÆö‰πâÂØºËà™Ê†èÔºà‰∏éÈ¶ñÈ°µ‰∏ÄËá¥Ôºâ */\n.custom-navbar { position: fixed; top: 0; left: 0; right: 0; z-index: 9999; background-color: #FFFAF4; overflow: hidden; }\n.navbar-gradient-bg { position: absolute; top: 0; left: 0; right: 0; height: 200%; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }\n.status-bar { width: 100%; background: transparent; position: relative; z-index: 1; }\n.navbar-content { display: flex; align-items: center; justify-content: space-between; padding: 0 30rpx; box-sizing: border-box; position: relative; z-index: 1; }\n.navbar-left, .navbar-right { width: 80rpx; display: flex; align-items: center; justify-content: center; }\n.navbar-title { flex: 1; display: flex; align-items: center; justify-content: center; text-align: center; }\n.title-text { font-size: 36rpx; font-weight: 500; color: #4A4A4A; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif; }\n.back-icon { font-size: 50rpx; font-weight: 600; color: #4A4A4A; line-height: 1; }\n\n.center { display: flex; align-items: flex-start; justify-content: center; padding: 80rpx 0 0 60rpx; }\n.heart-grid { width: 640rpx; margin: 0 auto; display: grid; grid-template-columns: repeat(9, 1fr); grid-gap: 10rpx; }\n.cell { position: relative; width: 1fr; padding-bottom: 100%; background: rgba(255,255,255,0.7); border-radius: 12rpx; overflow: hidden; }\n.cell.hole { background: transparent; }\n.cell image { position: absolute; inset: 0; width: 100%; height: 100%; }\n.cell.filled { background: #ffffff; }\n\n.photo-count { \n  margin-top: 32rpx; \n  padding: 0 60rpx; \n  display: flex; \n  justify-content: space-between; \n  align-items: center; \n}\n.count-text { \n  font-size: 26rpx; \n  color: #666; \n  font-weight: 500; \n}\n.clear-btn { \n  font-size: 24rpx; \n  color: #D48806; \n  padding: 8rpx 20rpx; \n  background: rgba(255, 201, 77, 0.15); \n  border-radius: 20rpx; \n}\n\n.actions { margin-top: 24rpx; padding-bottom: 24rpx; display: flex; flex-direction: column; align-items: center; gap: 16rpx; }\n.btn { width: 70%; border-radius: 999rpx; padding: 18rpx 0; font-size: 26rpx; box-shadow: 0 8rpx 20rpx rgba(0,0,0,0.12); }\n.btn.yellow { background: linear-gradient(90deg, #FFB5C2 0%, #FFD4A3 100%); color: #3d2a00; }\n.btn.green { background: linear-gradient(90deg, #FFB5C2 0%, #FFD4A3 100%); color: #3d2a00; }\n.btn.pink { background: linear-gradient(90deg, #FFB5C2 0%, #FFD4A3 100%); color: #3d2a00; }\n</style>\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/È°πÁõÆ/love_time_fu - ÂâØÊú¨(ÊâìÂåÖÂêéÂâØÊú¨)/subPackages/record/pages/heartwall/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["baseUrl","config","uni","wx","clearProjectPhotos","updatePhoto","getProjectDetail","getProjectPhotos","http","updateProject","createProject","uploadPhoto"],"mappings":"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"}