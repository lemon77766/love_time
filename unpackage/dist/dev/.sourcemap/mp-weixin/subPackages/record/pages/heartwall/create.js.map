{"version":3,"file":"create.js","sources":["subPackages/record/pages/heartwall/create.vue","D:/softcaree/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3ViUGFja2FnZXNccmVjb3JkXHBhZ2VzXGhlYXJ0d2FsbFxjcmVhdGUudnVl"],"sourcesContent":["<template>\r\n  <view class=\"create-page\" :style=\"{ paddingTop: containerPaddingTop }\">\r\n    <!-- è‡ªå®šä¹‰å¯¼èˆªæ ï¼ˆä¸é¦–é¡µä¸€è‡´ï¼‰ -->\r\n    <view class=\"custom-navbar\">\r\n      <view class=\"navbar-gradient-bg\"></view>\r\n      <view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\r\n      <view class=\"navbar-content\" :style=\"{ height: navBarHeight + 'px' }\">\r\n        <view class=\"navbar-left\" @click=\"goBack\">\r\n          <text class=\"back-icon\">â†</text>\r\n        </view>\r\n        <view class=\"navbar-title\">\r\n          <text class=\"title-text\">çˆ±å¿ƒç…§ç‰‡å¢™</text>\r\n        </view>\r\n        <view class=\"navbar-right\"></view>\r\n      </view>\r\n    </view>\r\n    <view class=\"center\">\r\n      <view id=\"heartArea\" class=\"heart-grid\">\r\n        <view v-for=\"(cell, idx) in heartMask\" :key=\"idx\" class=\"cell\" :class=\"{ hole: !cell, filled: cell && images[idx] }\" @tap=\"onPickSingle(idx)\">\r\n          <image v-if=\"images[idx]\" :src=\"images[idx]\" mode=\"aspectFill\" />\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- ç…§ç‰‡æ•°é‡æç¤º -->\r\n    <view class=\"photo-count\">\r\n      <text class=\"count-text\">å·²æ·»åŠ  {{ filledCount }}/{{ totalSlots }} å¼ ç…§ç‰‡</text>\r\n      <text v-if=\"filledCount > 0\" class=\"clear-btn\" @click=\"clearAllImages\">æ¸…ç©º</text>\r\n    </view>\r\n\r\n    <view class=\"actions\">\r\n      <button class=\"btn yellow\" @click=\"onBatchUpload\">\r\n        æ‰¹é‡ä¸Šä¼ ç…§ç‰‡ ({{ remainingSlots > 0 ? `è¿˜å¯æ·»åŠ ${Math.min(9, remainingSlots)}å¼ ` : 'å·²æ»¡' }})\r\n      </button>\r\n      <button class=\"btn green\" @click=\"onSaveProject\">ä¿å­˜é¡¹ç›®</button>\r\n      <button class=\"btn pink\" @click=\"exportAsImage\" v-if=\"filledCount > 0\">å¯¼å‡ºä¸ºå›¾ç‰‡</button>\r\n    </view>\r\n    \r\n    <!-- éšè—çš„ Canvas ç”¨äºå¯¼å‡ºå›¾ç‰‡ -->\r\n    <canvas canvas-id=\"exportCanvas\" id=\"exportCanvas\" style=\"width: 750px; height: 1000px; position: fixed; top: -10000px; left: -10000px; background: #FFFAF4;\"></canvas>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { createProject, updateProject, uploadPhoto, uploadPhotoWithFile, getProjectDetail, getProjectPhotos, clearProjectPhotos, updatePhoto } from '@/api/heartwall.js';\r\nimport http from '@/utils/http.js';\r\nimport config from '@/utils/config.js';\r\n\r\n// å¤„ç†å›¾ç‰‡URLï¼šå¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œæ‹¼æ¥baseURL\r\nfunction processImageUrl(url) {\r\n  if (!url || url === '') {\r\n    return '';\r\n  }\r\n  \r\n  // å¦‚æœå·²ç»æ˜¯å®Œæ•´çš„URLï¼ˆhttp:// æˆ– https://ï¼‰ï¼Œç›´æ¥è¿”å›\r\n  if (url.startsWith('http://') || url.startsWith('https://')) {\r\n    return url;\r\n  }\r\n  \r\n  // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆä»¥ / å¼€å¤´ï¼‰ï¼Œæ‹¼æ¥baseURL\r\n  if (url.startsWith('/')) {\r\n    // å…¼å®¹é”™è¯¯è¿”å›çš„å‰ç«¯è·¯å¾„ï¼Œå¦‚ /pages/heartwall/uploads/... -> å½’ä¸€åŒ–ä¸º /uploads/... æˆ–å»æ‰ /pages å‰ç¼€\r\n    if (url.startsWith('/pages/')) {\r\n      const stripped = url.replace(/^\\/pages/, '');\r\n      const uploadsIndex = stripped.indexOf('/uploads/');\r\n      if (uploadsIndex !== -1) {\r\n        url = stripped.slice(uploadsIndex);\r\n      } else {\r\n        url = stripped.startsWith('/') ? stripped : '/' + stripped;\r\n      }\r\n    }\r\n    // ç§»é™¤baseURLæœ«å°¾å¯èƒ½å­˜åœ¨çš„æ–œæ ï¼Œé¿å…åŒæ–œæ \r\n    const baseUrl = config.baseURL.endsWith('/') ? config.baseURL.slice(0, -1) : config.baseURL;\r\n    return baseUrl + url;\r\n  }\r\n  \r\n  // å…¶ä»–æƒ…å†µï¼ˆå¯èƒ½æ˜¯ç›¸å¯¹è·¯å¾„ä½†ä¸ä»¥/å¼€å¤´ï¼‰ï¼Œä¹Ÿå°è¯•æ‹¼æ¥\r\n  const baseUrl = config.baseURL.endsWith('/') ? config.baseURL.slice(0, -1) : config.baseURL;\r\n  return baseUrl + '/' + url;\r\n}\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      statusBarHeight: 0,\r\n      navBarHeight: 44,\r\n      screenWidth: 375,\r\n      // 9x9 å¿ƒå½¢æ©ç ï¼ˆ1 è¡¨ç¤ºå¯å¡«å……ï¼Œ0 è¡¨ç¤ºç©ºä½ï¼‰ï¼›å¯æŒ‰éœ€è°ƒæ•´\r\n      heartMask: [\r\n        0,1,1,0,0,1,1,0,0,\r\n        1,1,1,1,1,1,1,1,0,\r\n        1,1,1,1,1,1,1,1,0,\r\n        1,1,1,1,1,1,1,1,0,\r\n        0,1,1,1,1,1,1,0,0,\r\n        0,0,1,1,1,1,0,0,0,\r\n        0,0,0,1,1,0,0,0,0,\r\n        0,0,0,0,0,0,0,0,0,\r\n        0,0,0,0,0,0,0,0,0\r\n      ],\r\n      images: [],\r\n      editingProjectId: null,  // æ­£åœ¨ç¼–è¾‘çš„é¡¹ç›®IDï¼Œnull è¡¨ç¤ºåˆ›å»ºæ–°é¡¹ç›®\r\n      saving: false,  // ä¿å­˜ä¸­çŠ¶æ€\r\n      photoMap: {},  // å­˜å‚¨positionIndexåˆ°photoIdçš„æ˜ å°„ { positionIndex: photoId }\r\n      canvasWidth: 0,\r\n      canvasHeight: 0\r\n    };\r\n  },\r\n  computed: {\r\n    containerPaddingTop() {\r\n      const totalHeightPx = this.statusBarHeight + this.navBarHeight;\r\n      const pxToRpx = 750 / this.screenWidth;\r\n      return totalHeightPx * pxToRpx + 'rpx';\r\n    },\r\n    // æ€»å…±å¯å¡«å……çš„ä½ç½®æ•°\r\n    totalSlots() {\r\n      return this.heartMask.filter(cell => cell === 1).length;\r\n    },\r\n    // å·²å¡«å……çš„ç…§ç‰‡æ•°\r\n    filledCount() {\r\n      let count = 0;\r\n      for (let i = 0; i < this.heartMask.length; i++) {\r\n        if (this.heartMask[i] && this.images[i]) {\r\n          count++;\r\n        }\r\n      }\r\n      return count;\r\n    },\r\n    // å‰©ä½™å¯æ·»åŠ çš„ç…§ç‰‡æ•°\r\n    remainingSlots() {\r\n      return this.totalSlots - this.filledCount;\r\n    }\r\n  },\r\n  async mounted() {\r\n    this.getSystemInfo();\r\n    // æ£€æŸ¥æ˜¯å¦åœ¨ç¼–è¾‘ç°æœ‰é¡¹ç›®\r\n    try {\r\n      const editingProjectId = uni.getStorageSync('heartwall_editing_projectId');\r\n      if (editingProjectId) {\r\n        this.editingProjectId = editingProjectId;\r\n        // ä»åç«¯åŠ è½½é¡¹ç›®æ•°æ®\r\n        await this.loadProjectFromBackend(editingProjectId);\r\n      } else {\r\n        // å¦‚æœæ²¡æœ‰é¡¹ç›®IDï¼Œå°è¯•ä»æœ¬åœ°ç¼“å­˜åŠ è½½ï¼ˆå…¼å®¹æ—§æ•°æ®ï¼‰\r\n      const cached = uni.getStorageSync('heartwall_grid_images');\r\n      if (Array.isArray(cached)) {\r\n        this.images = cached;\r\n      }\r\n      }\r\n    } catch (e) {\r\n      console.error('åŠ è½½é¡¹ç›®æ•°æ®å¤±è´¥:', e);\r\n    }\r\n  },\r\n  methods: {\r\n    goBack() {\r\n      uni.navigateBack();\r\n    },\r\n    \r\n    // å¯¼å‡ºä¸ºå›¾ç‰‡åŠŸèƒ½\r\n    async exportAsImage() {\r\n      // æ£€æŸ¥æ˜¯å¦æœ‰ç…§ç‰‡\r\n      if (this.filledCount === 0) {\r\n        uni.showToast({\r\n          title: 'è¯·å…ˆæ·»åŠ ç…§ç‰‡å†å¯¼å‡º',\r\n          icon: 'none'\r\n        });\r\n        return;\r\n      }\r\n      \r\n      uni.showLoading({ title: 'æ­£åœ¨ç”Ÿæˆç²¾ç¾å›¾ç‰‡...', mask: true });\r\n      \r\n      try {\r\n        // ä½¿ç”¨å›ºå®šçš„ç”»å¸ƒå°ºå¯¸\r\n        const canvasWidth = 750; // ä¸Canvaså…ƒç´ å®½åº¦ä¸€è‡´\r\n        const canvasHeight = 1000; // ä¸Canvaså…ƒç´ é«˜åº¦ä¸€è‡´\r\n        const cellSize = 70; // å›ºå®šæ ¼å­å¤§å°\r\n        const gridWidth = cellSize * 9;\r\n        const gridHeight = cellSize * 9;\r\n        const startX = (canvasWidth - gridWidth) / 2; // å±…ä¸­æ˜¾ç¤º\r\n        const startY = 180; // ä»é¡¶éƒ¨180pxå¼€å§‹ç»˜åˆ¶\r\n        \r\n        // åˆ›å»ºç”»å¸ƒä¸Šä¸‹æ–‡\r\n        const ctx = uni.createCanvasContext('exportCanvas', this);\r\n        \r\n        // æ¸…ç©ºç”»å¸ƒ\r\n        ctx.clearRect(0, 0, canvasWidth, canvasHeight);\r\n        \r\n        // è®¾ç½®ç”»å¸ƒèƒŒæ™¯ - æ¸å˜èƒŒæ™¯\r\n        const gradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);\r\n        gradient.addColorStop(0, '#FFF0F5'); // æµ…ç²‰è‰²\r\n        gradient.addColorStop(1, '#FFE4E1'); // æµ…ç«ç‘°è‰²\r\n        ctx.setFillStyle(gradient);\r\n        ctx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n        \r\n        // ç»˜åˆ¶é¡¶éƒ¨è£…é¥°çº¿æ¡\r\n        ctx.setStrokeStyle('#FFB6C1');\r\n        ctx.setLineWidth(2);\r\n        ctx.beginPath();\r\n        ctx.moveTo(startX, startY - 30);\r\n        ctx.lineTo(startX + gridWidth, startY - 30);\r\n        ctx.stroke();\r\n        \r\n        // ç»˜åˆ¶åº•éƒ¨è£…é¥°çº¿æ¡\r\n        ctx.beginPath();\r\n        ctx.moveTo(startX, startY + gridHeight + 30);\r\n        ctx.lineTo(startX + gridWidth, startY + gridHeight + 30);\r\n        ctx.stroke();\r\n        \r\n        // ç»˜åˆ¶è£…é¥°æ€§å¿ƒå½¢å›¾æ ‡\r\n        ctx.setFontSize(36);\r\n        ctx.setFillStyle('#FF69B4');\r\n        ctx.setTextAlign('center');\r\n        ctx.setTextBaseline('middle');\r\n        ctx.fillText('â™¥', canvasWidth / 2, 60);\r\n        \r\n        // ç»˜åˆ¶æ ‡é¢˜\r\n        ctx.setFontSize(28);\r\n        ctx.setFillStyle('#8B4513'); // æ£•è‰²\r\n        ctx.setTextAlign('center');\r\n        ctx.setTextBaseline('middle');\r\n        ctx.fillText('çˆ±å¿ƒç…§ç‰‡å¢™', canvasWidth / 2, 100);\r\n        \r\n        // ç»˜åˆ¶ç»Ÿè®¡ä¿¡æ¯\r\n        ctx.setFontSize(18);\r\n        ctx.setFillStyle('#8B4513');\r\n        ctx.setTextAlign('center');\r\n        ctx.setTextBaseline('middle');\r\n        ctx.fillText(`å…± ${this.filledCount} å¼ çè´µç…§ç‰‡`, canvasWidth / 2, 140);\r\n        \r\n        // ç»˜åˆ¶å¿ƒå½¢å›¾æ¡ˆ\r\n        // ç»˜åˆ¶æ¯ä¸ªæ ¼å­\r\n        for (let row = 0; row < 9; row++) {\r\n          for (let col = 0; col < 9; col++) {\r\n            const idx = row * 9 + col;\r\n            \r\n            // å¦‚æœæ˜¯å¿ƒå½¢åŒºåŸŸ\r\n            if (this.heartMask[idx]) {\r\n              const x = startX + col * cellSize;\r\n              const y = startY + row * cellSize;\r\n              \r\n              // ç»˜åˆ¶åœ†è§’çŸ©å½¢èƒŒæ™¯\r\n              this.drawRoundedRect(ctx, x, y, cellSize, cellSize, 10);\r\n              ctx.setFillStyle('rgba(255, 255, 255, 0.9)');\r\n              ctx.fill();\r\n              ctx.setStrokeStyle('#FFB6C1');\r\n              ctx.setLineWidth(1);\r\n              ctx.stroke();\r\n              \r\n              // å¦‚æœæœ‰å›¾ç‰‡ï¼Œåˆ™ç»˜åˆ¶å›¾ç‰‡\r\n              if (this.images[idx]) {\r\n                // ç­‰å¾…å›¾ç‰‡åŠ è½½å®Œæˆåå†ç»˜åˆ¶\r\n                await this.drawImageOnCanvas(ctx, this.images[idx], x + 2, y + 2, cellSize - 4, cellSize - 4);\r\n              } else {\r\n                // ç»˜åˆ¶ç©ºæ ¼å­çš„æç¤º\r\n                ctx.setFontSize(12);\r\n                ctx.setFillStyle('#FFB6C1');\r\n                ctx.setTextAlign('center');\r\n                ctx.setTextBaseline('middle');\r\n                ctx.fillText('+', x + cellSize / 2, y + cellSize / 2);\r\n              }\r\n            }\r\n          }\r\n        }\r\n        \r\n        // ç»˜åˆ¶åº•éƒ¨ä¿¡æ¯\r\n        ctx.setFontSize(16);\r\n        ctx.setFillStyle('#8B4513');\r\n        ctx.setTextAlign('center');\r\n        ctx.setTextBaseline('middle');\r\n        ctx.fillText('Created with Love Time', canvasWidth / 2, canvasHeight - 50);\r\n        ctx.fillText(new Date().toLocaleDateString('zh-CN', { \r\n          year: 'numeric', \r\n          month: 'long', \r\n          day: 'numeric' \r\n        }), canvasWidth / 2, canvasHeight - 20);\r\n        \r\n        // ç»˜åˆ¶åº•éƒ¨è£…é¥°å¿ƒå½¢\r\n        ctx.setFontSize(20);\r\n        ctx.setFillStyle('#FF69B4');\r\n        ctx.fillText('â™¥ â™¡ â™¥ â™¡ â™¥', canvasWidth / 2, canvasHeight - 80);\r\n        \r\n        // ç»˜åˆ¶å®Œæˆï¼Œä¿å­˜åˆ°ç›¸å†Œ\r\n        ctx.draw(true, () => {  // ä½¿ç”¨åŒæ­¥ç»˜åˆ¶\r\n          // å»¶è¿Ÿä¸€ä¼šå„¿ç¡®ä¿ç»˜åˆ¶å®Œæˆ\r\n          setTimeout(() => {\r\n            uni.canvasToTempFilePath({\r\n              x: 0,\r\n              y: 0,\r\n              width: canvasWidth,\r\n              height: canvasHeight,\r\n              destWidth: canvasWidth * 2, // æé«˜åˆ†è¾¨ç‡\r\n              destHeight: canvasHeight * 2,\r\n              canvasId: 'exportCanvas',\r\n              fileType: 'png',\r\n              quality: 1,\r\n              success: (res) => {\r\n                // æ£€æŸ¥è¿”å›çš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„\r\n                if (!res.tempFilePath) {\r\n                  uni.hideLoading();\r\n                  uni.showToast({\r\n                    title: 'å¯¼å‡ºå¤±è´¥ï¼šæ— æ³•ç”Ÿæˆå›¾ç‰‡',\r\n                    icon: 'none'\r\n                  });\r\n                  return;\r\n                }\r\n                \r\n                // ä¿å­˜åˆ°ç›¸å†Œ\r\n                uni.saveImageToPhotosAlbum({\r\n                  filePath: res.tempFilePath,\r\n                  success: () => {\r\n                    uni.hideLoading();\r\n                    uni.showToast({\r\n                      title: 'ç²¾ç¾å›¾ç‰‡å·²ä¿å­˜åˆ°ç›¸å†Œ',\r\n                      icon: 'success'\r\n                    });\r\n                  },\r\n                  fail: (err) => {\r\n                    uni.hideLoading();\r\n                    console.error('ä¿å­˜å›¾ç‰‡å¤±è´¥:', err);\r\n                    // æ£€æŸ¥æ˜¯å¦æ˜¯å› ä¸ºæƒé™é—®é¢˜\r\n                    if (err.errMsg && err.errMsg.includes('auth deny')) {\r\n                      uni.showModal({\r\n                        title: 'æƒé™ç”³è¯·',\r\n                        content: 'éœ€è¦ç›¸å†Œæƒé™æ‰èƒ½ä¿å­˜å›¾ç‰‡ï¼Œè¯·åœ¨è®¾ç½®ä¸­å¼€å¯ç›¸å†Œæƒé™',\r\n                        showCancel: true,\r\n                        confirmText: 'å»è®¾ç½®',\r\n                        success: (modalRes) => {\r\n                          if (modalRes.confirm) {\r\n                            // #ifdef MP-WEIXIN\r\n                            uni.openSetting({\r\n                              success: (settingRes) => {\r\n                                if (settingRes.authSetting['scope.writePhotosAlbum']) {\r\n                                  uni.showToast({\r\n                                    title: 'æƒé™å·²å¼€å¯ï¼Œè¯·é‡æ–°å¯¼å‡º',\r\n                                    icon: 'none'\r\n                                  });\r\n                                }\r\n                              },\r\n                              fail: (settingErr) => {\r\n                                console.error('æ‰“å¼€è®¾ç½®å¤±è´¥:', settingErr);\r\n                                uni.showToast({\r\n                                  title: 'æ‰“å¼€è®¾ç½®å¤±è´¥',\r\n                                  icon: 'none'\r\n                                });\r\n                              }\r\n                            });\r\n                            // #endif\r\n                          }\r\n                        },\r\n                        fail: (modalErr) => {\r\n                          console.error('æ˜¾ç¤ºæ¨¡æ€æ¡†å¤±è´¥:', modalErr);\r\n                          uni.showToast({\r\n                            title: 'æ“ä½œå¤±è´¥',\r\n                            icon: 'none'\r\n                          });\r\n                        }\r\n                      });\r\n                    } else {\r\n                      uni.showToast({\r\n                        title: 'ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•',\r\n                        icon: 'none'\r\n                      });\r\n                    }\r\n                  }\r\n                });\r\n              },\r\n              fail: (err) => {\r\n                uni.hideLoading();\r\n                console.error('å¯¼å‡ºå›¾ç‰‡å¤±è´¥:', err);\r\n                uni.showToast({\r\n                  title: 'å¯¼å‡ºå¤±è´¥: ' + (err.errMsg || 'æ— æ³•ç”Ÿæˆå›¾ç‰‡'),\r\n                  icon: 'none'\r\n                });\r\n              }\r\n            }, this);\r\n          }, 1500); // å¢åŠ å»¶è¿Ÿæ—¶é—´ç¡®ä¿ç»˜åˆ¶å®Œæˆ\r\n        });\r\n      } catch (error) {\r\n        uni.hideLoading();\r\n        console.error('å¯¼å‡ºå›¾ç‰‡å¤±è´¥:', error);\r\n        uni.showToast({\r\n          title: 'å¯¼å‡ºå¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'),\r\n          icon: 'none'\r\n        });\r\n      }\r\n    },\r\n    \r\n    // åœ¨Canvasä¸Šç»˜åˆ¶å›¾ç‰‡çš„å¼‚æ­¥æ–¹æ³•\r\n    drawImageOnCanvas(ctx, imageUrl, x, y, width, height) {\r\n      return new Promise((resolve) => {\r\n        // æ£€æŸ¥å›¾ç‰‡URLæ˜¯å¦æœ‰æ•ˆ\r\n        if (!imageUrl || typeof imageUrl !== 'string') {\r\n          console.warn('æ— æ•ˆçš„å›¾ç‰‡URL:', imageUrl);\r\n          this.drawPlaceholder(ctx, x, y, width, height);\r\n          resolve();\r\n          return;\r\n        }\r\n        \r\n        // åœ¨ä¸åŒå¹³å°ä½¿ç”¨ä¸åŒçš„å›¾ç‰‡åŠ è½½æ–¹å¼\r\n        // #ifdef MP-WEIXIN\r\n        // å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸‹ä½¿ç”¨ getImageInfo\r\n        uni.getImageInfo({\r\n          src: imageUrl,\r\n          success: (info) => {\r\n            // ç¡®ä¿å›¾ç‰‡æœ‰æ•ˆå†ç»˜åˆ¶\r\n            if (info && info.path) {\r\n              try {\r\n                ctx.drawImage(info.path, x, y, width, height);\r\n              } catch (drawErr) {\r\n                console.warn('ç»˜åˆ¶å›¾ç‰‡å¤±è´¥:', drawErr);\r\n                this.drawPlaceholder(ctx, x, y, width, height);\r\n              }\r\n            } else {\r\n              // å›¾ç‰‡æ— æ•ˆæ—¶ç»˜åˆ¶å ä½ç¬¦\r\n              this.drawPlaceholder(ctx, x, y, width, height);\r\n            }\r\n            resolve();\r\n          },\r\n          fail: (err) => {\r\n            console.warn('å›¾ç‰‡åŠ è½½å¤±è´¥:', imageUrl, err);\r\n            // å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ç»˜åˆ¶å ä½ç¬¦\r\n            this.drawPlaceholder(ctx, x, y, width, height);\r\n            resolve();\r\n          }\r\n        });\r\n        // #endif\r\n        \r\n        // #ifndef MP-WEIXIN\r\n        // å…¶ä»–ç¯å¢ƒä½¿ç”¨ä¼ ç»Ÿæ–¹å¼\r\n        const img = new Image();\r\n        img.onload = () => {\r\n          // ç¡®ä¿å›¾ç‰‡æœ‰æ•ˆå†ç»˜åˆ¶\r\n          if (img.complete && img.naturalWidth !== 0) {\r\n            try {\r\n              ctx.drawImage(img, x, y, width, height);\r\n            } catch (drawErr) {\r\n              console.warn('ç»˜åˆ¶å›¾ç‰‡å¤±è´¥:', drawErr);\r\n              this.drawPlaceholder(ctx, x, y, width, height);\r\n            }\r\n          } else {\r\n            // å›¾ç‰‡æ— æ•ˆæ—¶ç»˜åˆ¶å ä½ç¬¦\r\n            this.drawPlaceholder(ctx, x, y, width, height);\r\n          }\r\n          resolve();\r\n        };\r\n        img.onerror = () => {\r\n          console.warn('å›¾ç‰‡åŠ è½½å¤±è´¥:', imageUrl);\r\n          // å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ç»˜åˆ¶å ä½ç¬¦\r\n          this.drawPlaceholder(ctx, x, y, width, height);\r\n          resolve();\r\n        };\r\n        img.src = imageUrl;\r\n        // #endif\r\n      });\r\n    },\r\n    \r\n    // ç»˜åˆ¶å ä½ç¬¦ï¼ˆå½“å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ï¼‰\r\n    drawPlaceholder(ctx, x, y, width, height) {\r\n      // ç»˜åˆ¶æµ…è‰²èƒŒæ™¯\r\n      ctx.setFillStyle('rgba(255, 255, 255, 0.7)');\r\n      this.drawRoundedRect(ctx, x, y, width, height, 8);\r\n      ctx.fill();\r\n      \r\n      // ç»˜åˆ¶è¾¹æ¡†\r\n      ctx.setStrokeStyle('#FFB6C1');\r\n      ctx.setLineWidth(1);\r\n      ctx.stroke();\r\n      \r\n      // ç»˜åˆ¶å ä½ç¬¦å›¾æ ‡\r\n      ctx.setFontSize(20);\r\n      ctx.setFillStyle('#FFB6C1');\r\n      ctx.setTextAlign('center');\r\n      ctx.setTextBaseline('middle');\r\n      ctx.fillText('â™¥', x + width / 2, y + height / 2);\r\n    },\r\n\r\n    // ç»˜åˆ¶åœ†è§’çŸ©å½¢\r\n    drawRoundedRect(ctx, x, y, width, height, radius) {\r\n      ctx.beginPath();\r\n      ctx.moveTo(x + radius, y);\r\n      ctx.lineTo(x + width - radius, y);\r\n      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\r\n      ctx.lineTo(x + width, y + height - radius);\r\n      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\r\n      ctx.lineTo(x + radius, y + height);\r\n      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\r\n      ctx.lineTo(x, y + radius);\r\n      ctx.quadraticCurveTo(x, y, x + radius, y);\r\n      ctx.closePath();\r\n      ctx.setFillStyle('#ffffff');\r\n      ctx.fill();\r\n    },\r\n\r\n    getSystemInfo() {\r\n      // #ifdef MP-WEIXIN\r\n      try {\r\n        const windowInfo = wx.getWindowInfo && wx.getWindowInfo();\r\n        if (windowInfo) {\r\n          this.statusBarHeight = windowInfo.statusBarHeight || 0;\r\n          this.screenWidth = windowInfo.windowWidth || 375;\r\n        } else {\r\n          const sys = uni.getSystemInfoSync();\r\n          this.statusBarHeight = sys.statusBarHeight || 0;\r\n          this.screenWidth = sys.windowWidth || 375;\r\n        }\r\n      } catch (e) {\r\n        const sys = uni.getSystemInfoSync();\r\n        this.statusBarHeight = sys.statusBarHeight || 0;\r\n        this.screenWidth = sys.windowWidth || 375;\r\n      }\r\n      this.navBarHeight = 44;\r\n      // #endif\r\n      // #ifdef H5\r\n      const sysH5 = uni.getSystemInfoSync();\r\n      this.statusBarHeight = sysH5.statusBarHeight || 0;\r\n      this.screenWidth = sysH5.windowWidth || 375;\r\n      this.navBarHeight = 44;\r\n      // #endif\r\n      // #ifndef MP-WEIXIN || H5\r\n      const sysOther = uni.getSystemInfoSync();\r\n      this.statusBarHeight = sysOther.statusBarHeight || 0;\r\n      this.screenWidth = sysOther.windowWidth || 375;\r\n      this.navBarHeight = 44;\r\n      // #endif\r\n    },\r\n    async onBatchUpload() {\r\n      // è®¡ç®—ç©ºä½æ•°é‡\r\n      const emptySlots = this.getEmptySlots();\r\n      if (emptySlots.length === 0) {\r\n        uni.showToast({ title: 'ç…§ç‰‡å¢™å·²æ»¡', icon: 'none' });\r\n        return;\r\n      }\r\n\r\n      try {\r\n        // uni-app ä¸€æ¬¡æœ€å¤šé€‰æ‹© 9 å¼ å›¾ç‰‡ï¼ˆå¾®ä¿¡å°ç¨‹åºé™åˆ¶ï¼‰\r\n        const maxCount = Math.min(9, emptySlots.length);\r\n        const res = await uni.chooseImage({ \r\n          count: maxCount, \r\n          sizeType: ['compressed'], \r\n          sourceType: ['album', 'camera'] \r\n        });\r\n        \r\n        if (!res || !res.tempFilePaths || res.tempFilePaths.length === 0) return;\r\n        \r\n        const files = res.tempFilePaths;\r\n        \r\n        // æŒ‰é¡ºåºå¡«å……ç©ºä½\r\n        for (let i = 0; i < files.length && i < emptySlots.length; i++) {\r\n          const idx = emptySlots[i];\r\n          this.$set(this.images, idx, files[i]);\r\n        }\r\n        \r\n        this.persist();\r\n        \r\n        // æç¤ºç”¨æˆ·\r\n        const remainingSlots = emptySlots.length - files.length;\r\n        if (remainingSlots > 0) {\r\n          uni.showToast({ \r\n            title: `å·²æ·»åŠ ${files.length}å¼ ï¼Œè¿˜å¯æ·»åŠ ${remainingSlots}å¼ `, \r\n            icon: 'none',\r\n            duration: 2000\r\n          });\r\n        } else {\r\n          uni.showToast({ \r\n            title: `å·²æ·»åŠ ${files.length}å¼ ç…§ç‰‡`, \r\n            icon: 'success' \r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error('æ‰¹é‡ä¸Šä¼ å¤±è´¥:', e);\r\n      }\r\n    },\r\n    \r\n    // è·å–æ‰€æœ‰ç©ºä½çš„ç´¢å¼•\r\n    getEmptySlots() {\r\n      const slots = [];\r\n      for (let i = 0; i < this.heartMask.length; i++) {\r\n        if (this.heartMask[i] && !this.images[i]) {\r\n          slots.push(i);\r\n        }\r\n      }\r\n      return slots;\r\n    },\r\n    \r\n    // æ¸…ç©ºæ‰€æœ‰ç…§ç‰‡\r\n    async clearAllImages() {\r\n      uni.showModal({\r\n        title: 'ç¡®è®¤æ¸…ç©º',\r\n        content: 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç…§ç‰‡å—ï¼Ÿæ¸…ç©ºåæ— æ³•æ¢å¤ã€‚',\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            try {\r\n              // å¦‚æœæœ‰é¡¹ç›®IDï¼Œè°ƒç”¨åç«¯æ¥å£æ¸…ç©º\r\n              if (this.editingProjectId) {\r\n                uni.showLoading({ title: 'æ¸…ç©ºä¸­...', mask: true });\r\n                console.log('ğŸ—‘ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å¼€å§‹æ¸…ç©ºé¡¹ç›®ç…§ç‰‡ï¼Œé¡¹ç›®ID:', this.editingProjectId);\r\n                \r\n                await clearProjectPhotos(this.editingProjectId);\r\n                \r\n                console.log('âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é¡¹ç›®ç…§ç‰‡æ¸…ç©ºæˆåŠŸ');\r\n                uni.hideLoading();\r\n              }\r\n              \r\n              // æ¸…ç©ºå‰ç«¯æ•°æ®\r\n              this.images = [];\r\n              this.photoMap = {};\r\n              this.persist();\r\n              \r\n            uni.showToast({ title: 'å·²æ¸…ç©º', icon: 'success' });\r\n            } catch (error) {\r\n              console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ¸…ç©ºé¡¹ç›®ç…§ç‰‡å¤±è´¥:', error);\r\n              uni.hideLoading();\r\n              \r\n              // å³ä½¿åç«¯æ¸…ç©ºå¤±è´¥ï¼Œä¹Ÿæ¸…ç©ºå‰ç«¯æ•°æ®\r\n              this.images = [];\r\n              this.persist();\r\n              \r\n              uni.showToast({ \r\n                title: error.message || 'æ¸…ç©ºå¤±è´¥ï¼Œå·²æ¸…ç©ºæœ¬åœ°æ•°æ®', \r\n                icon: 'none',\r\n                duration: 2000\r\n              });\r\n            }\r\n          }\r\n        }\r\n      });\r\n    },\r\n    // ä¸Šä¼ å›¾ç‰‡åˆ°æœåŠ¡å™¨çš„å‡½æ•°\r\n    async uploadImageToServer(imagePath, projectId, positionIndex) {\r\n      return new Promise((resolve, reject) => {\r\n        // ä½¿ç”¨uni.uploadFileä¸Šä¼ å›¾ç‰‡\r\n        const loginInfo = uni.getStorageSync('login_info');\r\n        const token = loginInfo?.token;\r\n        \r\n        if (!token) {\r\n          reject(new Error('æœªç™»å½•ï¼Œæ— æ³•ä¸Šä¼ å›¾ç‰‡'));\r\n          return;\r\n        }\r\n        \r\n        // ä½¿ç”¨é¡¹ç›®ä¸­å·²æœ‰çš„httpå·¥å…·è¿›è¡Œä¸Šä¼ ï¼Œç¡®ä¿ä¸é¡¹ç›®å…¶ä»–ä¸Šä¼ åŠŸèƒ½ä¿æŒä¸€è‡´\r\n        // ä¼ é€’projectIdå’ŒpositionIndexå‚æ•°\r\n        http.upload({\r\n          url: '/api/heart-wall/photos/upload',\r\n          filePath: imagePath,\r\n          name: 'file',\r\n          header: {\r\n            'Authorization': `Bearer ${token}`\r\n          },\r\n          formData: {\r\n            projectId: projectId.toString(),\r\n            positionIndex: positionIndex.toString()\r\n          }\r\n        }).then(response => {\r\n          // ä»å“åº”ä¸­æå–å›¾ç‰‡URL\r\n          // æ ¹æ®å®é™…å“åº”ç»“æ„è§£æï¼š{photos: [{photoUrl: '...'}]}\r\n          let photoUrl = null;\r\n          // æ£€æŸ¥photosæ•°ç»„\r\n          if (response.photos && Array.isArray(response.photos) && response.photos.length > 0) {\r\n            photoUrl = response.photos[0].photoUrl || response.photos[0].thumbnailUrl;\r\n          } else if (response.data?.photos && Array.isArray(response.data.photos) && response.data.photos.length > 0) {\r\n            photoUrl = response.data.photos[0].photoUrl || response.data.photos[0].thumbnailUrl;\r\n          } else if (response.data?.data?.photos && Array.isArray(response.data.data.photos) && response.data.data.photos.length > 0) {\r\n            photoUrl = response.data.data.photos[0].photoUrl || response.data.data.photos[0].thumbnailUrl;\r\n          } else if (response.data?.photoUrl) {\r\n            photoUrl = response.data.photoUrl;\r\n          } else if (response.data?.url) {\r\n            photoUrl = response.data.url;\r\n          } else if (response.photoUrl) {\r\n            photoUrl = response.photoUrl;\r\n          } else if (response.url) {\r\n            photoUrl = response.url;\r\n          }\r\n          \r\n          if (photoUrl) {\r\n            resolve(photoUrl);\r\n          } else {\r\n            console.warn('âš ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä¸Šä¼ å“åº”ç»“æ„:', response);\r\n            reject(new Error('ä¸Šä¼ æˆåŠŸä½†æœªè¿”å›å›¾ç‰‡URL'));\r\n          }\r\n        }).catch(error => {\r\n          console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä¸Šä¼ å›¾ç‰‡åˆ°æœåŠ¡å™¨å¤±è´¥:', error);\r\n          reject(new Error('ä¸Šä¼ å¤±è´¥: ' + (error.message || error.errMsg || 'æœªçŸ¥é”™è¯¯')));\r\n        });\r\n      });\r\n    },\r\n    \r\n    async onPickSingle(idx) {\r\n      if (!this.heartMask[idx]) return;\r\n      \r\n      try {\r\n        // é€‰æ‹©æ–°å›¾ç‰‡\r\n        const res = await uni.chooseImage({ \r\n          count: 1,\r\n          sizeType: ['compressed'],\r\n          sourceType: ['album', 'camera']\r\n        });\r\n        \r\n        if (!res || !res.tempFilePaths || !res.tempFilePaths[0]) {\r\n          return;\r\n        }\r\n        \r\n        const newImagePath = res.tempFilePaths[0];\r\n        const isExistingPhoto = this.images[idx] && this.editingProjectId;\r\n        const photoId = this.photoMap[idx];\r\n        \r\n        // å¦‚æœå·²æœ‰é¡¹ç›®ä¸”æœ‰photoIdï¼Œè¯´æ˜æ˜¯æ›¿æ¢å·²æœ‰ç…§ç‰‡\r\n        if (isExistingPhoto && photoId) {\r\n          uni.showLoading({ title: 'æ›¿æ¢ä¸­...', mask: true });\r\n          \r\n          try {\r\n            console.log(`ğŸ”„ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å¼€å§‹æ›¿æ¢ä½ç½® ${idx} çš„ç…§ç‰‡ï¼ŒphotoId: ${photoId}`);\r\n            \r\n            // 1. ä¸Šä¼ æ–°å›¾ç‰‡åˆ°æœåŠ¡å™¨\r\n            console.log('ğŸ“¤ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä¸Šä¼ æ–°å›¾ç‰‡åˆ°æœåŠ¡å™¨...');\r\n            const photoUrl = await this.uploadImageToServer(newImagePath, this.editingProjectId, idx);\r\n            console.log('âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ–°å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ŒURL:', photoUrl);\r\n            \r\n            // 2. æ›´æ–°åç«¯ç…§ç‰‡ä¿¡æ¯\r\n            const updateData = {\r\n              photoUrl: photoUrl,\r\n              thumbnailUrl: photoUrl,\r\n              positionIndex: idx\r\n            };\r\n            \r\n            console.log('ğŸ“ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ›´æ–°åç«¯ç…§ç‰‡ä¿¡æ¯...');\r\n            await updatePhoto(photoId, updateData);\r\n            console.log('âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] åç«¯ç…§ç‰‡æ›´æ–°æˆåŠŸ');\r\n            \r\n            // 3. æ›´æ–°å‰ç«¯æ˜¾ç¤º\r\n            this.$set(this.images, idx, photoUrl);\r\n            this.persist();\r\n            \r\n            uni.hideLoading();\r\n            uni.showToast({ \r\n              title: 'æ›¿æ¢æˆåŠŸ', \r\n              icon: 'success',\r\n              duration: 1500\r\n            });\r\n          } catch (error) {\r\n            console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ›¿æ¢ç…§ç‰‡å¤±è´¥:', error);\r\n            uni.hideLoading();\r\n            uni.showToast({ \r\n              title: error.message || 'æ›¿æ¢å¤±è´¥ï¼Œè¯·é‡è¯•', \r\n              icon: 'none',\r\n              duration: 2000\r\n            });\r\n          }\r\n        } else {\r\n          // æ–°æ·»åŠ ç…§ç‰‡ï¼ˆé¡¹ç›®æœªåˆ›å»ºæˆ–è¯¥ä½ç½®æ²¡æœ‰ç…§ç‰‡ï¼‰\r\n          // æš‚æ—¶åªæ›´æ–°å‰ç«¯æ˜¾ç¤ºï¼Œä¿å­˜é¡¹ç›®æ—¶ä¼šç»Ÿä¸€ä¸Šä¼ \r\n          this.$set(this.images, idx, newImagePath);\r\n          this.persist();\r\n          \r\n          uni.showToast({ \r\n            title: 'å·²æ·»åŠ ç…§ç‰‡', \r\n            icon: 'success',\r\n            duration: 1000\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é€‰æ‹©å›¾ç‰‡å¤±è´¥:', e);\r\n        uni.showToast({ \r\n          title: 'é€‰æ‹©å›¾ç‰‡å¤±è´¥', \r\n          icon: 'none'\r\n        });\r\n      }\r\n    },\r\n    onInvite() {\r\n      uni.showToast({ title: 'é‚€è¯·åŠŸèƒ½å¾…æ¥å…¥åç«¯', icon: 'none' });\r\n    },\r\n    \r\n    // åŠ è½½é¡¹ç›®æ•°æ®ï¼ˆä»åç«¯ï¼‰\r\n    async loadProjectFromBackend(projectId) {\r\n      try {\r\n        console.log('ğŸ“¡ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å¼€å§‹ä»åç«¯åŠ è½½é¡¹ç›®è¯¦æƒ… ID:', projectId);\r\n        \r\n        // è·å–é¡¹ç›®è¯¦æƒ…\r\n        const projectResponse = await getProjectDetail(projectId);\r\n        console.log('ğŸ“¡ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é¡¹ç›®è¯¦æƒ…:', projectResponse);\r\n        \r\n        // è·å–é¡¹ç›®ç…§ç‰‡åˆ—è¡¨\r\n        const photosResponse = await getProjectPhotos(projectId, { page: 1, pageSize: 100 });\r\n        console.log('ğŸ“¡ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é¡¹ç›®ç…§ç‰‡:', photosResponse);\r\n        \r\n        // å¤„ç†ç…§ç‰‡æ•°æ®\r\n        let photosData = [];\r\n        if (photosResponse && photosResponse.data) {\r\n          photosData = Array.isArray(photosResponse.data) ? photosResponse.data : (photosResponse.data.photos || []);\r\n        } else if (Array.isArray(photosResponse)) {\r\n          photosData = photosResponse;\r\n        } else if (photosResponse && photosResponse.photos) {\r\n          photosData = photosResponse.photos;\r\n        }\r\n        \r\n        // å°†ç…§ç‰‡æŒ‰ä½ç½®ç´¢å¼•å¡«å……åˆ°imagesæ•°ç»„ï¼ŒåŒæ—¶ä¿å­˜photoIdæ˜ å°„\r\n        this.images = [];\r\n        this.photoMap = {};\r\n        photosData.forEach(photo => {\r\n          const positionIndex = photo.positionIndex || photo.position_index || 0;\r\n          const photoId = photo.photoId || photo.photo_id || photo.id;\r\n          if (positionIndex >= 0 && positionIndex < this.heartMask.length) {\r\n            // ä¼˜å…ˆä½¿ç”¨photoUrlï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨thumbnailUrl\r\n            const rawUrl = photo.photoUrl || photo.photo_url || photo.thumbnailUrl || photo.thumbnail_url || '';\r\n            // å¤„ç†URLï¼šå¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œæ‹¼æ¥baseURL\r\n            const processedUrl = processImageUrl(rawUrl);\r\n            console.log(`ğŸ–¼ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} åŸå§‹URL: ${rawUrl}, å¤„ç†åURL: ${processedUrl}`);\r\n            this.$set(this.images, positionIndex, processedUrl);\r\n            // ä¿å­˜photoIdæ˜ å°„\r\n            if (photoId) {\r\n              this.$set(this.photoMap, positionIndex, photoId);\r\n            }\r\n          }\r\n        });\r\n        \r\n        console.log(`âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æˆåŠŸåŠ è½½ ${photosData.length} å¼ ç…§ç‰‡`);\r\n        console.log('ğŸ“· [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡IDæ˜ å°„:', this.photoMap);\r\n        console.log('ğŸ–¼ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡URLåˆ—è¡¨:', this.images.filter(url => url));\r\n      } catch (error) {\r\n        console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] åŠ è½½é¡¹ç›®æ•°æ®å¤±è´¥:', error);\r\n        uni.showToast({ \r\n          title: 'åŠ è½½é¡¹ç›®å¤±è´¥', \r\n          icon: 'none',\r\n          duration: 2000\r\n        });\r\n      }\r\n    },\r\n    \r\n    // å‹ç¼©å›¾ç‰‡\r\n    compressImage(tempFilePath) {\r\n      return new Promise((resolve, reject) => {\r\n        uni.compressImage({\r\n          src: tempFilePath,\r\n          quality: 80,\r\n          success: (res) => {\r\n            console.log('âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å›¾ç‰‡å‹ç¼©æˆåŠŸï¼Œæ–°è·¯å¾„:', res.tempFilePath);\r\n            resolve(res.tempFilePath);\r\n          },\r\n          fail: (error) => {\r\n            console.warn('âš ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å›¾ç‰‡å‹ç¼©å¤±è´¥ï¼Œä½¿ç”¨åŸå›¾', error);\r\n            resolve(tempFilePath);\r\n          }\r\n        });\r\n      });\r\n    },\r\n    \r\n    // ä¿å­˜é¡¹ç›®åˆ°åˆ—è¡¨é¡µ\r\n    onSaveProject() {\r\n      if (this.filledCount === 0) {\r\n        uni.showToast({ title: 'è¯·è‡³å°‘æ·»åŠ ä¸€å¼ ç…§ç‰‡', icon: 'none' });\r\n        return;\r\n      }\r\n\r\n      if (this.saving) {\r\n        uni.showToast({ title: 'ä¿å­˜ä¸­ï¼Œè¯·ç¨å€™...', icon: 'none' });\r\n        return;\r\n      }\r\n\r\n      // å¼¹å‡ºè¾“å…¥æ¡†ï¼Œè®©ç”¨æˆ·è¾“å…¥é¡¹ç›®åç§°å’Œæè¿°\r\n      uni.showModal({\r\n        title: this.editingProjectId ? 'ä¿å­˜ä¿®æ”¹' : 'ä¿å­˜é¡¹ç›®',\r\n        editable: true,\r\n        placeholderText: 'è¯·è¾“å…¥é¡¹ç›®åç§°',\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            const projectName = res.content || 'æˆ‘çš„çˆ±å¿ƒå¢™';\r\n            await this.saveProjectData(projectName);\r\n          }\r\n        }\r\n      });\r\n    },\r\n    \r\n    // ä¿å­˜é¡¹ç›®æ•°æ®ï¼ˆè°ƒç”¨åç«¯APIï¼‰\r\n    async saveProjectData(projectName) {\r\n      this.saving = true;\r\n      \r\n      try {\r\n        uni.showLoading({ title: 'ä¿å­˜ä¸­...', mask: true });\r\n        \r\n        console.log('ğŸ’¾ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å¼€å§‹ä¿å­˜é¡¹ç›®åˆ°åç«¯');\r\n\r\n      // æ„å»ºé¡¹ç›®æ•°æ®\r\n      const projectData = {\r\n          projectName: projectName,\r\n          description: `å…±${this.filledCount}å¼ ç…§ç‰‡`,\r\n          isPublic: false,\r\n          maxPhotos: this.totalSlots\r\n        };\r\n        \r\n        let projectId;\r\n        let createResponse = null; // ç”¨äºé”™è¯¯è°ƒè¯•\r\n        \r\n        // åˆ›å»ºæˆ–æ›´æ–°é¡¹ç›®\r\n        if (this.editingProjectId) {\r\n          // æ›´æ–°ç°æœ‰é¡¹ç›®\r\n          console.log('ğŸ”„ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ›´æ–°é¡¹ç›® ID:', this.editingProjectId);\r\n          await updateProject(this.editingProjectId, projectData);\r\n          projectId = this.editingProjectId;\r\n        } else {\r\n          // åˆ›å»ºæ–°é¡¹ç›®\r\n          console.log('âœ¨ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] åˆ›å»ºæ–°é¡¹ç›®');\r\n          createResponse = await createProject(projectData);\r\n          console.log('âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é¡¹ç›®åˆ›å»ºæˆåŠŸ:', createResponse);\r\n          \r\n          // è·å–é¡¹ç›®ID - æ”¯æŒå¤šç§å“åº”æ ¼å¼\r\n          if (createResponse && createResponse.data) {\r\n            // æ ¼å¼: { data: { projectId: ..., id: ... } }\r\n            projectId = createResponse.data.projectId || createResponse.data.id;\r\n          } else if (createResponse && createResponse.project) {\r\n            // æ ¼å¼: { project: { projectId: ..., id: ... } }\r\n            projectId = createResponse.project.projectId || createResponse.project.id;\r\n          } else if (createResponse && (createResponse.projectId || createResponse.id)) {\r\n            // æ ¼å¼: { projectId: ..., id: ... }\r\n            projectId = createResponse.projectId || createResponse.id;\r\n          }\r\n          \r\n          console.log('ğŸ” [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æå–çš„é¡¹ç›®ID:', projectId);\r\n          \r\n          // å¦‚æœåˆ›å»ºé¡¹ç›®åä»æ— æ³•è·å–IDï¼ŒæŠ›å‡ºè¯¦ç»†é”™è¯¯\r\n          if (!projectId) {\r\n            console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ— æ³•è·å–é¡¹ç›®ID');\r\n            console.error('ğŸ“¦ [å“åº”æ•°æ®ç»“æ„]:', JSON.stringify(createResponse, null, 2));\r\n            throw new Error('æ— æ³•è·å–é¡¹ç›®IDï¼Œè¯·æ£€æŸ¥åç«¯è¿”å›çš„æ•°æ®æ ¼å¼');\r\n          }\r\n        }\r\n        \r\n        console.log('ğŸ“ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é¡¹ç›®ID:', projectId);\r\n        \r\n        // ç¬¬ä¸€æ­¥ï¼šæ”¶é›†æ‰€æœ‰éœ€è¦ä¸Šä¼ çš„ç…§ç‰‡ä¿¡æ¯\r\n        const photoTasks = [];\r\n        for (let i = 0; i < this.heartMask.length; i++) {\r\n          if (this.heartMask[i] && this.images[i]) {\r\n            photoTasks.push({\r\n              positionIndex: i,\r\n              imagePath: this.images[i]\r\n            });\r\n          }\r\n        }\r\n        \r\n        console.log(`ğŸ“‹ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å‡†å¤‡ä¸Šä¼  ${photoTasks.length} å¼ ç…§ç‰‡`);\r\n        \r\n        // ä½¿ç”¨ç›´æ¥ä¸Šä¼ æ–¹å¼ï¼ˆmultipart/form-dataï¼Œä¸€æ­¥å®Œæˆï¼Œæ¨èï¼‰\r\n        console.log('ğŸ“¤ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½¿ç”¨ç›´æ¥ä¸Šä¼ æ–¹å¼ï¼ˆmultipart/form-dataï¼‰');\r\n        \r\n        const savePromises = photoTasks.map(async (task) => {\r\n          const { positionIndex, imagePath } = task;\r\n          \r\n          // åˆ¤æ–­æ˜¯å¦æ˜¯æœ¬åœ°ä¸´æ—¶è·¯å¾„ï¼ˆéœ€è¦ä¸Šä¼ ï¼‰\r\n          const isTmpPath = imagePath && (imagePath.startsWith('http://tmp/') || imagePath.startsWith('https://tmp/'));\r\n          // åˆ¤æ–­æ˜¯å¦æ˜¯çœŸæ­£çš„HTTP/HTTPS URLï¼ˆæ’é™¤ä¸´æ—¶è·¯å¾„ï¼‰\r\n          const isRealUrl = imagePath && \r\n                           (imagePath.startsWith('http://') || imagePath.startsWith('https://')) &&\r\n                           !isTmpPath;\r\n          // åˆ¤æ–­æ˜¯å¦æ˜¯æœ¬åœ°è·¯å¾„ï¼ˆéœ€è¦ä¸Šä¼ ï¼‰\r\n          const isLocalPath = !isRealUrl && !imagePath.startsWith('data:');\r\n          \r\n          // æ£€æŸ¥è¯¥ä½ç½®æ˜¯å¦å·²æœ‰photoIdï¼ˆå·²å­˜åœ¨çš„ç…§ç‰‡ï¼‰\r\n          const existingPhotoId = this.photoMap[positionIndex];\r\n          \r\n          if (isLocalPath || isTmpPath) {\r\n            // æœ¬åœ°æ–‡ä»¶ï¼Œä½¿ç”¨ç›´æ¥ä¸Šä¼ æ–¹å¼\r\n            try {\r\n              if (existingPhotoId) {\r\n                // å·²æœ‰ç…§ç‰‡ï¼Œä½¿ç”¨updatePhotoæ›´æ–°å…¶ä»–ä¿¡æ¯\r\n                console.log(`ğŸ”„ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} å·²æœ‰ç…§ç‰‡(photoId: ${existingPhotoId})ï¼Œä½¿ç”¨æ›´æ–°æ¥å£`);\r\n                // å¯¹äºå·²å­˜åœ¨çš„ç…§ç‰‡ï¼Œæˆ‘ä»¬ä¸æ”¯æŒç›´æ¥æ›´æ–°æ–‡ä»¶ï¼Œåªèƒ½æ›´æ–°å…¶ä»–ä¿¡æ¯\r\n                // å¦‚æœéœ€è¦æ›´æ–°æ–‡ä»¶ï¼Œç”¨æˆ·åº”è¯¥å…ˆåˆ é™¤å†é‡æ–°ä¸Šä¼ \r\n                const photoData = {\r\n                  positionIndex: positionIndex\r\n                };\r\n                return updatePhoto(existingPhotoId, photoData).catch(error => {\r\n                  console.error(`âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡ ${positionIndex} æ›´æ–°å¤±è´¥:`, error);\r\n                  return null;\r\n                });\r\n              } else {\r\n                // æ–°ç…§ç‰‡ï¼Œç›´æ¥ä¸Šä¼ æ–‡ä»¶+å…ƒæ•°æ®\r\n                console.log(`ğŸ“¤ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç›´æ¥ä¸Šä¼ ç…§ç‰‡ ${positionIndex}ï¼ˆæ–‡ä»¶+å…ƒæ•°æ®ï¼‰...`);\r\n                const result = await uploadPhotoWithFile({\r\n                  filePath: imagePath,\r\n                  projectId: projectId,\r\n                  positionIndex: positionIndex\r\n                });\r\n                console.log(`âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡ ${positionIndex} ä¸Šä¼ æˆåŠŸ`);\r\n                return result;\r\n              }\r\n            } catch (uploadError) {\r\n              console.error(`âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡ ${positionIndex} ä¸Šä¼ å¤±è´¥:`, uploadError);\r\n              return null;\r\n            }\r\n          } else {\r\n            // å·²ç»æ˜¯URLï¼Œä¸æ”¯æŒä¸Šä¼ ï¼Œåªèƒ½æ›´æ–°ä½ç½®ä¿¡æ¯\r\n            console.log(`ğŸ”„ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} å·²ç»æ˜¯URLï¼Œä¸æ”¯æŒä¸Šä¼ ï¼Œåªèƒ½æ›´æ–°ä½ç½®ä¿¡æ¯`);\r\n            // å¯¹äºå·²å­˜åœ¨çš„ç…§ç‰‡ï¼Œæˆ‘ä»¬ä¸æ”¯æŒç›´æ¥æ›´æ–°æ–‡ä»¶ï¼Œåªèƒ½æ›´æ–°å…¶ä»–ä¿¡æ¯\r\n            // å¦‚æœéœ€è¦æ›´æ–°æ–‡ä»¶ï¼Œç”¨æˆ·åº”è¯¥å…ˆåˆ é™¤å†é‡æ–°ä¸Šä¼ \r\n            const photoData = {\r\n              positionIndex: positionIndex\r\n            };\r\n            \r\n            if (existingPhotoId) {\r\n              console.log(`ğŸ”„ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} å·²æœ‰ç…§ç‰‡(photoId: ${existingPhotoId})ï¼Œä½¿ç”¨æ›´æ–°æ¥å£`);\r\n              return updatePhoto(existingPhotoId, photoData).catch(error => {\r\n                console.error(`âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡ ${positionIndex} æ›´æ–°å¤±è´¥:`, error);\r\n                return null;\r\n              });\r\n            } else {\r\n              // å¯¹äºæ–°ç…§ç‰‡ï¼Œå¦‚æœå·²ç»æ˜¯URLåˆ™ä¸æ”¯æŒä¸Šä¼ \r\n              console.warn(`âš ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} æ˜¯æ–°ç…§ç‰‡ä½†å·²ç»æ˜¯URLï¼Œä¸æ”¯æŒä¸Šä¼ `);\r\n              uni.showToast({ \r\n                title: 'ä¸æ”¯æŒä¸Šä¼ å·²å­˜åœ¨çš„å›¾ç‰‡URL', \r\n                icon: 'none',\r\n                duration: 2000\r\n              });\r\n              return null;\r\n            }\r\n          }\r\n        });\r\n        \r\n        // ç­‰å¾…æ‰€æœ‰ç…§ç‰‡ä¿å­˜å®Œæˆ\r\n        console.log(`ğŸ’¾ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å¼€å§‹ä¿å­˜ ${savePromises.length} å¼ ç…§ç‰‡ä¿¡æ¯`);\r\n        const saveResults = await Promise.all(savePromises);\r\n        const savedCount = saveResults.filter(r => r !== null).length;\r\n        \r\n        console.log(`âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æˆåŠŸä¿å­˜ ${savedCount}/${photoTasks.length} å¼ ç…§ç‰‡`);\r\n        \r\n        // æ›´æ–°photoMapï¼Œä¿å­˜æ–°ä¸Šä¼ ç…§ç‰‡çš„photoIdæ˜ å°„\r\n        saveResults.forEach((result, index) => {\r\n          if (result && result.data) {\r\n            const photoId = result.data.photoId || result.data.photo_id || result.data.id;\r\n            const photo = photoTasks[index];\r\n            \r\n            if (photoId && photo) {\r\n              const positionIndex = photo.positionIndex || photo.index;\r\n              // åªæœ‰æ–°å¢çš„ç…§ç‰‡æ‰éœ€è¦æ›´æ–°photoMapï¼ˆå·²æœ‰çš„ç…§ç‰‡photoMapå·²ç»å­˜åœ¨ï¼‰\r\n              if (positionIndex !== undefined && !this.photoMap[positionIndex]) {\r\n                this.$set(this.photoMap, positionIndex, photoId);\r\n                console.log(`ğŸ“· [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ›´æ–°ç…§ç‰‡æ˜ å°„: positionIndex=${positionIndex}, photoId=${photoId}`);\r\n              } else if (positionIndex !== undefined) {\r\n                console.log(`ğŸ“· [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} ç…§ç‰‡å·²å­˜åœ¨(photoId: ${photoId})ï¼Œæ— éœ€æ›´æ–°æ˜ å°„`);\r\n              }\r\n            }\r\n          }\r\n        });\r\n        \r\n        // ä¿å­˜é¡¹ç›®IDï¼Œä»¥ä¾¿åç»­å¯ä»¥ç»§ç»­ç¼–è¾‘\r\n        this.editingProjectId = projectId;\r\n        uni.setStorageSync('heartwall_editing_projectId', projectId);\r\n        \r\n        uni.hideLoading();\r\n        uni.showToast({ \r\n          title: this.editingProjectId ? 'ä¿®æ”¹æˆåŠŸ' : 'ä¿å­˜æˆåŠŸ', \r\n          icon: 'success',\r\n          duration: 1500\r\n        });\r\n        \r\n        // å»¶è¿Ÿè·³è½¬åˆ°åˆ—è¡¨é¡µ\r\n        setTimeout(() => {\r\n          uni.navigateBack();\r\n        }, 1500);\r\n      } catch (error) {\r\n        console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä¿å­˜é¡¹ç›®å¤±è´¥:', error);\r\n        uni.hideLoading();\r\n        uni.showToast({ \r\n          title: error.message || 'ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', \r\n          icon: 'none',\r\n          duration: 2000\r\n        });\r\n      } finally {\r\n        this.saving = false;\r\n      }\r\n    },\r\n    persist() {\r\n      try { uni.setStorageSync('heartwall_grid_images', this.images); } catch (e) {}\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n.create-page { min-height: 100vh; background: #FFFAF4; display: flex; flex-direction: column; overflow: hidden; }\r\n\r\n/* è‡ªå®šä¹‰å¯¼èˆªæ ï¼ˆä¸é¦–é¡µä¸€è‡´ï¼‰ */\r\n.custom-navbar { position: fixed; top: 0; left: 0; right: 0; z-index: 9999; background-color: #FFFAF4; overflow: hidden; }\r\n.navbar-gradient-bg { position: absolute; top: 0; left: 0; right: 0; height: 200%; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }\r\n.status-bar { width: 100%; background: transparent; position: relative; z-index: 1; }\r\n.navbar-content { display: flex; align-items: center; justify-content: space-between; padding: 0 30rpx; box-sizing: border-box; position: relative; z-index: 1; }\r\n.navbar-left, .navbar-right { width: 80rpx; display: flex; align-items: center; justify-content: center; }\r\n.navbar-title { flex: 1; display: flex; align-items: center; justify-content: center; text-align: center; }\r\n.title-text { font-size: 36rpx; font-weight: 500; color: #4A4A4A; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif; }\r\n.back-icon { font-size: 50rpx; font-weight: 600; color: #4A4A4A; line-height: 1; }\r\n\r\n.center { display: flex; align-items: flex-start; justify-content: center; padding: 80rpx 0 0 60rpx; }\r\n.heart-grid { width: 640rpx; margin: 0 auto; display: grid; grid-template-columns: repeat(9, 1fr); grid-gap: 10rpx; }\r\n.cell { position: relative; width: 1fr; padding-bottom: 100%; background: rgba(255,255,255,0.7); border-radius: 12rpx; overflow: hidden; }\r\n.cell.hole { background: transparent; }\r\n.cell image { position: absolute; inset: 0; width: 100%; height: 100%; }\r\n.cell.filled { background: #ffffff; }\r\n\r\n.photo-count { \r\n  margin-top: 32rpx; \r\n  padding: 0 60rpx; \r\n  display: flex; \r\n  justify-content: space-between; \r\n  align-items: center; \r\n}\r\n.count-text { \r\n  font-size: 26rpx; \r\n  color: #666; \r\n  font-weight: 500; \r\n}\r\n.clear-btn { \r\n  font-size: 24rpx; \r\n  color: #D48806; \r\n  padding: 8rpx 20rpx; \r\n  background: rgba(255, 201, 77, 0.15); \r\n  border-radius: 20rpx; \r\n}\r\n\r\n.actions { margin-top: 24rpx; padding-bottom: 24rpx; display: flex; flex-direction: column; align-items: center; gap: 16rpx; }\r\n.btn { width: 70%; border-radius: 999rpx; padding: 18rpx 0; font-size: 26rpx; box-shadow: 0 8rpx 20rpx rgba(0,0,0,0.12); }\r\n.btn.yellow { background: linear-gradient(90deg, #FFB5C2 0%, #FFD4A3 100%); color: #3d2a00; }\r\n.btn.green { background: linear-gradient(90deg, #FFB5C2 0%, #FFD4A3 100%); color: #3d2a00; }\r\n.btn.pink { background: linear-gradient(90deg, #FFB5C2 0%, #FFD4A3 100%); color: #3d2a00; }\r\n</style>","import MiniProgramPage from 'C:/Users/Administrator/Desktop/love_time/subPackages/record/pages/heartwall/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["baseUrl","config","uni","wx","clearProjectPhotos","http","updatePhoto","getProjectDetail","getProjectPhotos","updateProject","createProject","uploadPhotoWithFile"],"mappings":"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"}