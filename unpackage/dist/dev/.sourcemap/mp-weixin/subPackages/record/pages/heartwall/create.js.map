{"version":3,"file":"create.js","sources":["subPackages/record/pages/heartwall/create.vue","D:/softcaree/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3ViUGFja2FnZXNccmVjb3JkXHBhZ2VzXGhlYXJ0d2FsbFxjcmVhdGUudnVl"],"sourcesContent":["<template>\r\n  <view class=\"create-page\" :style=\"{ paddingTop: containerPaddingTop }\">\r\n    <!-- è‡ªå®šä¹‰å¯¼èˆªæ ï¼ˆä¸é¦–é¡µä¸€è‡´ï¼‰ -->\r\n    <view class=\"custom-navbar\">\r\n      <view class=\"navbar-gradient-bg\"></view>\r\n      <view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\r\n      <view class=\"navbar-content\" :style=\"{ height: navBarHeight + 'px' }\">\r\n        <view class=\"navbar-left\" @click=\"goBack\">\r\n          <text class=\"back-icon\">â†</text>\r\n        </view>\r\n        <view class=\"navbar-title\">\r\n          <text class=\"title-text\">çˆ±å¿ƒç…§ç‰‡å¢™</text>\r\n        </view>\r\n        <view class=\"navbar-right\"></view>\r\n      </view>\r\n    </view>\r\n    <view class=\"center\">\r\n      <view id=\"heartArea\" class=\"heart-grid\">\r\n        <view v-for=\"(cell, idx) in heartMask\" :key=\"idx\" class=\"cell\" :class=\"{ hole: !cell, filled: cell && images[idx] }\" @tap=\"onPickSingle(idx)\">\r\n          <image v-if=\"images[idx]\" :src=\"images[idx]\" mode=\"aspectFill\" />\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- ç…§ç‰‡æ•°é‡æç¤º -->\r\n    <view class=\"photo-count\">\r\n      <text class=\"count-text\">å·²æ·»åŠ  {{ filledCount }}/{{ totalSlots }} å¼ ç…§ç‰‡</text>\r\n      <text v-if=\"filledCount > 0\" class=\"clear-btn\" @click=\"clearAllImages\">æ¸…ç©º</text>\r\n    </view>\r\n\r\n    <view class=\"actions\">\r\n      <button class=\"btn yellow\" @click=\"onBatchUpload\">\r\n        æ‰¹é‡ä¸Šä¼ ç…§ç‰‡ ({{ remainingSlots > 0 ? `è¿˜å¯æ·»åŠ ${Math.min(9, remainingSlots)}å¼ ` : 'å·²æ»¡' }})\r\n      </button>\r\n      <button class=\"btn green\" @click=\"onSaveProject\">ä¿å­˜é¡¹ç›®</button>\r\n      <button class=\"btn pink\" @click=\"exportAsImage\" v-if=\"filledCount > 0\">å¯¼å‡ºä¸ºå›¾ç‰‡</button>\r\n      <button class=\"btn blue\" @click=\"shareDirectly\" v-if=\"lastExportedImagePath\">åˆ†äº«çˆ±å¿ƒå¢™</button>\r\n    </view>\r\n    \r\n    <!-- éšè—çš„ Canvas ç”¨äºå¯¼å‡ºå›¾ç‰‡ -->\r\n    <canvas canvas-id=\"exportCanvas\" id=\"exportCanvas\" style=\"width: 750px; height: 1000px; position: fixed; top: -10000px; left: -10000px; background: #FFFAF4;\"></canvas>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { createProject, updateProject, uploadPhoto, uploadPhotoWithFile, getProjectDetail, getProjectPhotos, clearProjectPhotos, updatePhoto } from '@/api/heartwall.js';\r\nimport http from '@/utils/http.js';\r\nimport config from '@/utils/config.js';\r\n\r\n// å¤„ç†å›¾ç‰‡URLï¼šå¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œæ‹¼æ¥baseURL\r\nfunction processImageUrl(url) {\r\n  if (!url || url === '') {\r\n    return '';\r\n  }\r\n  \r\n  // å¦‚æœå·²ç»æ˜¯å®Œæ•´çš„URLï¼ˆhttp:// æˆ– https://ï¼‰ï¼Œç›´æ¥è¿”å›\r\n  if (url.startsWith('http://') || url.startsWith('https://')) {\r\n    return url;\r\n  }\r\n  \r\n  // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆä»¥ / å¼€å¤´ï¼‰ï¼Œæ‹¼æ¥baseURL\r\n  if (url.startsWith('/')) {\r\n    // å…¼å®¹é”™è¯¯è¿”å›çš„å‰ç«¯è·¯å¾„ï¼Œå¦‚ /pages/heartwall/uploads/... -> å½’ä¸€åŒ–ä¸º /uploads/... æˆ–å»æ‰ /pages å‰ç¼€\r\n    if (url.startsWith('/pages/')) {\r\n      const stripped = url.replace(/^\\/pages/, '');\r\n      const uploadsIndex = stripped.indexOf('/uploads/');\r\n      if (uploadsIndex !== -1) {\r\n        url = stripped.slice(uploadsIndex);\r\n      } else {\r\n        url = stripped.startsWith('/') ? stripped : '/' + stripped;\r\n      }\r\n    }\r\n    // ç§»é™¤baseURLæœ«å°¾å¯èƒ½å­˜åœ¨çš„æ–œæ ï¼Œé¿å…åŒæ–œæ \r\n    const baseUrl = config.baseURL.endsWith('/') ? config.baseURL.slice(0, -1) : config.baseURL;\r\n    return baseUrl + url;\r\n  }\r\n  \r\n  // å…¶ä»–æƒ…å†µï¼ˆå¯èƒ½æ˜¯ç›¸å¯¹è·¯å¾„ä½†ä¸ä»¥/å¼€å¤´ï¼‰ï¼Œä¹Ÿå°è¯•æ‹¼æ¥\r\n  const baseUrl = config.baseURL.endsWith('/') ? config.baseURL.slice(0, -1) : config.baseURL;\r\n  return baseUrl + '/' + url;\r\n}\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      statusBarHeight: 0,\r\n      navBarHeight: 44,\r\n      screenWidth: 375,\r\n      // 9x9 å¿ƒå½¢æ©ç ï¼ˆ1 è¡¨ç¤ºå¯å¡«å……ï¼Œ0 è¡¨ç¤ºç©ºä½ï¼‰ï¼›å¯æŒ‰éœ€è°ƒæ•´\r\n      heartMask: [\r\n        0,1,1,0,0,1,1,0,0,\r\n        1,1,1,1,1,1,1,1,0,\r\n        1,1,1,1,1,1,1,1,0,\r\n        1,1,1,1,1,1,1,1,0,\r\n        0,1,1,1,1,1,1,0,0,\r\n        0,0,1,1,1,1,0,0,0,\r\n        0,0,0,1,1,0,0,0,0,\r\n        0,0,0,0,0,0,0,0,0,\r\n        0,0,0,0,0,0,0,0,0\r\n      ],\r\n      images: [],\r\n      lastExportedImagePath: '', // æœ€åå¯¼å‡ºçš„å›¾ç‰‡è·¯å¾„ï¼Œç”¨äºåˆ†äº«\r\n      editingProjectId: null,  // æ­£åœ¨ç¼–è¾‘çš„é¡¹ç›®IDï¼Œnull è¡¨ç¤ºåˆ›å»ºæ–°é¡¹ç›®\r\n      saving: false,  // ä¿å­˜ä¸­çŠ¶æ€\r\n      photoMap: {},  // å­˜å‚¨positionIndexåˆ°photoIdçš„æ˜ å°„ { positionIndex: photoId }\r\n      canvasWidth: 0,\r\n      canvasHeight: 0\r\n    };\r\n  },\r\n  computed: {\r\n    containerPaddingTop() {\r\n      const totalHeightPx = this.statusBarHeight + this.navBarHeight;\r\n      const pxToRpx = 750 / this.screenWidth;\r\n      return totalHeightPx * pxToRpx + 'rpx';\r\n    },\r\n    // æ€»å…±å¯å¡«å……çš„ä½ç½®æ•°\r\n    totalSlots() {\r\n      return this.heartMask.filter(cell => cell === 1).length;\r\n    },\r\n    // å·²å¡«å……çš„ç…§ç‰‡æ•°\r\n    filledCount() {\r\n      let count = 0;\r\n      for (let i = 0; i < this.heartMask.length; i++) {\r\n        if (this.heartMask[i] && this.images[i]) {\r\n          count++;\r\n        }\r\n      }\r\n      return count;\r\n    },\r\n    // å‰©ä½™å¯æ·»åŠ çš„ç…§ç‰‡æ•°\r\n    remainingSlots() {\r\n      return this.totalSlots - this.filledCount;\r\n    }\r\n  },\r\n  async mounted() {\r\n    this.getSystemInfo();\r\n    // æ£€æŸ¥æ˜¯å¦åœ¨ç¼–è¾‘ç°æœ‰é¡¹ç›®\r\n    try {\r\n      const editingProjectId = uni.getStorageSync('heartwall_editing_projectId');\r\n      if (editingProjectId) {\r\n        this.editingProjectId = editingProjectId;\r\n        // ä»åç«¯åŠ è½½é¡¹ç›®æ•°æ®\r\n        await this.loadProjectFromBackend(editingProjectId);\r\n      } else {\r\n        // å¦‚æœæ²¡æœ‰é¡¹ç›®IDï¼Œå°è¯•ä»æœ¬åœ°ç¼“å­˜åŠ è½½ï¼ˆå…¼å®¹æ—§æ•°æ®ï¼‰\r\n      const cached = uni.getStorageSync('heartwall_grid_images');\r\n      if (Array.isArray(cached)) {\r\n        this.images = cached;\r\n      }\r\n      }\r\n    } catch (e) {\r\n      console.error('åŠ è½½é¡¹ç›®æ•°æ®å¤±è´¥:', e);\r\n    }\r\n  },\r\n  methods: {\r\n    goBack() {\r\n      uni.navigateBack();\r\n    },\r\n    \r\n    // å¯¼å‡ºä¸ºå›¾ç‰‡åŠŸèƒ½\r\n    async exportAsImage() {\r\n      // æ£€æŸ¥æ˜¯å¦æœ‰ç…§ç‰‡\r\n      if (this.filledCount === 0) {\r\n        uni.showToast({\r\n          title: 'è¯·å…ˆæ·»åŠ ç…§ç‰‡å†å¯¼å‡º',\r\n          icon: 'none'\r\n        });\r\n        return;\r\n      }\r\n      \r\n      // æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•\r\n      if (!this.checkLoginRequired()) {\r\n        return;\r\n      }\r\n      \r\n      uni.showLoading({ title: 'æ­£åœ¨ç”Ÿæˆç²¾ç¾å›¾ç‰‡...', mask: true });\r\n      \r\n      try {\r\n        // ä½¿ç”¨å›ºå®šçš„ç”»å¸ƒå°ºå¯¸\r\n        const canvasWidth = 750; // ä¸Canvaså…ƒç´ å®½åº¦ä¸€è‡´\r\n        const canvasHeight = 1000; // ä¸Canvaså…ƒç´ é«˜åº¦ä¸€è‡´\r\n        const cellSize = 70; // å›ºå®šæ ¼å­å¤§å°\r\n        const gridWidth = cellSize * 9;\r\n        const gridHeight = cellSize * 9;\r\n        const startX = (canvasWidth - gridWidth) / 2; // å±…ä¸­æ˜¾ç¤º\r\n        const startY = 180; // ä»é¡¶éƒ¨180pxå¼€å§‹ç»˜åˆ¶\r\n        \r\n        // åˆ›å»ºç”»å¸ƒä¸Šä¸‹æ–‡\r\n        const ctx = uni.createCanvasContext('exportCanvas', this);\r\n        \r\n        // æ¸…ç©ºç”»å¸ƒ\r\n        ctx.clearRect(0, 0, canvasWidth, canvasHeight);\r\n        \r\n        // è®¾ç½®ç”»å¸ƒèƒŒæ™¯ - æ¸å˜èƒŒæ™¯\r\n        const gradient = ctx.createLinearGradient(0, 0, 0, canvasHeight);\r\n        gradient.addColorStop(0, '#FFF0F5'); // æµ…ç²‰è‰²\r\n        gradient.addColorStop(1, '#FFE4E1'); // æµ…ç«ç‘°è‰²\r\n        ctx.setFillStyle(gradient);\r\n        ctx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n        \r\n        // ç»˜åˆ¶é¡¶éƒ¨è£…é¥°çº¿æ¡\r\n        ctx.setStrokeStyle('#FFB6C1');\r\n        ctx.setLineWidth(2);\r\n        ctx.beginPath();\r\n        ctx.moveTo(startX, startY - 30);\r\n        ctx.lineTo(startX + gridWidth, startY - 30);\r\n        ctx.stroke();\r\n        \r\n        // ç»˜åˆ¶åº•éƒ¨è£…é¥°çº¿æ¡\r\n        ctx.beginPath();\r\n        ctx.moveTo(startX, startY + gridHeight + 30);\r\n        ctx.lineTo(startX + gridWidth, startY + gridHeight + 30);\r\n        ctx.stroke();\r\n        \r\n        // ç»˜åˆ¶è£…é¥°æ€§å¿ƒå½¢å›¾æ ‡\r\n        ctx.setFontSize(36);\r\n        ctx.setFillStyle('#FF69B4');\r\n        ctx.setTextAlign('center');\r\n        ctx.setTextBaseline('middle');\r\n        ctx.fillText('â™¥', canvasWidth / 2, 60);\r\n        \r\n        // ç»˜åˆ¶æ ‡é¢˜\r\n        ctx.setFontSize(28);\r\n        ctx.setFillStyle('#8B4513'); // æ£•è‰²\r\n        ctx.setTextAlign('center');\r\n        ctx.setTextBaseline('middle');\r\n        ctx.fillText('çˆ±å¿ƒç…§ç‰‡å¢™', canvasWidth / 2, 100);\r\n        \r\n        // ç»˜åˆ¶ç»Ÿè®¡ä¿¡æ¯\r\n        ctx.setFontSize(18);\r\n        ctx.setFillStyle('#8B4513');\r\n        ctx.setTextAlign('center');\r\n        ctx.setTextBaseline('middle');\r\n        ctx.fillText(`å…± ${this.filledCount} å¼ çè´µç…§ç‰‡`, canvasWidth / 2, 140);\r\n        \r\n        // ç»˜åˆ¶å¿ƒå½¢å›¾æ¡ˆ\r\n        // ç»˜åˆ¶æ¯ä¸ªæ ¼å­\r\n        for (let row = 0; row < 9; row++) {\r\n          for (let col = 0; col < 9; col++) {\r\n            const idx = row * 9 + col;\r\n            \r\n            // å¦‚æœæ˜¯å¿ƒå½¢åŒºåŸŸ\r\n            if (this.heartMask[idx]) {\r\n              const x = startX + col * cellSize;\r\n              const y = startY + row * cellSize;\r\n              \r\n              // ç»˜åˆ¶åœ†è§’çŸ©å½¢èƒŒæ™¯\r\n              this.drawRoundedRect(ctx, x, y, cellSize, cellSize, 10);\r\n              ctx.setFillStyle('rgba(255, 255, 255, 0.9)');\r\n              ctx.fill();\r\n              ctx.setStrokeStyle('#FFB6C1');\r\n              ctx.setLineWidth(1);\r\n              ctx.stroke();\r\n              \r\n              // å¦‚æœæœ‰å›¾ç‰‡ï¼Œåˆ™ç»˜åˆ¶å›¾ç‰‡\r\n              if (this.images[idx]) {\r\n                // ç­‰å¾…å›¾ç‰‡åŠ è½½å®Œæˆåå†ç»˜åˆ¶\r\n                await this.drawImageOnCanvas(ctx, this.images[idx], x + 2, y + 2, cellSize - 4, cellSize - 4);\r\n              } else {\r\n                // ç»˜åˆ¶ç©ºæ ¼å­çš„æç¤º\r\n                ctx.setFontSize(12);\r\n                ctx.setFillStyle('#FFB6C1');\r\n                ctx.setTextAlign('center');\r\n                ctx.setTextBaseline('middle');\r\n                ctx.fillText('+', x + cellSize / 2, y + cellSize / 2);\r\n              }\r\n            }\r\n          }\r\n        }\r\n        \r\n        // ç»˜åˆ¶åº•éƒ¨ä¿¡æ¯\r\n        ctx.setFontSize(16);\r\n        ctx.setFillStyle('#8B4513');\r\n        ctx.setTextAlign('center');\r\n        ctx.setTextBaseline('middle');\r\n        ctx.fillText('Created with Love Time', canvasWidth / 2, canvasHeight - 50);\r\n        ctx.fillText(new Date().toLocaleDateString('zh-CN', { \r\n          year: 'numeric', \r\n          month: 'long', \r\n          day: 'numeric' \r\n        }), canvasWidth / 2, canvasHeight - 20);\r\n        \r\n        // ç»˜åˆ¶åº•éƒ¨è£…é¥°å¿ƒå½¢\r\n        ctx.setFontSize(20);\r\n        ctx.setFillStyle('#FF69B4');\r\n        ctx.fillText('â™¥ â™¡ â™¥ â™¡ â™¥', canvasWidth / 2, canvasHeight - 80);\r\n        \r\n        // ç»˜åˆ¶å®Œæˆï¼Œä¿å­˜åˆ°ç›¸å†Œ\r\n        ctx.draw(true, () => {  // ä½¿ç”¨åŒæ­¥ç»˜åˆ¶\r\n          // å»¶è¿Ÿä¸€ä¼šå„¿ç¡®ä¿ç»˜åˆ¶å®Œæˆ\r\n          setTimeout(() => {\r\n            uni.canvasToTempFilePath({\r\n              x: 0,\r\n              y: 0,\r\n              width: canvasWidth,\r\n              height: canvasHeight,\r\n              destWidth: canvasWidth * 2, // æé«˜åˆ†è¾¨ç‡\r\n              destHeight: canvasHeight * 2,\r\n              canvasId: 'exportCanvas',\r\n              fileType: 'png',\r\n              quality: 1,\r\n              success: (res) => {\r\n                // æ£€æŸ¥è¿”å›çš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„\r\n                if (!res.tempFilePath) {\r\n                  uni.hideLoading();\r\n                  uni.showToast({\r\n                    title: 'å¯¼å‡ºå¤±è´¥ï¼šæ— æ³•ç”Ÿæˆå›¾ç‰‡',\r\n                    icon: 'none'\r\n                  });\r\n                  return;\r\n                }\r\n                \r\n                // ä¿å­˜åˆ°ç›¸å†Œ\r\n                uni.saveImageToPhotosAlbum({\r\n                  filePath: res.tempFilePath,\r\n                  success: () => {\r\n                    uni.hideLoading();\r\n                    \r\n                    // ä¿å­˜æœ€åå¯¼å‡ºçš„å›¾ç‰‡è·¯å¾„ï¼Œç”¨äºåˆ†äº«\r\n                    this.lastExportedImagePath = res.tempFilePath;\r\n                    \r\n                    // ä¿å­˜æˆåŠŸåï¼Œæä¾›åˆ†äº«é€‰é¡¹\r\n                    this.showShareOptions(res.tempFilePath);\r\n                  },\r\n                  fail: (err) => {\r\n                    uni.hideLoading();\r\n                    console.error('ä¿å­˜å›¾ç‰‡å¤±è´¥:', err);\r\n                    // æ£€æŸ¥æ˜¯å¦æ˜¯å› ä¸ºæƒé™é—®é¢˜\r\n                    if (err.errMsg && err.errMsg.includes('auth deny')) {\r\n                      uni.showModal({\r\n                        title: 'æƒé™ç”³è¯·',\r\n                        content: 'éœ€è¦ç›¸å†Œæƒé™æ‰èƒ½ä¿å­˜å›¾ç‰‡ï¼Œè¯·åœ¨è®¾ç½®ä¸­å¼€å¯ç›¸å†Œæƒé™',\r\n                        showCancel: true,\r\n                        confirmText: 'å»è®¾ç½®',\r\n                        success: (modalRes) => {\r\n                          if (modalRes.confirm) {\r\n                            // #ifdef MP-WEIXIN\r\n                            uni.openSetting({\r\n                              success: (settingRes) => {\r\n                                if (settingRes.authSetting['scope.writePhotosAlbum']) {\r\n                                  uni.showToast({\r\n                                    title: 'æƒé™å·²å¼€å¯ï¼Œè¯·é‡æ–°å¯¼å‡º',\r\n                                    icon: 'none'\r\n                                  });\r\n                                }\r\n                              },\r\n                              fail: (settingErr) => {\r\n                                console.error('æ‰“å¼€è®¾ç½®å¤±è´¥:', settingErr);\r\n                                uni.showToast({\r\n                                  title: 'æ‰“å¼€è®¾ç½®å¤±è´¥',\r\n                                  icon: 'none'\r\n                                });\r\n                              }\r\n                            });\r\n                            // #endif\r\n                          }\r\n                        },\r\n                        fail: (modalErr) => {\r\n                          console.error('æ˜¾ç¤ºæ¨¡æ€æ¡†å¤±è´¥:', modalErr);\r\n                          uni.showToast({\r\n                            title: 'æ“ä½œå¤±è´¥',\r\n                            icon: 'none'\r\n                          });\r\n                        }\r\n                      });\r\n                    } else {\r\n                      uni.showToast({\r\n                        title: 'ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•',\r\n                        icon: 'none'\r\n                      });\r\n                    }\r\n                  }\r\n                });\r\n              },\r\n              fail: (err) => {\r\n                uni.hideLoading();\r\n                console.error('å¯¼å‡ºå›¾ç‰‡å¤±è´¥:', err);\r\n                uni.showToast({\r\n                  title: 'å¯¼å‡ºå¤±è´¥: ' + (err.errMsg || 'æ— æ³•ç”Ÿæˆå›¾ç‰‡'),\r\n                  icon: 'none'\r\n                });\r\n              }\r\n            }, this);\r\n          }, 1500); // å¢åŠ å»¶è¿Ÿæ—¶é—´ç¡®ä¿ç»˜åˆ¶å®Œæˆ\r\n        });\r\n      } catch (error) {\r\n        uni.hideLoading();\r\n        console.error('å¯¼å‡ºå›¾ç‰‡å¤±è´¥:', error);\r\n        uni.showToast({\r\n          title: 'å¯¼å‡ºå¤±è´¥: ' + (error.message || 'æœªçŸ¥é”™è¯¯'),\r\n          icon: 'none'\r\n        });\r\n      }\r\n    },\r\n\r\n    // æ˜¾ç¤ºåˆ†äº«é€‰é¡¹\r\n    showShareOptions(imagePath) {\r\n      uni.showActionSheet({\r\n        itemList: ['é¢„è§ˆå¹¶åˆ†äº«', 'ä¿å­˜åˆ°ç›¸å†Œ', 'å–æ¶ˆ'],\r\n        success: (res) => {\r\n          if (res.tapIndex === 0) {\r\n            // é¢„è§ˆå¹¶åˆ†äº«\r\n            this.previewAndShare(imagePath);\r\n          } else if (res.tapIndex === 1) {\r\n            // ä»…ä¿å­˜åˆ°ç›¸å†Œ\r\n            uni.showToast({\r\n              title: 'å·²ä¿å­˜åˆ°ç›¸å†Œ',\r\n              icon: 'success',\r\n              duration: 1500\r\n            });\r\n          }\r\n          // tapIndex === 2 æ˜¯å–æ¶ˆï¼Œä¸åšä»»ä½•æ“ä½œ\r\n        },\r\n        fail: (err) => {\r\n          console.error('æ˜¾ç¤ºåˆ†äº«é€‰é¡¹å¤±è´¥:', err);\r\n        }\r\n      });\r\n    },\r\n\r\n    // é¢„è§ˆå¹¶åˆ†äº«\r\n    previewAndShare(imagePath) {\r\n      // å…ˆé¢„è§ˆå›¾ç‰‡\r\n      uni.previewImage({\r\n        current: imagePath,\r\n        urls: [imagePath],\r\n        success: () => {\r\n          console.log('å›¾ç‰‡é¢„è§ˆæˆåŠŸ');\r\n          \r\n          // å»¶è¿Ÿæ˜¾ç¤ºåˆ†äº«èœå•ï¼Œè®©ç”¨æˆ·å…ˆçœ‹åˆ°é¢„è§ˆæ•ˆæœ\r\n          setTimeout(() => {\r\n            // #ifdef MP-WEIXIN\r\n            // å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸‹æ˜¾ç¤ºåˆ†äº«èœå•\r\n            this.showWechatShareMenu(imagePath);\r\n            // #endif\r\n            \r\n            // #ifndef MP-WEIXIN\r\n            // éå¾®ä¿¡ç¯å¢ƒä½¿ç”¨é€šç”¨åˆ†äº«\r\n            this.showUniversalShare(imagePath);\r\n            // #endif\r\n          }, 800);\r\n        },\r\n        fail: (error) => {\r\n          console.error('å›¾ç‰‡é¢„è§ˆå¤±è´¥:', error);\r\n          uni.showToast({\r\n            title: 'å›¾ç‰‡é¢„è§ˆå¤±è´¥',\r\n            icon: 'none',\r\n            duration: 1500\r\n          });\r\n        }\r\n      });\r\n    },\r\n\r\n    // ç›´æ¥åˆ†äº«åŠŸèƒ½\r\n    shareDirectly() {\r\n      if (!this.lastExportedImagePath) {\r\n        uni.showToast({\r\n          title: 'è¯·å…ˆå¯¼å‡ºå›¾ç‰‡',\r\n          icon: 'none',\r\n          duration: 1500\r\n        });\r\n        return;\r\n      }\r\n\r\n      console.log('ç›´æ¥åˆ†äº«çˆ±å¿ƒå¢™:', this.lastExportedImagePath);\r\n\r\n      // #ifdef MP-WEIXIN\r\n      // å¾®ä¿¡å°ç¨‹åºç¯å¢ƒ\r\n      this.showWechatShareMenu(this.lastExportedImagePath);\r\n      // #endif\r\n\r\n      // #ifndef MP-WEIXIN\r\n      // éå¾®ä¿¡ç¯å¢ƒ\r\n      this.showUniversalShare(this.lastExportedImagePath);\r\n      // #endif\r\n    },\r\n\r\n    // å¾®ä¿¡åˆ†äº«èœå•\r\n    showWechatShareMenu(imagePath) {\r\n      console.log('å¾®ä¿¡åˆ†äº«èœå•è¢«è°ƒç”¨ï¼Œ imagePath:', imagePath);\r\n      \r\n      // åœ¨å¾®ä¿¡å°ç¨‹åºä¸­ï¼Œåªæä¾›æŒ‡å¼•ï¼Œä¸è°ƒç”¨uni.share\r\n      uni.showModal({\r\n        title: 'åˆ†äº«æŒ‡å¼•',\r\n        content: 'è¯·ç‚¹å‡»å³ä¸Šè§’\"...\"æŒ‰é’®ï¼Œé€‰æ‹©\"è½¬å‘\"æ¥åˆ†äº«è¿™å¼ çˆ±å¿ƒç…§ç‰‡å¢™',\r\n        confirmText: 'æˆ‘çŸ¥é“äº†',\r\n        showCancel: false,\r\n        success: () => {\r\n          console.log('å·²æç¤ºç”¨æˆ·ä½¿ç”¨å³ä¸Šè§’èœå•åˆ†äº«');\r\n        }\r\n      });\r\n    },\r\n\r\n    // é€šç”¨åˆ†äº«\r\n    showUniversalShare(imagePath) {\r\n      try {\r\n        // æ£€æŸ¥æ˜¯å¦æ”¯æŒç³»ç»Ÿåˆ†äº«\r\n        if (typeof uni.shareWithSystem === 'function') {\r\n          uni.shareWithSystem({\r\n            type: 'image',\r\n            imageUrl: imagePath,\r\n            success: () => {\r\n              uni.showToast({\r\n                title: 'åˆ†äº«æˆåŠŸ',\r\n                icon: 'success',\r\n                duration: 1500\r\n              });\r\n            },\r\n            fail: (error) => {\r\n              console.error('ç³»ç»Ÿåˆ†äº«å¤±è´¥:', error);\r\n              this.showShareFallback(imagePath);\r\n            }\r\n          });\r\n        } else {\r\n          // ä¸æ”¯æŒç³»ç»Ÿåˆ†äº«ï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆ\r\n          this.showShareFallback(imagePath);\r\n        }\r\n      } catch (error) {\r\n        console.error('åˆ†äº«åŠŸèƒ½å¼‚å¸¸:', error);\r\n        this.showShareFallback(imagePath);\r\n      }\r\n    },\r\n\r\n    // åˆ†äº«åŠŸèƒ½é™çº§æ–¹æ¡ˆ\r\n    showShareFallback(imagePath) {\r\n      uni.showModal({\r\n        title: 'åˆ†äº«æç¤º',\r\n        content: 'å›¾ç‰‡å·²ä¿å­˜åˆ°ç›¸å†Œï¼Œæ‚¨å¯ä»¥æ‰“å¼€ç›¸å†Œè¿›è¡Œåˆ†äº«',\r\n        confirmText: 'çŸ¥é“äº†',\r\n        showCancel: false,\r\n        success: () => {\r\n          console.log('å·²æç¤ºç”¨æˆ·é€šè¿‡ç›¸å†Œåˆ†äº«');\r\n        }\r\n      });\r\n    },\r\n    \r\n    // åœ¨Canvasä¸Šç»˜åˆ¶å›¾ç‰‡çš„å¼‚æ­¥æ–¹æ³•\r\n    drawImageOnCanvas(ctx, imageUrl, x, y, width, height) {\r\n      return new Promise((resolve) => {\r\n        // æ£€æŸ¥å›¾ç‰‡URLæ˜¯å¦æœ‰æ•ˆ\r\n        if (!imageUrl || typeof imageUrl !== 'string') {\r\n          console.warn('æ— æ•ˆçš„å›¾ç‰‡URL:', imageUrl);\r\n          this.drawPlaceholder(ctx, x, y, width, height);\r\n          resolve();\r\n          return;\r\n        }\r\n        \r\n        // åœ¨ä¸åŒå¹³å°ä½¿ç”¨ä¸åŒçš„å›¾ç‰‡åŠ è½½æ–¹å¼\r\n        // #ifdef MP-WEIXIN\r\n        // å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸‹ä½¿ç”¨ getImageInfo\r\n        uni.getImageInfo({\r\n          src: imageUrl,\r\n          success: (info) => {\r\n            // ç¡®ä¿å›¾ç‰‡æœ‰æ•ˆå†ç»˜åˆ¶\r\n            if (info && info.path) {\r\n              try {\r\n                ctx.drawImage(info.path, x, y, width, height);\r\n              } catch (drawErr) {\r\n                console.warn('ç»˜åˆ¶å›¾ç‰‡å¤±è´¥:', drawErr);\r\n                this.drawPlaceholder(ctx, x, y, width, height);\r\n              }\r\n            } else {\r\n              // å›¾ç‰‡æ— æ•ˆæ—¶ç»˜åˆ¶å ä½ç¬¦\r\n              this.drawPlaceholder(ctx, x, y, width, height);\r\n            }\r\n            resolve();\r\n          },\r\n          fail: (err) => {\r\n            console.warn('å›¾ç‰‡åŠ è½½å¤±è´¥:', imageUrl, err);\r\n            // å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ç»˜åˆ¶å ä½ç¬¦\r\n            this.drawPlaceholder(ctx, x, y, width, height);\r\n            resolve();\r\n          }\r\n        });\r\n        // #endif\r\n        \r\n        // #ifndef MP-WEIXIN\r\n        // å…¶ä»–ç¯å¢ƒä½¿ç”¨ä¼ ç»Ÿæ–¹å¼\r\n        const img = new Image();\r\n        img.onload = () => {\r\n          // ç¡®ä¿å›¾ç‰‡æœ‰æ•ˆå†ç»˜åˆ¶\r\n          if (img.complete && img.naturalWidth !== 0) {\r\n            try {\r\n              ctx.drawImage(img, x, y, width, height);\r\n            } catch (drawErr) {\r\n              console.warn('ç»˜åˆ¶å›¾ç‰‡å¤±è´¥:', drawErr);\r\n              this.drawPlaceholder(ctx, x, y, width, height);\r\n            }\r\n          } else {\r\n            // å›¾ç‰‡æ— æ•ˆæ—¶ç»˜åˆ¶å ä½ç¬¦\r\n            this.drawPlaceholder(ctx, x, y, width, height);\r\n          }\r\n          resolve();\r\n        };\r\n        img.onerror = () => {\r\n          console.warn('å›¾ç‰‡åŠ è½½å¤±è´¥:', imageUrl);\r\n          // å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ç»˜åˆ¶å ä½ç¬¦\r\n          this.drawPlaceholder(ctx, x, y, width, height);\r\n          resolve();\r\n        };\r\n        img.src = imageUrl;\r\n        // #endif\r\n      });\r\n    },\r\n    \r\n    // ç»˜åˆ¶å ä½ç¬¦ï¼ˆå½“å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶ï¼‰\r\n    drawPlaceholder(ctx, x, y, width, height) {\r\n      // ç»˜åˆ¶æµ…è‰²èƒŒæ™¯\r\n      ctx.setFillStyle('rgba(255, 255, 255, 0.7)');\r\n      this.drawRoundedRect(ctx, x, y, width, height, 8);\r\n      ctx.fill();\r\n      \r\n      // ç»˜åˆ¶è¾¹æ¡†\r\n      ctx.setStrokeStyle('#FFB6C1');\r\n      ctx.setLineWidth(1);\r\n      ctx.stroke();\r\n      \r\n      // ç»˜åˆ¶å ä½ç¬¦å›¾æ ‡\r\n      ctx.setFontSize(20);\r\n      ctx.setFillStyle('#FFB6C1');\r\n      ctx.setTextAlign('center');\r\n      ctx.setTextBaseline('middle');\r\n      ctx.fillText('â™¥', x + width / 2, y + height / 2);\r\n    },\r\n\r\n    // ç»˜åˆ¶åœ†è§’çŸ©å½¢\r\n    drawRoundedRect(ctx, x, y, width, height, radius) {\r\n      ctx.beginPath();\r\n      ctx.moveTo(x + radius, y);\r\n      ctx.lineTo(x + width - radius, y);\r\n      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\r\n      ctx.lineTo(x + width, y + height - radius);\r\n      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\r\n      ctx.lineTo(x + radius, y + height);\r\n      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\r\n      ctx.lineTo(x, y + radius);\r\n      ctx.quadraticCurveTo(x, y, x + radius, y);\r\n      ctx.closePath();\r\n      ctx.setFillStyle('#ffffff');\r\n      ctx.fill();\r\n    },\r\n\r\n    getSystemInfo() {\r\n      // #ifdef MP-WEIXIN\r\n      try {\r\n        const windowInfo = wx.getWindowInfo && wx.getWindowInfo();\r\n        if (windowInfo) {\r\n          this.statusBarHeight = windowInfo.statusBarHeight || 0;\r\n          this.screenWidth = windowInfo.windowWidth || 375;\r\n        } else {\r\n          const sys = uni.getSystemInfoSync();\r\n          this.statusBarHeight = sys.statusBarHeight || 0;\r\n          this.screenWidth = sys.windowWidth || 375;\r\n        }\r\n      } catch (e) {\r\n        const sys = uni.getSystemInfoSync();\r\n        this.statusBarHeight = sys.statusBarHeight || 0;\r\n        this.screenWidth = sys.windowWidth || 375;\r\n      }\r\n      this.navBarHeight = 44;\r\n      // #endif\r\n      // #ifdef H5\r\n      const sysH5 = uni.getSystemInfoSync();\r\n      this.statusBarHeight = sysH5.statusBarHeight || 0;\r\n      this.screenWidth = sysH5.windowWidth || 375;\r\n      this.navBarHeight = 44;\r\n      // #endif\r\n      // #ifndef MP-WEIXIN || H5\r\n      const sysOther = uni.getSystemInfoSync();\r\n      this.statusBarHeight = sysOther.statusBarHeight || 0;\r\n      this.screenWidth = sysOther.windowWidth || 375;\r\n      this.navBarHeight = 44;\r\n      // #endif\r\n    },\r\n    async onBatchUpload() {\r\n      // æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•\r\n      if (!this.checkLoginRequired()) {\r\n        return;\r\n      }\r\n      \r\n      // è®¡ç®—ç©ºä½æ•°é‡\r\n      const emptySlots = this.getEmptySlots();\r\n      if (emptySlots.length === 0) {\r\n        uni.showToast({ title: 'ç…§ç‰‡å¢™å·²æ»¡', icon: 'none' });\r\n        return;\r\n      }\r\n\r\n      try {\r\n        // uni-app ä¸€æ¬¡æœ€å¤šé€‰æ‹© 9 å¼ å›¾ç‰‡ï¼ˆå¾®ä¿¡å°ç¨‹åºé™åˆ¶ï¼‰\r\n        const maxCount = Math.min(9, emptySlots.length);\r\n        const res = await uni.chooseImage({ \r\n          count: maxCount, \r\n          sizeType: ['compressed'], \r\n          sourceType: ['album', 'camera'] \r\n        });\r\n        \r\n        if (!res || !res.tempFilePaths || res.tempFilePaths.length === 0) return;\r\n        \r\n        const files = res.tempFilePaths;\r\n        \r\n        // æŒ‰é¡ºåºå¡«å……ç©ºä½\r\n        for (let i = 0; i < files.length && i < emptySlots.length; i++) {\r\n          const idx = emptySlots[i];\r\n          this.$set(this.images, idx, files[i]);\r\n        }\r\n        \r\n        this.persist();\r\n        \r\n        // æç¤ºç”¨æˆ·\r\n        const remainingSlots = emptySlots.length - files.length;\r\n        if (remainingSlots > 0) {\r\n          uni.showToast({ \r\n            title: `å·²æ·»åŠ ${files.length}å¼ ï¼Œè¿˜å¯æ·»åŠ ${remainingSlots}å¼ `, \r\n            icon: 'none',\r\n            duration: 2000\r\n          });\r\n        } else {\r\n          uni.showToast({ \r\n            title: `å·²æ·»åŠ ${files.length}å¼ ç…§ç‰‡`, \r\n            icon: 'success' \r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error('æ‰¹é‡ä¸Šä¼ å¤±è´¥:', e);\r\n      }\r\n    },\r\n    \r\n    // è·å–æ‰€æœ‰ç©ºä½çš„ç´¢å¼•\r\n    getEmptySlots() {\r\n      const slots = [];\r\n      for (let i = 0; i < this.heartMask.length; i++) {\r\n        if (this.heartMask[i] && !this.images[i]) {\r\n          slots.push(i);\r\n        }\r\n      }\r\n      return slots;\r\n    },\r\n    \r\n    // æ¸…ç©ºæ‰€æœ‰ç…§ç‰‡\r\n    async clearAllImages() {\r\n      uni.showModal({\r\n        title: 'ç¡®è®¤æ¸…ç©º',\r\n        content: 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç…§ç‰‡å—ï¼Ÿæ¸…ç©ºåæ— æ³•æ¢å¤ã€‚',\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            try {\r\n              // å¦‚æœæœ‰é¡¹ç›®IDï¼Œè°ƒç”¨åç«¯æ¥å£æ¸…ç©º\r\n              if (this.editingProjectId) {\r\n                uni.showLoading({ title: 'æ¸…ç©ºä¸­...', mask: true });\r\n                console.log('ğŸ—‘ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å¼€å§‹æ¸…ç©ºé¡¹ç›®ç…§ç‰‡ï¼Œé¡¹ç›®ID:', this.editingProjectId);\r\n                \r\n                await clearProjectPhotos(this.editingProjectId);\r\n                \r\n                console.log('âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é¡¹ç›®ç…§ç‰‡æ¸…ç©ºæˆåŠŸ');\r\n                uni.hideLoading();\r\n              }\r\n              \r\n              // æ¸…ç©ºå‰ç«¯æ•°æ®\r\n              this.images = [];\r\n              this.photoMap = {};\r\n              this.persist();\r\n              \r\n            uni.showToast({ title: 'å·²æ¸…ç©º', icon: 'success' });\r\n            } catch (error) {\r\n              console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ¸…ç©ºé¡¹ç›®ç…§ç‰‡å¤±è´¥:', error);\r\n              uni.hideLoading();\r\n              \r\n              // å³ä½¿åç«¯æ¸…ç©ºå¤±è´¥ï¼Œä¹Ÿæ¸…ç©ºå‰ç«¯æ•°æ®\r\n              this.images = [];\r\n              this.persist();\r\n              \r\n              uni.showToast({ \r\n                title: error.message || 'æ¸…ç©ºå¤±è´¥ï¼Œå·²æ¸…ç©ºæœ¬åœ°æ•°æ®', \r\n                icon: 'none',\r\n                duration: 2000\r\n              });\r\n            }\r\n          }\r\n        }\r\n      });\r\n    },\r\n    // ä¸Šä¼ å›¾ç‰‡åˆ°æœåŠ¡å™¨çš„å‡½æ•°\r\n    async uploadImageToServer(imagePath, projectId, positionIndex) {\r\n      return new Promise((resolve, reject) => {\r\n        // ä½¿ç”¨uni.uploadFileä¸Šä¼ å›¾ç‰‡\r\n        const loginInfo = uni.getStorageSync('login_info');\r\n        const token = loginInfo?.token;\r\n        \r\n        if (!token) {\r\n          reject(new Error('æœªç™»å½•ï¼Œæ— æ³•ä¸Šä¼ å›¾ç‰‡'));\r\n          return;\r\n        }\r\n        \r\n        // ä½¿ç”¨é¡¹ç›®ä¸­å·²æœ‰çš„httpå·¥å…·è¿›è¡Œä¸Šä¼ ï¼Œç¡®ä¿ä¸é¡¹ç›®å…¶ä»–ä¸Šä¼ åŠŸèƒ½ä¿æŒä¸€è‡´\r\n        // ä¼ é€’projectIdå’ŒpositionIndexå‚æ•°\r\n        http.upload({\r\n          url: '/api/heart-wall/photos/upload',\r\n          filePath: imagePath,\r\n          name: 'file',\r\n          header: {\r\n            'Authorization': `Bearer ${token}`\r\n          },\r\n          formData: {\r\n            projectId: projectId.toString(),\r\n            positionIndex: positionIndex.toString()\r\n          }\r\n        }).then(response => {\r\n          // ä»å“åº”ä¸­æå–å›¾ç‰‡URL\r\n          // æ ¹æ®å®é™…å“åº”ç»“æ„è§£æï¼š{photos: [{photoUrl: '...'}]}\r\n          let photoUrl = null;\r\n          // æ£€æŸ¥photosæ•°ç»„\r\n          if (response.photos && Array.isArray(response.photos) && response.photos.length > 0) {\r\n            photoUrl = response.photos[0].photoUrl || response.photos[0].thumbnailUrl;\r\n          } else if (response.data?.photos && Array.isArray(response.data.photos) && response.data.photos.length > 0) {\r\n            photoUrl = response.data.photos[0].photoUrl || response.data.photos[0].thumbnailUrl;\r\n          } else if (response.data?.data?.photos && Array.isArray(response.data.data.photos) && response.data.data.photos.length > 0) {\r\n            photoUrl = response.data.data.photos[0].photoUrl || response.data.data.photos[0].thumbnailUrl;\r\n          } else if (response.data?.photoUrl) {\r\n            photoUrl = response.data.photoUrl;\r\n          } else if (response.data?.url) {\r\n            photoUrl = response.data.url;\r\n          } else if (response.photoUrl) {\r\n            photoUrl = response.photoUrl;\r\n          } else if (response.url) {\r\n            photoUrl = response.url;\r\n          }\r\n          \r\n          if (photoUrl) {\r\n            resolve(photoUrl);\r\n          } else {\r\n            console.warn('âš ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä¸Šä¼ å“åº”ç»“æ„:', response);\r\n            reject(new Error('ä¸Šä¼ æˆåŠŸä½†æœªè¿”å›å›¾ç‰‡URL'));\r\n          }\r\n        }).catch(error => {\r\n          console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä¸Šä¼ å›¾ç‰‡åˆ°æœåŠ¡å™¨å¤±è´¥:', error);\r\n          reject(new Error('ä¸Šä¼ å¤±è´¥: ' + (error.message || error.errMsg || 'æœªçŸ¥é”™è¯¯')));\r\n        });\r\n      });\r\n    },\r\n    \r\n    async onPickSingle(idx) {\r\n      if (!this.heartMask[idx]) return;\r\n      \r\n      // æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•\r\n      if (!this.checkLoginRequired()) {\r\n        return;\r\n      }\r\n      \r\n      try {\r\n        // é€‰æ‹©æ–°å›¾ç‰‡\r\n        const res = await uni.chooseImage({ \r\n          count: 1,\r\n          sizeType: ['compressed'],\r\n          sourceType: ['album', 'camera']\r\n        });\r\n        \r\n        if (!res || !res.tempFilePaths || !res.tempFilePaths[0]) {\r\n          return;\r\n        }\r\n        \r\n        const newImagePath = res.tempFilePaths[0];\r\n        const isExistingPhoto = this.images[idx] && this.editingProjectId;\r\n        const photoId = this.photoMap[idx];\r\n        \r\n        console.log(`ğŸ”„ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ£€æŸ¥æ›¿æ¢æ¡ä»¶: isExistingPhoto=${isExistingPhoto}, photoId=${photoId}, images[idx]=${!!this.images[idx]}, editingProjectId=${this.editingProjectId}`);\r\n        \r\n        // å¦‚æœå·²æœ‰é¡¹ç›®ä¸”æœ‰photoIdï¼Œè¯´æ˜æ˜¯æ›¿æ¢å·²æœ‰ç…§ç‰‡\r\n        if (isExistingPhoto && photoId) {\r\n          uni.showLoading({ title: 'æ›¿æ¢ä¸­...', mask: true });\r\n          \r\n          try {\r\n            console.log(`ğŸ”„ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å¼€å§‹æ›¿æ¢ä½ç½® ${idx} çš„ç…§ç‰‡ï¼ŒphotoId: ${photoId}`);\r\n            \r\n            // 1. ä¸Šä¼ æ–°å›¾ç‰‡åˆ°æœåŠ¡å™¨\r\n            console.log('ğŸ“¤ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä¸Šä¼ æ–°å›¾ç‰‡åˆ°æœåŠ¡å™¨...');\r\n            const photoUrl = await this.uploadImageToServer(newImagePath, this.editingProjectId, idx);\r\n            console.log('âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ–°å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼ŒURL:', photoUrl);\r\n            \r\n            // 2. æ›´æ–°åç«¯ç…§ç‰‡ä¿¡æ¯\r\n            const updateData = {\r\n              photoUrl: photoUrl,\r\n              thumbnailUrl: photoUrl,\r\n              positionIndex: idx\r\n            };\r\n            \r\n            console.log('ğŸ“ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ›´æ–°åç«¯ç…§ç‰‡ä¿¡æ¯...');\r\n            console.log(`ğŸ“ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ›´æ–°å‚æ•°: photoId=${photoId}, updateData=`, updateData);\r\n            const updateResult = await updatePhoto(photoId, updateData);\r\n            console.log('âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] åç«¯ç…§ç‰‡æ›´æ–°æˆåŠŸ', updateResult);\r\n            \r\n            // 3. æ›´æ–°å‰ç«¯æ˜¾ç¤º\r\n            this.$set(this.images, idx, photoUrl);\r\n            this.persist();\r\n            \r\n            uni.hideLoading();\r\n            \r\n            // é€šçŸ¥é¡¹ç›®åˆ—è¡¨é¡µé¢éœ€è¦åˆ·æ–°å°é¢å›¾\r\n            uni.$emit('heartwallPhotoUpdated', {\r\n              projectId: this.editingProjectId,\r\n              positionIndex: idx,\r\n              photoUrl: photoUrl\r\n            });\r\n            \r\n            uni.showToast({ \r\n              title: 'æ›¿æ¢æˆåŠŸ', \r\n              icon: 'success',\r\n              duration: 1500\r\n            });\r\n          } catch (error) {\r\n            console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ›¿æ¢ç…§ç‰‡å¤±è´¥:', error);\r\n            uni.hideLoading();\r\n            \r\n            // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯\r\n            let errorMsg = error.message || 'æ›¿æ¢å¤±è´¥ï¼Œè¯·é‡è¯•';\r\n            if (error.message && error.message.includes('ç…§ç‰‡ä¸å­˜åœ¨')) {\r\n              errorMsg = 'ç…§ç‰‡ä¸å­˜åœ¨ï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•';\r\n            } else if (error.statusCode === 500) {\r\n              errorMsg = 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';\r\n            }\r\n            \r\n            uni.showToast({ \r\n              title: errorMsg,\r\n              icon: 'none',\r\n              duration: 3000\r\n            });\r\n          }\r\n        } else {\r\n          // æ–°æ·»åŠ ç…§ç‰‡ï¼ˆé¡¹ç›®æœªåˆ›å»ºæˆ–è¯¥ä½ç½®æ²¡æœ‰ç…§ç‰‡ï¼‰\r\n          // æš‚æ—¶åªæ›´æ–°å‰ç«¯æ˜¾ç¤ºï¼Œä¿å­˜é¡¹ç›®æ—¶ä¼šç»Ÿä¸€ä¸Šä¼ \r\n          this.$set(this.images, idx, newImagePath);\r\n          this.persist();\r\n          \r\n          uni.showToast({ \r\n            title: 'å·²æ·»åŠ ç…§ç‰‡', \r\n            icon: 'success',\r\n            duration: 1000\r\n          });\r\n        }\r\n      } catch (e) {\r\n        console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é€‰æ‹©å›¾ç‰‡å¤±è´¥:', e);\r\n        uni.showToast({ \r\n          title: 'é€‰æ‹©å›¾ç‰‡å¤±è´¥', \r\n          icon: 'none'\r\n        });\r\n      }\r\n    },\r\n    onInvite() {\r\n      uni.showToast({ title: 'é‚€è¯·åŠŸèƒ½å¾…æ¥å…¥åç«¯', icon: 'none' });\r\n    },\r\n    \r\n    // åŠ è½½é¡¹ç›®æ•°æ®ï¼ˆä»åç«¯ï¼‰\r\n    async loadProjectFromBackend(projectId) {\r\n      try {\r\n        console.log('ğŸ“¡ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å¼€å§‹ä»åç«¯åŠ è½½é¡¹ç›®è¯¦æƒ… ID:', projectId);\r\n        \r\n        // è·å–é¡¹ç›®è¯¦æƒ…\r\n        const projectResponse = await getProjectDetail(projectId);\r\n        console.log('ğŸ“¡ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é¡¹ç›®è¯¦æƒ…:', projectResponse);\r\n        \r\n        // è·å–é¡¹ç›®ç…§ç‰‡åˆ—è¡¨\r\n        const photosResponse = await getProjectPhotos(projectId, { page: 1, pageSize: 100 });\r\n        console.log('ğŸ“¡ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é¡¹ç›®ç…§ç‰‡:', photosResponse);\r\n        \r\n        // å¤„ç†ç…§ç‰‡æ•°æ®\r\n        let photosData = [];\r\n        if (photosResponse && photosResponse.data) {\r\n          photosData = Array.isArray(photosResponse.data) ? photosResponse.data : (photosResponse.data.photos || []);\r\n        } else if (Array.isArray(photosResponse)) {\r\n          photosData = photosResponse;\r\n        } else if (photosResponse && photosResponse.photos) {\r\n          photosData = photosResponse.photos;\r\n        }\r\n        \r\n        // å°†ç…§ç‰‡æŒ‰ä½ç½®ç´¢å¼•å¡«å……åˆ°imagesæ•°ç»„ï¼ŒåŒæ—¶ä¿å­˜photoIdæ˜ å°„\r\n        this.images = [];\r\n        this.photoMap = {};\r\n        photosData.forEach(photo => {\r\n          const positionIndex = photo.positionIndex || photo.position_index || 0;\r\n          // æ›´å®Œå–„çš„photoIdæå–é€»è¾‘\r\n          const photoId = photo.id || photo.photoId || photo.photo_id;\r\n          if (positionIndex >= 0 && positionIndex < this.heartMask.length) {\r\n            // ä¼˜å…ˆä½¿ç”¨photoUrlï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨thumbnailUrl\r\n            const rawUrl = photo.photoUrl || photo.photo_url || photo.thumbnailUrl || photo.thumbnail_url || '';\r\n            // å¤„ç†URLï¼šå¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œæ‹¼æ¥baseURL\r\n            const processedUrl = processImageUrl(rawUrl);\r\n            console.log(`ğŸ–¼ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} åŸå§‹URL: ${rawUrl}, å¤„ç†åURL: ${processedUrl}`);\r\n            this.$set(this.images, positionIndex, processedUrl);\r\n            // ä¿å­˜photoIdæ˜ å°„\r\n            if (photoId) {\r\n              this.$set(this.photoMap, positionIndex, photoId);\r\n              console.log(`ğŸ“· [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä¿å­˜ç…§ç‰‡æ˜ å°„: positionIndex=${positionIndex}, photoId=${photoId}`);\r\n            } else {\r\n              console.warn(`âš ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} çš„ç…§ç‰‡ç¼ºå°‘IDå­—æ®µ`);\r\n            }\r\n          }\r\n        });\r\n        \r\n        console.log(`âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æˆåŠŸåŠ è½½ ${photosData.length} å¼ ç…§ç‰‡`);\r\n        console.log('ğŸ“· [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡IDæ˜ å°„:', this.photoMap);\r\n        console.log('ğŸ–¼ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡URLåˆ—è¡¨:', this.images.filter(url => url));\r\n      } catch (error) {\r\n        console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] åŠ è½½é¡¹ç›®æ•°æ®å¤±è´¥:', error);\r\n        uni.showToast({ \r\n          title: 'åŠ è½½é¡¹ç›®å¤±è´¥', \r\n          icon: 'none',\r\n          duration: 2000\r\n        });\r\n      }\r\n    },\r\n    \r\n    // å‹ç¼©å›¾ç‰‡\r\n    compressImage(tempFilePath) {\r\n      return new Promise((resolve, reject) => {\r\n        uni.compressImage({\r\n          src: tempFilePath,\r\n          quality: 80,\r\n          success: (res) => {\r\n            console.log('âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å›¾ç‰‡å‹ç¼©æˆåŠŸï¼Œæ–°è·¯å¾„:', res.tempFilePath);\r\n            resolve(res.tempFilePath);\r\n          },\r\n          fail: (error) => {\r\n            console.warn('âš ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å›¾ç‰‡å‹ç¼©å¤±è´¥ï¼Œä½¿ç”¨åŸå›¾', error);\r\n            resolve(tempFilePath);\r\n          }\r\n        });\r\n      });\r\n    },\r\n    \r\n    // æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•\r\n    checkLoginRequired() {\r\n      const loginInfo = uni.getStorageSync('login_info');\r\n      // å¦‚æœæ˜¯æ¸¸å®¢ç”¨æˆ·ï¼Œæç¤ºéœ€è¦ç™»å½•\r\n      if (!loginInfo || loginInfo.isGuest || !loginInfo.isLoggedIn) {\r\n        uni.showModal({\r\n          title: 'éœ€è¦ç™»å½•',\r\n          content: 'ä¿å­˜é¡¹ç›®éœ€è¦ç™»å½•åæ‰èƒ½ä½¿ç”¨ï¼Œæ˜¯å¦å‰å¾€ç™»å½•ï¼Ÿ\\n\\næ‚¨ä»ç„¶å¯ä»¥ç»§ç»­æµè§ˆé¡µé¢åŠŸèƒ½ã€‚',\r\n          confirmText: 'å»ç™»å½•',\r\n          cancelText: 'ç»§ç»­æµè§ˆ',\r\n          success: (res) => {\r\n            if (res.confirm) {\r\n              uni.navigateTo({\r\n                url: '/pages/login/index'\r\n              });\r\n            }\r\n          }\r\n        });\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n    \r\n    // ä¿å­˜é¡¹ç›®åˆ°åˆ—è¡¨é¡µ\r\n    onSaveProject() {\r\n      if (this.filledCount === 0) {\r\n        uni.showToast({ title: 'è¯·è‡³å°‘æ·»åŠ ä¸€å¼ ç…§ç‰‡', icon: 'none' });\r\n        return;\r\n      }\r\n      \r\n      // æ£€æŸ¥æ˜¯å¦éœ€è¦ç™»å½•\r\n      if (!this.checkLoginRequired()) {\r\n        return;\r\n      }\r\n\r\n      if (this.saving) {\r\n        uni.showToast({ title: 'ä¿å­˜ä¸­ï¼Œè¯·ç¨å€™...', icon: 'none' });\r\n        return;\r\n      }\r\n\r\n      // å¼¹å‡ºè¾“å…¥æ¡†ï¼Œè®©ç”¨æˆ·è¾“å…¥é¡¹ç›®åç§°å’Œæè¿°\r\n      uni.showModal({\r\n        title: this.editingProjectId ? 'ä¿å­˜ä¿®æ”¹' : 'ä¿å­˜é¡¹ç›®',\r\n        editable: true,\r\n        placeholderText: 'è¯·è¾“å…¥é¡¹ç›®åç§°',\r\n        success: async (res) => {\r\n          if (res.confirm) {\r\n            const projectName = res.content || 'æˆ‘çš„çˆ±å¿ƒå¢™';\r\n            await this.saveProjectData(projectName);\r\n          }\r\n        }\r\n      });\r\n    },\r\n    \r\n    // ä¿å­˜é¡¹ç›®æ•°æ®ï¼ˆè°ƒç”¨åç«¯APIï¼‰\r\n    async saveProjectData(projectName) {\r\n      this.saving = true;\r\n      \r\n      try {\r\n        uni.showLoading({ title: 'ä¿å­˜ä¸­...', mask: true });\r\n        \r\n        console.log('ğŸ’¾ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å¼€å§‹ä¿å­˜é¡¹ç›®åˆ°åç«¯');\r\n\r\n      // æ„å»ºé¡¹ç›®æ•°æ®\r\n      const projectData = {\r\n          projectName: projectName,\r\n          description: `å…±${this.filledCount}å¼ ç…§ç‰‡`,\r\n          isPublic: false,\r\n          maxPhotos: this.totalSlots\r\n        };\r\n        \r\n        let projectId;\r\n        let createResponse = null; // ç”¨äºé”™è¯¯è°ƒè¯•\r\n        \r\n        // åˆ›å»ºæˆ–æ›´æ–°é¡¹ç›®\r\n        if (this.editingProjectId) {\r\n          // æ›´æ–°ç°æœ‰é¡¹ç›®\r\n          console.log('ğŸ”„ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ›´æ–°é¡¹ç›® ID:', this.editingProjectId);\r\n          await updateProject(this.editingProjectId, projectData);\r\n          projectId = this.editingProjectId;\r\n        } else {\r\n          // åˆ›å»ºæ–°é¡¹ç›®\r\n          console.log('âœ¨ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] åˆ›å»ºæ–°é¡¹ç›®');\r\n          createResponse = await createProject(projectData);\r\n          console.log('âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é¡¹ç›®åˆ›å»ºæˆåŠŸ:', createResponse);\r\n          \r\n          // è·å–é¡¹ç›®ID - æ”¯æŒå¤šç§å“åº”æ ¼å¼\r\n          if (createResponse && createResponse.data) {\r\n            // æ ¼å¼: { data: { projectId: ..., id: ... } }\r\n            projectId = createResponse.data.projectId || createResponse.data.id;\r\n          } else if (createResponse && createResponse.project) {\r\n            // æ ¼å¼: { project: { projectId: ..., id: ... } }\r\n            projectId = createResponse.project.projectId || createResponse.project.id;\r\n          } else if (createResponse && (createResponse.projectId || createResponse.id)) {\r\n            // æ ¼å¼: { projectId: ..., id: ... }\r\n            projectId = createResponse.projectId || createResponse.id;\r\n          }\r\n          \r\n          console.log('ğŸ” [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æå–çš„é¡¹ç›®ID:', projectId);\r\n          \r\n          // å¦‚æœåˆ›å»ºé¡¹ç›®åä»æ— æ³•è·å–IDï¼ŒæŠ›å‡ºè¯¦ç»†é”™è¯¯\r\n          if (!projectId) {\r\n            console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ— æ³•è·å–é¡¹ç›®ID');\r\n            console.error('ğŸ“¦ [å“åº”æ•°æ®ç»“æ„]:', JSON.stringify(createResponse, null, 2));\r\n            throw new Error('æ— æ³•è·å–é¡¹ç›®IDï¼Œè¯·æ£€æŸ¥åç«¯è¿”å›çš„æ•°æ®æ ¼å¼');\r\n          }\r\n        }\r\n        \r\n        console.log('ğŸ“ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] é¡¹ç›®ID:', projectId);\r\n        \r\n        // ç¬¬ä¸€æ­¥ï¼šæ”¶é›†æ‰€æœ‰éœ€è¦ä¸Šä¼ çš„ç…§ç‰‡ä¿¡æ¯\r\n        const photoTasks = [];\r\n        for (let i = 0; i < this.heartMask.length; i++) {\r\n          if (this.heartMask[i] && this.images[i]) {\r\n            photoTasks.push({\r\n              positionIndex: i,\r\n              imagePath: this.images[i]\r\n            });\r\n          }\r\n        }\r\n        \r\n        console.log(`ğŸ“‹ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å‡†å¤‡ä¸Šä¼  ${photoTasks.length} å¼ ç…§ç‰‡`);\r\n        \r\n        // ä½¿ç”¨ç›´æ¥ä¸Šä¼ æ–¹å¼ï¼ˆmultipart/form-dataï¼Œä¸€æ­¥å®Œæˆï¼Œæ¨èï¼‰\r\n        console.log('ğŸ“¤ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½¿ç”¨ç›´æ¥ä¸Šä¼ æ–¹å¼ï¼ˆmultipart/form-dataï¼‰');\r\n        \r\n        const savePromises = photoTasks.map(async (task) => {\r\n          const { positionIndex, imagePath } = task;\r\n          \r\n          // åˆ¤æ–­æ˜¯å¦æ˜¯æœ¬åœ°ä¸´æ—¶è·¯å¾„ï¼ˆéœ€è¦ä¸Šä¼ ï¼‰\r\n          const isTmpPath = imagePath && (imagePath.startsWith('http://tmp/') || imagePath.startsWith('https://tmp/'));\r\n          // åˆ¤æ–­æ˜¯å¦æ˜¯çœŸæ­£çš„HTTP/HTTPS URLï¼ˆæ’é™¤ä¸´æ—¶è·¯å¾„ï¼‰\r\n          const isRealUrl = imagePath && \r\n                           (imagePath.startsWith('http://') || imagePath.startsWith('https://')) &&\r\n                           !isTmpPath;\r\n          // åˆ¤æ–­æ˜¯å¦æ˜¯æœ¬åœ°è·¯å¾„ï¼ˆéœ€è¦ä¸Šä¼ ï¼‰\r\n          const isLocalPath = !isRealUrl && !imagePath.startsWith('data:');\r\n          \r\n          // æ£€æŸ¥è¯¥ä½ç½®æ˜¯å¦å·²æœ‰photoIdï¼ˆå·²å­˜åœ¨çš„ç…§ç‰‡ï¼‰\r\n          const existingPhotoId = this.photoMap[positionIndex];\r\n          \r\n          if (isLocalPath || isTmpPath) {\r\n            // æœ¬åœ°æ–‡ä»¶ï¼Œä½¿ç”¨ç›´æ¥ä¸Šä¼ æ–¹å¼\r\n            try {\r\n              if (existingPhotoId) {\r\n                // å·²æœ‰ç…§ç‰‡ï¼Œä½¿ç”¨updatePhotoæ›´æ–°å…¶ä»–ä¿¡æ¯\r\n                console.log(`ğŸ”„ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} å·²æœ‰ç…§ç‰‡(photoId: ${existingPhotoId})ï¼Œä½¿ç”¨æ›´æ–°æ¥å£`);\r\n                // å¯¹äºå·²å­˜åœ¨çš„ç…§ç‰‡ï¼Œæˆ‘ä»¬ä¸æ”¯æŒç›´æ¥æ›´æ–°æ–‡ä»¶ï¼Œåªèƒ½æ›´æ–°å…¶ä»–ä¿¡æ¯\r\n                // å¦‚æœéœ€è¦æ›´æ–°æ–‡ä»¶ï¼Œç”¨æˆ·åº”è¯¥å…ˆåˆ é™¤å†é‡æ–°ä¸Šä¼ \r\n                const photoData = {\r\n                  positionIndex: positionIndex\r\n                };\r\n                return updatePhoto(existingPhotoId, photoData).catch(error => {\r\n                  console.error(`âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡ ${positionIndex} æ›´æ–°å¤±è´¥:`, error);\r\n                  return null;\r\n                });\r\n              } else {\r\n                // æ–°ç…§ç‰‡ï¼Œç›´æ¥ä¸Šä¼ æ–‡ä»¶+å…ƒæ•°æ®\r\n                console.log(`ğŸ“¤ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç›´æ¥ä¸Šä¼ ç…§ç‰‡ ${positionIndex}ï¼ˆæ–‡ä»¶+å…ƒæ•°æ®ï¼‰...`);\r\n                const result = await uploadPhotoWithFile({\r\n                  filePath: imagePath,\r\n                  projectId: projectId,\r\n                  positionIndex: positionIndex\r\n                });\r\n                console.log(`âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡ ${positionIndex} ä¸Šä¼ æˆåŠŸ`);\r\n                return result;\r\n              }\r\n            } catch (uploadError) {\r\n              console.error(`âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡ ${positionIndex} ä¸Šä¼ å¤±è´¥:`, uploadError);\r\n              return null;\r\n            }\r\n          } else {\r\n            // å·²ç»æ˜¯URLï¼Œä¸æ”¯æŒä¸Šä¼ ï¼Œåªèƒ½æ›´æ–°ä½ç½®ä¿¡æ¯\r\n            console.log(`ğŸ”„ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} å·²ç»æ˜¯URLï¼Œä¸æ”¯æŒä¸Šä¼ ï¼Œåªèƒ½æ›´æ–°ä½ç½®ä¿¡æ¯`);\r\n            // å¯¹äºå·²å­˜åœ¨çš„ç…§ç‰‡ï¼Œæˆ‘ä»¬ä¸æ”¯æŒç›´æ¥æ›´æ–°æ–‡ä»¶ï¼Œåªèƒ½æ›´æ–°å…¶ä»–ä¿¡æ¯\r\n            // å¦‚æœéœ€è¦æ›´æ–°æ–‡ä»¶ï¼Œç”¨æˆ·åº”è¯¥å…ˆåˆ é™¤å†é‡æ–°ä¸Šä¼ \r\n            const photoData = {\r\n              positionIndex: positionIndex\r\n            };\r\n            \r\n            if (existingPhotoId) {\r\n              console.log(`ğŸ”„ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} å·²æœ‰ç…§ç‰‡(photoId: ${existingPhotoId})ï¼Œä½¿ç”¨æ›´æ–°æ¥å£`);\r\n              return updatePhoto(existingPhotoId, photoData).catch(error => {\r\n                console.error(`âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ç…§ç‰‡ ${positionIndex} æ›´æ–°å¤±è´¥:`, error);\r\n                return null;\r\n              });\r\n            } else {\r\n              // å¯¹äºæ–°ç…§ç‰‡ï¼Œå¦‚æœå·²ç»æ˜¯URLåˆ™ä¸æ”¯æŒä¸Šä¼ \r\n              console.warn(`âš ï¸ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} æ˜¯æ–°ç…§ç‰‡ä½†å·²ç»æ˜¯URLï¼Œä¸æ”¯æŒä¸Šä¼ `);\r\n              uni.showToast({ \r\n                title: 'ä¸æ”¯æŒä¸Šä¼ å·²å­˜åœ¨çš„å›¾ç‰‡URL', \r\n                icon: 'none',\r\n                duration: 2000\r\n              });\r\n              return null;\r\n            }\r\n          }\r\n        });\r\n        \r\n        // ç­‰å¾…æ‰€æœ‰ç…§ç‰‡ä¿å­˜å®Œæˆ\r\n        console.log(`ğŸ’¾ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] å¼€å§‹ä¿å­˜ ${savePromises.length} å¼ ç…§ç‰‡ä¿¡æ¯`);\r\n        const saveResults = await Promise.all(savePromises);\r\n        const savedCount = saveResults.filter(r => r !== null).length;\r\n        \r\n        console.log(`âœ… [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æˆåŠŸä¿å­˜ ${savedCount}/${photoTasks.length} å¼ ç…§ç‰‡`);\r\n        \r\n        // æ›´æ–°photoMapï¼Œä¿å­˜æ–°ä¸Šä¼ ç…§ç‰‡çš„photoIdæ˜ å°„\r\n        saveResults.forEach((result, index) => {\r\n          if (result && result.data) {\r\n            const photoId = result.data.photoId || result.data.photo_id || result.data.id;\r\n            const photo = photoTasks[index];\r\n            \r\n            if (photoId && photo) {\r\n              const positionIndex = photo.positionIndex || photo.index;\r\n              // åªæœ‰æ–°å¢çš„ç…§ç‰‡æ‰éœ€è¦æ›´æ–°photoMapï¼ˆå·²æœ‰çš„ç…§ç‰‡photoMapå·²ç»å­˜åœ¨ï¼‰\r\n              if (positionIndex !== undefined && !this.photoMap[positionIndex]) {\r\n                this.$set(this.photoMap, positionIndex, photoId);\r\n                console.log(`ğŸ“· [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] æ›´æ–°ç…§ç‰‡æ˜ å°„: positionIndex=${positionIndex}, photoId=${photoId}`);\r\n              } else if (positionIndex !== undefined) {\r\n                console.log(`ğŸ“· [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä½ç½® ${positionIndex} ç…§ç‰‡å·²å­˜åœ¨(photoId: ${photoId})ï¼Œæ— éœ€æ›´æ–°æ˜ å°„`);\r\n              }\r\n            }\r\n          }\r\n        });\r\n        \r\n        // ä¿å­˜é¡¹ç›®IDï¼Œä»¥ä¾¿åç»­å¯ä»¥ç»§ç»­ç¼–è¾‘\r\n        this.editingProjectId = projectId;\r\n        uni.setStorageSync('heartwall_editing_projectId', projectId);\r\n        \r\n        uni.hideLoading();\r\n        uni.showToast({ \r\n          title: this.editingProjectId ? 'ä¿®æ”¹æˆåŠŸ' : 'ä¿å­˜æˆåŠŸ', \r\n          icon: 'success',\r\n          duration: 1500\r\n        });\r\n        \r\n        // å»¶è¿Ÿè·³è½¬åˆ°åˆ—è¡¨é¡µ\r\n        setTimeout(() => {\r\n          uni.navigateBack();\r\n        }, 1500);\r\n      } catch (error) {\r\n        console.error('âŒ [çˆ±å¿ƒå¢™åˆ›å»ºé¡µ] ä¿å­˜é¡¹ç›®å¤±è´¥:', error);\r\n        uni.hideLoading();\r\n        uni.showToast({ \r\n          title: error.message || 'ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', \r\n          icon: 'none',\r\n          duration: 2000\r\n        });\r\n      } finally {\r\n        this.saving = false;\r\n      }\r\n    },\r\n    persist() {\r\n      try { uni.setStorageSync('heartwall_grid_images', this.images); } catch (e) {}\r\n    }\r\n  },\r\n  \r\n  // å¾®ä¿¡å°ç¨‹åºåˆ†äº«åŠŸèƒ½\r\n  onShareAppMessage(res) {\r\n    console.log('è§¦å‘å¾®ä¿¡åˆ†äº«:', res);\r\n    \r\n    return {\r\n      title: 'çˆ±å¿ƒç…§ç‰‡å¢™ - çˆ±ä¸æ—¶å…‰çš„è§è¯',\r\n      path: '/pages/index/index',\r\n      imageUrl: this.lastExportedImagePath || '',\r\n      success: function(shareRes) {\r\n        console.log('åˆ†äº«æˆåŠŸ:', shareRes);\r\n        uni.showToast({\r\n          title: 'åˆ†äº«æˆåŠŸ',\r\n          icon: 'success',\r\n          duration: 1500\r\n        });\r\n      },\r\n      fail: function(shareErr) {\r\n        console.log('åˆ†äº«å¤±è´¥:', shareErr);\r\n        uni.showToast({\r\n          title: 'åˆ†äº«å¤±è´¥',\r\n          icon: 'none',\r\n          duration: 1500\r\n        });\r\n      }\r\n    };\r\n  },\r\n  \r\n  // å¾®ä¿¡å°ç¨‹åºæœ‹å‹åœˆåˆ†äº«åŠŸèƒ½\r\n  onShareTimeline() {\r\n    console.log('è§¦å‘æœ‹å‹åœˆåˆ†äº«');\r\n    \r\n    return {\r\n      title: 'çˆ±å¿ƒç…§ç‰‡å¢™ - çˆ±ä¸æ—¶å…‰çš„è§è¯',\r\n      query: 'from=timeline',\r\n      imageUrl: this.lastExportedImagePath || ''\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n.create-page { min-height: 100vh; background: #FFFAF4; display: flex; flex-direction: column; overflow: hidden; }\r\n\r\n/* è‡ªå®šä¹‰å¯¼èˆªæ ï¼ˆä¸é¦–é¡µä¸€è‡´ï¼‰ */\r\n.custom-navbar { position: fixed; top: 0; left: 0; right: 0; z-index: 9999; background-color: #FFFAF4; overflow: hidden; }\r\n.navbar-gradient-bg { position: absolute; top: 0; left: 0; right: 0; height: 200%; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); }\r\n.status-bar { width: 100%; background: transparent; position: relative; z-index: 1; }\r\n.navbar-content { display: flex; align-items: center; justify-content: space-between; padding: 0 30rpx; box-sizing: border-box; position: relative; z-index: 1; }\r\n.navbar-left, .navbar-right { width: 80rpx; display: flex; align-items: center; justify-content: center; }\r\n.navbar-title { flex: 1; display: flex; align-items: center; justify-content: center; text-align: center; }\r\n.title-text { font-size: 36rpx; font-weight: 500; color: #4A4A4A; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif; }\r\n.back-icon { font-size: 50rpx; font-weight: 600; color: #4A4A4A; line-height: 1; }\r\n\r\n.center { display: flex; align-items: flex-start; justify-content: center; padding: 80rpx 0 0 60rpx; }\r\n.heart-grid { width: 640rpx; margin: 0 auto; display: grid; grid-template-columns: repeat(9, 1fr); grid-gap: 10rpx; }\r\n.cell { position: relative; width: 1fr; padding-bottom: 100%; background: rgba(255,255,255,0.7); border-radius: 12rpx; overflow: hidden; }\r\n.cell.hole { background: transparent; }\r\n.cell image { position: absolute; inset: 0; width: 100%; height: 100%; }\r\n.cell.filled { background: #ffffff; }\r\n\r\n.photo-count { \r\n  margin-top: 32rpx; \r\n  padding: 0 60rpx; \r\n  display: flex; \r\n  justify-content: space-between; \r\n  align-items: center; \r\n}\r\n.count-text { \r\n  font-size: 26rpx; \r\n  color: #666; \r\n  font-weight: 500; \r\n}\r\n.clear-btn { \r\n  font-size: 24rpx; \r\n  color: #D48806; \r\n  padding: 8rpx 20rpx; \r\n  background: rgba(255, 201, 77, 0.15); \r\n  border-radius: 20rpx; \r\n}\r\n\r\n.actions { margin-top: 24rpx; padding-bottom: 24rpx; display: flex; flex-direction: column; align-items: center; gap: 16rpx; }\r\n.btn { width: 70%; border-radius: 999rpx; padding: 18rpx 0; font-size: 26rpx; box-shadow: 0 8rpx 20rpx rgba(0,0,0,0.12); }\r\n.btn.yellow { background: linear-gradient(90deg, #FFD4A3 0%, #FFA500 100%); color: #3d2a00; }\r\n.btn.green { background: linear-gradient(90deg, #B5E7D3 0%, #8BC34A 100%); color: #1a5900; }\r\n.btn.pink { background: linear-gradient(90deg, #FFB5C2 0%, #FF69B4 100%); color: #3d2a00; }\r\n.btn.blue { background: linear-gradient(90deg, #B5D8FF 0%, #4A90E2 100%); color: white; }\r\n</style>","import MiniProgramPage from 'C:/Users/Administrator/Desktop/love_time/subPackages/record/pages/heartwall/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["baseUrl","config","uni","getProjectPhotos","uploadPhotoWithFile"],"mappings":"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"}