{"version":3,"file":"create.js","sources":["subPackages/record/pages/xinxiang/create.vue","D:/softcaree/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c3ViUGFja2FnZXNccmVjb3JkXHBhZ2VzXHhpbnhpYW5nXGNyZWF0ZS52dWU"],"sourcesContent":["<template>\r\n  <view class=\"create-page\" :style=\"{ paddingTop: containerPaddingTop }\">\r\n    <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->\r\n    <view class=\"custom-navbar\">\r\n      <!-- æ¸å˜èƒŒæ™¯ -->\r\n      <view class=\"navbar-gradient-bg\"></view>\r\n      <!-- çŠ¶æ€æ å ä½ -->\r\n      <view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\r\n      <!-- å¯¼èˆªæ å†…å®¹ -->\r\n      <view class=\"navbar-content\" :style=\"{ height: navBarHeight + 'px' }\">\r\n        <view class=\"navbar-left\" @click=\"goBack\">\r\n          <text class=\"back-icon\">â†</text>\r\n        </view>\r\n        <view class=\"navbar-title\">\r\n          <text class=\"title-text\">å†™ä¿¡</text>\r\n        </view>\r\n        <view class=\"navbar-right\"></view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->\r\n    <view class=\"steps\">\r\n      <view class=\"step\" :class=\"{ active: currentStep === 1 }\">\r\n        <view class=\"step-number\">1</view>\r\n        <text class=\"step-text\">é€‰æ‹©æ ·å¼</text>\r\n      </view>\r\n      <view class=\"step-line\"></view>\r\n      <view class=\"step\" :class=\"{ active: currentStep === 2 }\">\r\n        <view class=\"step-number\">2</view>\r\n        <text class=\"step-text\">å¡«å†™ä¿¡æ¯</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©ä¿¡ä»¶æ ·å¼ -->\r\n    <view v-if=\"currentStep === 1\" class=\"step-content\">\r\n      <text class=\"section-title\">é€‰æ‹©ä¿¡ä»¶æ ·å¼</text>\r\n      \r\n      <!-- é¢„è®¾æ ·å¼ç½‘æ ¼ -->\r\n      <view class=\"style-grid\">\r\n        <view \r\n          v-for=\"i in [1, 2, 3]\" \r\n          :key=\"i\" \r\n          class=\"style-item\"\r\n          :class=\"{ selected: selectedStyle === i && !isCustomStyle }\"\r\n          @click=\"selectPresetStyle(i)\"\r\n        >\r\n          <image class=\"style-image\" :src=\"`/static/xinxiang/xin${i}.jpg`\" mode=\"aspectFill\"></image>\r\n          <view v-if=\"selectedStyle === i && !isCustomStyle\" class=\"check-mark\">âœ“</view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- è‡ªå®šä¹‰æ ·å¼ -->\r\n      <view class=\"custom-section\">\r\n        <button class=\"custom-btn\" @click=\"uploadCustom\">\r\n          <text class=\"btn-icon\">ğŸ“·</text>\r\n          <text>è‡ªå®šä¹‰ä¿¡ä»¶åº•å›¾</text>\r\n        </button>\r\n        \r\n        <view v-if=\"customImage\" class=\"custom-preview\">\r\n          <view class=\"preview-wrapper\">\r\n            <image class=\"preview-bg\" :src=\"customImage\" mode=\"aspectFill\"></image>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <button class=\"next-btn\" @click=\"nextStep\">ä¸‹ä¸€æ­¥</button>\r\n    </view>\r\n\r\n\r\n    <!-- ç¬¬äºŒæ­¥ï¼šå¡«å†™ä¿¡æ¯ -->\r\n    <view v-if=\"currentStep === 2\" class=\"step-content\">\r\n      <text class=\"section-title\">å¡«å†™ä¿¡ä»¶ä¿¡æ¯</text>\r\n      \r\n      <view class=\"form\">\r\n        <!-- ä¿¡ä»¶ä¸»é¢˜ -->\r\n        <view class=\"form-item\">\r\n          <text class=\"form-label\">ä¿¡ä»¶ä¸»é¢˜</text>\r\n          <input \r\n            class=\"form-input\" \r\n            v-model=\"form.title\" \r\n            placeholder=\"ä¾‹å¦‚ï¼šç»™æœªæ¥çš„ä½ \"\r\n            maxlength=\"50\"\r\n          />\r\n        </view>\r\n\r\n        <!-- é¢„è®¡é€è¾¾æ—¶é—´ -->\r\n        <view class=\"form-item\">\r\n          <text class=\"form-label\">é¢„è®¡é€è¾¾æ—¶é—´</text>\r\n          <picker \r\n            mode=\"date\" \r\n            :value=\"form.deliveryDate\" \r\n            @change=\"onDateChange\"\r\n            :start=\"minDate\"\r\n          >\r\n            <view class=\"picker-display\">\r\n              {{ form.deliveryDate || 'è¯·é€‰æ‹©æ—¥æœŸ' }}\r\n            </view>\r\n          </picker>\r\n        </view>\r\n\r\n        <!-- å­—ä½“æ ·å¼ -->\r\n        <view class=\"form-item font-style-item\">\r\n          <text class=\"form-label\">å­—ä½“æ ·å¼</text>\r\n          <view v-if=\"fontLoading\" class=\"font-loading\">æ­£åœ¨åŠ è½½å­—ä½“...</view>\r\n          <view v-else class=\"font-options\">\r\n            <view\r\n              v-for=\"font in fontOptions\"\r\n              :key=\"font.value\"\r\n              class=\"font-option\"\r\n              :class=\"{ active: selectedFontStyle === font.value }\"\r\n              @click=\"selectFont(font.value)\"\r\n            >\r\n              <view class=\"font-option-header\">\r\n                <text class=\"font-option-name\">{{ font.label }}</text>\r\n                <text class=\"font-option-desc\">{{ font.description || 'ç‚¹å‡»é€‰æ‹©' }}</text>\r\n              </view>\r\n              <text class=\"font-option-sample\" :class=\"`font-style-${font.value}`\">\r\n                {{ font.sample || 'æœªæ¥ä¸ä½ ' }}\r\n              </text>\r\n            </view>\r\n          </view>\r\n          <text v-if=\"fontRequestError\" class=\"font-error\">{{ fontRequestError }}</text>\r\n        </view>\r\n\r\n        <!-- ä¿¡ä»¶å†…å®¹ -->\r\n        <view class=\"form-item\">\r\n          <text class=\"form-label\">ä¿¡ä»¶å†…å®¹</text>\r\n          <textarea \r\n            class=\"form-textarea\" \r\n            v-model=\"form.content\" \r\n            placeholder=\"å†™ä¸‹ä½ æƒ³è¯´çš„è¯...\"\r\n            maxlength=\"1000\"\r\n          />\r\n          <text class=\"char-count\">{{ form.content.length }}/1000</text>\r\n        </view>\r\n      </view>\r\n\r\n      <view class=\"action-btns\">\r\n        <button class=\"back-btn\" @click=\"prevStep\">ä¸Šä¸€æ­¥</button>\r\n        <button class=\"preview-btn\" @click=\"openPreview\">ğŸ‘ï¸ é¢„è§ˆ</button>\r\n        <button class=\"submit-btn\" @click=\"submitLetter\">æäº¤ä¿¡ä»¶</button>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- é¢„è§ˆå¼¹çª— -->\r\n    <view v-if=\"showLivePreviewModal\" class=\"preview-modal-overlay\" @click=\"showLivePreviewModal = false\">\r\n      <view class=\"preview-modal-content\" @click.stop>\r\n        <text class=\"preview-modal-title\">ä¿¡ä»¶é¢„è§ˆ</text>\r\n        \r\n        <!-- ä¿¡ä»¶èåˆé¢„è§ˆ -->\r\n        <view class=\"letter-preview\">\r\n          <view class=\"letter-wrapper\">\r\n            <!-- åº•å›¾å±‚ -->\r\n            <image \r\n              class=\"letter-bg\" \r\n              :src=\"letterBackground\" \r\n              mode=\"aspectFill\"\r\n            ></image>\r\n            \r\n            <!-- ä¿¡ä»¶å†…å®¹å±‚ -->\r\n            <view class=\"letter-content\">\r\n              <view class=\"letter-header\">\r\n                <text class=\"letter-title\" :class=\"selectedFontClass\">{{ form.title || 'ä¿¡ä»¶ä¸»é¢˜' }}</text>\r\n                <text class=\"letter-date\" :class=\"selectedFontClass\">é€è¾¾æ—¶é—´ï¼š{{ form.deliveryDate || 'æœªé€‰æ‹©' }}</text>\r\n              </view>\r\n              \r\n              <view class=\"letter-body\">\r\n                <text class=\"letter-text\" :class=\"selectedFontClass\">{{ form.content || 'ä¿¡ä»¶å†…å®¹...' }}</text>\r\n              </view>\r\n              \r\n              <view class=\"letter-footer\">\r\n                <text class=\"letter-sign\" :class=\"selectedFontClass\">â€”â€” ç»™æœªæ¥çš„ä½ </text>\r\n              </view>\r\n            </view>\r\n          </view>\r\n        </view>\r\n\r\n        <view class=\"preview-modal-actions\">\r\n          <button class=\"preview-modal-btn close\" @click=\"showLivePreviewModal = false\">å…³é—­</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n\r\n    <!-- ä¿¡ä»¶é¢„è§ˆå¼¹çª— -->\r\n    <view v-if=\"showPreviewModal\" class=\"preview-modal-overlay\">\r\n      <view class=\"preview-modal-content\" @click.stop>\r\n        <text class=\"preview-modal-title\">ä¿¡ä»¶é¢„è§ˆ</text>\r\n        \r\n        <!-- ä¿¡ä»¶èåˆé¢„è§ˆ -->\r\n        <view class=\"letter-preview\">\r\n          <view class=\"letter-wrapper\">\r\n            <!-- åº•å›¾å±‚ -->\r\n            <image \r\n              class=\"letter-bg\" \r\n              :src=\"letterBackground\" \r\n              mode=\"aspectFill\"\r\n            ></image>\r\n            \r\n            <!-- ä¿¡ä»¶å†…å®¹å±‚ -->\r\n            <view class=\"letter-content\">\r\n              <view class=\"letter-header\">\r\n                <text class=\"letter-title\" :class=\"selectedFontClass\">{{ form.title }}</text>\r\n                <text class=\"letter-date\" :class=\"selectedFontClass\">é€è¾¾æ—¶é—´ï¼š{{ form.deliveryDate }}</text>\r\n              </view>\r\n                \r\n                <view class=\"letter-body\">\r\n                  <text class=\"letter-text\" :class=\"selectedFontClass\">{{ form.content }}</text>\r\n                </view>\r\n                \r\n                <view class=\"letter-footer\">\r\n                  <text class=\"letter-sign\" :class=\"selectedFontClass\">â€”â€” ç»™æœªæ¥çš„ä½ </text>\r\n                </view>\r\n              </view>\r\n          </view>\r\n        </view>\r\n\r\n        <view class=\"preview-modal-actions\">\r\n          <button class=\"preview-modal-btn confirm\" @click=\"closePreviewAndBack\">ç¡®è®¤</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { createFutureLetter, sendFutureLetter, getFutureLetterFonts } from '@/api/futureLetter.js';\r\nimport { getPartnerInfo, isBound } from '@/utils/couple.js';\r\nimport config from '@/utils/config.js';\r\n\r\nconst FALLBACK_FONT_OPTIONS = [\r\n  { label: 'é»˜è®¤å­—ä½“', value: 'default', description: 'æ¸…æ™°æ˜“è¯»', sample: 'æœªæ¥ä¸ä½ ' },\r\n  { label: 'é©¬å–„æ”¿æ‰‹å†™', value: 'mashanzheng', description: 'æ¸©æŸ”æ‰‹å†™æ„Ÿ', sample: 'æœªæ¥ä¸ä½ ' },\r\n  { label: 'ç«™é…·å¿«ä¹ä½“', value: 'zcoolkuaile', description: 'æ´»æ³¼å¯çˆ±', sample: 'æœªæ¥ä¸ä½ ' },\r\n  { label: 'æ¸…æ¾æ‰‹å†™ä½“', value: 'qingsong', description: 'è‡ªç„¶æµç•…', sample: 'æœªæ¥ä¸ä½ ' },\r\n  { label: 'ç«™é…·å°è–‡ä½“', value: 'zcoolxiaowei', description: 'æ¸…æ–°æ–‡è‰º', sample: 'æœªæ¥ä¸ä½ ' },\r\n  { label: 'ç«™é…·æ–‡è‰ºä½“', value: 'zcoolwenyi', description: 'ä¼˜é›…æ–‡è‰º', sample: 'æœªæ¥ä¸ä½ ' }\r\n];\r\n\r\nconst FALLBACK_FONT_MAP = FALLBACK_FONT_OPTIONS.reduce((map, option) => {\r\n  map[option.value] = option;\r\n  return map;\r\n}, {});\r\n\r\nlet maShanZhengFontPromise = null;\r\nlet zcoolKuaiLeFontPromise = null;\r\nlet qingSongFontPromise = null;\r\nlet zcoolXiaoWeiFontPromise = null;\r\nlet zcoolWenYiFontPromise = null;\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      statusBarHeight: 0,\r\n      navBarHeight: 44,\r\n      screenWidth: 375,\r\n      currentStep: 1,\r\n      selectedStyle: 1,\r\n      isCustomStyle: false,\r\n      customImage: '',\r\n      showPreviewModal: false,\r\n      showLivePreviewModal: false,\r\n      form: {\r\n        title: '',\r\n        deliveryDate: '',\r\n        content: '',\r\n        fontStyle: 'default'\r\n      },\r\n      fontOptions: [...FALLBACK_FONT_OPTIONS],\r\n      fontLoading: false,\r\n      fontRequestError: '',\r\n      customFontLoaded: false\r\n    };\r\n  },\r\n  computed: {\r\n    containerPaddingTop() {\r\n      const totalHeightPx = this.statusBarHeight + this.navBarHeight;\r\n      const pxToRpx = 750 / this.screenWidth;\r\n      const totalHeightRpx = totalHeightPx * pxToRpx;\r\n      return totalHeightRpx + 20 + 'rpx';\r\n    },\r\n    minDate() {\r\n      const today = new Date();\r\n      const year = today.getFullYear();\r\n      const month = String(today.getMonth() + 1).padStart(2, '0');\r\n      const day = String(today.getDate()).padStart(2, '0');\r\n      return `${year}-${month}-${day}`;\r\n    },\r\n    // è·å–ä¿¡ä»¶åº•å›¾è·¯å¾„\r\n    letterBackground() {\r\n      if (this.isCustomStyle) {\r\n        return this.customImage;\r\n      }\r\n      return `/static/xinxiang/xin${this.selectedStyle}.jpg`;\r\n    },\r\n    selectedFontStyle() {\r\n      return this.form.fontStyle || 'default';\r\n    },\r\n    selectedFontClass() {\r\n      return `font-style-${this.selectedFontStyle}`;\r\n    }\r\n  },\r\n  onLoad() {\r\n    this.getSystemInfo();\r\n    this.preloadCustomFont();\r\n    this.fetchFontOptions();\r\n  },\r\n  methods: {\r\n    goBack() {\r\n      uni.navigateBack();\r\n    },\r\n    getSystemInfo() {\r\n      const systemInfo = uni.getSystemInfoSync();\r\n      this.statusBarHeight = systemInfo.statusBarHeight || 0;\r\n      this.screenWidth = systemInfo.windowWidth || 375;\r\n      // #ifdef MP-WEIXIN\r\n      this.navBarHeight = 44;\r\n      // #endif\r\n      // #ifdef H5\r\n      this.navBarHeight = 44;\r\n      // #endif\r\n    },\r\n    async fetchFontOptions() {\r\n      this.fontLoading = true;\r\n      this.fontRequestError = '';\r\n      try {\r\n        const response = await getFutureLetterFonts();\r\n        const fontList = this.extractFontList(response);\r\n        const normalized = this.normalizeFontOptions(fontList);\r\n        if (normalized.length > 0) {\r\n          this.fontOptions = normalized;\r\n        } else {\r\n          console.warn('å­—ä½“åˆ—è¡¨ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤å­—ä½“é…ç½®');\r\n          this.fontOptions = [...FALLBACK_FONT_OPTIONS];\r\n        }\r\n        if (!this.fontOptions.some(font => font.value === this.selectedFontStyle) && this.fontOptions.length > 0) {\r\n          this.form.fontStyle = this.fontOptions[0].value;\r\n        }\r\n      } catch (error) {\r\n        console.error('è·å–å­—ä½“åˆ—è¡¨å¤±è´¥:', error);\r\n        this.fontRequestError = 'å­—ä½“åŠ è½½å¤±è´¥ï¼Œå·²ä½¿ç”¨é»˜è®¤å­—ä½“';\r\n        this.fontOptions = [...FALLBACK_FONT_OPTIONS];\r\n        uni.showToast({ title: 'å­—ä½“åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å­—ä½“', icon: 'none' });\r\n      } finally {\r\n        this.fontLoading = false;\r\n      }\r\n    },\r\n    async preloadCustomFont() {\r\n      if (this.customFontLoaded) {\r\n        return;\r\n      }\r\n      if (typeof uni === 'undefined' || typeof uni.loadFontFace !== 'function') {\r\n        console.warn('å½“å‰å¹³å°ä¸æ”¯æŒè‡ªå®šä¹‰å­—ä½“åŠ è½½');\r\n        return;\r\n      }\r\n      try {\r\n        // å¹¶è¡ŒåŠ è½½æ‰€æœ‰å­—ä½“\r\n        await Promise.allSettled([\r\n          this.ensureMaShanZhengFont(),\r\n          this.ensureZcoolKuaiLeFont(),\r\n          this.ensureQingSongFont(),\r\n          this.ensureZcoolXiaoWeiFont(),\r\n          this.ensureZcoolWenYiFont()\r\n        ]);\r\n        this.customFontLoaded = true;\r\n        console.log('æ‰€æœ‰æ‰‹å†™å­—ä½“åŠ è½½å®Œæˆ');\r\n      } catch (error) {\r\n        console.error('åŠ è½½å­—ä½“å¤±è´¥:', error);\r\n        // ä¸æ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œå…è®¸éƒ¨åˆ†å­—ä½“åŠ è½½å¤±è´¥\r\n      }\r\n    },\r\n    ensureMaShanZhengFont() {\r\n      if (maShanZhengFontPromise) {\r\n        return maShanZhengFontPromise;\r\n      }\r\n      // å¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒæœ¬åœ°å­—ä½“æ–‡ä»¶ï¼Œä½¿ç”¨æœåŠ¡å™¨å­—ä½“æ–‡ä»¶\r\n      // å…¶ä»–å¹³å°ä¼˜å…ˆä½¿ç”¨æœ¬åœ°å­—ä½“æ–‡ä»¶\r\n      let fontSource;\r\n      // #ifdef MP-WEIXIN\r\n      // å¾®ä¿¡å°ç¨‹åºå¿…é¡»ä½¿ç”¨ç½‘ç»œURLï¼Œä½¿ç”¨æœåŠ¡å™¨å­—ä½“æ–‡ä»¶\r\n      fontSource = `url(\"${config.baseURL}/fonts/MaShanZheng-Regular.ttf\")`;\r\n      // #endif\r\n      // #ifndef MP-WEIXIN\r\n      fontSource = 'url(\"/static/fonts/MaShanZheng-Regular.ttf\")';\r\n      // #endif\r\n      maShanZhengFontPromise = new Promise((resolve, reject) => {\r\n        uni.loadFontFace({\r\n          global: true,\r\n          family: 'MaShanZheng',\r\n          source: fontSource,\r\n          desc: {\r\n            style: 'normal',\r\n            weight: '400'\r\n          },\r\n          success: (res) => {\r\n            console.log('MaShanZheng å­—ä½“åŠ è½½æˆåŠŸ', res);\r\n            resolve(res);\r\n          },\r\n          fail: (error) => {\r\n            console.warn('MaShanZheng å­—ä½“åŠ è½½å¤±è´¥:', error);\r\n            // å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸‹ï¼Œå¦‚æœç½‘ç»œåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å­—ä½“\r\n            // #ifdef MP-WEIXIN\r\n            maShanZhengFontPromise = null;\r\n            resolve(null); // ä¸é˜»æ­¢å…¶ä»–å­—ä½“åŠ è½½\r\n            // #endif\r\n            // éå¾®ä¿¡å°ç¨‹åºï¼Œå¦‚æœæœ¬åœ°åŠ è½½å¤±è´¥ï¼Œå°è¯•æœåŠ¡å™¨å­—ä½“\r\n            // #ifndef MP-WEIXIN\r\n            if (fontSource.includes('/static/')) {\r\n              console.log('å°è¯•ä½¿ç”¨æœåŠ¡å™¨åŠ è½½ MaShanZheng å­—ä½“');\r\n              fontSource = `url(\"${config.baseURL}/fonts/MaShanZheng-Regular.ttf\")`;\r\n              uni.loadFontFace({\r\n                global: true,\r\n                family: 'MaShanZheng',\r\n                source: fontSource,\r\n                desc: {\r\n                  style: 'normal',\r\n                  weight: '400'\r\n                },\r\n                success: (res) => {\r\n                  console.log('MaShanZheng å­—ä½“ä»CDNåŠ è½½æˆåŠŸ', res);\r\n                  resolve(res);\r\n                },\r\n                fail: (error2) => {\r\n                  console.warn('MaShanZheng å­—ä½“CDNåŠ è½½ä¹Ÿå¤±è´¥:', error2);\r\n                  maShanZhengFontPromise = null;\r\n                  resolve(null);\r\n                }\r\n              });\r\n              return;\r\n            }\r\n            // #endif\r\n            maShanZhengFontPromise = null;\r\n            resolve(null); // ä¸é˜»æ­¢å…¶ä»–å­—ä½“åŠ è½½\r\n          }\r\n        });\r\n      });\r\n      return maShanZhengFontPromise;\r\n    },\r\n    ensureZcoolKuaiLeFont() {\r\n      if (zcoolKuaiLeFontPromise) {\r\n        return zcoolKuaiLeFontPromise;\r\n      }\r\n      // å¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒæœ¬åœ°å­—ä½“æ–‡ä»¶ï¼Œä½¿ç”¨æœåŠ¡å™¨å­—ä½“æ–‡ä»¶\r\n      // å…¶ä»–å¹³å°ä¼˜å…ˆä½¿ç”¨æœ¬åœ°å­—ä½“æ–‡ä»¶\r\n      let fontSource;\r\n      // #ifdef MP-WEIXIN\r\n      // å¾®ä¿¡å°ç¨‹åºå¿…é¡»ä½¿ç”¨ç½‘ç»œURLï¼Œä½¿ç”¨æœåŠ¡å™¨å­—ä½“æ–‡ä»¶\r\n      fontSource = `url(\"${config.baseURL}/fonts/ZCOOLKuaiLe-Regular.ttf\")`;\r\n      // #endif\r\n      // #ifndef MP-WEIXIN\r\n      fontSource = 'url(\"/static/fonts/ZCOOLKuaiLe-Regular.ttf\")';\r\n      // #endif\r\n      zcoolKuaiLeFontPromise = new Promise((resolve, reject) => {\r\n        uni.loadFontFace({\r\n          global: true,\r\n          family: 'ZCOOLKuaiLe',\r\n          source: fontSource,\r\n          desc: {\r\n            style: 'normal',\r\n            weight: '400'\r\n          },\r\n          success: (res) => {\r\n            console.log('ZCOOLKuaiLe å­—ä½“åŠ è½½æˆåŠŸ', res);\r\n            resolve(res);\r\n          },\r\n          fail: (error) => {\r\n            console.warn('ZCOOLKuaiLe å­—ä½“åŠ è½½å¤±è´¥:', error);\r\n            // å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸‹ï¼Œå¦‚æœç½‘ç»œåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å­—ä½“\r\n            // #ifdef MP-WEIXIN\r\n            zcoolKuaiLeFontPromise = null;\r\n            resolve(null);\r\n            // #endif\r\n            // éå¾®ä¿¡å°ç¨‹åºï¼Œå¦‚æœæœ¬åœ°åŠ è½½å¤±è´¥ï¼Œå°è¯•æœåŠ¡å™¨å­—ä½“\r\n            // #ifndef MP-WEIXIN\r\n            if (fontSource.includes('/static/')) {\r\n              console.log('å°è¯•ä½¿ç”¨æœåŠ¡å™¨åŠ è½½ ZCOOLKuaiLe å­—ä½“');\r\n              fontSource = `url(\"${config.baseURL}/fonts/ZCOOLKuaiLe-Regular.ttf\")`;\r\n              uni.loadFontFace({\r\n                global: true,\r\n                family: 'ZCOOLKuaiLe',\r\n                source: fontSource,\r\n                desc: {\r\n                  style: 'normal',\r\n                  weight: '400'\r\n                },\r\n                success: (res) => {\r\n                  console.log('ZCOOLKuaiLe å­—ä½“ä»CDNåŠ è½½æˆåŠŸ', res);\r\n                  resolve(res);\r\n                },\r\n                fail: (error2) => {\r\n                  console.warn('ZCOOLKuaiLe å­—ä½“CDNåŠ è½½ä¹Ÿå¤±è´¥:', error2);\r\n                  zcoolKuaiLeFontPromise = null;\r\n                  resolve(null);\r\n                }\r\n              });\r\n              return;\r\n            }\r\n            // #endif\r\n            zcoolKuaiLeFontPromise = null;\r\n            resolve(null);\r\n          }\r\n        });\r\n      });\r\n      return zcoolKuaiLeFontPromise;\r\n    },\r\n    ensureQingSongFont() {\r\n      if (qingSongFontPromise) {\r\n        return qingSongFontPromise;\r\n      }\r\n      // å¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒæœ¬åœ°å­—ä½“æ–‡ä»¶ï¼Œä½¿ç”¨æœåŠ¡å™¨å­—ä½“æ–‡ä»¶\r\n      // å…¶ä»–å¹³å°ä¼˜å…ˆä½¿ç”¨æœ¬åœ°å­—ä½“æ–‡ä»¶\r\n      let fontSource;\r\n      // #ifdef MP-WEIXIN\r\n      // å¾®ä¿¡å°ç¨‹åºå¿…é¡»ä½¿ç”¨ç½‘ç»œURLï¼Œä½¿ç”¨æœåŠ¡å™¨å­—ä½“æ–‡ä»¶\r\n      fontSource = `url(\"${config.baseURL}/fonts/QingSong-Regular.ttf\")`;\r\n      // #endif\r\n      // #ifndef MP-WEIXIN\r\n      fontSource = 'url(\"/static/fonts/QingSong-Regular.ttf\")';\r\n      // #endif\r\n      qingSongFontPromise = new Promise((resolve, reject) => {\r\n        uni.loadFontFace({\r\n          global: true,\r\n          family: 'QingSong',\r\n          source: fontSource,\r\n          desc: {\r\n            style: 'normal',\r\n            weight: '400'\r\n          },\r\n          success: (res) => {\r\n            console.log('QingSong å­—ä½“åŠ è½½æˆåŠŸ', res);\r\n            resolve(res);\r\n          },\r\n          fail: (error) => {\r\n            console.warn('QingSong å­—ä½“åŠ è½½å¤±è´¥:', error);\r\n            // å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸‹ï¼Œå¦‚æœç½‘ç»œåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å­—ä½“\r\n            // #ifdef MP-WEIXIN\r\n            qingSongFontPromise = null;\r\n            resolve(null);\r\n            // #endif\r\n            // éå¾®ä¿¡å°ç¨‹åºï¼Œå¦‚æœæœ¬åœ°åŠ è½½å¤±è´¥ï¼Œå°è¯•æœåŠ¡å™¨å­—ä½“\r\n            // #ifndef MP-WEIXIN\r\n            if (fontSource.includes('/static/')) {\r\n              console.log('å°è¯•ä½¿ç”¨æœåŠ¡å™¨åŠ è½½ QingSong å­—ä½“');\r\n              fontSource = `url(\"${config.baseURL}/fonts/QingSong-Regular.ttf\")`;\r\n              uni.loadFontFace({\r\n                global: true,\r\n                family: 'QingSong',\r\n                source: fontSource,\r\n                desc: {\r\n                  style: 'normal',\r\n                  weight: '400'\r\n                },\r\n                success: (res) => {\r\n                  console.log('QingSong å­—ä½“ä»CDNåŠ è½½æˆåŠŸ', res);\r\n                  resolve(res);\r\n                },\r\n                fail: (error2) => {\r\n                  console.warn('QingSong å­—ä½“CDNåŠ è½½ä¹Ÿå¤±è´¥:', error2);\r\n                  qingSongFontPromise = null;\r\n                  resolve(null);\r\n                }\r\n              });\r\n              return;\r\n            }\r\n            // #endif\r\n            qingSongFontPromise = null;\r\n            resolve(null);\r\n          }\r\n        });\r\n      });\r\n      return qingSongFontPromise;\r\n    },\r\n    ensureZcoolXiaoWeiFont() {\r\n      if (zcoolXiaoWeiFontPromise) {\r\n        return zcoolXiaoWeiFontPromise;\r\n      }\r\n      // å¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒæœ¬åœ°å­—ä½“æ–‡ä»¶ï¼Œä½¿ç”¨æœåŠ¡å™¨å­—ä½“æ–‡ä»¶\r\n      // å…¶ä»–å¹³å°ä¼˜å…ˆä½¿ç”¨æœ¬åœ°å­—ä½“æ–‡ä»¶\r\n      let fontSource;\r\n      // #ifdef MP-WEIXIN\r\n      // å¾®ä¿¡å°ç¨‹åºå¿…é¡»ä½¿ç”¨ç½‘ç»œURLï¼Œä½¿ç”¨æœåŠ¡å™¨å­—ä½“æ–‡ä»¶\r\n      fontSource = `url(\"${config.baseURL}/fonts/ZCOOLXiaoWei-Regular.ttf\")`;\r\n      // #endif\r\n      // #ifndef MP-WEIXIN\r\n      fontSource = 'url(\"/static/fonts/ZCOOLXiaoWei-Regular.ttf\")';\r\n      // #endif\r\n      zcoolXiaoWeiFontPromise = new Promise((resolve, reject) => {\r\n        uni.loadFontFace({\r\n          global: true,\r\n          family: 'ZCOOLXiaoWei',\r\n          source: fontSource,\r\n          desc: {\r\n            style: 'normal',\r\n            weight: '400'\r\n          },\r\n          success: (res) => {\r\n            console.log('ZCOOLXiaoWei å­—ä½“åŠ è½½æˆåŠŸ', res);\r\n            resolve(res);\r\n          },\r\n          fail: (error) => {\r\n            console.warn('ZCOOLXiaoWei å­—ä½“åŠ è½½å¤±è´¥:', error);\r\n            // å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸‹ï¼Œå¦‚æœç½‘ç»œåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å­—ä½“\r\n            // #ifdef MP-WEIXIN\r\n            zcoolXiaoWeiFontPromise = null;\r\n            resolve(null);\r\n            // #endif\r\n            // éå¾®ä¿¡å°ç¨‹åºï¼Œå¦‚æœæœ¬åœ°åŠ è½½å¤±è´¥ï¼Œå°è¯•æœåŠ¡å™¨å­—ä½“\r\n            // #ifndef MP-WEIXIN\r\n            if (fontSource.includes('/static/')) {\r\n              console.log('å°è¯•ä½¿ç”¨æœåŠ¡å™¨åŠ è½½ ZCOOLXiaoWei å­—ä½“');\r\n              fontSource = `url(\"${config.baseURL}/fonts/ZCOOLXiaoWei-Regular.ttf\")`;\r\n              uni.loadFontFace({\r\n                global: true,\r\n                family: 'ZCOOLXiaoWei',\r\n                source: fontSource,\r\n                desc: {\r\n                  style: 'normal',\r\n                  weight: '400'\r\n                },\r\n                success: (res) => {\r\n                  console.log('ZCOOLXiaoWei å­—ä½“ä»CDNåŠ è½½æˆåŠŸ', res);\r\n                  resolve(res);\r\n                },\r\n                fail: (error2) => {\r\n                  console.warn('ZCOOLXiaoWei å­—ä½“CDNåŠ è½½ä¹Ÿå¤±è´¥:', error2);\r\n                  zcoolXiaoWeiFontPromise = null;\r\n                  resolve(null);\r\n                }\r\n              });\r\n              return;\r\n            }\r\n            // #endif\r\n            zcoolXiaoWeiFontPromise = null;\r\n            resolve(null);\r\n          }\r\n        });\r\n      });\r\n      return zcoolXiaoWeiFontPromise;\r\n    },\r\n    ensureZcoolWenYiFont() {\r\n      if (zcoolWenYiFontPromise) {\r\n        return zcoolWenYiFontPromise;\r\n      }\r\n      // å¾®ä¿¡å°ç¨‹åºä¸æ”¯æŒæœ¬åœ°å­—ä½“æ–‡ä»¶ï¼Œä½¿ç”¨æœåŠ¡å™¨å­—ä½“æ–‡ä»¶\r\n      // å…¶ä»–å¹³å°ä¼˜å…ˆä½¿ç”¨æœ¬åœ°å­—ä½“æ–‡ä»¶\r\n      let fontSource;\r\n      // #ifdef MP-WEIXIN\r\n      // å¾®ä¿¡å°ç¨‹åºå¿…é¡»ä½¿ç”¨ç½‘ç»œURLï¼Œä½¿ç”¨æœåŠ¡å™¨å­—ä½“æ–‡ä»¶\r\n      fontSource = `url(\"${config.baseURL}/fonts/ZCOOLWenYi-Regular.ttf\")`;\r\n      // #endif\r\n      // #ifndef MP-WEIXIN\r\n      fontSource = 'url(\"/static/fonts/ZCOOLWenYi-Regular.ttf\")';\r\n      // #endif\r\n      zcoolWenYiFontPromise = new Promise((resolve, reject) => {\r\n        uni.loadFontFace({\r\n          global: true,\r\n          family: 'ZCOOLWenYi',\r\n          source: fontSource,\r\n          desc: {\r\n            style: 'normal',\r\n            weight: '400'\r\n          },\r\n          success: (res) => {\r\n            console.log('ZCOOLWenYi å­—ä½“åŠ è½½æˆåŠŸ', res);\r\n            resolve(res);\r\n          },\r\n          fail: (error) => {\r\n            console.warn('ZCOOLWenYi å­—ä½“åŠ è½½å¤±è´¥:', error);\r\n            // å¾®ä¿¡å°ç¨‹åºç¯å¢ƒä¸‹ï¼Œå¦‚æœç½‘ç»œåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å­—ä½“\r\n            // #ifdef MP-WEIXIN\r\n            zcoolWenYiFontPromise = null;\r\n            resolve(null);\r\n            // #endif\r\n            // éå¾®ä¿¡å°ç¨‹åºï¼Œå¦‚æœæœ¬åœ°åŠ è½½å¤±è´¥ï¼Œå°è¯•æœåŠ¡å™¨å­—ä½“\r\n            // #ifndef MP-WEIXIN\r\n            if (fontSource.includes('/static/')) {\r\n              console.log('å°è¯•ä½¿ç”¨æœåŠ¡å™¨åŠ è½½ ZCOOLWenYi å­—ä½“');\r\n              fontSource = `url(\"${config.baseURL}/fonts/ZCOOLWenYi-Regular.ttf\")`;\r\n              uni.loadFontFace({\r\n                global: true,\r\n                family: 'ZCOOLWenYi',\r\n                source: fontSource,\r\n                desc: {\r\n                  style: 'normal',\r\n                  weight: '400'\r\n                },\r\n                success: (res) => {\r\n                  console.log('ZCOOLWenYi å­—ä½“ä»CDNåŠ è½½æˆåŠŸ', res);\r\n                  resolve(res);\r\n                },\r\n                fail: (error2) => {\r\n                  console.warn('ZCOOLWenYi å­—ä½“CDNåŠ è½½ä¹Ÿå¤±è´¥:', error2);\r\n                  zcoolWenYiFontPromise = null;\r\n                  resolve(null);\r\n                }\r\n              });\r\n              return;\r\n            }\r\n            // #endif\r\n            zcoolWenYiFontPromise = null;\r\n            resolve(null);\r\n          }\r\n        });\r\n      });\r\n      return zcoolWenYiFontPromise;\r\n    },\r\n    extractFontList(response) {\r\n      if (!response) return [];\r\n      const candidates = [\r\n        response.data?.fonts,\r\n        response.data?.items,\r\n        response.data,\r\n        response.fonts,\r\n        response.items,\r\n        response.list,\r\n        response\r\n      ];\r\n      for (const candidate of candidates) {\r\n        if (Array.isArray(candidate)) {\r\n          return candidate;\r\n        }\r\n      }\r\n      return [];\r\n    },\r\n    normalizeFontOptions(fonts = []) {\r\n      if (!Array.isArray(fonts)) return [];\r\n      return fonts\r\n        .map(item => {\r\n          if (typeof item === 'string') {\r\n            return this.createFontOption(item);\r\n          }\r\n          const value = item.value || item.fontStyle || item.font_style || item.code || item.key;\r\n          if (!value) return null;\r\n          const base = this.createFontOption(value);\r\n          return {\r\n            ...base,\r\n            ...item,\r\n            value: base.value,\r\n            label: item.label || item.name || base.label,\r\n            description: item.description || base.description,\r\n            sample: item.sample || base.sample\r\n          };\r\n        })\r\n        .filter(Boolean);\r\n    },\r\n    createFontOption(value) {\r\n      if (!value && value !== 0) {\r\n        return FALLBACK_FONT_OPTIONS[0];\r\n      }\r\n      const normalizedValue = String(value).trim().toLowerCase();\r\n      const base = FALLBACK_FONT_MAP[normalizedValue] || {\r\n        label: value,\r\n        description: 'è‡ªå®šä¹‰å­—ä½“',\r\n        sample: 'æœªæ¥ä¸ä½ '\r\n      };\r\n      return {\r\n        value: normalizedValue,\r\n        label: base.label,\r\n        description: base.description,\r\n        sample: base.sample\r\n      };\r\n    },\r\n    selectFont(value) {\r\n      if (!value) return;\r\n      this.form.fontStyle = String(value).trim().toLowerCase();\r\n    },\r\n    // é€‰æ‹©é¢„è®¾æ ·å¼\r\n    selectPresetStyle(index) {\r\n      this.selectedStyle = index;\r\n      this.isCustomStyle = false;\r\n      this.customImage = '';\r\n    },\r\n    \r\n    // ä¸Šä¼ è‡ªå®šä¹‰å›¾ç‰‡\r\n    uploadCustom() {\r\n      uni.chooseImage({\r\n        count: 1,\r\n        sizeType: ['compressed'],\r\n        sourceType: ['album', 'camera'],\r\n        success: (res) => {\r\n          this.customImage = res.tempFilePaths[0];\r\n          this.isCustomStyle = true;\r\n          uni.showToast({ title: 'è‡ªå®šä¹‰åº•å›¾å·²é€‰æ‹©', icon: 'success' });\r\n        }\r\n      });\r\n    },\r\n    \r\n    // æ‰“å¼€é¢„è§ˆå¼¹çª—\r\n    openPreview() {\r\n      this.showLivePreviewModal = true;\r\n    },\r\n    \r\n    // æ—¥æœŸé€‰æ‹©\r\n    onDateChange(e) {\r\n      this.form.deliveryDate = e.detail.value;\r\n    },\r\n    \r\n    // ä¸‹ä¸€æ­¥\r\n    nextStep() {\r\n      if (!this.selectedStyle && !this.isCustomStyle) {\r\n        uni.showToast({ title: 'è¯·é€‰æ‹©ä¿¡ä»¶æ ·å¼', icon: 'none' });\r\n        return;\r\n      }\r\n      this.currentStep = 2;\r\n    },\r\n    \r\n    // ä¸Šä¸€æ­¥\r\n    prevStep() {\r\n      this.currentStep = 1;\r\n    },\r\n    \r\n    // æäº¤ä¿¡ä»¶\r\n    async submitLetter() {\r\n      // éªŒè¯å¿…å¡«é¡¹\r\n      if (!this.form.title) {\r\n        uni.showToast({ title: 'è¯·å¡«å†™ä¿¡ä»¶ä¸»é¢˜', icon: 'none' });\r\n        return;\r\n      }\r\n      if (!this.form.deliveryDate) {\r\n        uni.showToast({ title: 'è¯·é€‰æ‹©é€è¾¾æ—¶é—´', icon: 'none' });\r\n        return;\r\n      }\r\n      if (!this.form.content) {\r\n        uni.showToast({ title: 'è¯·å¡«å†™ä¿¡ä»¶å†…å®¹', icon: 'none' });\r\n        return;\r\n      }\r\n\r\n      // æ˜¾ç¤ºåŠ è½½æç¤º\r\n      uni.showLoading({ title: 'æ­£åœ¨åˆ›å»º...' });\r\n\r\n      try {\r\n        // è·å–å¯¹æ–¹IDï¼ˆå¦‚æœå·²ç»‘å®šï¼‰\r\n        let receiverId = null;\r\n        if (isBound()) {\r\n          try {\r\n            const coupleInfo = uni.getStorageSync('couple_info');\r\n            console.log('ğŸ‘« [æƒ…ä¾£ä¿¡æ¯]', coupleInfo);\r\n            \r\n            // ä¼˜å…ˆä½¿ç”¨ partnerIdï¼ˆå¦‚æœå­˜åœ¨ï¼‰\r\n            if (coupleInfo && coupleInfo.partnerId) {\r\n              receiverId = coupleInfo.partnerId;\r\n              console.log('âœ… [è·å–å¯¹æ–¹ID] ä» partnerId è·å–:', receiverId);\r\n            } else {\r\n              // å¦åˆ™ä» partnerInfo.userId è·å–\r\n              const partnerInfo = getPartnerInfo();\r\n              if (partnerInfo && partnerInfo.userId) {\r\n                receiverId = partnerInfo.userId;\r\n                console.log('âœ… [è·å–å¯¹æ–¹ID] ä» partnerInfo.userId è·å–:', receiverId);\r\n              }\r\n            }\r\n          } catch (e) {\r\n            console.warn('âš ï¸ è·å–å¯¹æ–¹IDå¤±è´¥:', e);\r\n          }\r\n        } else {\r\n          console.log('âš ï¸ æœªç»‘å®šæƒ…ä¾£å…³ç³»ï¼Œè·³è¿‡ receiverId');\r\n        }\r\n\r\n        // æ„å»ºèƒŒæ™¯å›¾ç‰‡URLï¼ˆå¦‚æœæ˜¯è‡ªå®šä¹‰å›¾ç‰‡ï¼Œéœ€è¦å…ˆä¸Šä¼ ï¼‰\r\n        let backgroundImage = null;\r\n        if (this.isCustomStyle && this.customImage) {\r\n          // å¦‚æœæ˜¯è‡ªå®šä¹‰å›¾ç‰‡ï¼Œè¿™é‡Œéœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨è·å–URL\r\n          // æš‚æ—¶ä½¿ç”¨æœ¬åœ°è·¯å¾„ï¼Œåç»­å¯ä»¥é›†æˆå›¾ç‰‡ä¸Šä¼ åŠŸèƒ½\r\n          backgroundImage = this.customImage;\r\n        } else {\r\n          // é¢„è®¾æ ·å¼å¯ä»¥è½¬æ¢ä¸ºå®Œæ•´URLæˆ–ä½¿ç”¨æ ·å¼ID\r\n          backgroundImage = `/static/xinxiang/xin${this.selectedStyle}.jpg`;\r\n        }\r\n\r\n        // éªŒè¯æ—¥æœŸæ ¼å¼\r\n        if (!this.form.deliveryDate || !/^\\d{4}-\\d{2}-\\d{2}$/.test(this.form.deliveryDate)) {\r\n          uni.hideLoading();\r\n          uni.showToast({ title: 'æ—¥æœŸæ ¼å¼é”™è¯¯ï¼Œè¯·é‡æ–°é€‰æ‹©', icon: 'none' });\r\n          return;\r\n        }\r\n\r\n        // æ„å»ºåç«¯APIè¯·æ±‚æ•°æ®\r\n        const letterData = {\r\n          title: this.form.title.trim(),\r\n          content: this.form.content.trim(),\r\n          deliveryMethod: 'PARTNER', // ç›®å‰åªæ”¯æŒPARTNER\r\n          scheduledDate: this.form.deliveryDate, // æ ¼å¼ï¼šYYYY-MM-DD\r\n          scheduledTime: `${this.form.deliveryDate}T00:00:00.000`, // é»˜è®¤æ—¶é—´ï¼Œç¡®ä¿åç«¯å¯è§£æ\r\n          status: 'DRAFT', // è‰ç¨¿çŠ¶æ€\r\n          fontStyle: this.selectedFontStyle\r\n        };\r\n        letterData.font_style = this.selectedFontStyle;\r\n\r\n        // å¦‚æœå·²ç»‘å®šä¸”è·å–åˆ°å¯¹æ–¹IDï¼Œæ·»åŠ receiverIdï¼ˆç¡®ä¿æ˜¯æ•°å­—ç±»å‹ï¼‰\r\n        if (receiverId) {\r\n          letterData.receiverId = Number(receiverId);\r\n          if (isNaN(letterData.receiverId)) {\r\n            console.warn('receiverId ä¸æ˜¯æœ‰æ•ˆæ•°å­—:', receiverId);\r\n            delete letterData.receiverId;\r\n          }\r\n        }\r\n\r\n        // åªæœ‰å½“èƒŒæ™¯å›¾ç‰‡å­˜åœ¨æ—¶æ‰æ·»åŠ ï¼ˆé¿å…nullå€¼å¯¼è‡´åç«¯é”™è¯¯ï¼‰\r\n        if (backgroundImage && backgroundImage.trim()) {\r\n          letterData.backgroundImage = backgroundImage.trim();\r\n        }\r\n\r\n        console.log('ğŸ“¤ [åˆ›å»ºæƒ…ä¹¦] æœ€ç»ˆè¯·æ±‚å‚æ•°:', JSON.stringify(letterData, null, 2));\r\n\r\n        // è°ƒç”¨åç«¯APIåˆ›å»ºæƒ…ä¹¦\r\n        const response = await createFutureLetter(letterData);\r\n\r\n        if (response && response.success !== false && response.data?.id) {\r\n          const letterId = response.data.id;\r\n          \r\n          // åˆ›å»ºæˆåŠŸåç«‹å³å‘é€ä¿¡ä»¶\r\n          uni.showLoading({ title: 'æ­£åœ¨å‘é€...' });\r\n          \r\n          try {\r\n            // è°ƒç”¨å‘é€æ¥å£\r\n            const sendResponse = await sendFutureLetter(letterId);\r\n            \r\n            uni.hideLoading();\r\n            \r\n            if (sendResponse && sendResponse.success !== false) {\r\n              // ä¿å­˜æœ¬åœ°é¢„è§ˆæ•°æ®ï¼ˆç”¨äºé¢„è§ˆæ˜¾ç¤ºï¼‰\r\n              const localData = {\r\n                id: letterId,\r\n                style: this.isCustomStyle ? 'custom' : this.selectedStyle,\r\n                customImage: this.customImage,\r\n                title: this.form.title,\r\n                deliveryDate: this.form.deliveryDate,\r\n                content: this.form.content,\r\n                fontStyle: this.selectedFontStyle,\r\n                createTime: new Date().toLocaleString(),\r\n                status: 'SENT' // æ ‡è®°ä¸ºå·²å‘é€\r\n              };\r\n\r\n              // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆç”¨äºé¢„è§ˆï¼‰\r\n              try {\r\n                const letters = uni.getStorageSync('xinxiang_letters') || [];\r\n                letters.unshift(localData);\r\n                uni.setStorageSync('xinxiang_letters', letters);\r\n              } catch (e) {\r\n                console.warn('ä¿å­˜æœ¬åœ°é¢„è§ˆæ•°æ®å¤±è´¥', e);\r\n              }\r\n\r\n              uni.showToast({ title: 'æäº¤æˆåŠŸ', icon: 'success' });\r\n              \r\n              // æ˜¾ç¤ºé¢„è§ˆå¼¹çª—\r\n              this.showPreviewModal = true;\r\n            } else {\r\n              // å‘é€å¤±è´¥ï¼Œä½†åˆ›å»ºæˆåŠŸ\r\n              uni.showToast({ \r\n                title: sendResponse.message || 'åˆ›å»ºæˆåŠŸï¼Œä½†å‘é€å¤±è´¥', \r\n                icon: 'none',\r\n                duration: 2000\r\n              });\r\n              \r\n              // å³ä½¿å‘é€å¤±è´¥ä¹Ÿæ˜¾ç¤ºé¢„è§ˆå¼¹çª—\r\n              this.showPreviewModal = true;\r\n            }\r\n          } catch (sendError) {\r\n            uni.hideLoading();\r\n            console.error('å‘é€æœªæ¥æƒ…ä¹¦å¤±è´¥:', sendError);\r\n            \r\n            // å‘é€å¤±è´¥ï¼Œä½†åˆ›å»ºæˆåŠŸï¼Œä»ç„¶ä¿å­˜æ•°æ®\r\n            const localData = {\r\n              id: letterId,\r\n              style: this.isCustomStyle ? 'custom' : this.selectedStyle,\r\n              customImage: this.customImage,\r\n              title: this.form.title,\r\n              deliveryDate: this.form.deliveryDate,\r\n              content: this.form.content,\r\n              fontStyle: this.selectedFontStyle,\r\n              createTime: new Date().toLocaleString(),\r\n              status: 'DRAFT' // æ ‡è®°ä¸ºè‰ç¨¿ï¼ˆå‘é€å¤±è´¥ï¼‰\r\n            };\r\n\r\n            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆç”¨äºé¢„è§ˆï¼‰\r\n            try {\r\n              const letters = uni.getStorageSync('xinxiang_letters') || [];\r\n              letters.unshift(localData);\r\n              uni.setStorageSync('xinxiang_letters', letters);\r\n            } catch (e) {\r\n              console.warn('ä¿å­˜æœ¬åœ°é¢„è§ˆæ•°æ®å¤±è´¥', e);\r\n            }\r\n            \r\n            uni.showToast({ \r\n              title: sendError.message || 'åˆ›å»ºæˆåŠŸï¼Œä½†å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', \r\n              icon: 'none',\r\n              duration: 2000\r\n            });\r\n            \r\n            // å³ä½¿å‘é€å¤±è´¥ä¹Ÿæ˜¾ç¤ºé¢„è§ˆå¼¹çª—\r\n            this.showPreviewModal = true;\r\n          }\r\n        } else {\r\n          uni.showToast({ \r\n            title: response.message || 'åˆ›å»ºå¤±è´¥ï¼Œè¯·é‡è¯•', \r\n            icon: 'none' \r\n          });\r\n        }\r\n      } catch (error) {\r\n        uni.hideLoading();\r\n        console.error('åˆ›å»ºæœªæ¥æƒ…ä¹¦å¤±è´¥:', error);\r\n        uni.showToast({ \r\n          title: error.message || 'åˆ›å»ºå¤±è´¥ï¼Œè¯·é‡è¯•', \r\n          icon: 'none',\r\n          duration: 2000\r\n        });\r\n      }\r\n    },\r\n    \r\n    // å…³é—­é¢„è§ˆå¼¹çª—å¹¶è¿”å›\r\n    closePreviewAndBack() {\r\n      this.showPreviewModal = false;\r\n      setTimeout(() => {\r\n        uni.navigateBack();\r\n      }, 300);\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n/* è‡ªå®šä¹‰å¯¼èˆªæ æ ·å¼ */\r\n.custom-navbar {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  z-index: 9999;\r\n  background-color: #FFFAF4;\r\n  overflow: hidden;\r\n}\r\n\r\n.navbar-gradient-bg {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  height: 200%;\r\n  background: rgba(255, 255, 255, 0.7);\r\n  backdrop-filter: blur(15px);\r\n  -webkit-backdrop-filter: blur(15px);\r\n}\r\n\r\n.status-bar {\r\n  width: 100%;\r\n  background: transparent;\r\n  position: relative;\r\n  z-index: 1;\r\n}\r\n\r\n.navbar-content {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 0 30rpx;\r\n  box-sizing: border-box;\r\n  position: relative;\r\n  z-index: 1;\r\n}\r\n\r\n.navbar-title {\r\n  flex: 1;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  text-align: center;\r\n}\r\n\r\n.title-text {\r\n  font-size: 36rpx;\r\n  font-weight: 500;\r\n  color: #4A4A4A;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.navbar-left {\r\n  width: 80rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.back-icon {\r\n  font-size: 50rpx;\r\n  font-weight: 600;\r\n  color: #4A4A4A;\r\n  line-height: 1;\r\n  cursor: pointer;\r\n  transition: opacity 0.3s;\r\n}\r\n\r\n.back-icon:active {\r\n  opacity: 0.6;\r\n}\r\n\r\n.navbar-right {\r\n  width: 80rpx;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.create-page {\r\n  min-height: 100vh;\r\n  background: #FFFAF4;\r\n  padding: 24rpx;\r\n  padding-bottom: 120rpx;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n/* æ­¥éª¤æŒ‡ç¤ºå™¨ */\r\n.steps {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  padding: 32rpx 0;\r\n  margin-bottom: 24rpx;\r\n}\r\n\r\n.step {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 8rpx;\r\n}\r\n\r\n.step-number {\r\n  width: 60rpx;\r\n  height: 60rpx;\r\n  border-radius: 50%;\r\n  background: #FFE6D0;\r\n  color: #888888;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-size: 24rpx;\r\n  font-weight: 600;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.step.active .step-number {\r\n  background: linear-gradient(135deg, #FFB5C2 0%, #FFD4A3 100%);\r\n  color: #3d2a00;\r\n}\r\n\r\n.step-text {\r\n  font-size: 24rpx;\r\n  color: #888888;\r\n  font-weight: 400;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.step.active .step-text {\r\n  color: #3d2a00;\r\n  font-weight: 600;\r\n}\r\n\r\n.step-line {\r\n  width: 120rpx;\r\n  height: 2rpx;\r\n  background: #FFE6D0;\r\n  margin: 0 20rpx;\r\n  margin-bottom: 28rpx;\r\n}\r\n\r\n/* å†…å®¹åŒºåŸŸ */\r\n.step-content {\r\n  background: rgba(255, 255, 255, 0.7);\r\n  backdrop-filter: blur(15px);\r\n  -webkit-backdrop-filter: blur(15px);\r\n  border-radius: 16rpx;\r\n  padding: 32rpx;\r\n  box-shadow: 0 8rpx 12rpx rgba(0, 0, 0, 0.04), inset 0 0 0 2rpx rgba(255,255,255,0.5);\r\n  overflow: hidden;\r\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\r\n}\r\n\r\n.section-title {\r\n  font-size: 32rpx;\r\n  font-weight: 500;\r\n  color: #4A4A4A;\r\n  display: block;\r\n  margin-bottom: 24rpx;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n/* æ ·å¼ç½‘æ ¼ */\r\n.style-grid {\r\n  display: grid;\r\n  grid-template-columns: repeat(3, 1fr);\r\n  gap: 16rpx;\r\n  margin-bottom: 32rpx;\r\n}\r\n\r\n.style-item {\r\n  position: relative;\r\n  aspect-ratio: 1;\r\n  border-radius: 16rpx;\r\n  overflow: hidden;\r\n  border: 3rpx solid transparent;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.style-item.selected {\r\n  border-color: #FFB5C2;\r\n  box-shadow: 0 4rpx 12rpx rgba(255, 181, 194, 0.3);\r\n}\r\n\r\n.style-image {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.check-mark {\r\n  position: absolute;\r\n  top: 8rpx;\r\n  right: 8rpx;\r\n  width: 40rpx;\r\n  height: 40rpx;\r\n  border-radius: 50%;\r\n  background: linear-gradient(135deg, #FFB5C2 0%, #FFD4A3 100%);\r\n  color: #ffffff;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-size: 24rpx;\r\n}\r\n\r\n/* è‡ªå®šä¹‰æ ·å¼ */\r\n.custom-section {\r\n  margin-bottom: 32rpx;\r\n}\r\n\r\n.custom-btn {\r\n  width: 100%;\r\n  padding: 24rpx;\r\n  background: rgba(255, 255, 255, 0.7);\r\n  backdrop-filter: blur(15px);\r\n  -webkit-backdrop-filter: blur(15px);\r\n  border-radius: 16rpx;\r\n  border: 2rpx dashed #FFB5C2;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 12rpx;\r\n  font-size: 28rpx;\r\n  color: #4A4A4A;\r\n  font-weight: 400;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.btn-icon {\r\n  font-size: 36rpx;\r\n}\r\n\r\n.custom-preview {\r\n  margin-top: 20rpx;\r\n  border-radius: 16rpx;\r\n  overflow: hidden;\r\n  border: 2rpx solid #DCC7E1;\r\n  cursor: pointer;\r\n}\r\n\r\n.preview-wrapper {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 400rpx;\r\n  overflow: hidden;\r\n}\r\n\r\n.preview-bg {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.preview-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: #ffffff;\r\n  pointer-events: none;\r\n}\r\n\r\n/* è£å‰ªæ¡†é¢„è§ˆ */\r\n.crop-preview {\r\n  position: absolute;\r\n  border: 2rpx solid #DCC7E1;\r\n  box-sizing: border-box;\r\n  pointer-events: none;\r\n}\r\n\r\n/* é®ç½©å±‚ - è®©æœªé€‰ä¸­åŒºåŸŸå˜æš— */\r\n.mask-layer {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  pointer-events: none;\r\n}\r\n\r\n.mask-top,\r\n.mask-bottom {\r\n  position: absolute;\r\n  left: 0;\r\n  width: 100%;\r\n  background: rgba(0, 0, 0, 0.5);\r\n}\r\n\r\n.mask-top {\r\n  top: 0;\r\n}\r\n\r\n.mask-middle {\r\n  position: absolute;\r\n  left: 0;\r\n  width: 100%;\r\n  display: flex;\r\n}\r\n\r\n.mask-left,\r\n.mask-right {\r\n  background: rgba(0, 0, 0, 0.5);\r\n  height: 100%;\r\n}\r\n\r\n.mask-center {\r\n  height: 100%;\r\n  /* é€æ˜ï¼Œæ˜¾ç¤ºé€‰ä¸­åŒºåŸŸ */\r\n}\r\n\r\n.preview-tip {\r\n  display: block;\r\n  text-align: center;\r\n  padding: 16rpx;\r\n  background: #F8F0FC;\r\n  color: #DCC7E1;\r\n  font-size: 24rpx;\r\n  font-weight: 400;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n/* é€æ˜åº¦è°ƒæ•´å¼¹çª— */\r\n.modal-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.6);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 1000;\r\n}\r\n\r\n.modal-content {\r\n  width: 90%;\r\n  max-width: 600rpx;\r\n  background: #ffffff;\r\n  border-radius: 24rpx;\r\n  padding: 32rpx;\r\n  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.modal-title {\r\n  font-size: 34rpx;\r\n  font-weight: 600;\r\n  color: #6B5B95;\r\n  display: block;\r\n  text-align: center;\r\n  margin-bottom: 24rpx;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.modal-preview {\r\n  margin-bottom: 24rpx;\r\n  border-radius: 16rpx;\r\n  overflow: hidden;\r\n}\r\n\r\n.modal-preview .preview-wrapper {\r\n  height: 400rpx;\r\n  position: relative;\r\n}\r\n\r\n/* å¯æ‹–åŠ¨è£å‰ªæ¡† */\r\n.crop-box {\r\n  position: absolute;\r\n  touch-action: none;\r\n  cursor: move;\r\n}\r\n\r\n.crop-border {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  border: 3rpx solid #DCC7E1;\r\n  box-sizing: border-box;\r\n  background: rgba(220, 199, 225, 0.1);\r\n}\r\n\r\n.crop-corner {\r\n  position: absolute;\r\n  width: 20rpx;\r\n  height: 20rpx;\r\n  background: #DCC7E1;\r\n  border: 2rpx solid #ffffff;\r\n  border-radius: 50%;\r\n}\r\n\r\n.corner-tl {\r\n  top: -10rpx;\r\n  left: -10rpx;\r\n}\r\n\r\n.corner-tr {\r\n  top: -10rpx;\r\n  right: -10rpx;\r\n}\r\n\r\n.corner-bl {\r\n  bottom: -10rpx;\r\n  left: -10rpx;\r\n}\r\n\r\n.corner-br {\r\n  bottom: -10rpx;\r\n  right: -10rpx;\r\n  width: 30rpx;\r\n  height: 30rpx;\r\n  background: #DCC7E1;\r\n  cursor: se-resize;\r\n}\r\n\r\n.crop-hint {\r\n  position: absolute;\r\n  bottom: -40rpx;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  font-size: 22rpx;\r\n  color: #DCC7E1;\r\n  white-space: nowrap;\r\n  background: rgba(255, 255, 255, 0.9);\r\n  padding: 4rpx 12rpx;\r\n  border-radius: 8rpx;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.opacity-control {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 16rpx;\r\n  padding: 24rpx;\r\n  background: #F8F0FC;\r\n  border-radius: 16rpx;\r\n  margin-bottom: 24rpx;\r\n  border: 1rpx solid #F3E8FF;\r\n}\r\n\r\n.opacity-control .control-label {\r\n  font-size: 26rpx;\r\n  color: #6B5B95;\r\n  width: 100rpx;\r\n  font-weight: 600;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.opacity-control .slider {\r\n  flex: 1;\r\n}\r\n\r\n.opacity-control .control-value {\r\n  font-size: 28rpx;\r\n  color: #DCC7E1;\r\n  font-weight: 600;\r\n  width: 80rpx;\r\n  text-align: right;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.modal-actions {\r\n  display: flex;\r\n  gap: 16rpx;\r\n}\r\n\r\n.modal-btn {\r\n  flex: 1;\r\n  padding: 20rpx;\r\n  border-radius: 12rpx;\r\n  font-size: 28rpx;\r\n  font-weight: 600;\r\n}\r\n\r\n.modal-btn.cancel {\r\n  background: #DCC7E1;\r\n  color: #ffffff;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n/* è¡¨å• */\r\n.form {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 24rpx;\r\n}\r\n.form {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 24rpx;\r\n}\r\n\r\n.form-item {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12rpx;\r\n}\r\n\r\n.form-label {\r\n  font-size: 28rpx;\r\n  color: #4A4A4A;\r\n  font-weight: 500;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.form-input,\r\n.picker-display {\r\n  padding: 20rpx;\r\n  background: #ffffff;\r\n  border-radius: 12rpx;\r\n  font-size: 26rpx;\r\n  border: 1rpx solid #F3E8FF;\r\n  color: #333;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.picker-display {\r\n  color: #333;\r\n}\r\n\r\n.form-textarea {\r\n  min-height: 300rpx;\r\n  padding: 20rpx;\r\n  background: #ffffff;\r\n  border-radius: 12rpx;\r\n  font-size: 26rpx;\r\n  border: 1rpx solid #F3E8FF;\r\n  color: #333;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.font-style-item {\r\n  gap: 16rpx;\r\n}\r\n\r\n.font-loading {\r\n  font-size: 24rpx;\r\n  color: #999999;\r\n}\r\n\r\n.font-error {\r\n  font-size: 22rpx;\r\n  color: #ff4d4f;\r\n}\r\n\r\n.font-options {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 16rpx;\r\n}\r\n\r\n.font-option {\r\n  padding: 20rpx;\r\n  border-radius: 12rpx;\r\n  border: 2rpx solid transparent;\r\n  background: #ffffff;\r\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.04);\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12rpx;\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.font-option.active {\r\n  border-color: #FFB5C2;\r\n  box-shadow: 0 6rpx 16rpx rgba(255, 181, 194, 0.3);\r\n}\r\n\r\n.font-option-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.font-option-name {\r\n  font-size: 28rpx;\r\n  font-weight: 600;\r\n  color: #4A4A4A;\r\n}\r\n\r\n.font-option-desc {\r\n  font-size: 24rpx;\r\n  color: #999999;\r\n}\r\n\r\n.font-option-sample {\r\n  font-size: 30rpx;\r\n  color: #4A4A4A;\r\n}\r\n\r\n.font-style-default {\r\n  font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n  letter-spacing: 0;\r\n}\r\n\r\n.font-style-mashanzheng {\r\n  font-family: 'MaShanZheng', 'Ma Shan Zheng', 'KaiTi', cursive;\r\n  letter-spacing: 2rpx;\r\n}\r\n\r\n.font-style-zcoolkuaile {\r\n  font-family: 'ZCOOLKuaiLe', 'ZCOOL KuaiLe', 'KaiTi', cursive;\r\n  letter-spacing: 1rpx;\r\n}\r\n\r\n.font-style-qingsong {\r\n  font-family: 'QingSong', 'KaiTi', 'STKaiti', cursive;\r\n  letter-spacing: 1.5rpx;\r\n}\r\n\r\n.font-style-zcoolxiaowei {\r\n  font-family: 'ZCOOLXiaoWei', 'ZCOOL XiaoWei', 'KaiTi', cursive;\r\n  letter-spacing: 1rpx;\r\n}\r\n\r\n.font-style-zcoolwenyi {\r\n  font-family: 'ZCOOLWenYi', 'ZCOOL WenYi', 'KaiTi', cursive;\r\n  letter-spacing: 1.5rpx;\r\n}\r\n\r\n/* å…¼å®¹æ—§çš„æ‰‹å†™ä½“æ ·å¼ */\r\n.font-style-handwriting {\r\n  font-family: 'MaShanZheng', 'Ma Shan Zheng', 'ZCOOL KuaiLe', 'KaiTi', cursive;\r\n  letter-spacing: 2rpx;\r\n}\r\n\r\n.font-style-typewriter {\r\n  font-family: 'Courier New', 'Special Elite', 'Source Code Pro', monospace;\r\n  letter-spacing: 1rpx;\r\n}\r\n\r\n.char-count {\r\n  font-size: 22rpx;\r\n  color: #666;\r\n  text-align: right;\r\n  font-weight: 400;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n/* æŒ‰é’® */\r\n.next-btn {\r\n  width: 100%;\r\n  padding: 24rpx;\r\n  background: linear-gradient(135deg, #FFB5C2 0%, #FFD4A3 100%);\r\n  color: #ffffff;\r\n  border-radius: 16rpx;\r\n  font-size: 28rpx;\r\n  font-weight: 500;\r\n  margin-top: 40rpx;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.action-btns {\r\n  display: flex;\r\n  gap: 16rpx;\r\n  margin-top: 40rpx;\r\n}\r\n\r\n.back-btn,\r\n.preview-btn,\r\n.submit-btn {\r\n  flex: 1;\r\n  padding: 24rpx;\r\n  border-radius: 16rpx;\r\n  font-size: 28rpx;\r\n  font-weight: 500;\r\n}\r\n\r\n.back-btn {\r\n  background: #F5F5F5;\r\n  color: #4A4A4A;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.preview-btn {\r\n  background: linear-gradient(135deg, #FFB5C2 0%, #FFD4A3 100%);\r\n  color: #ffffff;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.submit-btn {\r\n  background: linear-gradient(135deg, #FFB5C2 0%, #FFD4A3 100%);\r\n  color: #ffffff;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.preview-modal-btn.adjust {\r\n  background: #F3E8FF;\r\n  color: #6B5B95;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.preview-modal-btn.close {\r\n  background: linear-gradient(90deg, #FFB5C2 0%, #FFD4A3 100%);\r\n  color: #3d2a00;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n/* ä¿¡ä»¶é¢„è§ˆå¼¹çª— */\r\n.preview-modal-overlay {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  background: rgba(0, 0, 0, 0.8);\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  z-index: 2000;\r\n}\r\n\r\n.preview-modal-content {\r\n  width: 90%;\r\n  max-width: 650rpx;\r\n  background: #ffffff;\r\n  border-radius: 24rpx;\r\n  padding: 32rpx;\r\n  box-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.3);\r\n  max-height: 90vh;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.preview-modal-title {\r\n  font-size: 32rpx;\r\n  font-weight: 500;\r\n  color: #4A4A4A;\r\n  display: block;\r\n  text-align: center;\r\n  margin-bottom: 24rpx;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n\r\n.letter-preview {\r\n  flex: 1;\r\n  overflow: hidden;\r\n  border-radius: 16rpx;\r\n  margin-bottom: 24rpx;\r\n}\r\n\r\n.letter-wrapper {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 800rpx;\r\n  border-radius: 16rpx;\r\n  overflow: hidden;\r\n  box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.letter-bg {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  z-index: 0;\r\n}\r\n\r\n.letter-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: #ffffff;\r\n  z-index: 1;\r\n}\r\n\r\n.letter-content {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 60rpx 40rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  z-index: 2;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.letter-header {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 12rpx;\r\n  margin-bottom: 40rpx;\r\n  padding-bottom: 24rpx;\r\n  border-bottom: 2rpx solid rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.letter-title {\r\n  font-size: 36rpx;\r\n  font-weight: 600;\r\n  color: #4A4A4A;\r\n}\r\n\r\n.letter-date {\r\n  font-size: 24rpx;\r\n  color: #666;\r\n  font-weight: 400;\r\n}\r\n\r\n.letter-body {\r\n  flex: 1;\r\n  overflow-y: auto;\r\n  margin-bottom: 32rpx;\r\n}\r\n\r\n.letter-text {\r\n  font-size: 28rpx;\r\n  line-height: 2;\r\n  color: #4A4A4A;\r\n  white-space: pre-wrap;\r\n  word-break: break-all;\r\n  font-weight: 400;\r\n}\r\n\r\n.letter-footer {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  padding-top: 24rpx;\r\n  border-top: 2rpx solid rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.letter-sign {\r\n  font-size: 26rpx;\r\n  color: #666;\r\n  font-style: italic;\r\n  font-weight: 400;\r\n}\r\n\r\n.preview-modal-actions {\r\n  display: flex;\r\n  gap: 16rpx;\r\n}\r\n\r\n.preview-modal-btn {\r\n  flex: 1;\r\n  padding: 24rpx;\r\n  border-radius: 12rpx;\r\n  font-size: 28rpx;\r\n  font-weight: 600;\r\n}\r\n\r\n.preview-modal-btn.confirm {\r\n  background: linear-gradient(90deg, #FFD666 0%, #FFC53D 100%);\r\n  color: #3d2a00;\r\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/Administrator/Desktop/love_time - å‰¯æœ¬/subPackages/record/pages/xinxiang/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getFutureLetterFonts","config","isBound","getPartnerInfo","createFutureLetter","sendFutureLetter"],"mappings":"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"}