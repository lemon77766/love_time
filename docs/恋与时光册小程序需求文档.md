# 恋与时光册（LoveTime）需求文档


## 📋 文档信息

- **项目名称**：恋与时光册（LoveTime）
- **项目类型**：微信小程序（uni-app + Vue3）
- **文档版本**：v1.2
- **创建日期**：2025-10-21
- **最后更新**：2025-12-16



## 📖 项目概述

### 1.1 项目定位

恋与时光册是一款专为情侣设计的微信小程序，旨在帮助情侣记录和分享彼此的美好时光，增进感情，创造更多甜蜜回忆。

### 1.2 核心价值

- **记录美好**：记录恋爱轨迹、照片、问答等珍贵回忆
- **增进感情**：通过问答、挑战等方式增进彼此了解
- **实时互动**：查看对方实时位置，了解彼此动态
- **未来寄语**：通过未来情书功能，为未来留下美好寄语

### 1.3 目标用户

- 处于恋爱关系中的情侣
- 希望记录和分享恋爱时光的用户
- 喜欢通过互动方式增进感情的情侣

---

## 🎯 功能模块

### 2.1 用户认证模块

#### 2.1.1 微信登录
- **功能描述**：支持微信小程序授权登录
- **核心流程**：
  1. 用户点击"微信授权登录"
  2. 调用 `wx.login()` 获取临时凭证 code
  3. 调用 `uni.getUserProfile()` 获取用户信息
  4. 发送 code 和用户信息到后端
  5. 后端验证并返回 token
  6. 前端保存 token 和用户信息
  7. 跳转到首页

- **接口**：`POST /api/login/wechat`
- **数据存储**：`uni.getStorageSync('login_info')`

#### 2.1.2 用户信息管理
- 获取用户基本信息
- 更新用户昵称、头像
- 个人资料页面展示

---

### 2.2 情侣关系模块

#### 2.2.1 绑定关系
- **功能描述**：支持两个用户之间建立唯一的情侣关系
- **绑定方式**：邀请码绑定
- **核心流程**：
  1. 用户A生成邀请码（6位字母数字组合，有效期24小时）
  2. 用户B输入邀请码
  3. 系统验证邀请码并显示用户A信息
  4. 用户B确认绑定
  5. 后端建立关系记录
  6. 双方客户端更新本地状态

- **接口列表**：
  - `POST /api/couple/invite/create` - 生成邀请码
  - `GET /api/couple/invite/validate?code=xxx` - 验证邀请码
  - `POST /api/couple/bind/accept` - 接受邀请
  - `GET /api/couple/status` - 查询绑定状态
  - `POST /api/couple/unbind` - 解绑关系
  - `GET /api/couple/love-days` - 获取相爱天数

#### 2.2.2 关系管理
- 查看绑定状态
- 查看对方信息
- 设置纪念日
- 解绑关系

#### 2.2.3 数据存储
- 本地存储：`uni.getStorageSync('couple_info')`
- 包含字段：`isBound`、`coupleId`、`partnerInfo`、`bindTime`、`anniversaryDate` 等

---

### 2.3 甜蜜问答模块

#### 2.3.1 问题管理
- **预设问题**：系统提供预设问题列表
- **自定义问题**：用户可添加自定义问题
- **问题分类**：预设问题、自定义问题

#### 2.3.2 答案提交
- 用户回答问题
- 提交答案到后端
- 查看对方答案（如果对方已回答）

#### 2.3.3 历史记录
- 查看历史问答记录
- 支持分页加载
- 显示双方答案对比

#### 2.3.4 接口列表
- `GET /api/qna/questions` - 获取问题列表
- `POST /api/qna/answer/submit` - 提交答案
- `GET /api/qna/history` - 获取历史记录
- `GET /api/qna/partner` - 获取对方答案
- `POST /api/qna/question/add` - 添加自定义问题
- `POST /api/qna/question/delete` - 删除自定义问题

---

### 2.4 恋爱轨迹模块

#### 2.4.1 实时定位
- **功能描述**：上传和查看双方实时位置，并以图片或虚拟形象方式呈现对方状态
- **核心功能**：
  - 上传用户当前位置
  - 获取双方实时位置
  - 计算双方距离
  - 显示位置信息（地址、地点名称）
  - 支持以情侣虚拟形象或自定义图片标记当前位置

#### 2.4.2 轨迹记录
- **主要轨迹点**：显示重要轨迹点列表
- **历史轨迹**：查看历史轨迹记录
- **轨迹统计**：统计轨迹数据（总点数、总距离、最常去地点等）
- **手动添加**：支持手动添加轨迹点

#### 2.4.3 接口列表
- `POST /api/trajectory/location/update` - 上传/更新位置
- `GET /api/trajectory/location/current` - 获取双方实时位置
- `GET /api/trajectory/points` - 获取主要轨迹点列表
- `GET /api/trajectory/list` - 获取历史轨迹列表
- `POST /api/trajectory/points` - 手动添加轨迹点
- `GET /api/trajectory/statistics` - 获取轨迹统计信息
- `GET /api/trajectory/avatar` - 获取情侣虚拟形象配置

#### 2.4.4 权限要求
- 需要获取用户位置权限（`scope.userLocation`）

---

### 2.5 未来情书模块

#### 2.5.1 创建情书
- **功能描述**：创建未来情书，设置发送时间
- **核心功能**：
  - 编辑情书标题和内容
  - 选择字体样式（默认字体、手写体、打字机体等）
  - 选择发送方式（目前支持发送给情侣）
  - 设置发送日期和时间
  - 保存草稿或立即发送
  - 选择背景图片（可选）

#### 2.5.2 情书管理
- **写信记录**：查看已创建的情书列表
- **收信记录**：查看收到的情书列表
- **已发送记录**：查看已发送的情书列表
- **状态管理**：草稿、已安排、定时发送中、已发送
- **定时发送**：支持按分钟级别精确发送，提供失败重试与发送结果通知

#### 2.5.3 接口列表
- `POST /api/future-letter` - 创建未来情书
- `GET /api/future-letter` - 获取情书列表
- `GET /api/future-letter/sent` - 获取已发送情书
- `GET /api/future-letter/received` - 获取收到情书
- `GET /api/future-letter/stats` - 获取统计信息
- `GET /api/future-letter/{id}` - 获取情书详情
- `PUT /api/future-letter/{id}` - 更新情书
- `POST /api/future-letter/{id}/send` - 立即发送
- `DELETE /api/future-letter/{id}` - 删除情书
- `GET /api/future-letter/fonts` - 获取可选字体列表
- `POST /api/future-letter/{id}/schedule` - 更新情书定时发送配置

---

### 2.6 爱心照片墙模块

#### 2.6.1 项目管理
- **创建项目**：创建新的照片墙项目
- **项目设置**：设置项目名称、描述、最大照片数
- **项目列表**：查看所有照片墙项目
- **项目详情**：查看项目详情和照片列表

#### 2.6.2 照片管理
- **上传照片**：上传照片到指定项目
- **照片列表**：查看项目中的所有照片
- **照片编辑**：编辑照片说明、拍摄日期等
- **照片删除**：删除照片
- **清空照片**：清空项目中的所有照片

#### 2.6.3 接口列表
- `POST /api/heart-wall/projects` - 创建项目
- `GET /api/heart-wall/projects` - 获取项目列表
- `GET /api/heart-wall/projects/{projectId}` - 获取项目详情
- `PUT /api/heart-wall/projects/{projectId}` - 更新项目
- `DELETE /api/heart-wall/projects/{projectId}` - 删除项目
- `POST /api/heart-wall/photos` - 上传照片
- `GET /api/heart-wall/projects/{projectId}?action=photos` - 获取照片列表
- `PUT /api/heart-wall/photos/{photoId}` - 更新照片
- `DELETE /api/heart-wall/photos/{photoId}` - 删除照片
- `PUT /api/heart-wall/clear-photos?projectId=xxx` - 清空照片
- `GET /api/heart-wall/next-position?projectId=xxx` - 获取下一个可用位置
- `GET /api/heart-wall/export?projectId=xxx` - 导出心形墙生成图片

#### 2.6.4 导出分享
- **功能描述**：将当前心形墙布局导出为高清图片，支持保存至相册或分享
- **处理流程**：
  1. 前端收集心形墙布局数据
  2. 调用后端合成图片接口
  3. 返回图片下载链接
  4. 用户可保存或分享
- **分享渠道**：朋友圈、好友、即时分享模块

---

### 2.7 一百件小事模块

#### 2.7.1 任务管理
- **预设任务**：系统提供预设任务列表
- **自定义任务**：用户可添加自定义任务
- **任务分类**：预设任务、自定义任务
- **任务状态**：待完成、已完成

#### 2.7.2 任务操作
- **完成任务**：标记任务为已完成
- **取消完成**：取消任务完成状态
- **收藏任务**：收藏/取消收藏任务
- **删除任务**：删除自定义任务
- **上传照片**：完成任务时上传照片

#### 2.7.3 进度统计
- 总任务数
- 已完成数量
- 完成率
- 已收藏数量
- 最后活跃时间

#### 2.7.4 接口列表
- `GET /api/challenge/tasks` - 获取任务列表
- `GET /api/challenge/progress` - 获取用户进度
- `POST /api/challenge/task/add` - 添加自定义任务
- `POST /api/challenge/task/delete` - 删除任务
- `POST /api/challenge/complete` - 标记任务完成/取消完成
- `POST /api/challenge/upload` - 上传任务完成照片
- `POST /api/challenge/favorite` - 收藏/取消收藏任务

---

### 2.8 首页模块

#### 2.8.1 情侣状态展示
- **已绑定状态**：
  - 显示双方头像
  - 显示相爱天数
  - 显示纪念日倒计时
  - 显示统计数据（聊天、礼物、周年等）

- **未绑定状态**：
  - 显示用户头像和占位符
  - 提示"等待另一半"
  - 提供"邀请另一半"入口

#### 2.8.2 功能入口
- 甜蜜问答
- 一百件事
- 未来情书
- 爱心照片墙
- 记忆（待开发）
- 即时分享
- 虚拟人功能

---

### 2.9 我们模块

#### 2.9.1 个人资料
- 查看个人资料
- 编辑昵称、头像
- 查看绑定状态

#### 2.9.2 关系信息
- 查看对方信息
- 查看绑定时间
- 查看相爱天数
- 设置纪念日

---

### 2.10 即时分享与互动模块

#### 2.10.1 功能目标
- 提供一键分享到朋友圈/聊天的体验
- 支持模板化内容（纪念日、打卡、礼物等）
- 增加情侣间互动小游戏与任务提醒

#### 2.10.2 核心功能
- **内容生成**：根据模块数据自动生成分享卡片
- **即时分享**：接入微信分享组件，支持分享到好友、微信群、朋友圈
- **互动玩法**：提供连麦聊天、即时互送表情、互动签到等功能入口
- **提醒机制**：分享后可提醒另一半参与/查看

#### 2.10.3 接口列表
- `POST /api/share/card` - 生成分享卡片
- `GET /api/share/templates` - 获取分享模板列表
- `POST /api/interaction/poke` - 发送互动提醒
- `POST /api/interaction/game/invite` - 邀请另一半参与互动

---

### 2.11 虚拟人功能模块

#### 2.11.1 功能目标
- 基于虚拟人形象提供智能交互服务
- 提供多种情景、角色和话题选择
- 支持情感分析和沟通建议

#### 2.11.2 核心功能
- **虚拟形象**：支持自定义虚拟形象外观
- **情景剧本**：预设常见情景场景，支持自定义话题
- **智能对话**：AI 提供沟通建议与情绪分析
- **互动体验**：提供沉浸式虚拟人交互体验

#### 2.11.3 接口列表
- `GET /api/virtual-human/scenarios` - 获取情景剧本列表
- `POST /api/virtual-human/session` - 创建互动会话
- `POST /api/virtual-human/message` - 提交对话信息
- `GET /api/virtual-human/report/{sessionId}` - 获取互动报告

---


### 2.12 后台管理系统模块

#### 2.12.1 功能目标
- 提供用户、情侣关系、内容数据的统一管理平台
- 支持数据统计和运营分析
- 提供内容审核和风险管控功能

#### 2.12.2 核心功能
- **用户管理**：查看和管理用户信息
- **关系管理**：查看和管理情侣关系
- **内容管理**：审核和管理用户生成内容
- **数据统计**：提供各类运营数据统计报表
- **系统配置**：管理系统参数和配置项

#### 2.12.3 接口列表
- `GET /admin/users` - 获取用户列表
- `GET /admin/couples` - 获取情侣关系列表
- `GET /admin/content` - 获取内容列表
- `POST /admin/content/{id}/review` - 审核内容
- `GET /admin/stats` - 获取统计数据
- `GET /admin/config` - 获取系统配置
- `PUT /admin/config` - 更新系统配置

---


## 📱 页面结构

### 3.1 页面列表

| 页面路径 | 页面名称 | 说明 |
|---------|---------|------|
| `pages/login/index` | 登录页 | 微信授权登录 |
| `pages/index/index` | 首页 | 甜蜜小屋，功能入口 |
| `pages/we/index` | 我们 | 个人资料和关系信息 |
| `pages/we/profile` | 个人资料 | 编辑个人资料 |
| `pages/trajectory/index` | 恋爱轨迹 | 实时位置和轨迹展示 |
| `pages/trajectory/history` | 历史轨迹 | 历史轨迹记录 |
| `pages/qna/index` | 甜蜜问答 | 问答主页面 |
| `pages/qna/history` | 问答历史 | 历史问答记录 |
| `pages/xinxiang/index` | 未来情书 | 情书主页面 |
| `pages/xinxiang/create` | 写信 | 创建未来情书 |
| `pages/xinxiang/history` | 写信记录 | 已创建情书列表 |
| `pages/xinxiang/received` | 收信记录 | 收到情书列表 |
| `pages/heartwall/index` | 爱心照片墙 | 照片墙项目列表 |
| `pages/heartwall/create` | 创建照片墙 | 创建新项目 |
| `pages/hundred/index` | 一百件小事 | 任务列表和进度 |
| `pages/invite/index` | 邀请另一半 | 绑定情侣关系 |
| `pages/jiyi/index` | 记忆 | 记忆相关功能（待开发） |
| `pages/share/index` | 即时分享 | 分享卡片与互动中心 |
| `pages/virtual-argue/index` | 虚拟人功能 | 虚拟人交互入口 |

### 3.2 TabBar 配置

底部导航栏包含三个主要入口：
- **Home**：首页（`pages/index/index`）
- **Trajectory**：恋爱轨迹（`pages/trajectory/index`）
- **We**：我们（`pages/we/index`）

---

## 🔌 API 接口规范

### 4.1 统一响应格式

所有API接口返回统一格式：

```json
{
  "success": true|false,    // 业务是否成功
  "message": "提示信息",     // 提示消息
  "data": {}|[]|null        // 返回数据
}
```

### 4.2 请求头格式

后续请求需要携带token：

```javascript
{
  "Content-Type": "application/json",
  "Authorization": "Bearer {token}"
}
```

### 4.3 HTTP 状态码

- `200` - 成功
- `400` - 请求参数错误
- `401` - 未授权（token过期或无效）
- `404` - 资源不存在
- `500` - 服务器内部错误

### 4.4 错误处理

- 网络错误：提示网络连接失败
- 业务错误：显示后端返回的错误消息
- Token过期：自动跳转到登录页

---

## 💾 数据存储

### 5.1 本地存储

#### 5.1.1 登录信息
- **键名**：`login_info`
- **内容**：token、openid、userId、用户信息等

#### 5.1.2 情侣信息
- **键名**：`couple_info`
- **内容**：绑定状态、对方信息、纪念日等

### 5.2 数据结构

#### 登录信息结构
```javascript
{
  token: "JWT token",
  openid: "微信openid",
  userId: "用户ID",
  userInfo: {
    nickName: "用户昵称",
    avatarUrl: "头像URL"
  }
}
```

#### 情侣信息结构
```javascript
{
  isBound: true,
  coupleId: "关系ID",
  partnerId: "对方用户ID",
  partnerInfo: {
    userId: "对方用户ID",
    nickName: "对方昵称",
    avatarUrl: "对方头像URL"
  },
  bindTime: "绑定时间",
  anniversaryDate: "纪念日",
  role: "initiator" | "accepter"
}
```

---

## 🎨 UI/UX 设计

### 6.1 设计风格

- **主色调**：粉色系（#FF9EBC、#C084FC、#D9ACFF）
- **背景色**：浅紫色（#F8F0FC）
- **字体**：全站统一中文字体（优先使用 `PingFang SC`、`HarmonyOS Sans SC`，不支持的设备回退系统字体），未来情书支持字体切换
- **图标**：统一使用彩色矢量图标集，保证风格一致（优先选择线条 + 彩色填充）

### 6.2 交互设计

- **导航栏**：自定义导航栏，支持自定义样式
- **TabBar**：底部导航栏，三个主要入口
- **卡片式布局**：主要功能采用卡片式设计
- **加载状态**：所有异步操作显示加载提示
- **错误提示**：友好的错误提示信息
- **语言规范**：界面文本统一使用简体中文，提供多语言扩展预留

### 6.3 响应式设计

- 适配不同尺寸的微信小程序屏幕
- 使用 rpx 单位进行响应式布局

---

## 🔒 安全考虑

### 7.1 认证安全

- 使用 JWT token 进行身份认证
- Token 存储在本地，定期刷新
- 所有接口请求携带 token

### 7.2 数据安全

- 敏感数据加密传输（HTTPS）
- 用户隐私数据保护
- 位置信息仅用于功能展示

### 7.3 权限控制

- 需要绑定关系后才能使用部分功能
- 位置权限需要用户授权
- 照片上传需要用户授权

---

## 📊 性能优化

### 8.1 数据加载

- 列表数据支持分页加载
- 图片懒加载
- 数据缓存机制

### 8.2 网络优化

- 请求超时设置（10秒）
- 请求重试机制
- 错误降级处理

### 8.3 存储优化

- 合理使用本地存储
- 定期清理过期数据
- 避免存储过大数据

---

## 🧪 测试要求

### 9.1 功能测试

- 登录流程测试
- 绑定关系流程测试
- 各功能模块功能测试
- 异常场景测试

### 9.2 兼容性测试

- 不同微信版本测试
- 不同设备型号测试
- 不同网络环境测试

### 9.3 性能测试

- 页面加载速度测试
- 接口响应时间测试
- 内存占用测试

---

## 📝 开发规范

### 10.1 代码规范

- 使用 Vue3 Composition API
- 遵循 ESLint 规范
- 统一代码风格

### 10.2 命名规范

- 文件命名：小写字母，使用连字符（kebab-case）
- 变量命名：驼峰命名（camelCase）
- 常量命名：大写下划线（UPPER_SNAKE_CASE）

### 10.3 注释规范

- 函数注释：说明参数、返回值、功能
- 复杂逻辑注释：说明实现思路
- API 接口注释：说明接口用途和参数

---

## 🚀 部署说明

### 11.1 开发环境

- 使用 `npm run dev:mp-weixin` 启动开发
- 配置开发环境后端地址

### 11.2 生产环境

- 使用 `npm run build:mp-weixin` 构建生产版本
- 配置生产环境后端地址
- 上传到微信小程序后台
- 对接后端部署服务器（Node.js + NestJS 服务端），确保 API 域名通过微信小程序备案
- 服务器部署方案：Docker 容器化部署 + 自动化 CI/CD（GitHub Actions），提供 HTTPS 证书与域名解析
- 数据库与对象存储部署到云端（如 TencentDB、COS），开启自动备份

### 11.3 环境配置

- 开发环境：`utils/config.js` 中配置 `development`
- 生产环境：`utils/config.js` 中配置 `production`
- 服务器环境：配置 `SERVER_API_BASE`、`CDN_BASE_URL`、`WEBSOCKET_URL` 等运行参数

---

## 📚 相关文档

### 12.1 技术文档

- [情侣绑定设计文档](./COUPLE_BINDING_DESIGN.md)
- [问答功能快速开始](./QNA_QUICK_START.md)
- [问答API集成指南](./QNA_API_INTEGRATION_GUIDE.md)
- [问答调试指南](./QNA_DEBUGGING_GUIDE.md)
- [轨迹API需求文档](./trajectory_api_requirements.md)
- [后端API对接文档](../BACKEND_API.md)

### 12.2 开发文档

- [登录功能说明](../LOGIN_README.md)
- [快速联调指南](../快速联调指南.md)
- [联调测试清单](../联调测试清单.md)

---

## 🔄 版本历史

### v1.2 (2025-12-16)

- 虚拟人功能模块细化和完善
- 新增后台管理系统模块
- 调整部分接口路径和功能描述

### v1.1 (2025-11-12)

- 新增心形墙导出图片功能需求
- 完善未来信箱字体选择与定时发送能力
- 更新恋爱轨迹实时位置展示形式
- 新增即时分享与虚拟人功能模块
- 调整 UI 设计规范（彩色图标、中文字体统一）
- 补充后端服务器部署要求

### v1.0 (2025-11-11)

- 初始版本
- 完成核心功能模块设计
- 完成API接口设计
- 完成页面结构设计

---

## 📞 联系方式

如有问题或建议，请联系开发团队。

---

**文档维护者**：开发团队  
**最后更新**：2025-12-16

