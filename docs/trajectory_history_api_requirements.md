# åŽ†å²è½¨è¿¹æŸ¥è¯¢åŠŸèƒ½ - åŽç«¯æŽ¥å£éœ€æ±‚

## ðŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜Žäº†åŽ†å²è½¨è¿¹æŸ¥è¯¢åŠŸèƒ½æ‰€éœ€çš„åŽç«¯æŽ¥å£ã€‚å‰ç«¯å·²å®žçŽ°æ—¶é—´åŒºé—´é€‰æ‹©å™¨ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸï¼ŒæŸ¥è¯¢è¯¥æ—¶é—´åŒºé—´å†…çš„è½¨è¿¹ç‚¹ï¼Œå¹¶åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºå’Œè¿žçº¿ã€‚

---

## ðŸ”Œ å¿…é¡»å®žçŽ°çš„æŽ¥å£

### 1. **èŽ·å–åŽ†å²è½¨è¿¹ç‚¹åˆ—è¡¨ï¼ˆæ”¯æŒè‡ªå®šä¹‰æ—¶é—´åŒºé—´ï¼‰**

#### æŽ¥å£ä¿¡æ¯
- **è¯·æ±‚æ–¹æ³•**: `GET`
- **è¯·æ±‚åœ°å€**: `/api/trajectory/points`
- **è¯·æ±‚å¤´**: éœ€æºå¸¦ `Authorization: Bearer {token}`

#### è¯·æ±‚å‚æ•°ï¼ˆQueryå‚æ•°ï¼‰

æ”¯æŒä¸¤ç§æŸ¥è¯¢æ–¹å¼ï¼š

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ period å‚æ•°ï¼ˆå·²æ”¯æŒï¼‰**
```
period=7d          // æ—¶é—´èŒƒå›´ï¼š'7d'ï¼ˆ7å¤©ï¼‰æˆ– '30d'ï¼ˆ30å¤©ï¼‰
page=1             // é¡µç ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼‰
limit=50           // æ¯é¡µæ•°é‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤50ï¼‰
```

**æ–¹å¼äºŒï¼šä½¿ç”¨è‡ªå®šä¹‰æ—¶é—´åŒºé—´ï¼ˆæ–°å¢žï¼Œå¿…é¡»å®žçŽ°ï¼‰**
```
start_date=2024-01-01    // å¼€å§‹æ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
end_date=2024-01-31      // ç»“æŸæ—¥æœŸï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
page=1                   // é¡µç ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼‰
limit=1000               // æ¯é¡µæ•°é‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤50ï¼Œå»ºè®®æ”¯æŒæœ€å¤§1000ï¼‰
```

**å‚æ•°è¯´æ˜Ž**ï¼š
- `start_date` å’Œ `end_date` å¿…é¡»åŒæ—¶æä¾›ï¼Œæˆ–éƒ½ä¸æä¾›
- å¦‚æžœæä¾›äº† `start_date` å’Œ `end_date`ï¼Œåˆ™å¿½ç•¥ `period` å‚æ•°
- `start_date` å¿…é¡»å°äºŽç­‰äºŽ `end_date`
- æ—¥æœŸæ ¼å¼å¿…é¡»ä¸º `YYYY-MM-DD`ï¼ˆä¾‹å¦‚ï¼š`2024-01-01`ï¼‰
- æŸ¥è¯¢èŒƒå›´åº”åŒ…å«å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸå½“å¤©çš„æ‰€æœ‰è½¨è¿¹ç‚¹ï¼ˆæ—¶é—´èŒƒå›´ï¼šstart_date 00:00:00 è‡³ end_date 23:59:59ï¼‰

#### è¿”å›žæ•°æ®æ ¼å¼

```json
{
  "success": true,
  "data": {
    "points": [
      {
        "id": 123,
        "user_id": 1,
        "latitude": 39.9042,
        "longitude": 116.4074,
        "address": "åŒ—äº¬å¸‚æœé˜³åŒºxxxè¡—é“",
        "location_name": "åˆé‡å’–å•¡åŽ…",
        "visit_time": "2024-01-15T10:30:00.000Z",  // ISOæ—¶é—´æ ¼å¼ï¼Œå¿…å¡«
        "stay_duration": 120,                      // åœç•™æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ï¼Œå¯é€‰
        "importance_score": 9.5,                  // é‡è¦æ€§è¯„åˆ†ï¼ˆ0-10ï¼‰ï¼Œå¯é€‰
        "visit_count": 1,                          // åˆ°è®¿æ¬¡æ•°ï¼Œå¯é€‰
        "is_manual": false,                        // æ˜¯å¦æ‰‹åŠ¨æ·»åŠ ï¼Œå¯é€‰
        "description": "ç¬¬ä¸€æ¬¡è§é¢çš„åœ°æ–¹",          // æè¿°ï¼Œå¯é€‰
        "photos": [                                // ç…§ç‰‡åˆ—è¡¨ï¼Œå¯é€‰
          "/path/to/photo1.jpg"
        ]
      }
    ],
    "summary": {
      "total_points": 50,                          // æ€»è½¨è¿¹ç‚¹æ•°
      "total_distance": 125.5,                    // æ€»è¡Œç¨‹ï¼ˆå…¬é‡Œï¼‰ï¼ŒæŒ‰æ—¶é—´é¡ºåºè®¡ç®—è½¨è¿¹ç‚¹ä¹‹é—´çš„è·ç¦»æ€»å’Œ
      "most_visited": {                            // æœ€å¸¸åŽ»çš„åœ°ç‚¹ï¼Œå¯é€‰
        "location_name": "åˆé‡å’–å•¡åŽ…",
        "visit_count": 5
      }
    }
  }
}
```

#### æ•°æ®å­—æ®µè¯´æ˜Ž

**è½¨è¿¹ç‚¹å¯¹è±¡ï¼ˆpointsæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼‰**ï¼š
- `id` (number, å¿…å¡«): è½¨è¿¹ç‚¹ID
- `user_id` (number, å¿…å¡«): ç”¨æˆ·ID
- `latitude` (number, å¿…å¡«): çº¬åº¦
- `longitude` (number, å¿…å¡«): ç»åº¦
- `address` (string, å¯é€‰): è¯¦ç»†åœ°å€
- `location_name` (string, å¯é€‰): åœ°ç‚¹åç§°
- `visit_time` (string, å¿…å¡«): è®¿é—®æ—¶é—´ï¼ŒISO 8601æ ¼å¼ï¼ˆä¾‹å¦‚ï¼š`2024-01-15T10:30:00.000Z`ï¼‰
- `stay_duration` (number, å¯é€‰): åœç•™æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
- `importance_score` (number, å¯é€‰): é‡è¦æ€§è¯„åˆ†ï¼ˆ0-10ï¼‰
- `visit_count` (number, å¯é€‰): åˆ°è®¿æ¬¡æ•°
- `is_manual` (boolean, å¯é€‰): æ˜¯å¦æ‰‹åŠ¨æ·»åŠ 
- `description` (string, å¯é€‰): æè¿°ä¿¡æ¯
- `photos` (string[], å¯é€‰): ç…§ç‰‡URLåˆ—è¡¨

**ç»Ÿè®¡ä¿¡æ¯ï¼ˆsummaryå¯¹è±¡ï¼‰**ï¼š
- `total_points` (number, å¿…å¡«): æ€»è½¨è¿¹ç‚¹æ•°
- `total_distance` (number, å¿…å¡«): æ€»è¡Œç¨‹ï¼ˆå…¬é‡Œï¼‰ï¼Œè®¡ç®—æ–¹æ³•ï¼š
  - æŒ‰ `visit_time` æŽ’åºæ‰€æœ‰è½¨è¿¹ç‚¹
  - è®¡ç®—ç›¸é‚»è½¨è¿¹ç‚¹ä¹‹é—´çš„è·ç¦»ï¼ˆä½¿ç”¨Haversineå…¬å¼ï¼‰
  - ç´¯åŠ æ‰€æœ‰è·ç¦»å¾—åˆ°æ€»è¡Œç¨‹
- `most_visited` (object, å¯é€‰): æœ€å¸¸åŽ»çš„åœ°ç‚¹
  - `location_name` (string): åœ°ç‚¹åç§°
  - `visit_count` (number): åˆ°è®¿æ¬¡æ•°

#### æŸ¥è¯¢é€»è¾‘è¦æ±‚

1. **æ—¶é—´åŒºé—´æŸ¥è¯¢**ï¼š
   - æŸ¥è¯¢ `visit_time` åœ¨ `[start_date 00:00:00, end_date 23:59:59]` èŒƒå›´å†…çš„è½¨è¿¹ç‚¹
   - å¿…é¡»åŒ…å«å¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸå½“å¤©çš„æ‰€æœ‰è½¨è¿¹ç‚¹

2. **æ•°æ®èŒƒå›´**ï¼š
   - åªè¿”å›žå½“å‰ç”¨æˆ·åŠå…¶é…å¯¹ç”¨æˆ·çš„è½¨è¿¹ç‚¹ï¼ˆåŒæ–¹è½¨è¿¹ç‚¹ï¼‰
   - å¦‚æžœç”¨æˆ·æœªç»‘å®šé…å¯¹å…³ç³»ï¼Œåªè¿”å›žå½“å‰ç”¨æˆ·çš„è½¨è¿¹ç‚¹

3. **æŽ’åº**ï¼š
   - è½¨è¿¹ç‚¹æŒ‰ `visit_time` å‡åºæŽ’åºï¼ˆæ—¶é—´ä»Žæ—©åˆ°æ™šï¼‰
   - å‰ç«¯ä¼šæ ¹æ®è¿™ä¸ªé¡ºåºè¿žæŽ¥è½¨è¿¹çº¿

4. **åˆ†é¡µ**ï¼š
   - æ”¯æŒåˆ†é¡µæŸ¥è¯¢ï¼Œä½†å»ºè®®å‰ç«¯ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®ï¼ˆlimit=1000ï¼‰ä»¥ä¾¿å®Œæ•´æ˜¾ç¤ºè½¨è¿¹çº¿
   - å¦‚æžœæ•°æ®é‡å¾ˆå¤§ï¼Œå¯ä»¥è€ƒè™‘åŽç«¯åˆ†é¡µï¼Œä½†å‰ç«¯éœ€è¦å¤„ç†å¤šé¡µæ•°æ®åˆå¹¶

5. **æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š
   - å¦‚æžœæ—¶é—´åŒºé—´å¾ˆå¤§ï¼ˆå¦‚è¶…è¿‡1å¹´ï¼‰ï¼Œå»ºè®®é™åˆ¶æŸ¥è¯¢èŒƒå›´æˆ–æé†’ç”¨æˆ·ç¼©å°æ—¶é—´åŒºé—´
   - å¯ä»¥è€ƒè™‘å¯¹è½¨è¿¹ç‚¹è¿›è¡ŒåŽ»é‡æˆ–èšåˆï¼ˆç›¸åŒåœ°ç‚¹å¤šæ¬¡è®¿é—®ï¼Œåªè¿”å›žé‡è¦çš„ä¸€æ¬¡ï¼‰

#### é”™è¯¯å¤„ç†

**å‚æ•°é”™è¯¯**ï¼š
```json
{
  "success": false,
  "message": "å¼€å§‹æ—¥æœŸä¸èƒ½æ™šäºŽç»“æŸæ—¥æœŸ",
  "code": "INVALID_PARAMS"
}
```

**æ—¶é—´åŒºé—´è¿‡å¤§**ï¼š
```json
{
  "success": false,
  "message": "æŸ¥è¯¢æ—¶é—´åŒºé—´ä¸èƒ½è¶…è¿‡365å¤©",
  "code": "DATE_RANGE_TOO_LARGE"
}
```

**æ— æ•°æ®**ï¼š
```json
{
  "success": true,
  "data": {
    "points": [],
    "summary": {
      "total_points": 0,
      "total_distance": 0
    }
  }
}
```

---

## ðŸ“Š æ•°æ®æ¨¡åž‹å»ºè®®

### è½¨è¿¹ç‚¹è¡¨ç»“æž„ï¼ˆtrajectory_pointsï¼‰

```sql
CREATE TABLE trajectory_points (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  latitude DECIMAL(10, 8) NOT NULL,
  longitude DECIMAL(11, 8) NOT NULL,
  address VARCHAR(255),
  location_name VARCHAR(100),
  visit_time DATETIME NOT NULL,           -- è®¿é—®æ—¶é—´
  stay_duration INT,                      -- åœç•™æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  importance_score DECIMAL(3, 1),         -- é‡è¦æ€§è¯„åˆ†ï¼ˆ0-10ï¼‰
  visit_count INT DEFAULT 1,             -- åˆ°è®¿æ¬¡æ•°
  is_manual BOOLEAN DEFAULT FALSE,        -- æ˜¯å¦æ‰‹åŠ¨æ·»åŠ 
  description TEXT,                       -- æè¿°
  photos JSON,                            -- ç…§ç‰‡åˆ—è¡¨ï¼ˆJSONæ•°ç»„ï¼‰
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_user_visit_time (user_id, visit_time),
  INDEX idx_visit_time (visit_time)
);
```

### æŸ¥è¯¢SQLç¤ºä¾‹

```sql
-- æŸ¥è¯¢æŒ‡å®šæ—¶é—´åŒºé—´å†…çš„è½¨è¿¹ç‚¹
SELECT 
  id,
  user_id,
  latitude,
  longitude,
  address,
  location_name,
  visit_time,
  stay_duration,
  importance_score,
  visit_count,
  is_manual,
  description,
  photos
FROM trajectory_points
WHERE 
  user_id IN (?, ?)  -- å½“å‰ç”¨æˆ·IDå’Œé…å¯¹ç”¨æˆ·ID
  AND visit_time >= ?  -- start_date 00:00:00
  AND visit_time <= ?  -- end_date 23:59:59
ORDER BY visit_time ASC
LIMIT ? OFFSET ?;
```

---

## ðŸŽ¯ å®žçŽ°ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®žçŽ°ï¼‰
1. âœ… æ”¯æŒ `start_date` å’Œ `end_date` å‚æ•°
2. âœ… è¿”å›žè½¨è¿¹ç‚¹åˆ—è¡¨ï¼ŒåŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
3. âœ… æŒ‰ `visit_time` æŽ’åº
4. âœ… è¿”å›ž `summary.total_points` å’Œ `summary.total_distance`

### ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®å®žçŽ°ï¼‰
1. âš ï¸ è¿”å›ž `summary.most_visited`ï¼ˆæœ€å¸¸åŽ»çš„åœ°ç‚¹ï¼‰
2. âš ï¸ æ”¯æŒåˆ†é¡µæŸ¥è¯¢ï¼ˆå¤„ç†å¤§æ•°æ®é‡ï¼‰
3. âš ï¸ æ—¶é—´åŒºé—´èŒƒå›´é™åˆ¶å’ŒéªŒè¯

### ä½Žä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰
1. ðŸ“ è½¨è¿¹ç‚¹åŽ»é‡æˆ–èšåˆ
2. ðŸ“ æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€ç´¢å¼•ç­‰ï¼‰

---

## ðŸ” æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•ç”¨ä¾‹1ï¼šæ­£å¸¸æŸ¥è¯¢
```
GET /api/trajectory/points?start_date=2024-01-01&end_date=2024-01-31&limit=1000
```
**é¢„æœŸç»“æžœ**ï¼šè¿”å›ž2024å¹´1æœˆ1æ—¥è‡³31æ—¥ä¹‹é—´çš„æ‰€æœ‰è½¨è¿¹ç‚¹

### æµ‹è¯•ç”¨ä¾‹2ï¼šå•æ—¥æŸ¥è¯¢
```
GET /api/trajectory/points?start_date=2024-01-15&end_date=2024-01-15&limit=1000
```
**é¢„æœŸç»“æžœ**ï¼šè¿”å›ž2024å¹´1æœˆ15æ—¥å½“å¤©çš„æ‰€æœ‰è½¨è¿¹ç‚¹

### æµ‹è¯•ç”¨ä¾‹3ï¼šå‚æ•°é”™è¯¯
```
GET /api/trajectory/points?start_date=2024-01-31&end_date=2024-01-01&limit=1000
```
**é¢„æœŸç»“æžœ**ï¼šè¿”å›žé”™è¯¯ï¼š"å¼€å§‹æ—¥æœŸä¸èƒ½æ™šäºŽç»“æŸæ—¥æœŸ"

### æµ‹è¯•ç”¨ä¾‹4ï¼šæ— æ•°æ®
```
GET /api/trajectory/points?start_date=2020-01-01&end_date=2020-01-31&limit=1000
```
**é¢„æœŸç»“æžœ**ï¼šè¿”å›žç©ºæ•°ç»„ï¼Œ`total_points: 0`

---

## ðŸ“ æ³¨æ„äº‹é¡¹

1. **æ—¶åŒºå¤„ç†**ï¼šç¡®ä¿ `visit_time` çš„æ—¶åŒºå¤„ç†æ­£ç¡®ï¼Œå»ºè®®ç»Ÿä¸€ä½¿ç”¨UTCæ—¶é—´å­˜å‚¨ï¼Œå‰ç«¯æ ¹æ®æ—¶åŒºè½¬æ¢æ˜¾ç¤º

2. **æ•°æ®å®Œæ•´æ€§**ï¼šç¡®ä¿è¿”å›žçš„è½¨è¿¹ç‚¹æ•°æ®åŒ…å«å‰ç«¯æ‰€éœ€çš„æ‰€æœ‰å­—æ®µï¼Œé¿å…å‰ç«¯æŠ¥é”™

3. **æ€§èƒ½è€ƒè™‘**ï¼š
   - å¦‚æžœæ—¶é—´åŒºé—´å¾ˆå¤§ï¼Œå»ºè®®é™åˆ¶æŸ¥è¯¢èŒƒå›´ï¼ˆå¦‚æœ€å¤š365å¤©ï¼‰
   - ä¸º `user_id` å’Œ `visit_time` å­—æ®µå»ºç«‹ç´¢å¼•ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½

4. **å…¼å®¹æ€§**ï¼šä¿æŒå¯¹ `period` å‚æ•°çš„æ”¯æŒï¼ˆå‘åŽå…¼å®¹ï¼‰ï¼ŒåŒæ—¶æ”¯æŒæ–°çš„ `start_date`/`end_date` å‚æ•°

5. **è·ç¦»è®¡ç®—**ï¼š`total_distance` çš„è®¡ç®—éœ€è¦ä½¿ç”¨Haversineå…¬å¼è®¡ç®—ç›¸é‚»è½¨è¿¹ç‚¹ä¹‹é—´çš„åœ°ç†è·ç¦»

---

## âœ… å‰ç«¯å·²å®žçŽ°åŠŸèƒ½

- âœ… æ—¶é—´åŒºé—´é€‰æ‹©å™¨ï¼ˆå¼€å§‹æ—¥æœŸã€ç»“æŸæ—¥æœŸï¼‰
- âœ… æŸ¥è¯¢æŒ‰é’®å’ŒåŠ è½½çŠ¶æ€
- âœ… åŽ†å²è½¨è¿¹ç‚¹åœ°å›¾æ˜¾ç¤º
- âœ… è½¨è¿¹ç‚¹æŒ‰æ—¶é—´é¡ºåºè¿žçº¿
- âœ… ç‚¹å‡»è½¨è¿¹ç‚¹æŸ¥çœ‹è¯¦æƒ…
- âœ… æ¸…é™¤åŽ†å²è½¨è¿¹åŠŸèƒ½
- âœ… ç»Ÿè®¡ä¿¡æ¯å±•ç¤ºï¼ˆæ€»è½¨è¿¹ç‚¹æ•°ã€æ€»è¡Œç¨‹ï¼‰

---

## ðŸ“ž è”ç³»

å¦‚æœ‰é—®é¢˜æˆ–éœ€è¦æ¾„æ¸…ï¼Œè¯·å‚è€ƒå‰ç«¯ä»£ç ï¼š
- APIè°ƒç”¨ï¼š`api/trajectory.js` ä¸­çš„ `getTrajectoryPoints` å‡½æ•°
- é¡µé¢å®žçŽ°ï¼š`pages/trajectory/index.vue`

