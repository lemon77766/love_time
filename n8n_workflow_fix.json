{
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 8
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -960,
        -144
      ],
      "id": "55367099-97ac-4441-a3c9-3b07c0040b00",
      "name": "ä¸Šåˆå…«ç‚¹å‡†æ—¶å¯åŠ¨1"
    },
    {
      "parameters": {
        "url": "https://apis.netstart.cn/maoyan/index/comingList?ci=1&limit=10",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -704,
        -176
      ],
      "id": "72907ac3-ee8a-49c5-98ff-4d91523f44a2",
      "name": "è°ƒç”¨çŒ«çœ¼å¾…æ˜ ç”µå½± API1"
    },
    {
      "parameters": {
        "jsCode": "// ä» HTTP èŠ‚ç‚¹è·å– API å“åº”\nconst apiResponse = $node[\"è°ƒç”¨çŒ«çœ¼å¾…æ˜ ç”µå½± API1\"].json;\nconst comingMovies = apiResponse.coming || [];\n\n// å¤„ç†ç”µå½±æ•°æ®\nconst processedMovies = comingMovies.slice(0, 10).map((movie, index) => {\n  if (!movie) return null;\n  \n  return {\n    åºå·: index + 1,\n    ç”µå½±ID: movie.id,\n    ç”µå½±åç§°: movie.nm || \"æœªçŸ¥åç§°\",\n    æ¼”å‘˜åˆ—è¡¨: movie.star || \"æœªçŸ¥æ¼”å‘˜\",\n    ä¸Šæ˜ æ—¥æœŸ: movie.rt ? movie.rt.replace('ä¸Šæ˜ ', '').trim() : \"æœªçŸ¥æ—¥æœŸ\",\n    ç”µå½±æµ·æŠ¥: movie.img || \"\",\n    æƒ³çœ‹äººæ•°: movie.wish || 0,\n    è¯„åˆ†: movie.sc || \"æš‚æ— è¯„åˆ†\",\n    åœºæ¬¡ä¿¡æ¯: movie.showInfo || \"å³å°†ä¸Šæ˜ \",\n    æ˜¯å¦é¢„å”®: movie.preShow ? \"æ˜¯\" : \"å¦\",\n    æ˜¯å¦å…¨çƒä¸Šæ˜ : movie.globalReleased ? \"æ˜¯\" : \"å¦\",\n    åŒæ­¥æ—¶é—´: new Date().toISOString()\n  };\n}).filter(movie => movie !== null);\n\nconst currentDate = new Date().toLocaleDateString('zh-CN');\nlet markdownText = `## ğŸ¬ æ¯æ—¥å½±è§†èµ„è®¯åŒæ­¥ (${currentDate})  \\n`;\nmarkdownText += `### å³å°†ä¸Šæ˜  Top ${processedMovies.length} éƒ¨å½±ç‰‡  \\n\\n`;\n\nprocessedMovies.forEach(movie => {\n  markdownText += `---  \\n`;\n  \n  if (movie.ç”µå½±æµ·æŠ¥ && movie.ç”µå½±æµ·æŠ¥.startsWith('http')) {\n    markdownText += `![${movie.ç”µå½±åç§°}](${movie.ç”µå½±æµ·æŠ¥})  \\n\\n`;\n  }\n  \n  markdownText += `**${movie.åºå·}. ${movie.ç”µå½±åç§°}**  \\n`;\n  markdownText += `ğŸ“… **ä¸Šæ˜ æ—¥æœŸ**: ${movie.ä¸Šæ˜ æ—¥æœŸ}  \\n`;\n  markdownText += `â¤ï¸ **æƒ³çœ‹äººæ•°**: ${movie.æƒ³çœ‹äººæ•°} äºº  \\n`;\n  markdownText += `ğŸ­ **ä¸»æ¼”**: ${movie.æ¼”å‘˜åˆ—è¡¨}  \\n`;\n  markdownText += `â­ **è¯„åˆ†**: ${movie.è¯„åˆ†}  \\n`;\n  markdownText += `ğŸ« **åœºæ¬¡ä¿¡æ¯**: ${movie.åœºæ¬¡ä¿¡æ¯}  \\n`;\n  markdownText += `ğŸ’° **æ˜¯å¦é¢„å”®**: ${movie.æ˜¯å¦é¢„å”®}  \\n`;\n  markdownText += `ğŸŒ **æ˜¯å¦å…¨çƒä¸Šæ˜ **: ${movie.æ˜¯å¦å…¨çƒä¸Šæ˜ }  \\n\\n`;\n});\n\n// è¿”å›ä¸¤ä¸ªè¾“å‡ºï¼šé’‰é’‰æ¶ˆæ¯å’Œé£ä¹¦è®°å½•\nreturn [\n  {\n    json: {\n      msgtype: \"markdown\",\n      markdown: {\n        title: `ä»Šæ—¥ç”µå½±èµ„è®¯ - ${currentDate}`,\n        text: markdownText\n      }\n    }\n  },\n  {\n    json: {\n      records: processedMovies.map(movie => ({\n        fields: {\n          \"ç”µå½±ID\": movie.ç”µå½±ID.toString(),\n          \"ç”µå½±åç§°\": movie.ç”µå½±åç§°,\n          \"æ¼”å‘˜åˆ—è¡¨\": movie.æ¼”å‘˜åˆ—è¡¨,\n          \"ä¸Šæ˜ æ—¥æœŸ\": movie.ä¸Šæ˜ æ—¥æœŸ,\n          \"ç”µå½±æµ·æŠ¥\": movie.ç”µå½±æµ·æŠ¥,\n          \"æƒ³çœ‹äººæ•°\": Number(movie.æƒ³çœ‹äººæ•°) || 0,\n          \"è¯„åˆ†\": movie.è¯„åˆ† === \"æš‚æ— è¯„åˆ†\" ? 0 : Number(movie.è¯„åˆ†),\n          \"åœºæ¬¡ä¿¡æ¯\": movie.åœºæ¬¡ä¿¡æ¯,\n          \"æ˜¯å¦é¢„å”®\": movie.æ˜¯å¦é¢„å”®,\n          \"æ˜¯å¦å…¨çƒä¸Šæ˜ \": movie.æ˜¯å¦å…¨çƒä¸Šæ˜ ,\n          \"åŒæ­¥æ—¶é—´\": new Date().toISOString(),\n          \"æ•°æ®çŠ¶æ€\": \"æ­£å¸¸\"\n        }\n      }))\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -432,
        -144
      ],
      "id": "bc2dec3a-f959-441b-9dc2-c311d61fbcab",
      "name": "å¤„ç†ç”µå½±æ•°æ®1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://oapi.dingtalk.com/robot/send?access_token=2eb3286b3c6631e384759f8e0d1be049f150634b4db8e0f0a2517ba9370d8cfb",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        80,
        -224
      ],
      "id": "53214b3e-4ea7-4782-8576-6a1d80728783",
      "name": "æ¨é€é’‰é’‰ç¾¤1"
    },
    {
      "parameters": {
        "jsCode": "// ä¿®å¤ç‰ˆä»£ç  - ç›´æ¥ä»ä¸Šæ¸¸èŠ‚ç‚¹è·å–ç¬¬äºŒä¸ªè¾“å‡ºï¼ˆé£ä¹¦è®°å½•ï¼‰\n// ç”±äºä¸Šæ¸¸èŠ‚ç‚¹è¿”å›ä¸¤ä¸ªè¾“å‡ºï¼Œè¿™é‡Œåº”è¯¥æ¥æ”¶ç¬¬äºŒä¸ªè¾“å‡ºï¼ˆç´¢å¼•1ï¼‰\nconst inputData = $input.item.json;\n\n// æ£€æŸ¥æ˜¯å¦æœ‰ records å­—æ®µ\nif (!inputData.records || !Array.isArray(inputData.records)) {\n  console.error('æœªæ‰¾åˆ° records æ•°æ®:', JSON.stringify(inputData, null, 2));\n  return [];\n}\n\nconsole.log('æ‰¾åˆ°çš„ç”µå½±è®°å½•æ•°:', inputData.records.length);\n\n// å¤„ç†æ¯æ¡è®°å½•ï¼Œé€‚é…é£ä¹¦å¤šç»´è¡¨æ ¼æ ¼å¼\nconst processedRecords = inputData.records.map(record => {\n  if (!record.fields) {\n    console.warn('è®°å½•ç¼ºå°‘ fields å­—æ®µ:', record);\n    return null;\n  }\n  \n  const fields = record.fields;\n  \n  // æ—¥æœŸæ ¼å¼å¤„ç†ï¼ˆé£ä¹¦éœ€è¦ç‰¹å®šæ ¼å¼ï¼‰\n  const processDate = (dateStr) => {\n    if (!dateStr) return '';\n    // å¦‚æœæ˜¯ISOæ ¼å¼æ—¥æœŸï¼Œç›´æ¥ä½¿ç”¨\n    if (dateStr.includes('T') && dateStr.includes('Z')) {\n      return dateStr;\n    }\n    // å¦‚æœæ˜¯ä¸­æ–‡æ—¥æœŸï¼Œè½¬æ¢ä¸ºISOæ ¼å¼\n    if (dateStr.includes('å¹´') && dateStr.includes('æœˆ')) {\n      const date = new Date(dateStr.replace('å¹´', '-').replace('æœˆ', '-').replace('æ—¥', ''));\n      return isNaN(date.getTime()) ? dateStr : date.toISOString();\n    }\n    return dateStr;\n  };\n  \n  return {\n    fields: {\n      \"ç”µå½±ID\": fields[\"ç”µå½±ID\"] || fields.ç”µå½±ID || \"\",\n      \"ç”µå½±åç§°\": fields[\"ç”µå½±åç§°\"] || fields.ç”µå½±åç§° || \"æœªçŸ¥\",\n      \"æ¼”å‘˜åˆ—è¡¨\": fields[\"æ¼”å‘˜åˆ—è¡¨\"] || fields.æ¼”å‘˜åˆ—è¡¨ || \"\",\n      \"ä¸Šæ˜ æ—¥æœŸ\": processDate(fields[\"ä¸Šæ˜ æ—¥æœŸ\"] || fields.ä¸Šæ˜ æ—¥æœŸ),\n      \"ç”µå½±æµ·æŠ¥\": fields[\"ç”µå½±æµ·æŠ¥\"] || fields.ç”µå½±æµ·æŠ¥ || \"\",\n      \"æƒ³çœ‹äººæ•°\": Number(fields[\"æƒ³çœ‹äººæ•°\"] || fields.æƒ³çœ‹äººæ•° || 0),\n      \"è¯„åˆ†\": fields[\"è¯„åˆ†\"] === \"æš‚æ— è¯„åˆ†\" ? 0 : Number(fields[\"è¯„åˆ†\"] || fields.è¯„åˆ† || 0),\n      \"åœºæ¬¡ä¿¡æ¯\": fields[\"åœºæ¬¡ä¿¡æ¯\"] || fields.åœºæ¬¡ä¿¡æ¯ || \"\",\n      \"æ˜¯å¦é¢„å”®\": fields[\"æ˜¯å¦é¢„å”®\"] || fields.æ˜¯å¦é¢„å”® || \"å¦\",\n      \"æ˜¯å¦å…¨çƒä¸Šæ˜ \": fields[\"æ˜¯å¦å…¨çƒä¸Šæ˜ \"] || fields.æ˜¯å¦å…¨çƒä¸Šæ˜  || \"å¦\",\n      \"åŒæ­¥æ—¶é—´\": fields[\"åŒæ­¥æ—¶é—´\"] || fields.åŒæ­¥æ—¶é—´ || new Date().toISOString(),\n      \"æ•°æ®çŠ¶æ€\": fields[\"æ•°æ®çŠ¶æ€\"] || fields.æ•°æ®çŠ¶æ€ || \"æ­£å¸¸\"\n    }\n  };\n}).filter(record => record !== null);\n\nconsole.log('å¤„ç†åçš„è®°å½•æ•°:', processedRecords.length);\n\nreturn [{\n  json: {\n    records: processedRecords\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -160,
        80
      ],
      "id": "0f436c8c-873e-4b29-8057-a21e1c835a17",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:batchAdd",
        "app_toke": "Sj4kbyfftaiDdUs4Ca4ckPmLnED",
        "table_id": "tbluPG2jWkfjVvOp",
        "body": "={{ $json }}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        224,
        80
      ],
      "id": "1586de1c-2914-4f7b-898a-a1e83a972a70",
      "name": "Bitable:table:record:batchAdd bitable",
      "credentials": {
        "feishuCredentialsApi": {
          "id": "fxJYOpL42JGKLOhD",
          "name": "Feishu Credentials account"
        }
      }
    }
  ],
  "connections": {
    "ä¸Šåˆå…«ç‚¹å‡†æ—¶å¯åŠ¨1": {
      "main": [
        [
          {
            "node": "è°ƒç”¨çŒ«çœ¼å¾…æ˜ ç”µå½± API1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è°ƒç”¨çŒ«çœ¼å¾…æ˜ ç”µå½± API1": {
      "main": [
        [
          {
            "node": "å¤„ç†ç”µå½±æ•°æ®1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†ç”µå½±æ•°æ®1": {
      "main": [
        [
          {
            "node": "æ¨é€é’‰é’‰ç¾¤1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Bitable:table:record:batchAdd bitable",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "329b25563c265af2ab13efe2d83d0d17f819ce4eda22f183e747b9f4e8f006be"
  }
}


