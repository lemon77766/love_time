# 微信小程序登录功能使用说明

## 📋 功能概述

本项目已成功集成微信小程序登录功能，用户在进入小程序时必须先完成微信授权登录。

## ✅ 已实现功能

### 1. 登录页面 (`pages/login/index.vue`)
- ✨ 精美的粉色系登录界面
- 📱 微信授权登录（获取用户头像和昵称）
- 💾 登录状态本地持久化
- 🎨 登录成功动画效果
- ⚡ 快速进入应用

### 2. 全局登录检查 (`App.vue`)
- 🔒 应用启动时自动检查登录状态
- 🚀 未登录自动跳转登录页
- 📝 白名单机制（登录页不需要验证）

### 3. 登录工具函数 (`utils/auth.js`)
- `isLoggedIn()` - 检查是否已登录
- `getUserInfo()` - 获取当前用户信息
- `saveLoginInfo(userInfo)` - 保存登录信息
- `logout()` - 退出登录
- `goToLogin()` - 跳转到登录页
- `checkLogin()` - 检查登录并跳转

### 4. 退出登录功能
- 首页右上角退出按钮
- 退出确认对话框
- 退出后自动跳转登录页

## 🚀 使用方法

### 运行项目

```bash
# 启动微信小程序开发
npm run dev:mp-weixin
```

### 测试流程

1. **首次启动**
   - 打开微信开发者工具
   - 导入项目
   - 点击"预览"或"真机调试"

2. **登录测试**
   - 小程序启动后会自动显示登录页
   - 点击"微信授权登录"按钮
   - 允许授权获取头像和昵称
   - 登录成功后自动进入首页

3. **退出测试**
   - 在首页点击右上角"退出"按钮
   - 确认退出
   - 自动跳转回登录页

4. **再次进入**
   - 关闭小程序后重新打开
   - 如果已登录，直接进入首页
   - 如果未登录，显示登录页

## 📂 文件结构

```
love_time/
├── pages/
│   ├── login/
│   │   └── index.vue          # 登录页面
│   ├── index/
│   │   └── index.vue          # 首页（已添加退出功能）
│   └── ...
├── utils/
│   └── auth.js                # 登录工具函数
├── App.vue                    # 全局配置（已添加登录检查）
└── pages.json                 # 路由配置（登录页为首页）
```

## 💾 数据存储

登录信息存储在本地 Storage 中：

```javascript
// 存储结构
{
  isLoggedIn: true,              // 是否已登录
  userInfo: {                    // 用户信息
    nickName: "用户昵称",
    avatarUrl: "头像URL"
  },
  loginTime: "2025-10-24T..."   // 登录时间
}
```

## 🔧 在其他页面使用

如果你想在其他页面添加登录检查，可以这样做：

```javascript
// 在页面的 script 中引入工具函数
import { checkLogin, getUserInfo, logout } from '@/utils/auth.js';

export default {
  onLoad() {
    // 检查登录状态，未登录则跳转
    if (!checkLogin()) {
      return;
    }
    
    // 获取用户信息
    const userInfo = getUserInfo();
    console.log('当前用户：', userInfo);
  },
  
  methods: {
    handleLogout() {
      logout();
      uni.reLaunch({
        url: '/pages/login/index'
      });
    }
  }
}
```

## 🎯 下一步优化建议

1. **对接后端 API**
   - 将用户信息发送到服务器
   - 使用 JWT Token 管理会话
   - 实现 Token 自动刷新

2. **增强功能**
   - 添加手机号绑定
   - 实现用户资料编辑
   - 添加用户设置页面

3. **安全优化**
   - 加密存储敏感信息
   - 添加登录过期检查
   - 实现多设备登录管理

## ⚠️ 注意事项

1. **微信小程序配置**
   - 确保在微信公众平台配置了小程序信息
   - 检查 `manifest.json` 中的 AppID 是否正确
   - 用户信息获取需要用户主动授权

2. **开发调试**
   - 微信开发者工具需要开启"不校验合法域名"
   - 真机调试需要配置服务器域名白名单

3. **隐私政策**
   - 上线前需要完善用户协议和隐私政策
   - 需要在小程序管理后台配置隐私协议

## 📞 技术支持

如有问题，请检查：
1. 微信开发者工具版本是否最新
2. uni-app 版本是否兼容
3. 控制台是否有错误信息

---

**开发完成时间**: 2025-10-24  
**适用平台**: 微信小程序 + H5  
**技术栈**: Vue3 + uni-app + Vite
