# 甜蜜问答和一百件事后端接口文档

## 📋 文档信息

- **文档版本**：v1.0
- **创建日期**：2025-01-XX
- **适用模块**：甜蜜问答、一百件事挑战
- **基础URL**：`http://your-backend-domain.com/api`

---

## 🔐 认证说明

所有接口（除登录接口外）都需要在请求头中携带认证信息：

```
Authorization: Bearer {token}
```

其中 `token` 为登录接口返回的 JWT token。

---

## 📝 统一响应格式

所有接口返回统一格式：

### 成功响应
```json
{
  "success": true,
  "message": "操作成功",
  "data": {} | [] | null
}
```

### 失败响应
```json
{
  "success": false,
  "message": "错误信息",
  "errorCode": "ERROR_CODE",  // 可选
  "data": null
}
```

### HTTP 状态码
- `200` - 请求成功
- `400` - 请求参数错误
- `401` - 未授权（token过期或无效）
- `404` - 资源不存在
- `500` - 服务器内部错误

---

## 💕 一、甜蜜问答模块接口

### 1.1 获取问题列表

**接口地址**：`GET /api/qna/questions`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**：无

**响应示例**：
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "questions": [
      {
        "id": 1,
        "questionText": "我们第一次约会的地点是哪里？",
        "category": "preset",
        "isDefault": true,
        "orderIndex": 1,
        "isActive": true
      },
      {
        "id": 101,
        "questionText": "你最喜欢我做的哪道菜？",
        "category": "custom",
        "isDefault": false,
        "orderIndex": 999,
        "isActive": true,
        "createdBy": "user_12345",
        "createdAt": "2025-01-15T10:30:00Z"
      }
    ],
    "totalCount": 2
  }
}
```

**字段说明**：
- `id`：问题ID（数字，必填）
- `questionText`：问题文本（字符串，必填）
- `category`：问题分类，`preset` 表示预设问题，`custom` 表示自定义问题（字符串，必填）
- `isDefault`：是否为预设问题（布尔值，必填）
- `orderIndex`：排序索引，预设问题按此排序（数字，可选，默认999）
- `isActive`：是否启用（布尔值，可选，默认true）
- `createdBy`：创建者用户ID（字符串，自定义问题必填）
- `createdAt`：创建时间（ISO 8601格式，自定义问题必填）

**注意事项**：
- 返回的问题列表应包含预设问题和当前用户的自定义问题
- 预设问题按 `orderIndex` 升序排列
- 自定义问题按创建时间倒序排列
- 只返回 `isActive` 为 `true` 的问题

---

### 1.2 提交答案

**接口地址**：`POST /api/qna/answer/submit`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**：
```json
{
  "questionId": 1,
  "answer": "我的答案是...",
  "questionText": "我们第一次约会的地点是哪里？"
}
```

**字段说明**：
- `questionId`：问题ID（数字，必填）
- `answer`：我的答案（字符串，必填，最大长度1000）
- `questionText`：问题文本（字符串，可选，用于记录）

**响应示例**：
```json
{
  "success": true,
  "message": "提交成功",
  "data": {
    "answerId": 1001,
    "questionId": 1,
    "myAnswer": "我的答案是...",
    "partnerAnswer": "对方的答案是...",
    "hasPartnerAnswered": true,
    "createdAt": "2025-01-15T10:30:00Z"
  }
}
```

**字段说明**：
- `answerId`：答案记录ID（数字，必填）
- `questionId`：问题ID（数字，必填）
- `myAnswer`：我的答案（字符串，必填）
- `partnerAnswer`：对方的答案（字符串，如果对方已回答则返回，否则为空字符串）
- `hasPartnerAnswered`：对方是否已回答（布尔值，必填）
- `createdAt`：创建时间（ISO 8601格式，必填）

**业务逻辑**：
1. 验证问题是否存在且有效
2. 检查用户是否已经回答过该问题（如果已回答，返回错误）
3. 保存用户的答案
4. 检查对方是否已回答该问题
5. 如果对方已回答，返回对方答案；否则返回空字符串
6. 返回提交结果

**错误情况**：
- 问题不存在：返回 `404` 状态码，`message: "问题不存在"`
- 问题已回答：返回 `400` 状态码，`message: "该问题已经回答过了"`
- 答案为空：返回 `400` 状态码，`message: "答案不能为空"`

---

### 1.3 获取历史记录

**接口地址**：`GET /api/qna/history`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**（Query参数）：
- `page`：页码（数字，可选，默认1）
- `pageSize`：每页数量（数字，可选，默认20，最大100）

**请求示例**：
```
GET /api/qna/history?page=1&pageSize=20
```

**响应示例**：
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "total": 50,
    "page": 1,
    "pageSize": 20,
    "list": [
      {
        "id": 1001,
        "answerId": 1001,
        "questionId": 1,
        "question": "我们第一次约会的地点是哪里？",
        "questionText": "我们第一次约会的地点是哪里？",
        "myAnswer": "我的答案是...",
        "partnerAnswer": "对方的答案是...",
        "questionCategory": "preset",
        "createdAt": "2025-01-15T10:30:00Z",
        "answeredAt": "2025-01-15T10:30:00Z",
        "updatedAt": "2025-01-15T10:30:00Z"
      }
    ]
  }
}
```

**字段说明**：
- `total`：总记录数（数字，必填）
- `page`：当前页码（数字，必填）
- `pageSize`：每页数量（数字，必填）
- `list`：答案记录列表（数组，必填）
  - `id`：记录ID（数字，必填）
  - `answerId`：答案ID（数字，必填）
  - `questionId`：问题ID（数字，必填）
  - `question`：问题文本（字符串，必填）
  - `questionText`：问题文本（字符串，兼容字段）
  - `myAnswer`：我的答案（字符串，必填）
  - `partnerAnswer`：对方的答案（字符串，如果对方已回答则返回，否则为空字符串）
  - `questionCategory`：问题分类（字符串，可选）
  - `createdAt`：创建时间（ISO 8601格式，必填）
  - `answeredAt`：回答时间（ISO 8601格式，必填）
  - `updatedAt`：更新时间（ISO 8601格式，必填）

**业务逻辑**：
1. 只返回当前用户已回答的问题记录
2. 按回答时间倒序排列（最新的在前）
3. 如果对方已回答，返回对方答案；否则返回空字符串
4. 支持分页查询

---

### 1.4 获取对方答案

**接口地址**：`GET /api/qna/partner`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**（Query参数）：
- `questionId`：问题ID（数字，必填）

**请求示例**：
```
GET /api/qna/partner?questionId=1
```

**响应示例**：
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "hasAnswered": true,
    "answer": "对方的答案是...",
    "answeredAt": "2025-01-15T10:30:00Z"
  }
}
```

**字段说明**：
- `hasAnswered`：对方是否已回答（布尔值，必填）
- `answer`：对方的答案（字符串，如果对方已回答则返回，否则为空字符串）
- `answeredAt`：对方回答时间（ISO 8601格式，如果对方已回答则返回，否则为null）

**业务逻辑**：
1. 验证问题是否存在
2. 检查用户是否已绑定情侣关系（未绑定返回错误）
3. 查询对方是否已回答该问题
4. 如果已回答，返回答案和回答时间；否则返回 `hasAnswered: false`

**错误情况**：
- 问题不存在：返回 `404` 状态码，`message: "问题不存在"`
- 未绑定关系：返回 `400` 状态码，`message: "未绑定情侣关系"`

---

### 1.5 添加自定义问题

**接口地址**：`POST /api/qna/question/add`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**：
```json
{
  "text": "你最喜欢我做的哪道菜？"
}
```

**字段说明**：
- `text`：问题文本（字符串，必填，最大长度100）

**响应示例**：
```json
{
  "success": true,
  "message": "添加成功",
  "data": {
    "id": 101,
    "text": "你最喜欢我做的哪道菜？",
    "questionText": "你最喜欢我做的哪道菜？",
    "category": "custom",
    "isDefault": false,
    "isActive": true,
    "orderIndex": 999,
    "userId": "user_12345",
    "createdBy": "user_12345",
    "createdAt": "2025-01-15T10:30:00Z"
  }
}
```

**字段说明**：
- `id`：新问题的ID（数字，必填）
- `text`：问题文本（字符串，必填）
- `questionText`：问题文本（字符串，兼容字段）
- `category`：问题分类，固定为 `custom`（字符串，必填）
- `isDefault`：是否为预设问题，固定为 `false`（布尔值，必填）
- `isActive`：是否启用，固定为 `true`（布尔值，必填）
- `orderIndex`：排序索引，固定为 `999`（数字，必填）
- `userId`：创建者用户ID（字符串，必填）
- `createdBy`：创建者用户ID（字符串，兼容字段）
- `createdAt`：创建时间（ISO 8601格式，必填）

**业务逻辑**：
1. 验证问题文本不为空且长度不超过100
2. 检查用户是否已绑定情侣关系（未绑定返回错误）
3. 创建自定义问题记录
4. 返回新创建的问题信息

**错误情况**：
- 问题文本为空：返回 `400` 状态码，`message: "问题文本不能为空"`
- 问题文本过长：返回 `400` 状态码，`message: "问题文本不能超过100个字符"`
- 未绑定关系：返回 `400` 状态码，`message: "未绑定情侣关系"`

---

### 1.6 删除自定义问题

**接口地址**：`POST /api/qna/question/delete` 或 `DELETE /api/qna/question/delete`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**：
```json
{
  "questionId": 101
}
```

**字段说明**：
- `questionId`：问题ID（数字，必填）

**响应示例**：
```json
{
  "success": true,
  "message": "删除成功"
}
```

**业务逻辑**：
1. 验证问题是否存在
2. 验证问题是否为自定义问题（预设问题不能删除）
3. 验证问题是否为当前用户创建（只能删除自己创建的问题）
4. 检查是否有用户已回答该问题（如果有，可以选择软删除或返回错误）
5. 删除问题记录（建议软删除，设置 `isActive: false`）

**错误情况**：
- 问题不存在：返回 `404` 状态码，`message: "问题不存在"`
- 预设问题不能删除：返回 `400` 状态码，`message: "预设问题不能删除"`
- 无权删除：返回 `403` 状态码，`message: "无权删除该问题"`
- 问题已被回答：返回 `400` 状态码，`message: "该问题已被回答，不能删除"`（可选，根据业务需求决定）

---

## 🎯 二、一百件事挑战模块接口

### 2.1 获取任务列表

**接口地址**：`GET /api/challenge/tasks`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**：无

**响应示例**：
```json
{
  "success": true,
  "message": "获取成功",
  "tasks": [
    {
      "id": 1,
      "taskName": "一起看日出",
      "taskDescription": "在清晨一起看日出，记录美好时刻",
      "taskIndex": 1,
      "category": "preset",
      "iconUrl": "https://example.com/icons/sunrise.png",
      "status": "completed",
      "photoUrl": "https://example.com/photos/task1.jpg",
      "note": "今天早上一起看了日出，很美！",
      "isFavorited": true,
      "completedAt": "2025-01-15T10:30:00Z",
      "userRecord": {
        "status": "completed",
        "photoUrl": "https://example.com/photos/task1.jpg",
        "note": "今天早上一起看了日出，很美！",
        "isFavorited": true,
        "completedAt": "2025-01-15T10:30:00Z"
      }
    },
    {
      "id": 101,
      "taskName": "一起做一顿大餐",
      "taskDescription": "",
      "taskIndex": null,
      "category": "custom",
      "iconUrl": null,
      "status": "pending",
      "photoUrl": null,
      "note": null,
      "isFavorited": false,
      "completedAt": null,
      "userRecord": null
    }
  ]
}
```

**字段说明**：
- `id`：任务ID（数字，必填）
- `taskName`：任务名称（字符串，必填）
- `taskDescription`：任务描述（字符串，可选）
- `taskIndex`：任务序号，预设任务有序号，自定义任务为null（数字，可选）
- `category`：任务分类，`preset` 表示预设任务，`custom` 表示自定义任务（字符串，必填）
- `iconUrl`：任务图标URL（字符串，可选）
- `status`：任务状态，`pending` 表示待完成，`completed` 表示已完成（字符串，必填）
- `photoUrl`：完成照片URL（字符串，可选）
- `note`：完成备注（字符串，可选）
- `isFavorited`：是否收藏（布尔值，必填）
- `completedAt`：完成时间（ISO 8601格式，可选）
- `userRecord`：用户完成记录（对象，可选）
  - `status`：完成状态（字符串，必填）
  - `photoUrl`：完成照片URL（字符串，可选）
  - `note`：完成备注（字符串，可选）
  - `isFavorited`：是否收藏（布尔值，必填）
  - `completedAt`：完成时间（ISO 8601格式，可选）

**业务逻辑**：
1. 返回所有预设任务和当前用户的自定义任务
2. 预设任务按 `taskIndex` 升序排列
3. 自定义任务按创建时间倒序排列
4. 合并用户完成记录到任务对象中（如果用户有完成记录）
5. 如果用户没有完成记录，`status` 默认为 `pending`，`userRecord` 为 `null`

---

### 2.2 获取用户进度

**接口地址**：`GET /api/challenge/progress`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**：无

**响应示例**：
```json
{
  "success": true,
  "message": "获取成功",
  "progress": {
    "totalTasks": 100,
    "completedCount": 25,
    "favoritedCount": 10,
    "completionRate": 25.0,
    "lastActiveAt": "2025-01-15T10:30:00Z"
  }
}
```

**字段说明**：
- `totalTasks`：总任务数（数字，必填）
- `completedCount`：已完成数量（数字，必填）
- `favoritedCount`：已收藏数量（数字，必填）
- `completionRate`：完成率，百分比（数字，必填，保留1位小数）
- `lastActiveAt`：最后活跃时间，即最后完成或收藏任务的时间（ISO 8601格式，可选）

**业务逻辑**：
1. 统计所有任务（预设任务 + 自定义任务）
2. 统计已完成任务数量
3. 统计已收藏任务数量
4. 计算完成率：`(completedCount / totalTasks) * 100`
5. 获取最后活跃时间（最后完成或收藏任务的时间）

---

### 2.3 添加自定义任务

**接口地址**：`POST /api/challenge/task/add`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**：
```json
{
  "taskName": "一起做一顿大餐",
  "taskDescription": "一起下厨做一顿丰盛的晚餐"
}
```

**字段说明**：
- `taskName`：任务名称（字符串，必填，最大长度50）
- `taskDescription`：任务描述（字符串，可选，最大长度200）

**响应示例**：
```json
{
  "success": true,
  "message": "添加成功",
  "task": {
    "id": 101,
    "taskName": "一起做一顿大餐",
    "taskDescription": "一起下厨做一顿丰盛的晚餐",
    "taskIndex": null,
    "category": "custom",
    "iconUrl": null,
    "status": "pending",
    "photoUrl": null,
    "note": null,
    "isFavorited": false,
    "completedAt": null,
    "createdBy": "user_12345",
    "createdAt": "2025-01-15T10:30:00Z"
  }
}
```

**字段说明**：
- `id`：新任务的ID（数字，必填）
- `taskName`：任务名称（字符串，必填）
- `taskDescription`：任务描述（字符串，可选）
- `taskIndex`：任务序号，自定义任务为null（数字，可选）
- `category`：任务分类，固定为 `custom`（字符串，必填）
- `iconUrl`：任务图标URL，自定义任务为null（字符串，可选）
- `status`：任务状态，新建任务固定为 `pending`（字符串，必填）
- `photoUrl`：完成照片URL，新建任务为null（字符串，可选）
- `note`：完成备注，新建任务为null（字符串，可选）
- `isFavorited`：是否收藏，新建任务固定为 `false`（布尔值，必填）
- `completedAt`：完成时间，新建任务为null（ISO 8601格式，可选）
- `createdBy`：创建者用户ID（字符串，必填）
- `createdAt`：创建时间（ISO 8601格式，必填）

**业务逻辑**：
1. 验证任务名称不为空且长度不超过50
2. 验证任务描述长度不超过200（如果提供）
3. 检查用户是否已绑定情侣关系（未绑定返回错误）
4. 创建自定义任务记录
5. 返回新创建的任务信息

**错误情况**：
- 任务名称为空：返回 `400` 状态码，`message: "任务名称不能为空"`
- 任务名称过长：返回 `400` 状态码，`message: "任务名称不能超过50个字符"`
- 任务描述过长：返回 `400` 状态码，`message: "任务描述不能超过200个字符"`
- 未绑定关系：返回 `400` 状态码，`message: "未绑定情侣关系"`

---

### 2.4 删除任务

**接口地址**：`POST /api/challenge/task/delete`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**：
```json
{
  "taskId": 101
}
```

**字段说明**：
- `taskId`：任务ID（数字，必填）

**响应示例**：
```json
{
  "success": true,
  "message": "删除成功"
}
```

**业务逻辑**：
1. 验证任务是否存在
2. 验证任务是否为自定义任务（预设任务不能删除）
3. 验证任务是否为当前用户创建（只能删除自己创建的任务）
4. 删除任务记录（建议软删除，设置 `isActive: false` 或直接删除）

**错误情况**：
- 任务不存在：返回 `404` 状态码，`message: "任务不存在"`
- 预设任务不能删除：返回 `400` 状态码，`message: "预设任务不能删除"`
- 无权删除：返回 `403` 状态码，`message: "无权删除该任务"`

---

### 2.5 标记任务完成/取消完成

**接口地址**：`POST /api/challenge/complete`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**：
```json
{
  "taskId": 1,
  "completed": true,
  "photoUrl": "https://example.com/photos/task1.jpg",
  "note": "今天早上一起看了日出，很美！"
}
```

**字段说明**：
- `taskId`：任务ID（数字，必填）
- `completed`：是否完成（布尔值，必填）
- `photoUrl`：完成照片URL（字符串，可选，仅在 `completed` 为 `true` 时有效）
- `note`：完成备注（字符串，可选，仅在 `completed` 为 `true` 时有效，最大长度500）

**响应示例**：
```json
{
  "success": true,
  "message": "操作成功",
  "data": {
    "taskId": 1,
    "status": "completed",
    "photoUrl": "https://example.com/photos/task1.jpg",
    "note": "今天早上一起看了日出，很美！",
    "completedAt": "2025-01-15T10:30:00Z"
  }
}
```

**字段说明**：
- `taskId`：任务ID（数字，必填）
- `status`：任务状态，`pending` 或 `completed`（字符串，必填）
- `photoUrl`：完成照片URL（字符串，可选）
- `note`：完成备注（字符串，可选）
- `completedAt`：完成时间（ISO 8601格式，如果 `completed` 为 `true` 则返回，否则为null）

**业务逻辑**：
1. 验证任务是否存在
2. 如果 `completed` 为 `true`：
   - 创建或更新用户完成记录
   - 保存照片URL和备注（如果提供）
   - 设置完成时间为当前时间
3. 如果 `completed` 为 `false`：
   - 删除或清空用户完成记录
   - 清空照片URL和备注
   - 设置完成时间为null
4. 返回操作结果

**错误情况**：
- 任务不存在：返回 `404` 状态码，`message: "任务不存在"`
- 备注过长：返回 `400` 状态码，`message: "备注不能超过500个字符"`

---

### 2.6 上传任务完成照片

**接口地址**：`POST /api/challenge/upload`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: multipart/form-data
```

**请求参数**（Form Data）：
- `file`：照片文件（文件，必填）
  - 支持格式：jpg、jpeg、png
  - 最大大小：10MB

**响应示例**：
```json
{
  "success": true,
  "message": "照片上传成功",
  "photoUrl": "https://example.com/challenge/photos/2025/01/15/xxx.jpg"
}
```

**字段说明**：
- `photoUrl`：上传后的照片URL（字符串，必填）

**业务逻辑**：
1. 验证文件格式和大小
2. 上传文件到对象存储（如腾讯云COS、阿里云OSS等）
3. 生成可访问的URL
4. 返回照片URL

**错误情况**：
- 文件格式不支持：返回 `400` 状态码，`message: "不支持的文件格式，仅支持 jpg、jpeg、png"`
- 文件过大：返回 `400` 状态码，`message: "文件大小不能超过10MB"`
- 上传失败：返回 `500` 状态码，`message: "照片上传失败"`

**注意事项**：
- 建议对上传的照片进行压缩处理，减少存储空间
- 建议生成缩略图，提高加载速度
- 建议设置照片访问权限，仅允许授权用户访问

---

### 2.7 收藏/取消收藏任务

**接口地址**：`POST /api/challenge/favorite`

**请求头**：
```
Authorization: Bearer {token}
Content-Type: application/json
```

**请求参数**：
```json
{
  "taskId": 1,
  "favorited": true
}
```

**字段说明**：
- `taskId`：任务ID（数字，必填）
- `favorited`：是否收藏（布尔值，必填）

**响应示例**：
```json
{
  "success": true,
  "message": "操作成功",
  "data": {
    "taskId": 1,
    "isFavorited": true
  }
}
```

**字段说明**：
- `taskId`：任务ID（数字，必填）
- `isFavorited`：是否收藏（布尔值，必填）

**业务逻辑**：
1. 验证任务是否存在
2. 如果 `favorited` 为 `true`：
   - 创建或更新用户收藏记录
3. 如果 `favorited` 为 `false`：
   - 删除用户收藏记录
4. 返回操作结果

**错误情况**：
- 任务不存在：返回 `404` 状态码，`message: "任务不存在"`

---

## 📊 数据库设计建议

### 甜蜜问答模块

#### 问题表（qna_questions）
```sql
CREATE TABLE qna_questions (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  question_text VARCHAR(200) NOT NULL COMMENT '问题文本',
  category VARCHAR(20) NOT NULL COMMENT '问题分类：preset/custom',
  is_default BOOLEAN NOT NULL DEFAULT FALSE COMMENT '是否为预设问题',
  order_index INT DEFAULT 999 COMMENT '排序索引',
  is_active BOOLEAN NOT NULL DEFAULT TRUE COMMENT '是否启用',
  created_by VARCHAR(50) COMMENT '创建者用户ID（自定义问题）',
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_category (category),
  INDEX idx_created_by (created_by)
);
```

#### 答案表（qna_answers）
```sql
CREATE TABLE qna_answers (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  question_id BIGINT NOT NULL COMMENT '问题ID',
  user_id VARCHAR(50) NOT NULL COMMENT '用户ID',
  answer TEXT NOT NULL COMMENT '答案内容',
  question_text VARCHAR(200) COMMENT '问题文本（冗余字段）',
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY uk_question_user (question_id, user_id),
  INDEX idx_user_id (user_id),
  INDEX idx_question_id (question_id),
  INDEX idx_created_at (created_at)
);
```

### 一百件事挑战模块

#### 任务表（challenge_tasks）
```sql
CREATE TABLE challenge_tasks (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  task_name VARCHAR(100) NOT NULL COMMENT '任务名称',
  task_description VARCHAR(500) COMMENT '任务描述',
  task_index INT COMMENT '任务序号（预设任务）',
  category VARCHAR(20) NOT NULL COMMENT '任务分类：preset/custom',
  icon_url VARCHAR(500) COMMENT '任务图标URL',
  created_by VARCHAR(50) COMMENT '创建者用户ID（自定义任务）',
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  is_active BOOLEAN NOT NULL DEFAULT TRUE COMMENT '是否启用',
  INDEX idx_category (category),
  INDEX idx_created_by (created_by)
);
```

#### 任务完成记录表（challenge_user_records）
```sql
CREATE TABLE challenge_user_records (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  task_id BIGINT NOT NULL COMMENT '任务ID',
  user_id VARCHAR(50) NOT NULL COMMENT '用户ID',
  status VARCHAR(20) NOT NULL DEFAULT 'pending' COMMENT '完成状态：pending/completed',
  photo_url VARCHAR(500) COMMENT '完成照片URL',
  note TEXT COMMENT '完成备注',
  is_favorited BOOLEAN NOT NULL DEFAULT FALSE COMMENT '是否收藏',
  completed_at DATETIME COMMENT '完成时间',
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  UNIQUE KEY uk_task_user (task_id, user_id),
  INDEX idx_user_id (user_id),
  INDEX idx_task_id (task_id),
  INDEX idx_status (status),
  INDEX idx_completed_at (completed_at)
);
```

---

## 🔄 业务逻辑说明

### 甜蜜问答模块

1. **问题管理**：
   - 预设问题由系统管理员创建，用户不能修改或删除
   - 用户只能创建、查看和删除自己的自定义问题
   - 自定义问题在用户解绑关系后仍然保留（或根据业务需求决定是否删除）

2. **答案提交**：
   - 每个问题每个用户只能回答一次
   - 提交答案后，如果对方已回答，立即返回对方答案
   - 如果对方未回答，返回空字符串，前端显示"对方暂未作答"

3. **历史记录**：
   - 只显示当前用户已回答的问题
   - 按回答时间倒序排列
   - 支持分页查询

4. **对方答案**：
   - 只有绑定情侣关系的用户才能查看对方答案
   - 如果对方未回答，返回 `hasAnswered: false`

### 一百件事挑战模块

1. **任务管理**：
   - 预设任务由系统管理员创建，用户不能修改或删除
   - 用户只能创建、查看和删除自己的自定义任务
   - 自定义任务在用户解绑关系后仍然保留（或根据业务需求决定是否删除）

2. **任务完成**：
   - 每个任务每个用户可以多次完成/取消完成（根据业务需求）
   - 完成时可以上传照片和添加备注
   - 取消完成时清空照片和备注

3. **照片上传**：
   - 支持 jpg、jpeg、png 格式
   - 最大文件大小 10MB
   - 建议压缩和生成缩略图

4. **收藏功能**：
   - 用户可以收藏/取消收藏任意任务（包括预设任务和自定义任务）
   - 收藏状态独立于完成状态

5. **进度统计**：
   - 总任务数 = 预设任务数 + 自定义任务数
   - 完成率 = (已完成任务数 / 总任务数) * 100
   - 最后活跃时间 = 最后完成或收藏任务的时间

---

## 🧪 测试建议

### 单元测试

1. **甜蜜问答模块**：
   - 测试问题列表获取
   - 测试答案提交（包括对方已回答和未回答的情况）
   - 测试历史记录查询（包括分页）
   - 测试自定义问题的添加和删除
   - 测试对方答案获取

2. **一百件事挑战模块**：
   - 测试任务列表获取
   - 测试任务完成/取消完成
   - 测试照片上传（包括格式验证和大小限制）
   - 测试收藏/取消收藏
   - 测试进度统计
   - 测试自定义任务的添加和删除

### 集成测试

1. **情侣关系验证**：
   - 测试未绑定关系时的接口调用（应返回错误）
   - 测试绑定关系后的正常流程

2. **权限验证**：
   - 测试只能删除自己创建的自定义问题/任务
   - 测试预设问题/任务不能删除

3. **数据一致性**：
   - 测试答案提交后历史记录的正确性
   - 测试任务完成状态的一致性

---

## 📞 联系方式

如有问题或建议，请联系开发团队。

---

**文档维护者**：开发团队  
**最后更新**：2025-01-XX



